(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();const St={simple:[["C","G","Am","F"],["C","Em","F","G"],["Am","F","C","G"],["C","Am","Dm","G"],["C","F","G","C"]],town_peaceful:[["C","F","C","G"],["C","G","Em","Am"],["F","G","Em","Am"],["C","F","Am","G"],["C","G","F","C"]],heroic_fanfare:[["C","Am","F","G"],["C","G","Am","Em"],["F","C","G","Am"],["C","Dm","G","C"],["Am","F","G","C"]],playful:[["C","F","G","Am"],["C","Em","Am","F"],["F","G","C","Am"],["C","G","F","Em"],["Am","G","F","C"]]},Rt={castle_majestic:[["Em","C","G","D"],["Em","B7","Em","C"],["C","G","D","Em"],["Em","C","D","G"],["Em","Em","C","D"]],dark:[["Em","D","C","B7"],["Em","C","Am","B7"],["Em","Bm","C","G"],["Em","C","D","Bm"],["Em","G","F","B7"]],ending_sorrowful:[["Em","C","G","D"],["Em","Bm","C","G"],["Em","D","C","B7"],["Em","G","D","C"],["Em","C","Am","B7"]],final_battle_tense:[["Em","C","D","B7"],["Em","G","D","Em"],["C","D","Em","Em"],["Em","Bm","C","D"],["G","D","Em","C"]],mysterious:[["Em","Am","F","C"],["Am","Em","G","C"],["Em","F","G","Em"],["Dm","Am","G","C"],["Em","C","Am","Bm"]],epic_adventure:[["Em","C","G","D"],["G","Em","C","D"],["C","G","Am","Em"],["Em","D","C","G"],["Am","Em","G","D"]]},xt={heroic:[["G","C","D","G"],["G","Em","C","D"],["C","D","G","G"],["G","B7","Em","C"],["Em","C","G","D"]],overworld_bright:[["G","D","Em","C"],["C","G","D","G"],["G","Em","Am","D"],["G","C","D","G"],["G","B7","Em","C"]],triumph:[["G","D","C","G"],["C","D","G","Em"],["G","C","Am","D"],["Em","C","D","G"],["G","D","Em","D"]],adventure:[["G","Em","C","D"],["Am","D","G","C"],["G","C","D","Em"],["C","Am","G","D"],["G","D","C","Am"]]},Pt={C_Major:St,E_Minor:Rt,G_Major:xt},tt=Pt,Bt={slow:90,medium:120,fast:150},Et={upbeat:["overworld_bright","heroic"],sad:["ending_sorrowful","dark"],tense:["final_battle_tense","castle_majestic"],peaceful:["town_peaceful","simple"]},Tt={upbeat:"G_Major",sad:"E_Minor",tense:"E_Minor",peaceful:"C_Major"},W=Object.keys(tt),It={G_Major:[0,2,4,5,7,9,11],E_Minor:[0,2,3,5,7,8,10],C_Major:[0,2,4,5,7,9,11]},Ke=[[{id:"Intro",measures:1},{id:"A",measures:3},{id:"B",measures:2},{id:"A",measures:2}],[{id:"A",measures:2},{id:"B",measures:2},{id:"A",measures:2},{id:"C",measures:2}],[{id:"Intro",measures:2},{id:"A",measures:2},{id:"Bridge",measures:2},{id:"A",measures:2}],[{id:"A",measures:4},{id:"B",measures:2},{id:"C",measures:2}]],Ht={tense:[0,3],upbeat:[1,2],sad:[2,3],peaceful:[1,2]},Oe={16:{upbeat:[{id:"A",measures:8},{id:"B",measures:8}],peaceful:[{id:"A",measures:8},{id:"B",measures:8}],tense:[{id:"A",measures:8},{id:"B",measures:8}],sad:[{id:"A",measures:8},{id:"B",measures:8}]},32:{upbeat:[{id:"A",measures:8},{id:"B",measures:8},{id:"C",measures:8},{id:"D",measures:8}],peaceful:[{id:"A",measures:16},{id:"B",measures:16}],tense:[{id:"A",measures:8},{id:"B",measures:8},{id:"A",measures:8},{id:"C",measures:8}],sad:[{id:"Intro",measures:4},{id:"A",measures:12},{id:"B",measures:8},{id:"A",measures:8}]},64:{upbeat:[{id:"A",measures:16},{id:"B",measures:16},{id:"C",measures:16},{id:"D",measures:16}],peaceful:[{id:"A",measures:16},{id:"B",measures:16},{id:"A",measures:16},{id:"C",measures:16}],tense:[{id:"Intro",measures:8},{id:"A",measures:16},{id:"B",measures:16},{id:"C",measures:12},{id:"A",measures:12}],sad:[{id:"Intro",measures:8},{id:"A",measures:20},{id:"B",measures:16},{id:"A",measures:20}]}},at=new Set(["A"]),ge="steady",Kt=1,Ot={textureFocus:!1,loopCentric:!1,gradualBuild:!1,harmonicStatic:!1,percussiveLayering:!1,breakInsertion:!1,filterMotion:!1,syncopationBias:!1,atmosPad:!1},nt={minimalTechno:{textureFocus:!0,loopCentric:!0,harmonicStatic:!0,percussiveLayering:!0,filterMotion:!0,syncopationBias:!0},progressiveHouse:{textureFocus:!0,loopCentric:!0,gradualBuild:!0,percussiveLayering:!0,breakInsertion:!0,filterMotion:!0,atmosPad:!0},retroLoopwave:{textureFocus:!0,loopCentric:!0,percussiveLayering:!0,filterMotion:!0,syncopationBias:!0},breakbeatJungle:{textureFocus:!0,percussiveLayering:!0,breakInsertion:!0,filterMotion:!0,syncopationBias:!0},lofiChillhop:{loopCentric:!0,harmonicStatic:!0,atmosPad:!0,textureFocus:!0}};function At(){return{...Ot}}function Ae(a,e){if(!e)return a;const t={...a};for(const n of Object.keys(a))e[n]!==void 0&&(t[n]=!!e[n]);return t}function kt(a){let e={};if(a.stylePreset){const t=nt[a.stylePreset];t&&(e={...e,...t})}return a.styleOverrides&&(e={...e,...a.styleOverrides}),e}function wt(a,e){let t=At();if(a.stylePreset){const h=nt[a.stylePreset];h&&(t=Ae(t,h))}const n=e.reduce((h,g)=>h+g.measures,0),s=e.reduce((h,g)=>(h.set(g.templateId,(h.get(g.templateId)??0)+1),h),new Map),r=Array.from(s.values()).some(h=>h>=2),o=e.length?n/e.length:n;(r||o<=4)&&(t.loopCentric=!0),a.tempo!=="slow"&&n>=8&&(t.loopCentric=!0,t.percussiveLayering=!0),(a.mood==="tense"||a.mood==="sad")&&(t.textureFocus=!0),a.mood==="peaceful"&&(t.atmosPad=!0),(a.mood==="upbeat"||a.mood==="tense")&&(t.syncopationBias=!0),a.tempo==="fast"&&(t.filterMotion=!0,t.percussiveLayering=!0),n>=12&&(t.gradualBuild=!0);const i=new Set,l=new Set;let u=0;for(const h of e)h.chordProgression.forEach(g=>i.add(g)),l.add(h.chordProgression.join("|")),new Set(h.chordProgression).size<=1&&u++;const d=e.length>0&&u===e.length;l.size<=1&&(i.size<=2||d)&&(t.harmonicStatic=!0),n>=8&&a.tempo!=="slow"&&(t.breakInsertion=!0);const c=t.harmonicStatic;t=Ae(t,a.styleOverrides);const p=a.styleOverrides&&typeof a.styleOverrides.harmonicStatic=="boolean";return!c&&!p&&(t.harmonicStatic=!1),t}function H(a,e){const t=Math.imul(a??0,1664525)+Math.imul(e,1013904223)>>>0;return(Math.imul(t,22695477)+1>>>0)/4294967295}function Ft(a,e,t){const n=tt[a];if(!n)throw new Error(`No chord motifs for key ${a}`);const s=[];for(const o of e)Array.isArray(n[o])&&s.push(...n[o]);const r=s.length?s:Object.values(n).flat();if(!r.length)throw new Error(`No chord progressions available for key ${a}`);return st(r,t,100).map(o=>[...o])}function ke(a,e){const t=a.match(/^([A-G])(#|b)?(.*)$/);if(!t)return a;const[,n,s="",r]=t,o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],i={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},l=n+s,u=i[l];if(u===void 0)return a;const d=(u+e+12)%12;return o[d]+r}function Ct(a){const e=a.match(/^([A-G](?:#|b)?)(m?)(.*)$/);if(!e)return a;const[,t,n,s]=e;return n==="m"?t+s:t+"m"+s}function Dt(a){const e=[];return e.push(ke(a,7)),e.push(ke(a,5)),e.push(Ct(a)),e}function Lt(a,e){const t=3+Math.floor(e()*2),n=Array(t).fill(a);if(e()<.2){const s=Dt(a),r=s[Math.floor(e()*s.length)];n.push(r)}return n}function Gt(a,e,t,n){const s=a.lengthInMeasures;let r;s in Oe?r=Oe[s][a.mood].map(v=>({...v})):r=Zt(a.mood,t);const o=r.reduce((v,y)=>v+y.measures,0);let i=[];if(s===o)i=r;else if(s>o){const v=Math.floor(s/o);for(let x=0;x<v;x++)i=i.concat(r);let y=s-v*o,S=0;for(;y>0;){const x=r[S%r.length],O=Math.min(x.measures,y);i.push({id:x.id,measures:O}),y-=O,S++}}else{let v=0;for(const y of r){if(v+y.measures>s){const S=Math.max(s-v,0);S>0&&i.push({id:y.id,measures:S});break}i.push(y),v+=y.measures}}const l=[];let u=0,d=0;const c=st(e,t,200+d),p=new Map,h=new Set;for(const v of c)v.forEach(y=>h.add(y));const g=(v=>{let y=(v??987654321)>>>0;return y===0&&(y=987654321),()=>(y=y*1664525+1013904223>>>0,y/4294967295)})(t),f=n.harmonicStatic===!0,m=f&&h.size<=1;for(const v of i){let y;if(m&&c.length>0)y=[c[0][0]];else if(f&&c.length>0){const R=c[d%c.length][0];y=Lt(R,g)}else y=c[d%c.length];const S=v.id,x=(p.get(S)??0)+1;p.set(S,x);const O=Vt(S,x,t);l.push({id:`${v.id}${l.filter(R=>R.id.startsWith(v.id)).length+1}`,startMeasure:u,measures:v.measures,chordProgression:y,templateId:S,occurrenceIndex:x,texture:O}),u+=v.measures,m||d++}return l}const Nt={Intro:["broken"],A:["broken","steady","broken"],B:["steady","steady","arpeggio"],Bridge:["arpeggio","steady"],C:["steady","arpeggio","steady"]},qt={Intro:1,A:2,B:2,Bridge:4,C:2},we={firstOccurrence:.7,repeatOccurrence:.4},Ut=.1;function Vt(a,e,t){const n=Nt[a]??[ge],s=n[(e-1)%n.length]??ge;if(s==="arpeggio"){const o=e===1,i=a.split("").reduce((d,c)=>d+c.charCodeAt(0),0),l=H(t,1e3+i*7+e*13),u=o?we.firstOccurrence:we.repeatOccurrence;if(l>u)return n.find(d=>d!=="arpeggio")??ge}const r=a.charCodeAt(0)*100+e;if(H(t,2e3+r)<Ut){const o=["steady","broken","arpeggio"].filter(l=>l!==s),i=Math.floor(H(t,3e3+r)*o.length);return o[i]??s}return s}function zt(a){return qt[a]??Kt}function Wt(a){return zt(a.templateId)}function le(a){return a.occurrenceIndex===1&&at.has(a.templateId)}function A(a){return a.occurrenceIndex>1&&at.has(a.templateId)}function $t(a,e,t){let n,s=50;switch(a){case"tense":n={echoProbability:.5,detuneProbability:.3,fastArpeggioProbability:.4},s=10;break;case"upbeat":n={echoProbability:.4,detuneProbability:.2,fastArpeggioProbability:.2},s=20;break;case"sad":n={echoProbability:.6,detuneProbability:.1,fastArpeggioProbability:.1},s=30;break;case"peaceful":n={echoProbability:.5,detuneProbability:.05,fastArpeggioProbability:.05},s=40;break;default:n={echoProbability:.3,detuneProbability:.3,fastArpeggioProbability:.3};break}const r=Yt(n,e);return jt(r,t,s)}function jt(a,e,t){const n=r=>Math.min(.95,Math.max(.05,r)),s=r=>(H(e,t+r)-.5)*.2;return{echoProbability:n(a.echoProbability+s(1)),detuneProbability:n(a.detuneProbability+s(2)),fastArpeggioProbability:n(a.fastArpeggioProbability+s(3))}}function Yt(a,e){const t={...a};return e.textureFocus&&(t.fastArpeggioProbability=Math.max(.05,t.fastArpeggioProbability*.6),t.echoProbability=Math.min(.95,t.echoProbability+.05)),e.loopCentric&&(t.detuneProbability=Math.max(.05,t.detuneProbability*.8)),e.gradualBuild&&(t.echoProbability=Math.min(.95,t.echoProbability+.1)),e.harmonicStatic&&(t.detuneProbability=Math.max(.05,t.detuneProbability*.7)),e.percussiveLayering&&(t.fastArpeggioProbability=Math.min(.9,t.fastArpeggioProbability+.05)),e.filterMotion&&(t.detuneProbability=Math.min(.9,t.detuneProbability+.1)),e.syncopationBias&&(t.echoProbability=Math.min(.9,t.echoProbability+.05)),e.atmosPad&&(t.echoProbability=Math.min(.95,t.echoProbability+.08)),e.breakInsertion&&(t.fastArpeggioProbability=Math.max(.05,t.fastArpeggioProbability*.9)),t}const Fe={standard:{id:"standard",description:"Classic melody + accompaniment + bass",voices:[{role:"melody",channel:"square1",priority:1,octaveOffset:0},{role:"accompaniment",channel:"square2",priority:1,octaveOffset:0},{role:"bass",channel:"triangle",priority:1,octaveOffset:0}]},swapped:{id:"swapped",description:"Swapped square channels for tonal variety",voices:[{role:"melody",channel:"square2",priority:1,octaveOffset:0},{role:"accompaniment",channel:"square1",priority:1,octaveOffset:0},{role:"bass",channel:"triangle",priority:1,octaveOffset:0}]},dualBass:{id:"dualBass",description:"Melody with dual bass (thick low end)",voices:[{role:"melody",channel:"square1",priority:1,octaveOffset:0},{role:"bass",channel:"square2",priority:1,octaveOffset:0,seedOffset:0},{role:"bassAlt",channel:"triangle",priority:.7,octaveOffset:-1,seedOffset:100}]},bassLed:{id:"bassLed",description:"Bass-focused with sparse melodic decoration",voices:[{role:"bass",channel:"triangle",priority:1,octaveOffset:-1,seedOffset:0},{role:"bassAlt",channel:"square2",priority:.8,octaveOffset:0,seedOffset:200},{role:"melody",channel:"square1",priority:.3,octaveOffset:0}]},layeredBass:{id:"layeredBass",description:"Layered bass with complementary square/triangle movement",voices:[{role:"bass",channel:"square1",priority:1,octaveOffset:0,seedOffset:0},{role:"bassAlt",channel:"triangle",priority:.85,octaveOffset:0,seedOffset:160},{role:"melody",channel:"square2",priority:1,octaveOffset:0}]},minimal:{id:"minimal",description:"Minimal techno: bass + sparse pad only",voices:[{role:"bass",channel:"square1",priority:1,octaveOffset:0},{role:"pad",channel:"triangle",priority:.4,octaveOffset:0}]},breakLayered:{id:"breakLayered",description:"Breakbeat layering: dual bass pressure with agile lead",voices:[{role:"bass",channel:"square1",priority:1,octaveOffset:0,seedOffset:0},{role:"bassAlt",channel:"triangle",priority:.95,octaveOffset:-1,seedOffset:140},{role:"melody",channel:"square2",priority:.85,octaveOffset:0,seedOffset:240}]},lofiPadLead:{id:"lofiPadLead",description:"Lo-fi pad-first texture with gentle lead flourishes",voices:[{role:"pad",channel:"triangle",priority:.9,octaveOffset:-1},{role:"accompaniment",channel:"square2",priority:1,octaveOffset:-1,seedOffset:60},{role:"melody",channel:"square1",priority:.45,octaveOffset:0,seedOffset:180}]},retroPulse:{id:"retroPulse",description:"Retro loopwave pulse arpeggios with anchored bass",voices:[{role:"melody",channel:"square1",priority:1,octaveOffset:0,seedOffset:80},{role:"accompaniment",channel:"square2",priority:.85,octaveOffset:0,seedOffset:140},{role:"bass",channel:"triangle",priority:.9,octaveOffset:-1,seedOffset:40}]}},Jt={minimalTechno:{standard:2,minimal:5,bassLed:3,dualBass:2,swapped:1,layeredBass:1},progressiveHouse:{standard:4,swapped:3,layeredBass:3,dualBass:2,bassLed:1,minimal:0},retroLoopwave:{standard:2,swapped:3,retroPulse:5,layeredBass:1,minimal:0,bassLed:1},breakbeatJungle:{breakLayered:5,dualBass:3,layeredBass:2,bassLed:2,standard:1,swapped:1,minimal:0},lofiChillhop:{lofiPadLead:5,minimal:3,standard:2,swapped:1,bassLed:1,layeredBass:0,dualBass:1}},Ce={standard:5,swapped:4,dualBass:2,bassLed:2,layeredBass:2,minimal:1,breakLayered:1,lofiPadLead:1,retroPulse:2};function Xt(a,e){const t=e?{...Ce,...Jt[e]}:Ce,n=Object.entries(t),s=n.reduce((i,[,l])=>i+l,0),r=H(a,100);let o=0;for(const[i,l]of n)if(o+=l/s,r<o)return Fe[i];return Fe.standard}function Qt(a){const e=Bt[a.tempo],t=Math.round((H(a.seed,1)-.5)*30),n=e+Math.max(-15,Math.min(15,t)),s=Et[a.mood],r=ea(a.mood,a.seed),o=It[r];if(!o)throw new Error(`Scale not defined for key ${r}`);const i=Ft(r,s,a.seed),l=kt(a),u=Gt(a,i,a.seed,l),d=wt(a,u),c=$t(a.mood,d,a.seed);ta(a.lengthInMeasures,u);const p=Xt(a.seed,a.stylePreset);return{bpm:n,key:r,scaleDegrees:o,sections:u,techniqueStrategy:c,styleIntent:d,voiceArrangement:p}}function Zt(a,e){const t=Ht[a]??Ke.map((s,r)=>r),n=t[Math.floor(H(e,60)*t.length)]??0;return Ke[n].map(s=>({...s}))}function st(a,e,t){const n=[...a];for(let s=n.length-1;s>0;s--){const r=Math.floor(H(e,t+s)*(s+1)),o=n[s];n[s]=n[r],n[r]=o}return n}function ea(a,e){const t=Tt[a];if(t&&W.includes(t))return t;if(!W.length)throw new Error("Chord library is empty");const n=Math.floor(H(e,5)*W.length)%W.length;return W[n]}function ta(a,e){const t=e.reduce((n,s)=>n+s.measures,0);if(t!==a)throw new Error(`Section length mismatch. expected=${a}, actual=${t}`)}const aa={K:.25,S:.25,H:.125,O:.375,T:.5,N:.375},na={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},Z={"":[0,4,7],m:[0,3,7],7:[0,4,7,10],m7:[0,3,7,10],maj7:[0,4,7,11],sus2:[0,2,7],sus4:[0,5,7],dim:[0,3,6],aug:[0,4,8]},_=4;function ue(a,e){const t=a.match(/^[A-G](#|b)?/i);if(!t)return e;const n=t[0].toUpperCase(),s=na[n]??0;return e-e%12+s}function Me(a){const e=a.match(/^[A-G](?:#|b)?(.*)$/),t=(e==null?void 0:e[1])??"";return t in Z?Z[t]:t.startsWith("m")?Z.m:Z[""]}function de(a,e,t,n=0){const s=((a-1)%e.length+e.length)%e.length,r=Math.floor((a-1)/e.length)+n,o=e[s]+12*r;return t+o}function rt(a,e,t){const n=[];for(let s=0;s<a.length;s++){const r=a[s];if(r==="-")continue;const o=e+s/16*_;n.push({startBeat:o,durationBeats:aa[r]??.25,instrument:r,sectionId:t})}return n}function I(a,e,t=_){const n=Math.floor(e/t),s=a.sections.find(o=>n>=o.startMeasure&&n<o.startMeasure+o.measures);if(!s){const o=a.sections[0];return(o==null?void 0:o.chordProgression[0])??"C"}const r=Math.max(0,n-s.startMeasure);return s.chordProgression[r%s.chordProgression.length]}function sa(a){return 12*Math.log2(a)}function ra(a){return 440*Math.pow(2,(a-69)/12)}function oa(a){return(a%12+12)%12}function E(a,e){const t=ue(e,a),n=Me(e);let s=a,r=1/0;for(const o of n)for(let i=-2;i<=2;i++){const l=t+o+i*12,u=Math.abs(l-a);u<r&&(s=l,r=u)}return s}const ia=new Set([0,3,4,5,7,8,9]);function J(a,e,t){if(t===void 0)return E(a,e);const n=ue(e,t),s=Me(e);let r=a,o=Number.POSITIVE_INFINITY;for(const i of s)for(let l=-2;l<=2;l++){const u=n+i+l*12,d=oa(u-t),c=ia.has(d)?0:10,p=Math.abs(u-a)*.1,h=Math.abs(u-t)*.05,g=c+p+h;g<o&&(o=g,r=u)}return r}const De={MIN:20,MAX_ACCENT:118},$={TRIANGLE_BASE:.75,TRIANGLE_NON_BASS:.9,BASS_BASE:.7,BASS_LOW_RANGE:.85,SQUARE_BASS:.82},la={BASS_LOW_RANGE:52},Le={broken:74,steady:70,arpeggio:76,default:72},Ge={DOWNBEAT_BOOST:6,STRONG_BEAT_BOOST:3},ua={PICKUP_BASE:72},K={EARLY_START:52,PAD_MIN:48,ARPEGGIO_SCALE:.75,BROKEN_SCALE:.9,STEADY_SCALE:.85},Ne={ECHO_SCALE:.6,DETUNE_SCALE:.7},L={KICK:120,TOM:116,LOW_NOISE:112,SNARE:115,HIHAT:118,OPEN_HAT:114},da=[{id:"RM001",length:4,pattern:[4,4,4,4],tags:["start","straight","loop_safe","loop_safe"],variations:["RM002","RM003"]},{id:"RM002",length:4,pattern:[4,8,8,4,4],tags:["start","straight","loop_safe","kick"],variations:["RM003","RM004"]},{id:"RM003",length:4,pattern:[8,8,8,8,4,4],tags:["start","straight","loop_safe","sfx_long"],variations:["RM004","RM005"]},{id:"RM004",length:4,pattern:[4,8,8,4,4],tags:["start","straight","loop_safe"],variations:["RM005","RM006"]},{id:"RM005",length:4,pattern:[8,8,4,8,8,4],tags:["start","straight","loop_safe"],variations:["RM006","RM007"]},{id:"RM006",length:4,pattern:[8,8,4,8,8,4],tags:["start","syncopation","loop_safe","anacrusis"],variations:["RM007","RM008"]},{id:"RM007",length:4,pattern:[8,16,16,8,16,16,4,4],tags:["start","syncopation","loop_safe","anacrusis"],variations:["RM008","RM027"]},{id:"RM008",length:4,pattern:[4,8,8,4,8,8],tags:["start","syncopation","loop_safe","anacrusis"],variations:["RM027","RM028"]},{id:"RM009",length:4,pattern:[8,8,4,8,8,4],tags:["middle","straight","bridge"],variations:["RM010","RM011"]},{id:"RM010",length:4,pattern:[4,4,8,8,4],tags:["middle","straight","bridge"],variations:["RM011","RM012"]},{id:"RM011",length:4,pattern:[4,4,4,8,8],tags:["middle","straight","bridge"],variations:["RM012","RM013"]},{id:"RM012",length:8,pattern:[8,8,4,4,8,8,4,4,4,4],tags:["middle","syncopation","bridge"],variations:["RM013","RM014"]},{id:"RM013",length:8,pattern:[4,8,8,4,8,8,4,4,4,4],tags:["middle","syncopation","bridge"],variations:["RM014","RM015"]},{id:"RM014",length:8,pattern:[8,8,8,8,4,4,4,4,4,4],tags:["middle","syncopation","bridge"],variations:["RM015","RM016"]},{id:"RM015",length:8,pattern:[4,4,4,4,4,4,4,4],tags:["middle","sustain","open"],variations:["RM016","RM017"]},{id:"RM016",length:8,pattern:[4,8,8,4,4,4,8,8,4,4],tags:["middle","sustain","open"],variations:["RM017","RM018"]},{id:"RM017",length:4,pattern:[8,16,16,8,16,16,8,16,16,4],tags:["middle","swing_hint","bridge"],variations:["RM018","RM029"]},{id:"RM018",length:4,pattern:[8,16,16,4,8,16,16,4],tags:["middle","swing_hint","bridge"],variations:["RM029","RM030"]},{id:"RM019",length:4,pattern:[4,4,4,4],tags:["end","straight","loop_safe"],variations:["RM020","RM021"]},{id:"RM020",length:4,pattern:[8,8,4,8,8,4],tags:["end","straight","loop_safe"],variations:["RM021","RM022"]},{id:"RM021",length:4,pattern:[4,8,8,4,4],tags:["end","straight","loop_safe"],variations:["RM022","RM023"]},{id:"RM022",length:4,pattern:[4,4,4,4],tags:["end","cadence"],variations:["RM023","RM024"]},{id:"RM023",length:4,pattern:[8,8,4,4,4],tags:["end","cadence"],variations:["RM024","RM025"]},{id:"RM024",length:4,pattern:[4,8,8,4,4],tags:["end","cadence"],variations:["RM025","RM026"]},{id:"RM025",length:8,pattern:[4,4,4,4,4,4,4,4],tags:["end","cadence","loop_safe"],variations:["RM026","RM019"]},{id:"RM026",length:8,pattern:[8,8,4,4,4,8,8,4,4,4],tags:["end","cadence","loop_safe"],variations:["RM019","RM020"]},{id:"RM027",length:4,pattern:[8,8,8,8,8,8,4],tags:["start","staccato","anacrusis"],variations:["RM028","RM001"]},{id:"RM028",length:4,pattern:[8,8,8,8,4,8,8],tags:["start","staccato","anacrusis"],variations:["RM001","RM002"]},{id:"RM029",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM030","RM031"]},{id:"RM030",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM031","RM032"]},{id:"RM031",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM032","RM033"]},{id:"RM032",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM033","RM034"]},{id:"RM033",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM034","RM035"]},{id:"RM034",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM035","RM036"]},{id:"RM035",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM036","RM037"]},{id:"RM036",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM037","RM038"]},{id:"RM037",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM038","RM039"]},{id:"RM038",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM039","RM040"]},{id:"RM039",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM040","RM041"]},{id:"RM040",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM041","RM042"]},{id:"RM041",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM042","RM043"]},{id:"RM042",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM043","RM044"]},{id:"RM043",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM044","RM045"]},{id:"RM044",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM045","RM046"]},{id:"RM045",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM046","RM047"]},{id:"RM046",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM047","RM048"]},{id:"RM047",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM048","RM049"]},{id:"RM048",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM049","RM050"]},{id:"RM049",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM050","RM009"]},{id:"RM050",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM009","RM010"]},{id:"RM051",length:4,pattern:[8,8,4,8,8,4],tags:["start","accented","syncopation","loop_safe"],variations:["RM052","RM053"]},{id:"RM052",length:4,pattern:[4,8,8,4,4],tags:["middle","accented","bridge","loop_safe"],variations:["RM051","RM053"]},{id:"RM053",length:4,pattern:[8,8,8,8,4,4],tags:["end","accented","cadence","loop_safe"],variations:["RM051","RM052"]},{id:"RM054",length:4,pattern:[4,4,8,8,8,8],tags:["middle","accented","variation","loop_safe"],variations:["RM052","RM055"]},{id:"RM055",length:4,pattern:[4,8,8,8,8,4],tags:["start","accented","bridge","loop_safe"],variations:["RM051","RM054"]},{id:"RM056",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","straight","texture_loop","grid16","loop_safe"],variations:["RM057"]},{id:"RM057",length:4,pattern:[16,16,16,16,16,16,16,8,8,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe"],variations:["RM056"]},{id:"RM058",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","middle","texture_loop","grid16","loop_safe","simple"],variations:["RM059","RM060"]},{id:"RM059",length:4,pattern:[16,16,16,16,16,16,8,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM058","RM060"]},{id:"RM060",length:4,pattern:[16,16,8,16,16,16,16,8,16,16,16,16,8],tags:["middle","texture_loop","grid16","loop_safe","syncopation"],variations:["RM058","RM059"]},{id:"RM061",length:4,pattern:[8,8,8,8,8,8,8,8],tags:["start","middle","texture_loop","loop_safe","straight"],variations:["RM062"]},{id:"RM062",length:4,pattern:[8,8,8,16,16,8,8,8,16,16],tags:["middle","texture_loop","loop_safe","straight"],variations:["RM061"]},{id:"RM063",length:4,pattern:[16,16,16,16,8,16,16,16,16,8,16,16,16,16],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM064"]},{id:"RM064",length:4,pattern:[16,16,16,16,16,16,16,16,8,16,16,16,16,8],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM063"]},{id:"RM065",length:4,pattern:[4,16,16,16,16,4,16,16,16,16],tags:["start","middle","texture_loop","loop_safe","simple"],variations:["RM066"]},{id:"RM066",length:4,pattern:[4,16,16,16,16,8,8,16,16,16,16],tags:["middle","texture_loop","loop_safe"],variations:["RM065"]},{id:"RM067",length:4,pattern:[8,16,16,8,16,16,8,16,16,8,16,16],tags:["start","middle","texture_loop","loop_safe","straight"],variations:["RM068"]},{id:"RM068",length:4,pattern:[8,16,16,8,8,8,16,16,8,16,16],tags:["middle","texture_loop","loop_safe","syncopation"],variations:["RM067"]},{id:"RM069",length:4,pattern:[16,16,8,16,16,8,16,16,8,16,16,8],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM070"]},{id:"RM070",length:4,pattern:[16,16,8,8,16,16,8,16,16,8,16,16],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM069"]},{id:"RM071",length:4,pattern:[4,4,16,16,16,16,4],tags:["start","middle","texture_loop","loop_safe","accented"],variations:["RM072"]},{id:"RM072",length:4,pattern:[4,8,8,16,16,16,16,4],tags:["middle","end","texture_loop","loop_safe","accented"],variations:["RM071"]},{id:"RM073",length:8,pattern:[4,4,4,4,4,4,4,4],tags:["end","cadence","loop_safe","final"],variations:["RM074","RM075"]},{id:"RM074",length:8,pattern:[4,8,8,4,4,4,8,8,4,4],tags:["end","cadence","loop_safe","final"],variations:["RM073","RM075"]},{id:"RM075",length:8,pattern:[8,8,4,4,4,2,2],tags:["end","cadence","loop_safe","ritardando"],variations:["RM073","RM074"]},{id:"RM076",length:4,pattern:[8,8,8,8,4,4],tags:["start","anacrusis","staccato","loop_safe"],variations:["RM077","RM078"]},{id:"RM077",length:4,pattern:[16,16,16,16,8,8,4,4],tags:["start","anacrusis","drive","loop_safe"],variations:["RM076","RM078"]},{id:"RM078",length:4,pattern:[8,8,4,8,8,4],tags:["start","anacrusis","syncopation","loop_safe"],variations:["RM076","RM077"]},{id:"RM079",length:4,pattern:[8,16,16,4,8,16,16,4],tags:["middle","syncopation","drive","loop_safe"],variations:["RM080","RM081"]},{id:"RM080",length:4,pattern:[4,16,16,8,8,4,8],tags:["middle","syncopation","accented","loop_safe"],variations:["RM079","RM082"]},{id:"RM081",length:4,pattern:[16,16,8,16,16,8,16,16,8,4],tags:["start","syncopation","staccato","loop_safe"],variations:["RM079","RM082"]},{id:"RM082",length:4,pattern:[8,8,16,16,16,16,8,8,4],tags:["middle","syncopation","drive","loop_safe"],variations:["RM080","RM083"]},{id:"RM083",length:4,pattern:[4,8,16,16,8,8,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM082","RM084"]},{id:"RM084",length:8,pattern:[8,16,16,8,16,16,4,4,8,16,16,8,16,16,4,4],tags:["middle","syncopation","drive","loop_safe"],variations:["RM083","RM085"]},{id:"RM085",length:8,pattern:[4,8,8,4,4,8,8,4,4,4],tags:["end","syncopation","cadence","loop_safe"],variations:["RM084","RM079"]},{id:"RM086",length:8,pattern:[8,8,4,8,8,4,8,8,4,8,8,4],tags:["middle","bridge","syncopation","loop_safe"],variations:["RM087","RM088"]},{id:"RM087",length:8,pattern:[4,4,8,8,8,8,4,4,8,8,8,8],tags:["middle","bridge","straight","loop_safe"],variations:["RM086","RM089"]},{id:"RM088",length:8,pattern:[16,16,16,16,8,8,4,4,16,16,16,16,8,8,4,4],tags:["middle","bridge","drive","loop_safe"],variations:["RM086","RM089"]},{id:"RM089",length:8,pattern:[8,8,8,8,4,4,8,8,8,8,4,4],tags:["middle","bridge","sustain","loop_safe"],variations:["RM087","RM090"]},{id:"RM090",length:8,pattern:[4,8,8,4,4,8,8,4,4,4],tags:["middle","bridge","variation","loop_safe"],variations:["RM089","RM086"]},{id:"RM091",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM092",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","syncopation"]},{id:"RM093",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","simple"]},{id:"RM094",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","accented"]},{id:"RM095",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM096",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM097",length:4,pattern:[8,8,16,16,16,16,8,8,16,16,16,16],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","syncopation"]},{id:"RM098",length:4,pattern:[16,16,8,16,16,8,16,16,8,16,16,8],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","simple"]},{id:"RM099",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","accented"]},{id:"RM100",length:4,pattern:[8,16,16,16,16,8,16,16,16,16,8,8],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","open"]},{id:"RM101",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM102",length:4,pattern:[8,16,16,16,16,8,8,16,16,16,16,8],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","syncopation"]},{id:"RM103",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","simple"]},{id:"RM104",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","accented"]},{id:"RM105",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","open"]},{id:"RM106",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","straight"]},{id:"RM107",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","syncopation"]},{id:"RM108",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","simple"]},{id:"RM109",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","accented"]},{id:"RM110",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","open"]},{id:"RM111",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16}],tags:["middle","texture_loop","grid16","syncopation","percussive_layer"]},{id:"RM112",length:4,pattern:[{value:8,accent:!0},{value:16},{value:16},{value:8},{value:16},{value:16,accent:!0},{value:8},{value:16},{value:16},{value:8,rest:!0},{value:16},{value:16}],tags:["middle","texture_loop","grid16","percussive_layer","drive"]},{id:"RM113",length:4,pattern:[{value:4,accent:!0},{value:16},{value:16},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","syncopation","break"]},{id:"RM114",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0}],tags:["middle","loop_safe","grid16","syncopation","breakbeat"]},{id:"RM115",length:4,pattern:[{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:4},{value:16,rest:!0},{value:8,accent:!0},{value:16,rest:!0},{value:16},{value:16,rest:!0}],tags:["middle","loop_safe","swing_hint","rest_heavy","lofi"]},{id:"RM116",length:4,pattern:[{value:8,accent:!0},{value:16},{value:16},{value:8,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:8},{value:16,accent:!0},{value:16},{value:8,accent:!0},{value:16,rest:!0},{value:16,accent:!0}],tags:["middle","loop_safe","syncopation","grid16","breakbeat"]},{id:"RM117",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0}],tags:["middle","loop_safe","grid16","syncopation","breakbeat","variation"]},{id:"RM118",length:4,pattern:[{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:8,accent:!0},{value:8,rest:!0},{value:8},{value:16,rest:!0},{value:8},{value:16,rest:!0}],tags:["middle","loop_safe","swing_hint","rest_heavy","lofi"]},{id:"RM119",length:4,pattern:[{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:8}],tags:["start","loop_safe","swing_hint","rest_heavy","lofi","variation"]}],ca=[{id:"MF001",pattern:[1,3,5],tags:["ascending","scalar","bright","heroic","start","loop_safe","short","slide"]},{id:"MF002",pattern:[1,4,5,7],tags:["ascending","scalar","bright","heroic","start","loop_safe","short","bend"]},{id:"MF003",pattern:[2,3,6,6,9],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF004",pattern:[1,3,6,6,7],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF005",pattern:[1,3,5,7,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF006",pattern:[1,3,4],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF007",pattern:[2,4,5,6],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF008",pattern:[1,2,5,5,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF009",pattern:[1,3,6,6,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF010",pattern:[1,3,5,6,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF011",pattern:[5,4,3],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF012",pattern:[5,5,3,3],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF013",pattern:[6,4,4,2,2],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF014",pattern:[4,4,4,2,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF015",pattern:[5,4,3,3,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF016",pattern:[5,4,2],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF017",pattern:[6,5,3,2],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF018",pattern:[5,3,3,1,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF019",pattern:[5,4,4,2,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF020",pattern:[5,4,3,2,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF021",pattern:[1,4,6],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF022",pattern:[1,5,6,6],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF023",pattern:[2,4,7,5,4],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF024",pattern:[1,4,7,5,2],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF025",pattern:[1,4,6,6,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF026",pattern:[1,4,5],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF027",pattern:[2,5,6,5],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF028",pattern:[1,3,6,4,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF029",pattern:[1,4,7,5,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF030",pattern:[1,4,6,5,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF031",pattern:[6,4,2],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF032",pattern:[6,5,2,4],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF033",pattern:[7,4,3,3,2],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF034",pattern:[5,4,3,3,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF035",pattern:[6,4,2,4,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF036",pattern:[6,4,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF037",pattern:[7,5,2,3],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF038",pattern:[6,3,2,2,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF039",pattern:[6,4,3,3,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF040",pattern:[6,4,2,3,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF041",pattern:[1,2,3],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF042",pattern:[1,3,3,6],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF043",pattern:[2,2,4,5,8],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF044",pattern:[1,2,4,5,6,6],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF045",pattern:[1,2,3,6,7,7],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF046",pattern:[1,2,2],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF047",pattern:[2,3,3,5],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF048",pattern:[1,1,3,4,7],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF049",pattern:[1,2,4,5,7,7],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF050",pattern:[1,2,3,5,7,6],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF051",pattern:[5,7,6],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF052",pattern:[5,8,6,5],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF053",pattern:[6,7,7,4,3],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF054",pattern:[4,7,7,4,1],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF055",pattern:[5,7,6,5,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF056",pattern:[5,7,5],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF057",pattern:[6,8,6,4],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF058",pattern:[5,6,6,3,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF059",pattern:[5,7,7,4,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF060",pattern:[5,7,6,4,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF061",pattern:[3,5,4],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF062",pattern:[3,6,4,7],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF063",pattern:[4,5,5,6,6],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF064",pattern:[2,5,5,6,4,3],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF065",pattern:[3,5,4,7,5,4],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF066",pattern:[3,5,3],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF067",pattern:[4,6,4,6],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF068",pattern:[3,4,4,5,5],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF069",pattern:[3,5,5,6,5,4],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF070",pattern:[3,5,4,6,5,3],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF071",pattern:[2,4,6],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF072",pattern:[2,5,6,6],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF073",pattern:[3,4,7,5,4],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF074",pattern:[1,4,7,5,2,1],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF075",pattern:[2,4,6,6,3,2],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF076",pattern:[2,4,5],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF077",pattern:[3,5,6,5],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF078",pattern:[2,3,6,4,3],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF079",pattern:[2,4,7,5,3,2],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF080",pattern:[2,4,6,5,3,1],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF081",pattern:[1,5,3],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF082",pattern:[1,6,3,7],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF083",pattern:[2,5,4,6,5],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF084",pattern:[1,5,4,6,3,7],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF085",pattern:[1,5,3,7,4,8],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF086",pattern:[1,5,2],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF087",pattern:[2,6,3,6],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF088",pattern:[1,4,3,5,4],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF089",pattern:[1,5,4,6,4,8],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF090",pattern:[1,5,3,6,4,7],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF091",pattern:[6,3,5],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF092",pattern:[6,4,5,3],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF093",pattern:[7,3,6,2,5],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF094",pattern:[5,3,6,2,3,1],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF095",pattern:[6,3,5,3,4,2],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF096",pattern:[6,3,4],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF097",pattern:[7,4,5,2],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF098",pattern:[6,2,5,1,4],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF099",pattern:[6,3,6,2,4,2],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF100",pattern:[6,3,5,2,4,1],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF101",pattern:[1,1,1,1],tags:["flat","static","texture_loop","loop_safe","simple","ostinato"]},{id:"MF102",pattern:[1,5,1,5],tags:["flat","texture_loop","loop_safe","ostinato","percussive_layer"]},{id:"MF103",pattern:[1,1,1,1],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF104",pattern:[1,1,1,2,1],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF105",pattern:[5,5,5,5],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF106",pattern:[1,2,1,2],tags:["flat","static","drone","loop_safe","ostinato","simple"]},{id:"MF107",pattern:[3,3,3,3],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF108",pattern:[1,3,1,3],tags:["flat","static","drone","loop_safe","ostinato"]},{id:"MF109",pattern:[1,1,5,1,1,5],tags:["flat","static","loop_safe","ostinato","percussive_layer"]},{id:"MF110",pattern:[1,1,1,1,1,1],tags:["flat","static","drone","loop_safe","simple","texture_loop"]},{id:"MF111",pattern:[5,6,7,1],tags:["mysterious","ascending","dark","start","loop_safe","short"]},{id:"MF112",pattern:[1,7,6,5],tags:["mysterious","descending","dark","middle","loop_safe","short"]},{id:"MF113",pattern:[3,1,6,5],tags:["mysterious","complex","dark","tense","loop_safe","short"]},{id:"MF114",pattern:[1,2,3,2,1],tags:["playful","neighbor","bright","simple","loop_safe","short"]},{id:"MF115",pattern:[5,4,3,4,5],tags:["playful","wave","bright","upbeat","loop_safe","short"]},{id:"MF116",pattern:[1,3,5,3,1],tags:["playful","arch","bright","simple","loop_safe","short"]},{id:"MF117",pattern:[1,5,1,5],tags:["epic","leaping","bright","heroic","loop_safe","short"]},{id:"MF118",pattern:[5,6,7,1,2],tags:["epic","ascending","bright","heroic","build","short"]},{id:"MF119",pattern:[1,3,5,7,1],tags:["epic","ascending","arpeggio","heroic","bright","short"]},{id:"MF120",pattern:[6,5,4,3],tags:["mysterious","descending","scalar","dark","loop_safe","short"]},{id:"MF121",pattern:[3,5,3,1],tags:["playful","wave","bright","simple","loop_safe","short"]},{id:"MF122",pattern:[5,3,1,5],tags:["epic","leaping","arpeggio","heroic","loop_safe","short"]},{id:"MF123",pattern:[1,6,5,1],tags:["mysterious","complex","dark","cadence","loop_safe","short"]},{id:"MF124",pattern:[2,3,4,5],tags:["playful","ascending","scalar","bright","loop_safe","short"]},{id:"MF125",pattern:[1,4,7,4,1],tags:["epic","arch","leaping","heroic","bright","extended"]},{id:"MF126",pattern:[5,7,6,5,3],tags:["mysterious","complex","dark","descending","loop_safe","extended"]},{id:"MF127",pattern:[1,1,3,3,5,5],tags:["playful","sequence","ascending","bright","loop_safe","extended"]},{id:"MF128",pattern:[1,7,1,5],tags:["epic","leaping","heroic","bright","loop_safe","short"]},{id:"MF129",pattern:[3,2,1,6],tags:["mysterious","descending","dark","tense","loop_safe","short"]},{id:"MF130",pattern:[5,5,6,6,7,7,1],tags:["epic","sequence","ascending","heroic","build","extended"]},{id:"MF131",pattern:[5,4,3,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF132",pattern:[6,5,4,2],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF133",pattern:[7,5,3,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF134",pattern:[5,3,2,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF135",pattern:[6,4,3,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF136",pattern:[1,2,3,5],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF137",pattern:[1,3,5,6],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF138",pattern:[2,3,4,6],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF139",pattern:[1,2,4,5],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF140",pattern:[3,4,5,7],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF141",pattern:[7,6,5,4,3],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF142",pattern:[5,4,3,2,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF143",pattern:[6,5,4,3,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF144",pattern:[7,5,4,2,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF145",pattern:[5,4,3,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF146",pattern:[1,2,1,3,1],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF147",pattern:[5,6,5,7,5],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF148",pattern:[1,3,1,2,1],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF149",pattern:[5,7,5,6,5],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF150",pattern:[1,4,1,3,1],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF151",pattern:[1,4,6,5,7,6,4],tags:["breakbeat","tense","leaping","loop_safe","short"]},{id:"MF152",pattern:[5,3,6,4,7,5],tags:["breakbeat","tense","sequence","loop_safe","short","variation"]},{id:"MF153",pattern:[1,5,4,6,3,7,5],tags:["breakbeat","upbeat","leaping","loop_safe","extended"]},{id:"MF154",pattern:[1,1,3,2,1],tags:["lofi","peaceful","stepwise","loop_safe","short"]},{id:"MF155",pattern:[5,4,4,3,2,2],tags:["lofi","peaceful","descending","loop_safe","long"]},{id:"MF156",pattern:[1,3,2,5,4,3,1],tags:["lofi","melancholic","stepwise","loop_safe","extended"]}],pa=[{id:"MR001",length:4,pattern:[{value:4},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["start","simple","drive","loop_safe"]},{id:"MR002",length:4,pattern:[{value:8},{value:8},{value:8},{value:8},{value:4},{value:4}],tags:["middle","syncopated","drive"]},{id:"MR003",length:4,pattern:[{value:4},{value:4},{value:4},{value:4}],tags:["start","legato","simple"]},{id:"MR004",length:4,pattern:[{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4}],tags:["middle","rest_heavy","staccato"]},{id:"MR005",length:4,pattern:[{value:8},{value:8},{value:4},{value:8},{value:8},{value:4}],tags:["middle","syncopated","drive"]},{id:"MR006",length:4,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["middle","legato","rest_heavy"]},{id:"MR007",length:4,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8}],tags:["start","staccato","drive"]},{id:"MR008",length:8,pattern:[{value:8},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4}],tags:["start","bridge","legato"]},{id:"MR009",length:4,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16},{value:16}],tags:["end","legato","loop_safe","cadence"]},{id:"MR010",length:4,pattern:[{value:8},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4}],tags:["end","syncopated","staccato","loop_safe","cadence"]},{id:"MR011",length:4,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:4}],tags:["start","legato","rest_heavy","loop_safe"]},{id:"MR012",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:8},{value:8},{value:8},{value:8}],tags:["middle","staccato","drive","syncopated"]},{id:"MR013",length:4,pattern:[{value:8,rest:!0},{value:8,rest:!0},{value:4},{value:8},{value:8},{value:4}],tags:["middle","rest_heavy","simple"]},{id:"MR014",length:4,pattern:[{value:4},{value:8},{value:8},{value:16,rest:!0},{value:16},{value:4},{value:8}],tags:["middle","syncopated","drive","accented"]},{id:"MR015",length:4,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:8},{value:8}],tags:["end","legato","rest_heavy","loop_safe"]},{id:"MR016",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:16,rest:!0},{value:16,rest:!0},{value:16},{value:16},{value:4},{value:4},{value:8},{value:8},{value:4}],tags:["bridge","legato","rest_heavy"]},{id:"MR017",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4}],tags:["bridge","syncopated","drive"]},{id:"MR018",length:8,pattern:[{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4}],tags:["end","legato","loop_safe","cadence"]},{id:"MR019",length:4,pattern:[{value:4},{value:8},{value:8},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16},{value:8},{value:8}],tags:["start","drive","accented"]},{id:"MR020",length:4,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:8},{value:8}],tags:["middle","rest_heavy","simple"]},{id:"MR021",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["middle","staccato","drive","syncopated"]},{id:"MR022",length:4,pattern:[{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:4},{value:8,rest:!0},{value:8}],tags:["end","legato","loop_safe"]},{id:"MR023",length:8,pattern:[{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["bridge","syncopated","drive","accented"]},{id:"MR024",length:8,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4}],tags:["bridge","legato","rest_heavy"]},{id:"MR025",length:8,pattern:[{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8,rest:!0},{value:4},{value:4},{value:8,rest:!0},{value:8,rest:!0},{value:4},{value:4}],tags:["end","legato","loop_safe","cadence"]},{id:"MR026",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["start","texture_loop","grid16","drive","loop_safe"]},{id:"MR027",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:8},{value:8},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR028",length:4,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8}],tags:["start","middle","texture_loop","simple","loop_safe","percussive_layer"]},{id:"MR029",length:4,pattern:[{value:8},{value:16},{value:16},{value:8},{value:8},{value:16},{value:16},{value:8},{value:8},{value:8}],tags:["middle","texture_loop","loop_safe","percussive_layer"]},{id:"MR030",length:4,pattern:[{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16}],tags:["start","middle","texture_loop","loop_safe","percussive_layer"]},{id:"MR031",length:4,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR032",length:4,pattern:[{value:8},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["middle","texture_loop","loop_safe","percussive_layer","syncopated"]},{id:"MR033",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:8},{value:16},{value:16},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR034",length:8,pattern:[{value:4},{value:4},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16},{value:4},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16},{value:4},{value:4},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16}],tags:["middle","end","staccato","rest_heavy","percussive_layer","loop_safe"]},{id:"MR035",length:4,pattern:[{value:8},{value:16,rest:!0},{value:16},{value:8},{value:16,rest:!0},{value:16},{value:8},{value:16,rest:!0},{value:16},{value:8},{value:16,rest:!0},{value:16}],tags:["start","middle","staccato","rest_heavy","percussive_layer","loop_safe"]},{id:"MR036",length:4,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:16},{value:16},{value:16},{value:16}],tags:["start","middle","rest_heavy","loop_safe","simple"]},{id:"MR037",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16}],tags:["middle","end","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR038",length:8,pattern:[{value:4},{value:4},{value:4},{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4}],tags:["start","drive","syncopated"]},{id:"MR039",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["start","simple","drive"]},{id:"MR040",length:8,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8}],tags:["start","legato","rest_heavy"]},{id:"MR041",length:8,pattern:[{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4}],tags:["start","syncopated","drive"]},{id:"MR042",length:8,pattern:[{value:4},{value:4},{value:8},{value:8},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["start","simple","legato"]},{id:"MR043",length:8,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:4},{value:4},{value:16},{value:16},{value:8},{value:4},{value:4},{value:4}],tags:["start","staccato","drive"]},{id:"MR044",length:8,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["start","rest_heavy","simple"]},{id:"MR045",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["start","syncopated","accented"]},{id:"MR046",length:8,pattern:[{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["middle","drive","syncopated"]},{id:"MR047",length:8,pattern:[{value:4},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","simple","legato"]},{id:"MR048",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","staccato","drive"]},{id:"MR049",length:8,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["middle","rest_heavy","legato"]},{id:"MR050",length:8,pattern:[{value:8},{value:16},{value:16},{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["middle","syncopated","accented"]},{id:"MR051",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4}],tags:["middle","simple","drive"]},{id:"MR052",length:8,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","staccato","syncopated"]},{id:"MR053",length:8,pattern:[{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","rest_heavy","staccato"]},{id:"MR054",length:8,pattern:[{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4}],tags:["end","legato","loop_safe","cadence"]},{id:"MR055",length:8,pattern:[{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4}],tags:["end","syncopated","loop_safe","cadence"]},{id:"MR056",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["end","simple","loop_safe","cadence"]},{id:"MR057",length:8,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR058",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8}],tags:["middle","texture_loop","simple","loop_safe","percussive_layer"]},{id:"MR059",length:8,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR060",length:8,pattern:[{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16}],tags:["middle","end","texture_loop","loop_safe","percussive_layer"]},{id:"MR061",length:8,pattern:[{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR062",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16}],tags:["middle","texture_loop","grid16","syncopated","drive"]},{id:"MR063",length:4,pattern:[{value:8,accent:!0},{value:16},{value:16},{value:8},{value:16},{value:16,accent:!0},{value:8},{value:16},{value:16},{value:8,rest:!0},{value:16},{value:16}],tags:["middle","texture_loop","grid16","percussive_layer","ostinato"]},{id:"MR064",length:4,pattern:[{value:4,accent:!0},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["start","texture_loop","grid16","percussive_layer","loop_safe"]}],ha=[{id:"DP001",length_beats:4,type:"beat",pattern:"K-H-S-H-K-H-S-H-",tags:["loop_safe"]},{id:"DP002",length_beats:4,type:"beat",pattern:"H-S-H-K-H-S-H-K-",tags:["loop_safe","variation"]},{id:"DP003",length_beats:4,type:"beat",pattern:"K---S---K-H-S-H",tags:["bridge"]},{id:"DP004",length_beats:4,type:"beat",pattern:"--S---K-H-S-HK-",tags:["bridge","variation"]},{id:"DP005",length_beats:4,type:"beat",pattern:"K-H-K---S-H-K---",tags:["build"]},{id:"DP006",length_beats:4,type:"beat",pattern:"H-K---S-H-K---K-",tags:["build","variation"]},{id:"DP007",length_beats:4,type:"beat",pattern:"K---S-H-K---S-H-",tags:["straight"]},{id:"DP008",length_beats:4,type:"beat",pattern:"--S-H-K---S-H-K-",tags:["straight","variation"]},{id:"DP009",length_beats:4,type:"beat",pattern:"K-H---S-K-H---S-",tags:["syncopation"]},{id:"DP010",length_beats:4,type:"beat",pattern:"H---S-K-H---S-K-",tags:["syncopation","variation"]},{id:"DP011",length_beats:4,type:"beat",pattern:"K---H-K-S---H-K-",tags:["open"]},{id:"DP012",length_beats:4,type:"beat",pattern:"--H-K-S---H-K-K-",tags:["open","variation"]},{id:"DP013",length_beats:4,type:"beat",pattern:"K-H-K-H-S-H-K-H-",tags:["loop_safe"]},{id:"DP014",length_beats:4,type:"beat",pattern:"H-K-H-S-H-K-H-K-",tags:["loop_safe","variation"]},{id:"DP015",length_beats:4,type:"beat",pattern:"K---S---K---H---",tags:["simple"]},{id:"DP016",length_beats:4,type:"beat",pattern:"--S---K---H---K-",tags:["simple","variation"]},{id:"DP017",length_beats:4,type:"beat",pattern:"K-H---K-S-H---K-",tags:["bridge"]},{id:"DP018",length_beats:4,type:"beat",pattern:"H---K-S-H---K-K-",tags:["bridge","variation"]},{id:"DP019",length_beats:4,type:"beat",pattern:"K--H-K--S-H-K--",tags:["swing_hint"]},{id:"DP020",length_beats:4,type:"beat",pattern:"-H-K--S-H-K--K-",tags:["swing_hint","variation"]},{id:"DP021",length_beats:4,type:"fill",pattern:"S-S-S-S-S-S-O---",tags:["cadence"]},{id:"DP022",length_beats:4,type:"fill",pattern:"S-S-S-S-O---S-S-",tags:["cadence","variation"]},{id:"DP023",length_beats:8,type:"fill",pattern:"S-S-S-S-S-S-O---S-S-S-S-S-S-O---",tags:["cadence","extended"]},{id:"DP024",length_beats:4,type:"fill",pattern:"KSKO-KSKO-KSKO-K",tags:["build"]},{id:"DP025",length_beats:4,type:"fill",pattern:"-KSKO-KSKO-KKSKO",tags:["build","variation"]},{id:"DP026",length_beats:8,type:"fill",pattern:"KSKO-KSKO-KSKO-KKSKO-KSKO-KSKO-K",tags:["build","extended"]},{id:"DP027",length_beats:4,type:"fill",pattern:"S-HS-HS-HS-HS-HS",tags:["bridge"]},{id:"DP028",length_beats:4,type:"fill",pattern:"-HS-HS-HS-HSS-HS",tags:["bridge","variation"]},{id:"DP029",length_beats:8,type:"fill",pattern:"S-HS-HS-HS-HS-HSS-HS-HS-HS-HS-HS",tags:["bridge","extended"]},{id:"DP030",length_beats:4,type:"fill",pattern:"K-SK-SK-SK-SK-SK",tags:["build"]},{id:"DP031",length_beats:4,type:"fill",pattern:"-SK-SK-SK-SKK-SK",tags:["build","variation"]},{id:"DP032",length_beats:8,type:"fill",pattern:"K-SK-SK-SK-SK-SKK-SK-SK-SK-SK-SK",tags:["build","extended"]},{id:"DP033",length_beats:4,type:"fill",pattern:"S--S-HHS--S-HHS-",tags:["break"]},{id:"DP034",length_beats:4,type:"fill",pattern:"-HHS--S-HHS-S--S",tags:["break","variation"]},{id:"DP035",length_beats:8,type:"fill",pattern:"S--S-HHS--S-HHS-S--S-HHS--S-HHS-",tags:["break","extended"]},{id:"DP036",length_beats:4,type:"fill",pattern:"K-K-K-K-S-S-S-S-",tags:["cadence"]},{id:"DP037",length_beats:4,type:"fill",pattern:"K-K-S-S-S-S-K-K-",tags:["cadence","variation"]},{id:"DP038",length_beats:8,type:"fill",pattern:"K-K-K-K-S-S-S-S-K-K-K-K-S-S-S-S-",tags:["cadence","extended"]},{id:"DP039",length_beats:4,type:"fill",pattern:"S-S-H-H-S-S-H-H-",tags:["bridge"]},{id:"DP040",length_beats:4,type:"fill",pattern:"H-H-S-S-H-H-S-S-",tags:["bridge","variation"]},{id:"DP041",length_beats:8,type:"fill",pattern:"S-S-H-H-S-S-H-H-S-S-H-H-S-S-H-H-",tags:["bridge","extended"]},{id:"DP042",length_beats:4,type:"fill",pattern:"KSTK-KSTK-KSTK-K",tags:["toms"]},{id:"DP043",length_beats:4,type:"fill",pattern:"-KSTK-KSTK-KKSTK",tags:["toms","variation"]},{id:"DP044",length_beats:8,type:"fill",pattern:"KSTK-KSTK-KSTK-KKSTK-KSTK-KSTK-K",tags:["toms","extended"]},{id:"DP045",length_beats:4,type:"fill",pattern:"S--S--S--S--S--S",tags:["loop_safe"]},{id:"DP046",length_beats:4,type:"fill",pattern:"--S--S--S--SS--S",tags:["loop_safe","variation"]},{id:"DP047",length_beats:8,type:"fill",pattern:"S--S--S--S--S--SS--S--S--S--S--S",tags:["loop_safe","extended"]},{id:"DP048",length_beats:4,type:"fill",pattern:"K-S-H-K-S-H-K-S-",tags:["bridge"]},{id:"DP049",length_beats:4,type:"fill",pattern:"H-K-S-H-K-S-K-S-",tags:["bridge","variation"]},{id:"DP050",length_beats:8,type:"fill",pattern:"K-S-H-K-S-H-K-S-K-S-H-K-S-H-K-S-",tags:["bridge","extended"]},{id:"DP051",length_beats:4,type:"beat",pattern:"K-H-K-H-K-H-K-H-",tags:["loop_safe","four_on_floor","straight","percussive_layer","texture_loop"]},{id:"DP052",length_beats:4,type:"beat",pattern:"K-HO-K-H-K-O-K-H-",tags:["loop_safe","four_on_floor","straight","variation","percussive_layer"]},{id:"DP053",length_beats:4,type:"beat",pattern:"K-HH-K-HH-K-HH-K-HH",tags:["loop_safe","grid16","texture_loop","percussive_layer"]},{id:"DP054",length_beats:4,type:"beat",pattern:"K--S--K-K--S--K-",tags:["rock","drive","loop_safe"]},{id:"DP055",length_beats:4,type:"beat",pattern:"K-K-S---K-K-S-K-",tags:["dance","syncopation","loop_safe"]},{id:"DP056",length_beats:4,type:"beat",pattern:"K-----S-K-----S-",tags:["ballad","simple","loop_safe"]},{id:"DP057",length_beats:4,type:"beat",pattern:"K-H-S-K-K-H-S-H-",tags:["rock","energetic","loop_safe","variation"]},{id:"DP058",length_beats:4,type:"beat",pattern:"K-S-K-S-K-S-K-S-",tags:["dance","four_on_floor","loop_safe"]},{id:"DP059",length_beats:4,type:"beat",pattern:"K---S-K-K---S---",tags:["syncopation","upbeat","loop_safe"]},{id:"DP060",length_beats:4,type:"beat",pattern:"K-H-S-H-K---S-H-",tags:["rock","variation","loop_safe"]},{id:"DP061",length_beats:4,type:"beat",pattern:"K-K---S-K-K-S---",tags:["dance","syncopation","tense","loop_safe"]},{id:"DP062",length_beats:4,type:"beat",pattern:"K-H-S---K-H-S-K-",tags:["rock","drive","loop_safe","variation"]},{id:"DP063",length_beats:4,type:"beat",pattern:"K-----S---K-S---",tags:["ballad","peaceful","simple","loop_safe"]},{id:"DP064",length_beats:4,type:"beat",pattern:"K-K-S-K-K-K-S-K-",tags:["dance","energetic","drive","loop_safe"]},{id:"DP065",length_beats:4,type:"beat",pattern:"K-H-S-K---H-S-H-",tags:["syncopation","rock","variation","loop_safe"]},{id:"DP066",length_beats:4,type:"beat",pattern:"K---S---K-K-S-K-",tags:["dance","syncopation","build","loop_safe"]},{id:"DP067",length_beats:4,type:"beat",pattern:"K-H-S-H-K-H-S---",tags:["rock","cadence","loop_safe"]},{id:"DP068",length_beats:4,type:"beat",pattern:"K-K-K-K-S-S-S-S-",tags:["experimental","build","tense","loop_safe"]},{id:"DP069",length_beats:4,type:"beat",pattern:"K-HO-K-HO-K-HO-K-HO",tags:["loop_safe","four_on_floor","texture_loop","percussive_layer","variation"]},{id:"DP070",length_beats:4,type:"beat",pattern:"K-HS-K-HK-HS-K-HK-HS",tags:["loop_safe","four_on_floor","grid16","percussive_layer","texture_loop"]},{id:"DP071",length_beats:4,type:"beat",pattern:"K-H-K-S-K-H-O-S-",tags:["loop_safe","four_on_floor","syncopation","percussive_layer","variation"]},{id:"DP072",length_beats:4,type:"beat",pattern:"K-HH-K-S-K-HH-K-S",tags:["loop_safe","four_on_floor","grid16","percussive_layer","build"]},{id:"DP073",length_beats:4,type:"beat",pattern:"KH-HSHKHOHSHKHSH",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP074",length_beats:4,type:"beat",pattern:"KH-HSH-KHSOHK-SH",tags:["loop_safe","grid16","syncopation","breakbeat","variation","percussive_layer"]},{id:"DP075",length_beats:4,type:"fill",pattern:"KHSHKHSHKTSHKHSH",tags:["break","breakbeat","drum_fill","grid16","syncopation"]},{id:"DP076",length_beats:4,type:"beat",pattern:"K--H-K--S-H--H--",tags:["loop_safe","swing_hint","simple","rest_heavy","lofi"]},{id:"DP077",length_beats:4,type:"beat",pattern:"K-H--K-HS--H--H-",tags:["loop_safe","swing_hint","rest_heavy","lofi","variation"]},{id:"DP078",length_beats:4,type:"beat",pattern:"K-HS-K-HSK-H-SH-",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP079",length_beats:4,type:"beat",pattern:"K-HO-KS-HK-S-HO-",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer","variation"]},{id:"DP080",length_beats:4,type:"fill",pattern:"KHSHKHSKTSHKHSS-",tags:["break","breakbeat","drum_fill","grid16","syncopation"]},{id:"DP081",length_beats:4,type:"beat",pattern:"K---H---S-H-----",tags:["loop_safe","swing_hint","rest_heavy","lofi"]},{id:"DP082",length_beats:4,type:"beat",pattern:"K--H---HS--H-K--",tags:["loop_safe","swing_hint","rest_heavy","lofi","variation"]},{id:"DP083",length_beats:4,type:"fill",pattern:"N---S---N---H---",tags:["lofi","drum_fill","rest_heavy","transition"]},{id:"DP084",length_beats:4,type:"beat",pattern:"KHHH-HSHKH-HSHK-",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP085",length_beats:4,type:"beat",pattern:"KH-HKHSH-HSHKHSO",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer","variation"]},{id:"DP086",length_beats:4,type:"beat",pattern:"K-HHKSH-HK-SHH-H",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP087",length_beats:4,type:"beat",pattern:"KHHSHK-HSHK-SHOH",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer","variation"]},{id:"DP088",length_beats:4,type:"fill",pattern:"KHSHSHKTSHSHKSH-",tags:["break","breakbeat","drum_fill","grid16","syncopation"]},{id:"DP089",length_beats:4,type:"fill",pattern:"KHSKHSKTSHSKHSKO",tags:["break","breakbeat","drum_fill","grid16","syncopation","variation"]}],ga=[{id:"BP_STEADY_ROOT_DRIVE",texture:"steady",steps:["root","root","fifth","root","fifth","root","fifth","approach"],tags:["default","loop_safe"]},{id:"BP_STEADY_UPWARD_WALK",texture:"steady",steps:["root","fifth","root","octave","fifth","root","octave","approach"],tags:["variation","section_end"]},{id:"BP_BROKEN_TRIAD_LIFT",texture:"broken",steps:["root","fifth","root","octave","root","fifth","root","approach"],tags:["default"]},{id:"BP_BROKEN_PICKUP_DROP",texture:"broken",steps:["root","octave","fifth","octaveHigh","root","fifth","octave","approach"],tags:["variation","pickup","section_end"]},{id:"BP_BREAK_OFFBEAT_DRIVE",texture:"broken",steps:["root","rest","octave","rest","fifth","approach","lowFifth","approach"],tags:["loop_safe","syncopated","breakbeat","variation","default"]},{id:"BP_BREAK_GHOST_RIDE",texture:"broken",steps:["root","octave","rest","fifth","rest","octave","lowFifth","approach"],tags:["loop_safe","breakbeat","syncopated","drive","default"]},{id:"BP_BREAK_SLIDE_UP",texture:"broken",steps:["root","approach","fifth","rest","root","octave","rest","approach"],tags:["loop_safe","breakbeat","variation"]},{id:"BP_LOFI_SWUNG_ROOT",texture:"steady",steps:["root","rest","rest","root","rest","fifth","rest","approach"],tags:["loop_safe","rest_heavy","swing_hint","lofi"]},{id:"BP_LOFI_DUSTY_STEP",texture:"steady",steps:["root","rest","rest","fifth","rest","rest","root","approach"],tags:["loop_safe","lofi","rest_heavy","swing_hint"]},{id:"BP_LOFI_WALKDOWN",texture:"steady",steps:["root","rest","third","rest","second","rest","root","approach"],tags:["loop_safe","lofi","rest_heavy","variation"]},{id:"BP_ARPEGGIO_GLIDE",texture:"arpeggio",steps:["root","octave","fifth","octaveHigh","root","fifth","octave","approach"],tags:["default","loop_safe"]},{id:"BP_ARPEGGIO_PULSE",texture:"arpeggio",steps:["root","fifth","octave","octaveHigh","root","fifth","octave","approach"],tags:["variation","transition","section_end"]},{id:"BP_STEADY_OFFBEAT_PUSH",texture:"steady",steps:["root","fifth","root","approach","fifth","root","octave","approach"],tags:["variation","syncopated","loop_safe"]},{id:"BP_BROKEN_LOW_SWING",texture:"broken",steps:["root","lowFifth","root","fifth","root","lowFifth","root","approach"],tags:["variation","loop_safe"]},{id:"BP_ARPEGGIO_SPREAD",texture:"arpeggio",steps:["root","octave","fifth","octaveHigh","fifth","octave","octaveHigh","approach"],tags:["variation","loop_safe"]},{id:"BP_STEADY_SUB_GRID",texture:"steady",steps:["root","root","root","root","root","root","root","root"],tags:["loop_safe","percussive_layer","four_on_floor","static"]},{id:"BP_STEADY_SUB_OFFSET",texture:"steady",steps:["root","root","root","fifth","root","root","root","approach"],tags:["loop_safe","percussive_layer","variation"]},{id:"BP_FOUR_ON_FLOOR_CLASSIC",texture:"steady",steps:["root","root","root","root","root","fifth","root","root"],tags:["loop_safe","four_on_floor","percussive_layer","static","drone"]},{id:"BP_FOUR_ON_FLOOR_GHOST",texture:"steady",steps:["root","root","fifth","root","root","root","fifth","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_FOUR_ON_FLOOR_OFFBEAT",texture:"steady",steps:["root","fifth","root","root","root","fifth","root","root"],tags:["loop_safe","four_on_floor","percussive_layer","syncopated"]},{id:"BP_FOUR_ON_FLOOR_OCTAVE_HIT",texture:"steady",steps:["root","root","root","octave","root","root","root","octave"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_FOUR_ON_FLOOR_ROLLING",texture:"steady",steps:["root","root","root","fifth","root","root","root","fifth"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_DRONE_STATIC_ROOT",texture:"steady",steps:["root","root","root","root","root","fifth","root","approach"],tags:["loop_safe","static","drone","four_on_floor","percussive_layer"]},{id:"BP_DRONE_LOW_PULSE",texture:"steady",steps:["root","lowFifth","root","lowFifth","root","lowFifth","root","lowFifth"],tags:["loop_safe","drone","percussive_layer"]},{id:"BP_DRONE_ACCENT_SPARK",texture:"steady",steps:["root","rest","octave","root","rest","fifth","root","approach"],tags:["loop_safe","drone","accent"]},{id:"BP_TECHNO_BOUNCE",texture:"broken",steps:["root","root","octave","root","root","root","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_TECHNO_SUB_EMPHASIS",texture:"steady",steps:["root","root","root","lowFifth","root","root","root","lowFifth"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_MINIMAL_BREATH",texture:"steady",steps:["root","root","root","root","fifth","root","root","root"],tags:["loop_safe","four_on_floor","percussive_layer","static"]},{id:"BP_WALKING_BASS",texture:"broken",steps:["root","second","third","fifth","root","seventh","octave","approach"],tags:["variation","walking","jazz_hint"]},{id:"BP_OCTAVE_JUMP",texture:"broken",steps:["root","octave","root","octave","fifth","octaveHigh","fifth","approach"],tags:["variation","energetic","jump"]},{id:"BP_CHROMATIC_WALK",texture:"broken",steps:["root","flatSecond","second","third","fifth","sixth","seventh","approach"],tags:["variation","chromatic","tense"]},{id:"BP_SYNCOPATED_GROOVE",texture:"broken",steps:["root","fifth","octave","root","fifth","octave","fifth","approach"],tags:["variation","syncopation","groove"]},{id:"BP_PEDAL_FIFTH",texture:"steady",steps:["root","fifth","root","fifth","root","fifth","root","fifth"],tags:["loop_safe","simple","rock"]},{id:"BP_ARPEGGIO_CASCADE",texture:"arpeggio",steps:["root","third","fifth","octave","fifth","third","root","approach"],tags:["variation","cascade","bright"]},{id:"BP_BOUNCY_RHYTHM",texture:"broken",steps:["root","root","fifth","fifth","octave","octave","fifth","approach"],tags:["variation","playful","bounce"]},{id:"BP_BROKEN_SYNCO_JUMP",texture:"broken",steps:["root","rest","octave","root","fifth","rest","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer","syncopated","default"]},{id:"BP_BROKEN_GRID_PULSE",texture:"broken",steps:["root","root","rest","root","octave","root","rest","root"],tags:["loop_safe","four_on_floor","percussive_layer","grid16"]},{id:"BP_BROKEN_TEXTURE_WAVE",texture:"broken",steps:["root","octave","fifth","root","root","octave","fifth","approach"],tags:["loop_safe","four_on_floor","percussive_layer","texture_loop"]},{id:"BP_BROKEN_DOUBLE_HIT",texture:"broken",steps:["root","root","octave","octave","fifth","fifth","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_BROKEN_OFFBEAT_DRIVE",texture:"broken",steps:["rest","root","rest","octave","rest","fifth","rest","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_BROKEN_SUB_BOUNCE",texture:"broken",steps:["root","lowFifth","octave","root","root","lowFifth","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer","static"]},{id:"BP_BROKEN_LIFT_DROP",texture:"broken",steps:["root","fifth","octave","octaveHigh","fifth","root","octave","approach"],tags:["loop_safe","four_on_floor","percussive_layer","variation"]},{id:"BP_BROKEN_STEADY_GRID",texture:"broken",steps:["root","root","root","octave","root","root","root","octave"],tags:["loop_safe","four_on_floor","percussive_layer","default"]}],ma={patterns:ga},fa=[{id:"TR_SECTION_NOISE_SWELL",pattern:"N---N---N---NNS-",length_beats:4,tags:["transition","section_end","noise_fx"],channel:"noise"},{id:"TR_SECTION_SNARE_RUSH",pattern:"--S-S-S-S-S-S-S-",length_beats:4,tags:["transition","section_end","drum_fill"],channel:"noise"},{id:"TR_LOOP_TIGHTENER",pattern:"K-HS-HK-HS-HK-H-",length_beats:4,tags:["transition","loop_out","drum_fill"],channel:"noise"},{id:"TR_SECTION_GHOST_ECHO",pattern:"N---S---N---S---",length_beats:4,tags:["transition","section_end","loop_out","noise_fx"],channel:"noise"},{id:"TR_BUILD_STUTTER_FILL",pattern:"K-SK-SK-SK-SK-S-",length_beats:4,tags:["transition","build","drum_fill"],channel:"noise"},{id:"TR_BREAKBEAT_SNARE_CHOP",pattern:"S--S-HS-S-HS-S--",length_beats:4,tags:["transition","section_end","break","breakbeat","drum_fill"],channel:"noise"},{id:"TR_LOFI_TAPE_SWELL",pattern:"N---H---S---H---",length_beats:4,tags:["transition","section_end","lofi","noise_fx","rest_heavy"],channel:"noise"}],va={transitions:fa},ya=da,_a=ca,Ma=pa,ba=ha,Sa=ma,Ra=va,ot=ya,se=_a,qe=new Map(se.map(a=>[a.id,a])),it=Ma,Ue=new Map(it.map(a=>[a.id,a])),re=ba,xa=new Map(re.map(a=>[a.id,a])),Pa=Sa.patterns??[],Ve=Pa.reduce((a,e)=>{const t=a.get(e.texture)??[];return t.push(e),a.set(e.texture,t),a},new Map),me=Ra.transitions??[],be=["root","root","fifth","root","fifth","root","fifth","approach"],Ba={id:"BP_FALLBACK_STEADY",texture:"steady",steps:be,tags:["fallback"]},Ea={upbeat:["straight","syncopation"],sad:["straight","simple"],tense:["syncopation","accented"],peaceful:["straight","open"]},Ta={upbeat:["bright","ascending"],sad:["dark","descending"],tense:["dark","complex","leaping"],peaceful:["simple","arch","bright"]},Ia={upbeat:["syncopated","drive"],sad:["legato","rest_heavy"],tense:["syncopated","staccato"],peaceful:["legato","simple"]},X=new Map(ot.map(a=>[a.id,a])),Ha={dualBass:{preferBeatTags:["percussive_layer","syncopation"],preferFillTags:["drum_fill","build"]},bassLed:{preferBeatTags:["four_on_floor","drive"],preferFillTags:["build"],earlySparseMeasures:1},layeredBass:{preferBeatTags:["four_on_floor","loop_safe"],preferFillTags:["drum_fill"]},minimal:{preferBeatTags:["simple","open"],preferFillTags:["noise_fx"],avoidTags:["build","drive"],earlySparseMeasures:2},breakLayered:{preferBeatTags:["breakbeat","percussive_layer","grid16"],preferFillTags:["break","drum_fill","breakbeat"],avoidTags:["four_on_floor"]},lofiPadLead:{preferBeatTags:["lofi","rest_heavy","swing_hint"],preferFillTags:["noise_fx","lofi"],avoidTags:["breakbeat"],earlySparseMeasures:2},retroPulse:{preferBeatTags:["loop_safe","grid16","syncopation"],preferFillTags:["build","transition"],avoidTags:["rest_heavy"]}},Ka={dualBass:{density:.85,velocityScale:.9,offbeatAccentBoost:3},bassLed:{density:.6,sustainWholeMeasure:!1,offbeatAccentBoost:5},layeredBass:{density:.75,velocityScale:.95},minimal:{density:.5,sustainWholeMeasure:!0,velocityScale:.8},breakLayered:{density:.95,velocityScale:1.05,offbeatAccentBoost:6},lofiPadLead:{density:.55,sustainWholeMeasure:!0,velocityScale:.7},retroPulse:{density:.78,velocityScale:.95,offbeatAccentBoost:2}};function b(a,e,t=.4){if(!e.length)return a;const n=a.filter(s=>{const r=s.tags??[];return e.some(o=>r.includes(o))});return n.length===0||a.length>=4&&n.length<a.length*t?a:n}function ze(a,e){const t=[...a];for(let n=t.length-1;n>0;n--){const s=Math.floor(e()*(n+1)),r=t[n];t[n]=t[s],t[s]=r}return t}function lt(a,e,t,n=.6){if(!e.length||a.length<=1)return a;const s=a.filter(c=>{const p=c.tags??[];return e.some(h=>p.includes(h))});if(!s.length||s.length===a.length)return a;const r=a.filter(c=>!s.includes(c)),o=ze(s,t),i=ze(r,t),l=Math.min(o.length,Math.max(1,Math.ceil(a.length*n))),u=o.slice(0,l),d=[...o.slice(l),...i];return[...u,...d]}const Q=1337;function ce(a){let e=(a??Q)>>>0;return e===0&&(e=Q),()=>(e=e*1664525+1013904223>>>0,e/4294967295)}function k(a,e,t){if(!a.length)throw new Error("No candidates available for selection");if(a.length===1)return a[0];let n=a[Math.floor(e()*a.length)];if(t&&a.length>1){let s=0;for(;(n==null?void 0:n.id)===t&&s<3;)n=a[Math.floor(e()*a.length)],s++}return n}function w(a,e){return e.length?e.every(t=>a.tags.includes(t)):!0}function Oa(a){return Math.abs(a%1)<1e-6}function Aa(a,e){return e.find(t=>a>=t.startBeat&&a<t.startBeat+t.durationBeats)}function ut(a,e){return a===0?"start":a===e-1?"end":"middle"}function ka(a){try{return gt(a),!0}catch{return!1}}function dt(a,e,t,n,s,r,o){var i;const l=ot.filter(ka),u=Ea[a.mood]??[],d=(f,m)=>f.filter(v=>m.some(y=>v.tags.includes(y))),c=l.filter(f=>w(f,s));let p=l.filter(f=>f.tags.includes(t));const h=d(p,u);if(h.length)p=h;else{const f=d(l,u);f.length&&(p=f)}if(e.loopCentric&&(p=b(p,["loop_safe","texture_loop"])),e.textureFocus&&(p=b(p,["texture_loop","straight","simple","grid16"])),e.percussiveLayering&&(p=b(p,["grid16","percussive_layer"])),e.syncopationBias&&(p=b(p,["syncopation"])),p.length||(p=l),s.length){const f=p.filter(m=>w(m,s));f.length?p=f:c.length&&(p=c)}if((i=n==null?void 0:n.variations)!=null&&i.length){const f=n.variations.map(m=>X.get(m)).filter(m=>!!m);if(f.length&&r()<.5){const m=F(f,o);return k(m,r,n.id)}}const g=F(p,o);return k(g,r,n==null?void 0:n.id)}function wa(a,e,t,n,s,r){const o=Ta[a.mood]??[];let i=se.filter(u=>o.some(d=>u.tags.includes(d)));if(t.length){const u=i.filter(d=>w(d,t));if(u.length)i=u;else{const d=se.filter(c=>w(c,t));d.length&&(i=d)}}i.length||(i=se),e.textureFocus&&(i=b(i,["texture_loop","ostinato","loop_safe","short","static"])),e.harmonicStatic&&(i=lt(i,["scalar","stepwise","static"],n,.6)),e.gradualBuild&&(i=b(i,["ascending"]));const l=F(i,r);return k(l,n,s==null?void 0:s.id)}function Fa(a,e,t,n,s,r,o,i){const l=Ia[a.mood]??[];let u=it.filter(h=>Math.abs(h.length-n)<1e-6);if(!u.length)throw new Error(`No melody rhythm motifs of length ${n}`);let d=u.filter(h=>h.tags.includes(t));d.length||(d=u);let c=d.filter(h=>l.some(g=>h.tags.includes(g)));if(c.length||(c=d),e.loopCentric&&(c=b(c,["loop_safe","texture_loop"])),e.textureFocus&&(c=b(c,["texture_loop","grid16","simple"])),e.syncopationBias&&(c=b(c,["syncopated","drive"])),s.length){const h=c.filter(g=>w(g,s));h.length&&(c=h)}c=Ja(c,n);const p=F(c,i);return k(p,r,o)}function Ca(a,e,t,n,s){let r={broken:90,steady:86,arpeggio:92}[a.texture]??88;const o=e===0?6:0,i=a.measures-e<=1?4:0;if(s.textureFocus&&(r-=8),s.gradualBuild){const l=n>1?t/Math.max(1,n-1):0,u=Math.min(1,Math.max(0,l)),d=n<=16?.6:n<=32?.75:.9,c=Math.pow(u,d),p=n<=16?14:n<=32?18:20,h=Math.floor(c*p);r+=h}return s.loopCentric&&(r=Math.max(60,r-2)),Math.min(110,Math.max(58,r+o+i))}function Da(a,e,t,n,s){const r={upbeat:0,peaceful:-3,tense:-5,sad:-2},o={slow:-2,medium:0,fast:2},i={minimalTechno:-4,progressiveHouse:3,retroLoopwave:2,breakbeatJungle:-2,lofiChillhop:-5},l=(n.textureFocus?2:0)+(n.gradualBuild?1:0)+(n.loopCentric?-1:0)+(n.atmosPad?2:0)+(n.percussiveLayering?-2:0),u=r[a]??0,d=o[e]??0,c=t?i[t]??0:0,p=ce(s),h=Math.floor(p()*7)-3,g=72+u+d+c+l+h;return Math.max(63,Math.min(78,g))}function La(a,e,t,n,s,r){if(!a)return r;const o={steady:0,broken:-3,arpeggio:4},i=Math.max(0,e);let l=o[a.texture]??0;if(s.textureFocus&&(l-=4),s.filterMotion&&(l+=1),le(a)&&i===0&&(l+=3),A(a)&&i===0&&(l-=2),s.gradualBuild){const h=t/Math.max(1,n-1),g=Math.round(Math.pow(h,.7)*8);l+=g}(a.measures>0?i/a.measures:0)>=.75&&(l-=2);const u=Math.min(a.occurrenceIndex-1,2)*2;l-=u,s.atmosPad&&(l-=1);const d=60,c=84,p=r+l;return Math.max(d,Math.min(c,p))}function Ga(a,e,t,n){if(e<=0)return;const s=e-.25;if(s<0)return;const r=t.pattern,o=r[r.length-1]??r[0]??1;a.push({channelRole:"melody",startBeat:s,durationBeats:.25,degree:o,velocity:ua.PICKUP_BASE,sectionId:n})}function Na(a,e,t,n){if(!e.length)return a;const s=[e[e.length-1]],r=s[0]+(t.textureFocus?2:1),o=s[0]-(t.loopCentric?1:2),i=new Set([a,s[0],r,o]),l=Array.from(i);return l[Math.floor(n()*l.length)]}function We(a,e,t,n,s){const r=a.variations??[];if(!r.length)return;const o=r.map(l=>X.get(l)).filter(l=>!!l).filter(l=>l.tags.includes(e)&&w(l,t));if(!o.length)return;const i=F(o,s);return k(i,n,a.id)}function qa(a,e,t,n,s){var r;const o=(r=s.steps)!=null&&r.length?s.steps:be,i=[],l=ue(t,40),u=n??t;for(let d=0;d<o.length;d++){const c=e+d*.5,p=ht(o[d],t,u,l);p!==null&&i.push({channelRole:"bass",startBeat:c,durationBeats:.5,degree:0,velocity:pt(a,d),sectionId:a.id,midiOverride:p})}return i}function ct(a,e,t,n,s,r,o){const i=(o==null?void 0:o.enforceDroneStatic)??!0,l=(o==null?void 0:o.preferredTags)??[],u=e===a.measures-1,d=s.get(a.id);if(d){if(u&&!(d.tags??[]).includes("section_end")){const h=G(a.texture,r,t,n,["section_end"],d.id);if(h)return n.add(h.id),h}return d}if(r.harmonicStatic){if(!i&&l.length){const g=G(a.texture,r,t,n,l,void 0);if(g)return s.set(a.id,g),n.add(g.id),g}const h=G(a.texture,r,t,n,["drone","static"],void 0);if(h&&i)return s.set(a.id,h),n.add(h.id),h}const c=le(a)?["pickup"]:[],p=G(a.texture,r,t,n,c,void 0)??G(a.texture,r,t,n,[],void 0)??Ba;if(s.set(a.id,p),n.add(p.id),u&&!(p.tags??[]).includes("section_end")){const h=G(a.texture,r,t,n,["section_end"],p.id);if(h)return n.add(h.id),h}return p}function G(a,e,t,n,s,r){let o=Ve.get(a)??[];if(!o.length&&a!=="steady"&&(o=Ve.get("steady")??[]),!o.length)return;if((e.loopCentric||e.harmonicStatic)&&(o=b(o,["loop_safe"])),e.syncopationBias&&(o=b(o,["syncopated"])),e.textureFocus&&(o=b(o,["default"])),e.percussiveLayering&&(o=b(o,["percussive_layer","four_on_floor"])),e.percussiveLayering&&e.syncopationBias&&e.breakInsertion&&(o=b(o,["breakbeat","variation"],.2)),e.atmosPad&&e.loopCentric&&(o=b(o,["lofi","rest_heavy"],.25)),e.harmonicStatic&&(o=lt(o,["drone","static"],t,.65)),s.length){const l=o.filter(u=>s.every(d=>(u.tags??[]).includes(d)));l.length&&(o=l)}if(!o.length)return;const i=F(o,n);return k(i,t,r)}function Ua(a,e){const t=[];for(const n of e){let s=n.startBeat,r=0;const o=4;for(;r<o&&a.some(i=>Math.abs(i.startBeat-s)<.0625);)r++,s=n.startBeat+r*.0625;t.push({...n,startBeat:s})}return t}function Va(a,e,t,n,s,r,o,i,l){if(!me.length)return;const u=["transition","section_end"];t&&u.push("loop_out");let d=me.filter(v=>v.length_beats<=_);d.length||(d=me);const c=l>1?i/Math.max(1,l-1):0,p=[];if(o.gradualBuild&&(c<.4?p.push("build"):c<.8?p.push("drum_fill"):p.push("loop_out")),o.breakInsertion&&c>=.5&&p.push("noise_fx"),o.percussiveLayering&&p.push("drum_fill"),p.length&&(d=b(d,p,.2)),u.length){const v=d.filter(y=>w(y,u));v.length&&(d=v)}if(!d.length)return;const h=F(d,r),g=k(h,n,s);if(!g)return;const f=g.length_beats>=_?e:e+Math.max(0,_-g.length_beats),m=rt(g.pattern,f,a.id);return{motifId:g.id,hits:m}}function pt(a,e){const t=Le[a.texture]??Le.default;return e===0?t+Ge.DOWNBEAT_BOOST:e%4===0?t+Ge.STRONG_BEAT_BOOST:t}function ht(a,e,t,n){switch(a){case"root":return E(n,e);case"fifth":return E(n+7,e);case"lowFifth":return E(n-5,e);case"octave":return E(n+12,e);case"octaveHigh":return E(n+19,e);case"approach":{const s=ue(t,n+5);return E(s-1,t)}case"rest":return null;default:return E(n,e)}}function gt(a){const e=a.pattern.map(n=>({durationBeats:Re(n)})),t=e.reduce((n,s)=>n+s.durationBeats,0);if(Math.abs(t-a.length)>1e-6)throw new Error(`Rhythm motif ${a.id} length mismatch. expected=${a.length}, got=${t}`);return e}function za(a,e,t){if(a==="steady"){const n=[1,5];return n[Math.floor(t/2)%n.length]}else{const n=[1,3,5,7];return n[e%n.length]}}function Wa(a,e){return 58+(a==="start"&&e===0?6:0)}function $a(a,e,t,n,s,r,o){const i=[],l=gt(t);let u=0,d=0;const c=Ka[r];for(let p=0;p<l.length;p++){const h=l[p];if(u>=_)break;const g=_-u,f=Math.min(h.durationBeats,g),m=za(a.texture,d,u),v=u%1>1e-6;let y=Wa(s,u);if(c!=null&&c.velocityScale&&(y=Math.round(y*c.velocityScale)),v&&c!=null&&c.offbeatAccentBoost&&(y+=c.offbeatAccentBoost),(c==null?void 0:c.density)!==void 0&&c.density<1){const S=Math.max(0,Math.min(1,c.density));if(o()>S){u+=f,d++;continue}}if(i.push({channelRole:"accompaniment",startBeat:e+u,durationBeats:f,degree:m,velocity:y,sectionId:a.id}),u+=f,d++,u>=_)break}if(s==="start"&&le(a)&&n.pattern.length&&e>=.5&&!((c==null?void 0:c.density)!==void 0&&c.density<.5)){const p=n.pattern[0];i.push({channelRole:"accompaniment",startBeat:Math.max(0,e-.5),durationBeats:.5,degree:p,velocity:K.EARLY_START,sectionId:a.id})}if(c!=null&&c.sustainWholeMeasure&&i.length){const p=i[0].degree,h=Math.max(K.PAD_MIN,Math.round(i.reduce((g,f)=>g+f.velocity,0)/i.length));return[{channelRole:"accompaniment",startBeat:e,durationBeats:_,degree:p,velocity:h,sectionId:a.id}]}return i}function ja(a){const e=a.pattern.map(n=>({durationBeats:Re(n.value),rest:!!n.rest,accent:n.accent})),t=e.reduce((n,s)=>n+s.durationBeats,0);if(Math.abs(t-a.length)>1e-6)throw new Error(`Melody rhythm motif ${a.id} length mismatch. expected=${a.length}, got=${t}`);return e}function Ya(a,e){const t=a.pattern??[];if(!t.length)return!1;const n=e>=4?.25:0;let s=0,r=!1,o=0;for(const i of t){const l=Re(i.value);if(i.rest){s+=l,o=0;continue}if(l>=.5){r=!0,o=0;continue}if(o+=l,o>1+1e-6)return!1}return s>=n?!0:r}function Ja(a,e){const t=a.filter(n=>Ya(n,e));return t.length?t:a}function Se(a,e,t){a.has(e)||a.set(e,new Map);const n=a.get(e);return n.has(t)||n.set(t,{}),n.get(t)}function Xa(a,e,t,n){const s=a.get(e);if(!(!s||s.size===0))return s.get(1)}function Qa(a,e,t,n){a.has(e)||a.set(e,new Map);const s=a.get(e);t===1&&s.set(t,n)}function Za(a,e){const t=ce(a.seed),n=a.seed??Date.now(),s=Da(a.mood,a.tempo,a.stylePreset,e.styleIntent,n);return{rng:t,compositionBaseRegister:s,sectionById:new Map(e.sections.map(r=>[r.id,r])),styleIntent:e.styleIntent,voiceArrangement:e.voiceArrangement,totalMeasures:a.lengthInMeasures,usedMotifs:{rhythms:new Set,melodies:new Set,drums:new Set,melodyRhythms:new Set,bassPatterns:new Set,transitions:new Set},caches:{template:new Map,hook:new Map,bassPattern:new Map},lastMotifs:{},motifUsage:{rhythm:{},melody:{},drums:{},melodyRhythm:{},bass:{},transitions:{}}}}function en(a,e,t,n,s){a.startMeasure*_;const r=Math.max(1,Wt(a));let o=0;for(;o<a.measures;){const i=Math.min(r,a.measures-o),l=o===0,u=a.startMeasure+o,d=tn(a,e,t,i,l,u,n,s);an(d,e,t,n,s),o+=i}}function tn(a,e,t,n,s,r,o,i){const l=Xa(o.caches.hook,a.templateId,a.occurrenceIndex,o.rng),u=ut(0,a.measures),d=[];r===o.totalMeasures-1?d.push("loop_safe"):r===o.totalMeasures-2&&!(A(a)&&s)&&d.push("cadence");let c,p,h;const g=oe(u,d);oe(u,d);const f=Se(o.caches.template,a.templateId,g);if(A(a)&&s&&l){const m=X.get(l.rhythmId),v=qe.get(l.melodyId);m&&(c=m),v&&(p=v)}if(!c){const m=f.rhythm;c=m?X.get(m):void 0,c||(c=dt(t,o.styleIntent,u,o.lastMotifs.rhythm,d,o.rng,o.usedMotifs.rhythms),f.rhythm=c.id)}if(!p){const m=f.melody;p=m?qe.get(m):void 0,p||(p=wa(t,o.styleIntent,d,o.rng,o.lastMotifs.melodyFragment,o.usedMotifs.melodies),f.melody=p.id)}if(A(a)&&s&&l){const m=Ue.get(l.melodyRhythmId);m&&(h=m)}if(!h){const m=f.melodyRhythm;h=m?Ue.get(m):void 0,h||(h=Fa(t,o.styleIntent,u,n*_,d,o.rng,void 0,o.usedMotifs.melodyRhythms),f.melodyRhythm=h.id)}return le(a)&&s&&Qa(o.caches.hook,a.templateId,a.occurrenceIndex,{rhythmId:c.id,melodyId:p.id,melodyRhythmId:h.id}),o.usedMotifs.rhythms.add(c.id),o.usedMotifs.melodies.add(p.id),o.usedMotifs.melodyRhythms.add(h.id),o.motifUsage.melodyRhythm[h.id]=(o.motifUsage.melodyRhythm[h.id]??0)+1,s&&i.sectionMotifPlan.push({sectionId:a.id,templateId:a.templateId,occurrenceIndex:a.occurrenceIndex,primaryRhythm:c.id,primaryMelody:p.id,primaryMelodyRhythm:h.id,reprisesHook:A(a)&&!!l&&(l==null?void 0:l.rhythmId)===c.id&&(l==null?void 0:l.melodyId)===p.id&&(l==null?void 0:l.melodyRhythmId)===h.id}),{section:a,phraseMeasures:n,isFirstPhrase:s,phraseStartMeasureIndex:r,cachedHook:l,baseRhythm:c,baseMelody:p,baseMelodyRhythm:h}}function an(a,e,t,n,s){const{section:r,phraseMeasures:o,isFirstPhrase:i,baseMelody:l,baseMelodyRhythm:u}=a;r.startMeasure*_;const d=ja(u);let c=0,p=0,h=0;for(let g=0;g<o;g++){const f=nn(a,g,t,n);i&&g===0&&Ga(s.melody,f.measureStartBeat,l,r.id),sn(f,d,l,r,n,s.melody,{phraseBeatCursor:c,phraseStepIndex:p,melodyDegreeCursor:h});const m=(g+1)*_;for(;p<d.length&&c<m;){const v=d[p];v.rest||h++,c+=v.durationBeats,p++}rn(f,e,r,n,s.bass),on(f,l,r,n,s.accompanimentSeeds),ln(f,r,n,s.drums),n.lastMotifs.rhythm=f.rhythmMotif,n.lastMotifs.melodyFragment=l}}function nn(a,e,t,n){const{section:s,isFirstPhrase:r,baseRhythm:o}=a,i=a.phraseStartMeasureIndex-s.startMeasure+e,l=s.startMeasure+i,u=s.startMeasure*_+i*_,d=ut(i,s.measures),c=[],p=A(s)&&i===0;l===n.totalMeasures-1?c.push("loop_safe"):l===n.totalMeasures-2&&!p&&c.push("cadence");const h=oe(d,c),g=Se(n.caches.template,s.templateId,h),f=t.sectionRepeatBias??.3,m=e>0||!r||s.occurrenceIndex>1,v=!A(s)&&m&&n.rng()>f;let y=g.rhythm?X.get(g.rhythm):void 0;if(!y)v?y=We(o,d,c,n.rng,n.usedMotifs.rhythms)??o:y=o;else if(v&&y.id===o.id){const S=We(o,d,c,n.rng,n.usedMotifs.rhythms);S&&(y=S)}return(!y.tags.includes(d)||!w(y,c))&&(y=dt(t,n.styleIntent,d,o,c,n.rng,n.usedMotifs.rhythms)),g.rhythm=y.id,n.motifUsage.rhythm[y.id]=(n.motifUsage.rhythm[y.id]??0)+1,n.usedMotifs.rhythms.add(y.id),{measureInSection:i,globalMeasureIndex:l,measureStartBeat:u,functionTag:d,requiredTags:c,isHookMeasure:p,phraseOffset:e,rhythmMotif:y}}function sn(a,e,t,n,s,r,o){const{measureStartBeat:i,measureInSection:l,globalMeasureIndex:u,phraseOffset:d}=a,c=(d+1)*_;for(;o.phraseStepIndex<e.length&&o.phraseBeatCursor<c;){const p=e[o.phraseStepIndex],h=o.phraseBeatCursor-d*_;if(!p.rest){let g=t.pattern[o.melodyDegreeCursor%t.pattern.length];o.phraseStepIndex===e.length-1&&(n.occurrenceIndex>1||l>0)&&!A(n)&&(g=Na(g,t.pattern,s.styleIntent,s.rng));let f=Ca(n,l,u,s.totalMeasures,s.styleIntent);r.push({channelRole:"melody",startBeat:i+h,durationBeats:p.durationBeats,degree:g,velocity:f,sectionId:n.id}),o.melodyDegreeCursor++}o.phraseBeatCursor+=p.durationBeats,o.phraseStepIndex++}}function rn(a,e,t,n,s){const{measureStartBeat:r,measureInSection:o}=a;let i=n.caches.bassPattern.get(t.id);i||(i=ct(t,o,n.rng,n.usedMotifs.bassPatterns,n.caches.bassPattern,n.styleIntent),n.caches.bassPattern.set(t.id,i));const l=I(e,r),u=I(e,r+_);s.push(...qa(t,r,l,u,i))}function on(a,e,t,n,s){const{measureStartBeat:r,rhythmMotif:o,functionTag:i}=a;s.push(...$a(t,r,o,e,i,n.voiceArrangement.id,n.rng))}function ln(a,e,t,n){var s;const{measureStartBeat:r,measureInSection:o,requiredTags:i}=a,l=o===e.measures-1,u=l||e.measures>2&&o===e.measures-2,d=oe(`${o}:${u?"fill":"beat"}`,i),c=Se(t.caches.template,e.templateId,d);let p=c.drum?xa.get(c.drum):void 0;if(p||(p=gn(o,e.measures,i,t.rng,t.lastMotifs.drumPatternId,t.usedMotifs.drums,u,t.styleIntent,t.voiceArrangement.id),p&&(c.drum=p.id)),p&&(t.motifUsage.drums[p.id]=(t.motifUsage.drums[p.id]??0)+1,t.usedMotifs.drums.add(p.id),n.push(...rt(p.pattern,r,e.id)),t.lastMotifs.drumPatternId=p.id),l){const h=e.id===((s=t.sectionById.get(Array.from(t.sectionById.keys()).pop()))==null?void 0:s.id),g=Va(e,r,h,t.rng,t.lastMotifs.transitionId,t.usedMotifs.transitions,t.styleIntent,e.startMeasure+o,t.totalMeasures);g&&(t.motifUsage.transitions[g.motifId]=(t.motifUsage.transitions[g.motifId]??0)+1,t.usedMotifs.transitions.add(g.motifId),n.push(...Ua(n,g.hits)),t.lastMotifs.transitionId=g.motifId)}}function un(a,e,t){return a.map(n=>{const s=t.sectionById.get(n.sectionId),r=Math.floor(n.startBeat/_),o=s?r-s.startMeasure:0,i=La(s,o,r,t.totalMeasures,t.styleIntent,t.compositionBaseRegister),l=de(n.degree,e.scaleDegrees,i),u=I(e,n.startBeat),d=Oa(n.startBeat)?E(l,u):J(l,u);return{...n,midi:d}})}function dn(a,e,t){return a.map(n=>{const s=de(n.degree,e.scaleDegrees,67),r=I(e,n.startBeat),o=Aa(n.startBeat,t),i=J(s,r,o==null?void 0:o.midi);return{...n,midi:i}})}function cn(a,e){return a.map(t=>{const n=t.midiOverride??de(t.degree,e.scaleDegrees,52,-1),s=I(e,t.startBeat),r=E(n,s);return{...t,midi:r}})}function pn(a,e){const t=Za(a,e),n={melody:[],bass:[],accompanimentSeeds:[],drums:[],sectionMotifPlan:[]};for(const i of e.sections)en(i,e,a,t,n);const s=un(n.melody,e,t),r=cn(n.bass,e),o=dn(n.accompanimentSeeds,e,s);return{melody:s,bass:r,accompanimentSeeds:o,drums:n.drums,motifUsage:t.motifUsage,sectionMotifPlan:n.sectionMotifPlan}}function hn(a,e){const{voiceArrangement:t}=e,n=a.seed??Q,s=pn(a,e);if(t.id==="standard"||t.id==="swapped")return{tracks:[{role:"melody",notes:s.melody},{role:"bass",notes:s.bass},{role:"accompaniment",notes:s.accompanimentSeeds}],drums:s.drums,motifUsage:s.motifUsage,sectionMotifPlan:s.sectionMotifPlan};const r=[];for(const o of t.voices){let i;switch(o.role){case"bass":case"bassAlt":i=vn(o.role,o.priority,o.octaveOffset??0,o.seedOffset??0,a,e);break;case"pad":i=yn(o.priority,a,e,n+(o.seedOffset??0));break;case"melody":case"melodyAlt":case"accompaniment":if(o.role==="melody"&&t.id==="minimal")continue;o.role==="melody"?i=s.melody:i=s.accompanimentSeeds;break;default:i=[]}const l=i.map(u=>{let d,c=u.velocity;if((u.channelRole==="bass"||o.role==="bass"||o.role==="bassAlt")&&u.midiOverride!==void 0)d=u.midiOverride;else{Math.floor(u.startBeat/_);const p=o.role==="melody"||o.role==="melodyAlt"?72:67,h=de(u.degree,e.scaleDegrees,p),g=I(e,u.startBeat);d=E(h,g),o.octaveOffset&&(d+=o.octaveOffset*12)}return t.id==="layeredBass"&&(o.role==="bass"?c=Math.max(28,Math.round(c*.65)):o.role==="bassAlt"&&(c=Math.max(22,Math.round(c*.5)))),{...u,midi:d,velocity:c}});l.length>0&&r.push({role:o.role,notes:l})}return{tracks:r,drums:s.drums,motifUsage:s.motifUsage,sectionMotifPlan:s.sectionMotifPlan}}function Re(a){switch(a){case 2:return 2;case 4:return 1;case 8:return .5;case 16:return .25;default:return .25}}function gn(a,e,t,n,s,r,o,i,l){var u,d,c;const p=Ha[l];if(!o&&p!=null&&p.earlySparseMeasures&&a<p.earlySparseMeasures&&n()<.3)return;if(i.gradualBuild&&e>=8){const R=a/Math.max(1,e-1),z=Math.min(.35,6/Math.max(1,e)),C=Math.min(.7,14/Math.max(1,e));if(R<z){if(n()<.75)return}else if(R<C&&n()<.35)return}const h=i.breakInsertion?2:4,g=h>0&&e>=h&&(a+1)%h===0,f=o||g;let m=re.filter(R=>f?R.type==="fill":R.type==="beat");const v=m.filter(R=>R.length_beats<=_);if(v.length&&(m=v),t.length){const R=m.filter(z=>{const C=z.tags;return C?t.every(he=>C.includes(he)):!1});R.length&&(m=R)}m.length||(m=re.filter(R=>f?R.type==="fill":R.type==="beat")),m.length||(m=re);const y=i.percussiveLayering&&i.syncopationBias&&i.breakInsertion&&!i.loopCentric,S=i.atmosPad&&i.loopCentric&&i.harmonicStatic,x=i.loopCentric&&i.textureFocus&&i.percussiveLayering;if(f?(d=p==null?void 0:p.preferFillTags)!=null&&d.length&&(m=b(m,p.preferFillTags,.25)):(i.loopCentric&&(m=b(m,["loop_safe"])),i.syncopationBias&&(m=b(m,y?["breakbeat","syncopation","grid16"]:["syncopation"])),i.textureFocus&&(m=b(m,["texture_loop","straight","grid16"])),i.percussiveLayering&&(m=b(m,y?["breakbeat","percussive_layer","grid16"]:["percussive_layer","four_on_floor"])),S&&(m=b(m,["lofi","rest_heavy","swing_hint"],.3)),x&&(m=b(m,["loop_safe","grid16","texture_loop"],.25)),(u=p==null?void 0:p.preferBeatTags)!=null&&u.length&&(m=b(m,p.preferBeatTags,.25))),y&&(m=b(m,["breakbeat","grid16"],.2)),(c=p==null?void 0:p.avoidTags)!=null&&c.length){const R=m.filter(z=>{const C=z.tags;return C?!p.avoidTags.some(he=>C.includes(he)):!0});R.length&&(m=R)}const O=F(m,r);return k(O,n,s)}function F(a,e){if(!a.length)return a;const t=a.filter(n=>n.id?!e.has(n.id):!0);return t.length?t:a}function oe(a,e){if(!e.length)return a;const t=[...e].sort();return`${a}:${t.join("|")}`}function mn(a,e){const t=(a??Q)+e>>>0;return ce(t)}function mt(a,e,t,n,s){if(a>=1)return!0;if(n.gradualBuild){const r=e/Math.max(1,t-1),o=Math.min(1,a+r*.3);return s()<o}return s()<a}function fn(a,e,t,n,s,r,o=0){var i;const l=(i=s.steps)!=null&&i.length?s.steps:be,u=[],d=n??t;for(let c=0;c<l.length;c++){const p=e+c*.5,h=ht(l[c],t,d,r);h!==null&&u.push({channelRole:"bass",startBeat:p,durationBeats:.5,degree:0,velocity:pt(a,c),sectionId:a.id,midiOverride:h})}return u}function vn(a,e,t,n,s,r){const o=[],i=r.styleIntent,l=s.seed??Q,u=mn(l,n),d=new Set,c=new Map,p=40+t*12;for(const h of r.sections){const g=h.startMeasure*_;for(let f=0;f<h.measures;f++){if(!mt(e,f,h.measures,i,u))continue;const m=g+f*_,v=ct(h,f,u,d,c,i,a==="bassAlt"?{enforceDroneStatic:!1,preferredTags:["drone","accent"]}:void 0),y=I(r,m),S=I(r,m+_),x=fn(h,m,y,S,v,p,t);o.push(...x)}}return o}function yn(a,e,t,n){const s=ce(n),r=[];for(const o of t.sections){const i=o.startMeasure*_;for(let l=0;l<o.measures;l++){if(!mt(a,l,o.measures,t.styleIntent,s))continue;const u=i+l*_,d=l%2===0?1:5;r.push({channelRole:"accompaniment",startBeat:u,durationBeats:_,degree:d,velocity:K.PAD_MIN,sectionId:o.id})}}return r}const _n=42,Mn=.5,bn=.015,Sn=.12,$e=1/16,Rn={K:{mode:"long",spec:"long_period",periodIndex:3,releaseRange:[.045,.075],velocity:L.KICK,amplitude:1},T:{mode:"long",spec:"long_period",periodIndex:5,releaseRange:[.05,.09],velocity:L.TOM,amplitude:.92},N:{mode:"long",spec:"long_period",periodIndex:8,releaseRange:[.06,.1],velocity:L.LOW_NOISE,amplitude:.88},S:{mode:"short",spec:"short_period",periodIndex:1,releaseRange:[.02,.045],velocity:L.SNARE,amplitude:.9},H:{mode:"short",spec:"short_period",periodIndex:0,releaseRange:[.015,.03],velocity:L.HIHAT,amplitude:.86},O:{mode:"short",spec:"short_period",periodIndex:2,releaseRange:[.03,.055],velocity:L.OPEN_HAT,amplitude:.94}},xn=5,Pn=.06;function Bn(a){let e=a;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function xe(a,e,t,n){let s=1;const r=e==="bass"||e==="bassAlt",o=a==="square1"||a==="square2";r&&(s*=$.BASS_BASE,t<la.BASS_LOW_RANGE&&(s*=$.BASS_LOW_RANGE)),a==="triangle"&&(s*=$.TRIANGLE_BASE,r||(s*=$.TRIANGLE_NON_BASS)),o&&r&&(s*=$.SQUARE_BASS);const i=Math.round(n*s);return Math.max(De.MIN,Math.min(De.MAX_ACCENT,i))}function En(a,e){const t={reverseProbability:.5,sustainProbability:.2,densityThresholds:{sparse:.45,normal:.85}};return a.textureFocus&&(t.reverseProbability=.35,t.sustainProbability=.12,t.densityThresholds={sparse:.3,normal:.7}),a.loopCentric&&(t.sustainProbability=Math.min(.35,t.sustainProbability+.1),t.densityThresholds={sparse:Math.min(.5,t.densityThresholds.sparse+.05),normal:Math.min(.95,t.densityThresholds.normal+.05)}),e==="arpeggio"&&a.gradualBuild&&(t.densityThresholds={sparse:.25,normal:.65}),t}function Tn(a,e,t,n,s){const r=Math.abs(e.midi-a.midi),o=e.startBeat-(a.startBeat+t),i=r>0&&r<=xn,l=o>=-.001&&o<=.5,u=t>=.5;if(!i||!l||!u)return!1;let d=.15;return n.atmosPad?d=.4:n.loopCentric&&n.textureFocus?d=.35:n.gradualBuild&&n.breakInsertion&&(d=.25),s()<d}function In(a,e,t){let n=a;return e==="slow"?n+=.02:e==="fast"&&(n-=.015),t>=4&&(n+=.01),Math.max(.02,Math.min(.12,n))}function Hn(a,e){if(!a)return!1;const t=`${a}|${e}`;return t==="H|H"||t==="H|O"||t==="O|H"}function Kn(a,e,t){const n=(a==null?void 0:a.releaseRange)??[bn,Sn],s=n[0]+t()*Math.max(0,n[1]-n[0]);return e.percussiveLayering?Math.max(n[0],s*.85):e.gradualBuild?Math.min(n[1],s*1.05):s}function On(a){const e=a.length>0?a:[0,4,7],t=[];for(let n=0;n<4;n++){const s=e[n%e.length],r=Math.floor(n/e.length)*12;t.push(s+r)}return t}function An(a,e,t){return a()<t?[...e].reverse():e}function kn(a,e,t,n,s){const r=En(n,s),o=Math.max(K.PAD_MIN,Math.round(a.velocity*K.ARPEGGIO_SCALE));if(t()<r.sustainProbability){const p=J(a.midi,e,a.midi);return[{...a,startBeat:a.startBeat,durationBeats:Math.max(a.durationBeats,1),velocity:o,midi:p}]}const i=An(t,On(Me(e)),r.reverseProbability),l=t();let u;l<r.densityThresholds.sparse?u=2:l<r.densityThresholds.normal?u=4:u=1;const d=u===4?.25:u===2?.5:Math.max(a.durationBeats,1),c=[];for(let p=0;p<u;p++){const h=a.startBeat+d*p,g=i[p%i.length],f=E(a.midi+g,e),m=J(f,e,a.midi);c.push({channelRole:"accompaniment",startBeat:h,durationBeats:d,degree:a.degree,velocity:o,sectionId:a.sectionId,midi:m})}return c}function wn(a){const e=[];for(const t of a){const n=[0,.5];for(const s of n)e.push({...t,startBeat:t.startBeat+s,durationBeats:.5,velocity:Math.max(K.PAD_MIN,Math.round(t.velocity*K.BROKEN_SCALE))})}return e}function Fn(a){return a.map(e=>({...e,durationBeats:e.durationBeats>=1?e.durationBeats:1,velocity:Math.max(K.PAD_MIN,Math.round(e.velocity*K.STEADY_SCALE))}))}function Cn(a,e,t){return{rng:Bn(a.seed??_n),sectionById:new Map(e.sections.map(n=>[n.id,n])),totalBeats:(a.lengthInMeasures??32)*_,styleIntent:e.styleIntent,tempoSetting:a.tempo??"medium",phase1:e,phase2:t}}function Dn(a,e,t){const n=[],s=e.channel;for(let r=0;r<a.notes.length;r++){const o=a.notes[r],i=t.sectionById.get(o.sectionId);i&&Math.max(0,Math.floor(o.startBeat/_)-i.startMeasure);const l={midi:o.midi,velocity:xe(s,e.role,o.midi,o.velocity)},u=a.notes[r+1];if(u&&Tn(o,u,o.durationBeats,t.styleIntent,t.rng)){const d=Math.abs(u.midi-o.midi);l.slide={targetMidi:u.midi,durationSeconds:In(Pn,t.tempoSetting,d)}}Pe(n,o.startBeat,o.durationBeats,s,l,t.totalBeats)}return n}function Ln(a,e,t){const n=[],s=e.channel;for(const r of a.notes)Pe(n,r.startBeat,r.durationBeats,s,{midi:r.midi,velocity:xe(s,e.role,r.midi,r.velocity)},t.totalBeats);return n}function Gn(a,e,t){var n;const s=[],r=e.channel,o=new Map;for(const l of a.notes){const u=Math.floor(l.startBeat/_),d=o.get(u)??[];d.push(l),o.set(u,d)}const i=Array.from(o.keys()).sort((l,u)=>l-u);for(const l of i){const u=o.get(l),d=u.length?t.sectionById.get(u[0].sectionId):void 0,c=(d==null?void 0:d.texture)??"steady",p=I(t.phase1,((n=u[0])==null?void 0:n.startBeat)??l*_);let h;c==="arpeggio"?h=u.flatMap(v=>kn(v,p,t.rng,t.styleIntent,d==null?void 0:d.texture)):c==="broken"?h=wn(u):h=Fn(u);const g=[],f=[];for(const v of h)t.rng()<t.phase1.techniqueStrategy.echoProbability&&g.push({...v,startBeat:v.startBeat+.25,velocity:Math.round(v.velocity*Ne.ECHO_SCALE)}),t.rng()<t.phase1.techniqueStrategy.detuneProbability&&f.push({...v,startBeat:v.startBeat,velocity:Math.round(v.velocity*Ne.DETUNE_SCALE),midi:v.midi,detuneCents:12});const m=[...h,...g,...f].map(v=>{const y=I(t.phase1,v.startBeat),S=t.phase2.tracks.find(R=>R.role==="melody"),x=S?zn(v.startBeat,S.notes):void 0,O=J(v.midi,y,(x==null?void 0:x.midi)??v.midi);return{...v,midi:O}});for(const v of m)Pe(s,v.startBeat,v.durationBeats,r,{midi:v.midi,velocity:xe(r,e.role,v.midi,v.velocity),detuneCents:v.detuneCents},t.totalBeats)}return s}function Nn(a,e){const t=[];let n=null,s=null,r=null;const o=[...a].sort((i,l)=>i.startBeat-l.startBeat);for(const i of o){let l=i.startBeat;const u=Rn[i.instrument];if(!u)continue;const d=Hn(r,i.instrument),c=d?0:$e;s!==null&&l-s<=c&&(l=s+Math.max(c,$e));const p=Kn(u,e.styleIntent,e.rng),h=Math.max(.01,Math.min(p*.7,p)),g=Math.min(i.durationBeats,Mn);if(l>=e.totalBeats)continue;if(n!==null&&l<n)if(d&&t.length>=2){const m=t[t.length-1];m.command==="noteOff"&&(m.beatTime=l),n=l}else t.pop(),t.pop(),n=null,s=null;t.push({beatTime:l,channel:"noise",command:"noteOn",data:{noiseMode:u.spec,mode:u.spec,velocity:u.velocity,amplitude:u.amplitude,releaseSeconds:p,decaySeconds:h,periodIndex:u.periodIndex,clockDivider:u.periodIndex}});const f=Math.min(l+g,e.totalBeats);t.push({beatTime:f,channel:"noise",command:"noteOff",data:{}}),n=f,s=l,r=i.instrument}return t}function qn(a,e,t){const n=e.role;return n==="melody"||n==="melodyAlt"?Dn(a,e,t):n==="bass"||n==="bassAlt"?Ln(a,e,t):n==="accompaniment"||n==="pad"?Gn(a,e,t):[]}function Un(a,e,t){const n=Cn(a,e,t),s=[];for(const i of t.tracks){const l=e.voiceArrangement.voices.find(d=>d.role===i.role);if(!l)continue;const u=qn(i,l,n);s.push(...u)}const r=Nn(t.drums,n);s.push(...r),s.sort((i,l)=>i.beatTime-l.beatTime);const o=Vn(s);return{events:s,diagnostics:o}}function Pe(a,e,t,n,s,r,o={}){if(e>=r)return;a.push({beatTime:e,channel:n,command:"noteOn",data:s});const i=Math.min(e+t,r);a.push({beatTime:i,channel:n,command:"noteOff",data:o})}function Vn(a){const e=new Map,t={voiceAllocation:[]};for(const n of a){e.has(n.channel)||e.set(n.channel,0);const s=e.get(n.channel);n.command==="noteOn"?e.set(n.channel,s+1):n.command==="noteOff"&&s>0&&e.set(n.channel,s-1),t.voiceAllocation.push({beatTime:n.beatTime,channel:n.channel,activeCount:e.get(n.channel)})}return t}function zn(a,e){return e.find(t=>a>=t.startBeat&&a<t.startBeat+t.durationBeats)}const Wn=[{channel:"square1",param:"duty",value:.25},{channel:"square2",param:"duty",value:.5}],$n=[{id:"DS_MEASURE_BOUNDARY_SWEEP",param:"duty",channels:["square1","square2"],minDurationBeats:1.5,requireMeasureBoundary:!0,steps:[.5,.75,.25]},{id:"DS_MINIMAL_LOW_PASS_THUMP",param:"duty",channels:["square1","square2"],minDurationBeats:2,requireMeasureBoundary:!0,steps:[.18,.38,.24]},{id:"DS_PROGRESSIVE_FILTER_RISE",param:"duty",channels:["square2"],minDurationBeats:4,steps:[.28,.46,.62,.76]},{id:"DS_PROGRESSIVE_PULSE_SQ1",param:"duty",channels:["square1"],minDurationBeats:3,steps:[.22,.4,.56]}],jn=[{id:"GP_TRIANGLE_MEASURE_ACCENT",channel:"triangle",param:"gain",measureBoundaryValue:.9,defaultValue:.7},{id:"GP_NOISE_BREAK_SPILL",channel:"noise",param:"gain",measureBoundaryValue:.82,defaultValue:.7},{id:"GP_MINIMAL_BASS_SIDECHAIN",channel:"square2",param:"gain",measureBoundaryValue:.68,defaultValue:.56},{id:"GP_MINIMAL_PERC_FADE",channel:"noise",param:"gain",measureBoundaryValue:.7,defaultValue:.58},{id:"GP_PROGRESSIVE_PAD_SWELL",channel:"triangle",param:"gain",measureBoundaryValue:.88,defaultValue:.74},{id:"GP_PROGRESSIVE_SQUARE_GLIDE",channel:"square1",param:"gain",measureBoundaryValue:.8,defaultValue:.66}],Yn={initialParams:Wn,dutySweeps:$n,gainProfiles:jn},fe=Yn,Jn={square1:{base:.68,peak:.9},square2:{base:.66,peak:.88},triangle:{base:.48,peak:.68},noise:{base:.74,peak:.82}};function Xn(a,e){const t=[],n=a.events.reduce((u,d)=>Math.max(u,d.beatTime),0),s=Math.max(1,Math.ceil(n/_));for(const u of fe.initialParams??[])t.push({beatTime:0,channel:u.channel,command:"setParam",data:{param:u.param,value:u.value}});const r=[...fe.dutySweeps??[]],o=[...fe.gainProfiles??[]];e.filterMotion&&r.push({id:"STYLE_FILTER_SWELL",param:"duty",channels:["square1","square2"],minDurationBeats:2,steps:[.2,.6,.4,.75]}),e.percussiveLayering&&o.push({id:"STYLE_NOISE_PUNCH",channel:"noise",param:"gain",measureBoundaryValue:.85,defaultValue:.78}),e.percussiveLayering&&!e.breakInsertion&&o.push({id:"STYLE_MINIMAL_SIDECHAIN_SQ1",channel:"square1",param:"gain",measureBoundaryValue:.74,defaultValue:.62},{id:"STYLE_MINIMAL_SIDECHAIN_SQ2",channel:"square2",param:"gain",measureBoundaryValue:.72,defaultValue:.6}),e.atmosPad&&o.push({id:"STYLE_TRIANGLE_PAD",channel:"triangle",param:"gain",measureBoundaryValue:.82,defaultValue:.72}),e.gradualBuild&&e.breakInsertion&&r.push({id:"STYLE_PROGRESSIVE_DUTY_SWELL",param:"duty",channels:["square2"],minDurationBeats:1,steps:[.32,.48,.58,.68]}),e.gradualBuild&&e.breakInsertion&&o.push({id:"STYLE_PROGRESSIVE_TRI_RISE",channel:"triangle",param:"gain",measureBoundaryValue:.9,defaultValue:.76});const i=new Set;for(const u of a.events){if(u.command!=="noteOn")continue;const d=Qn(a.events,u),c=d?d.beatTime-u.beatTime:0;for(const p of r){if(!p.channels.includes(u.channel)||!d||c<p.minDurationBeats||p.requireMeasureBoundary&&!(ve(u.beatTime)||d&&ve(d.beatTime)))continue;const h=c/(p.steps.length+1);p.steps.forEach((g,f)=>{t.push({beatTime:u.beatTime+h*(f+1),channel:u.channel,command:"setParam",data:{param:p.param,value:g}})})}for(const p of o){if(u.channel!==p.channel)continue;const h=ve(u.beatTime)?p.measureBoundaryValue:p.defaultValue;t.push({beatTime:u.beatTime,channel:u.channel,command:"setParam",data:{param:p.param,value:h}})}if(e.breakInsertion&&u.channel==="noise"){const p=Math.floor(u.beatTime/_);if(!i.has(p)&&p>0&&(p+1)%8===0){i.add(p);const h=p*_;t.push({beatTime:h-.25>=0?h-.25:h,channel:"noise",command:"setParam",data:{param:"gain",value:.45}}),t.push({beatTime:h+1,channel:"noise",command:"setParam",data:{param:"gain",value:.78}});for(const g of["square1","square2"])t.push({beatTime:h-.25>=0?h-.25:h,channel:g,command:"setParam",data:{param:"gain",value:.55}}),t.push({beatTime:h+1,channel:g,command:"setParam",data:{param:"gain",value:.82}})}}}if(e.gradualBuild&&s>1){const u=Math.max(1,Math.floor(s/8));for(const[d,c]of Object.entries(Jn)){const p=d;for(let h=0;h<s;h+=u){const g=s>1?h/(s-1):1,f=Math.pow(g,e.loopCentric?.8:1),m=c.base+(c.peak-c.base)*f;t.push({beatTime:h*_,channel:p,command:"setParam",data:{param:"gain",value:Number(m.toFixed(3))}})}}}const l=[...a.events,...t];return l.sort((u,d)=>u.beatTime===d.beatTime?u.command===d.command?0:u.command==="setParam"?-1:d.command==="setParam"?1:0:u.beatTime-d.beatTime),{events:l}}function Qn(a,e){if(e.command!=="noteOn")return;let t,n=1/0;for(const s of a)if(s.channel===e.channel&&s.command==="noteOff"&&s.beatTime>e.beatTime){const r=s.beatTime-e.beatTime;r<n&&(n=r,t=s)}return t}function ve(a){return Math.abs(a%_)<1e-6}function Zn(a,e,t,n,s){const r=60/a.bpm,o=e.map(l=>({time:l.beatTime*r,channel:l.channel,command:l.command,data:l.data}));o.sort((l,u)=>l.time-u.time);const i={voiceAllocation:t.voiceAllocation.map(l=>({time:l.beatTime*r,channel:l.channel,activeCount:l.activeCount})),loopWindow:es(o),motifUsage:n,sectionMotifPlan:s};return{events:o,diagnostics:i}}function es(a){if(!a.length)return{head:[],tail:[]};const e=.1,t=a[a.length-1].time,n=a.filter(s=>t-s.time<e);return{head:a.filter(s=>s.time<e),tail:n}}function ts(a){return{percussiveMelodic:Math.max(-1,Math.min(1,a.percussiveMelodic)),calmEnergetic:Math.max(-1,Math.min(1,a.calmEnergetic))}}function as(a){const{percussiveMelodic:e,calmEnergetic:t}=a,n=Math.max(0,-e),s=Math.max(0,e),r=Math.max(0,-t),o=Math.max(0,t);return{percussiveLayering:n>.3,syncopationBias:n>.4,breakInsertion:n>.35&&o>.4,harmonicStatic:s>.4&&r>.3||n>.3&&r>.2,atmosPad:s>.3||r>.5||o>.55,filterMotion:s>.3||o>.5,loopCentric:r>.3,textureFocus:r>.4||n>.5&&r>.2,gradualBuild:o>.4}}function ns(a){return a.calmEnergetic<-.4?"slow":a.calmEnergetic>.4?"fast":"medium"}function ss(a){const{percussiveMelodic:e,calmEnergetic:t}=a;let n="medium";t>.4&&(n="high"),t<-.4&&(n="low");let s="upbeat";return t<=-.5?s="peaceful":e<=-.4?s="tense":e>=.4?s="sad":t>=.4&&(s="upbeat"),{energy:n,mood:s}}const rs={"minimal-techno":{percussiveMelodic:-.4,calmEnergetic:-.3},"progressive-house":{percussiveMelodic:-.45,calmEnergetic:.6},"retro-loopwave":{percussiveMelodic:.3,calmEnergetic:-.2},"breakbeat-jungle":{percussiveMelodic:-.7,calmEnergetic:.7},"lofi-chillhop":{percussiveMelodic:.5,calmEnergetic:-.6}},Be=["textureFocus","loopCentric","gradualBuild","harmonicStatic","percussiveLayering","breakInsertion","filterMotion","syncopationBias","atmosPad"],os={textureFocus:!1,loopCentric:!1,gradualBuild:!1,harmonicStatic:!1,percussiveLayering:!1,breakInsertion:!1,filterMotion:!1,syncopationBias:!1,atmosPad:!1},is={"minimal-techno":"minimalTechno","progressive-house":"progressiveHouse","retro-loopwave":"retroLoopwave","breakbeat-jungle":"breakbeatJungle","lofi-chillhop":"lofiChillhop"},ls=.35,us={percussiveMelodic:0,calmEnergetic:0};function ds(a){let e=a>>>0;return e===0&&(e=1),()=>(e=e*1664525+1013904223>>>0,e/4294967295)}function cs(a,e,t){const n={...os};for(const s of Be){const r=a[s];typeof r=="boolean"?n[s]=r:t&&e?n[s]=e()>=.5:n[s]=!1}return n}function ps(a,e){const t={...a.intent};if(e.intent)for(const n of Be){const s=e.intent[n];typeof s=="boolean"&&(t[n]=s)}return{tempo:e.tempo??a.tempo,intent:t,randomizeUnsetIntent:e.randomizeUnsetIntent??a.randomizeUnsetIntent}}function hs(a){let e,t=Number.POSITIVE_INFINITY;for(const[n,s]of Object.entries(rs)){const r=Math.hypot(a.percussiveMelodic-s.percussiveMelodic,a.calmEnergetic-s.calmEnergetic);r<t&&(t=r,e=n)}if(!(!e||t>ls))return is[e]??void 0}function gs(a){var e;const t=typeof a.lengthInMeasures=="number"&&a.lengthInMeasures>0?Math.trunc(a.lengthInMeasures):32,n=typeof a.seed=="number"&&Number.isFinite(a.seed)?Math.trunc(a.seed):Math.floor(Math.random()*4294967295),s=a.twoAxisStyle??us,r=ts(s);let o=as(r);if((e=a.overrides)!=null&&e.intent)for(const v of Be){const y=a.overrides.intent[v];typeof y=="boolean"&&(o[v]=y)}const i=ns(r),l=ss(r),u=l.mood;let d={tempo:i,intent:o,randomizeUnsetIntent:!1};a.overrides&&(d=ps(d,a.overrides));const c=d.randomizeUnsetIntent??!1,p=c?ds(n):null,h=cs(d.intent,p,c);d={...d,intent:h,randomizeUnsetIntent:c};const g={mood:u,tempo:d.tempo??"medium",lengthInMeasures:t,seed:n,stylePreset:hs(r),styleOverrides:h},f={...d,tags:{mood:l.mood,energy:l.energy},twoAxisStyle:{...r}},m={lengthInMeasures:t,seed:n,twoAxisStyle:{...r}};return a.overrides&&(m.overrides=JSON.parse(JSON.stringify(a.overrides))),{pipeline:g,profile:f,replayOptions:m}}function ms(a){const{pipeline:e,profile:t,replayOptions:n}=vs(a),s=Qt(e),r=hn(e,s),o=Un(e,s,r),i=Xn(o,s.styleIntent),l=Zn(s,i.events,o.diagnostics,r.motifUsage,r.sectionMotifPlan),u=e.lengthInMeasures*4,d=u/s.bpm*60;return{events:l.events,diagnostics:l.diagnostics,meta:{bpm:s.bpm,key:s.key,seed:e.seed,mood:e.mood,tempo:e.tempo,lengthInMeasures:e.lengthInMeasures,styleIntent:s.styleIntent,voiceArrangement:s.voiceArrangement,profile:t,replayOptions:n,loopInfo:{loopStartBeat:0,loopEndBeat:u,loopStartTime:0,loopEndTime:d,totalBeats:u,totalDuration:d}}}}async function fs(a){return ms(a)}function vs(a){return gs(a)}const ys=[{id:"SE_JUMP_01",type:"jump",description:"Light upward jump sound (square wave sweep)",channels:["square1"],durationRange:[.12,.25],channelParams:{square1:{pitchStart:{min:50,max:62},pitchEnd:{min:72,max:84},dutyCycle:[.25,.5],velocityRange:[96,122]}},pitchSweep:{enabled:!0,curveOptions:["linear","exponential"],durationRange:[.14,.26]}},{id:"SE_JUMP_02",type:"jump",description:"Powerful jump sound (linear sweep, low-pitch start)",channels:["square2"],durationRange:[.15,.3],channelParams:{square2:{pitchStart:{min:40,max:52},pitchEnd:{min:64,max:76},dutyCycle:[.5],velocityRange:[94,120]}},pitchSweep:{enabled:!0,curveOptions:["linear","exponential"],durationRange:[.16,.32]}},{id:"SE_COIN_01",type:"coin",description:"Sparkling coin collection sound (2-note arpeggio)",channels:["square1"],durationRange:[.18,.24],channelParams:{square1:{pitchStart:{min:72,max:84},dutyCycle:[.5],velocityRange:[102,124]}},noteSequence:{intervals:[0,4],noteDurations:[.04,.16]}},{id:"SE_COIN_02",type:"coin",description:"Super Mario-style coin sound (3-note arpeggio, high-pitch)",channels:["square1"],durationRange:[.2,.28],channelParams:{square1:{pitchStart:{min:76,max:84},dutyCycle:[.5]}},noteSequence:{intervals:[0,4,12],noteDurations:[.04,.04,.16]}},{id:"SE_EXPLOSION_01",type:"explosion",description:"Impact explosion sound (noise + triangle bass sweep)",channels:["noise","triangle"],durationRange:[.8,1.2],channelParams:{noise:{noiseMode:"long",envelope:"percussive",velocityRange:[92,120],releaseRange:[.5,.8]},triangle:{pitchStart:{min:36,max:43},pitchEnd:{min:24,max:31}}},pitchSweep:{enabled:!0,curveType:"linear"}},{id:"SE_EXPLOSION_02",type:"explosion",description:"Short explosion sound (noise only, high-frequency)",channels:["noise"],durationRange:[.4,.6],channelParams:{noise:{noiseMode:"short",envelope:"percussive",velocityRange:[90,118],releaseRange:[.22,.4]}}},{id:"SE_HIT_01",type:"hit",description:"Damage sound (short descending arpeggio)",channels:["square1"],durationRange:[.08,.12],channelParams:{square1:{pitchStart:{min:60,max:72},dutyCycle:[.125],envelope:"percussive",velocityRange:[100,126]}},noteSequence:{intervals:[0,-2,-5],noteDurations:[.03,.03,.03]}},{id:"SE_HIT_02",type:"hit",description:"Sharp damage sound (noise + square wave combo)",channels:["square1","noise"],durationRange:[.1,.15],channelParams:{square1:{pitchStart:{min:48,max:60},dutyCycle:[.125],velocityRange:[96,120]},noise:{noiseMode:"short",envelope:"percussive",velocityRange:[94,120],releaseRange:[.12,.2]}}},{id:"SE_POWERUP_01",type:"powerup",description:"Power-up sound (ascending arpeggio, fast)",channels:["square1"],durationRange:[.24,.32],channelParams:{square1:{pitchStart:{min:60,max:67},dutyCycle:[.5]}},noteSequence:{intervals:[0,3,5,7,10,12],noteDurations:[.04,.04,.04,.04,.04,.08]}},{id:"SE_POWERUP_02",type:"powerup",description:"Bright power-up sound (fast arpeggio, high-pitch)",channels:["square2"],durationRange:[.28,.36],channelParams:{square2:{pitchStart:{min:64,max:72},dutyCycle:[.25]}},noteSequence:{intervals:[0,2,4,7,9,12,16],noteDurations:[.04,.04,.04,.04,.04,.04,.08]}},{id:"SE_SELECT_01",type:"select",description:"Menu selection sound (short single tone)",channels:["square1"],durationRange:[.05,.08],channelParams:{square1:{pitchStart:{min:72,max:84},dutyCycle:[.25]}}},{id:"SE_SELECT_02",type:"select",description:"Selection sound (2-note ascending arpeggio)",channels:["square1"],durationRange:[.06,.1],channelParams:{square1:{pitchStart:{min:72,max:84},dutyCycle:[.5]}},noteSequence:{intervals:[0,4],noteDurations:[.03,.04]}},{id:"SE_LASER_01",type:"laser",description:"Laser fire sound (fast descending sweep)",channels:["square1"],durationRange:[.1,.15],channelParams:{square1:{pitchStart:{min:72,max:84},pitchEnd:{min:48,max:60},dutyCycle:[.125,.25]}},pitchSweep:{enabled:!0,curveType:"exponential"}},{id:"SE_LASER_02",type:"laser",description:"Laser fire sound (linear descending sweep)",channels:["square2"],durationRange:[.12,.2],channelParams:{square2:{pitchStart:{min:76,max:88},pitchEnd:{min:52,max:64},dutyCycle:[.125]}},pitchSweep:{enabled:!0,curveType:"linear"}},{id:"SE_CLICK_01",type:"click",description:"Click sound (very short, high-pitch)",channels:["square1"],durationRange:[.02,.03],channelParams:{square1:{pitchStart:{min:84,max:96},dutyCycle:[.125],envelope:"percussive"}}},{id:"SE_CLICK_02",type:"click",description:"Click sound (slightly longer)",channels:["square1"],durationRange:[.03,.04],channelParams:{square1:{pitchStart:{min:88,max:100},dutyCycle:[.125],envelope:"percussive"}}},{id:"SE_SYNTH_01",type:"synth",description:"Synth single tone (square wave)",channels:["square1"],durationRange:[.15,.3],channelParams:{square1:{pitchStart:{min:48,max:72},dutyCycle:[.125,.25,.5]}}},{id:"SE_SYNTH_02",type:"synth",description:"Synth single tone (triangle wave)",channels:["triangle"],durationRange:[.2,.4],channelParams:{triangle:{pitchStart:{min:60,max:84}}}},{id:"SE_TONE_01",type:"tone",description:"Basic tone (square wave, mid-range)",channels:["square1"],durationRange:[.1,.2],channelParams:{square1:{pitchStart:{min:60,max:72},dutyCycle:[.5]}}},{id:"SE_TONE_02",type:"tone",description:"Basic tone (triangle wave, mid-range)",channels:["triangle"],durationRange:[.12,.3],channelParams:{triangle:{pitchStart:{min:60,max:72}}}}],_s={templates:ys};function Ms(){return _s.templates}function bs(a){let e=a>>>0;return e===0&&(e=1),()=>(e=e*1664525+1013904223>>>0,e/4294967295)}class Ss{constructor(){this.templates=Ms()}generateSE(e){const t=e.seed??Math.floor(Math.random()*1e9),n=bs(t),s=this.selectTemplate(e,n),r=this.concretizeParameters(s,n,e.baseFrequency),o=this.generateEvents(s,r,e.startTime??0),i={type:e.type,seed:t,startTime:e.startTime??0};return e.templateId&&(i.templateId=e.templateId),e.baseFrequency!==void 0&&(i.baseFrequency=e.baseFrequency),{events:o,meta:{type:e.type,templateId:s.id,seed:t,duration:r.duration,channels:s.channels,replayOptions:i}}}selectTemplate(e,t){if(e.templateId){const s=this.templates.find(r=>r.id===e.templateId);if(!s)throw new Error(`Template not found: ${e.templateId}`);return s}const n=this.templates.filter(s=>s.type===e.type);if(n.length===0)throw new Error(`No templates found for type: ${e.type}`);return n[Math.floor(t()*n.length)]}concretizeParameters(e,t,n){var s;const[r,o]=e.durationRange,i=r+t()*(o-r),l={};let u=0;n!==void 0&&(u=this.calculatePitchShift(e,n));for(const d of e.channels){const c=e.channelParams[d];if(!c)continue;const p=c.velocityRange?c.velocityRange:d==="noise"?[88,118]:[96,122],h=Math.round(Math.max(1,Math.min(127,this.sampleFloatRange(p,t)))),g=c.pitchStart?this.samplePitchRange(c.pitchStart,t):void 0,f=c.pitchEnd?this.samplePitchRange(c.pitchEnd,t):void 0;if(l[d]={pitchStart:g!==void 0?this.clampMidi(g+u):void 0,pitchEnd:f!==void 0?this.clampMidi(f+u):void 0,dutyCycle:c.dutyCycleRange?this.sampleFloatRange([c.dutyCycleRange.min,c.dutyCycleRange.max],t):c.dutyCycle?c.dutyCycle[Math.floor(t()*c.dutyCycle.length)]:void 0,noiseMode:c.noiseMode,envelope:c.envelope,velocity:h,releaseSeconds:c.releaseRange?this.sampleFloatRange(c.releaseRange,t):void 0},(s=e.pitchSweep)!=null&&s.enabled){const m=e.pitchSweep.curveOptions??(e.pitchSweep.curveType?[e.pitchSweep.curveType]:void 0);m&&(l[d].sweepCurve=this.weightedChoice(m,e.pitchSweep.curveWeights,t)??e.pitchSweep.curveType),e.pitchSweep.durationRange&&(l[d].sweepDuration=this.sampleFloatRange(e.pitchSweep.durationRange,t))}}return{duration:i,channelParams:l}}samplePitchRange(e,t){return Math.floor(e.min+t()*(e.max-e.min+1))}sampleFloatRange(e,t){return e[0]+t()*(e[1]-e[0])}weightedChoice(e,t,n){if(!t)return e[Math.floor(n()*e.length)];const s=e.reduce((o,i)=>o+(t[String(i)]||1),0);let r=n()*s;for(const o of e){const i=t[String(o)]||1;if(r<i)return o;r-=i}return e[e.length-1]}generateEvents(e,t,n){const s=[];for(const r of e.channels){const o=t.channelParams[r],i=this.generateChannelEvents(r,e,o,t,n);s.push(...i)}return s.sort((r,o)=>r.time-o.time),s}generateChannelEvents(e,t,n,s,r){return e.startsWith("square")?this.generateSquareEvents(e,t,n,s,r):e==="triangle"?this.generateTriangleEvents(e,t,n,s,r):e==="noise"?this.generateNoiseEvents(t,n,s,r):[]}generateSquareEvents(e,t,n,s,r){var o;const i=[];return n.dutyCycle!==void 0&&i.push({time:r,channel:e,command:"setParam",data:{param:"duty",value:n.dutyCycle}}),t.noteSequence?i.push(...this.generateNoteSequence(e,t,n,r)):(o=t.pitchSweep)!=null&&o.enabled?i.push(...this.generatePitchSweep(e,t,n,s,r)):n.pitchStart!==void 0&&i.push(...this.generateSimpleNote(e,n,s.duration,r)),i}generateTriangleEvents(e,t,n,s,r){var o;const i=[];return t.noteSequence?i.push(...this.generateNoteSequence(e,t,n,r)):(o=t.pitchSweep)!=null&&o.enabled?i.push(...this.generatePitchSweep(e,t,n,s,r)):n.pitchStart!==void 0&&i.push(...this.generateSimpleNote(e,n,s.duration,r)),i}generateNoiseEvents(e,t,n,s){const r=[],o="noise";t.noiseMode&&r.push({time:s,channel:o,command:"setParam",data:{param:"noiseMode",value:t.noiseMode}});const i=t.velocity??110,l=t.releaseSeconds??n.duration*.3,u={velocity:i};return t.noiseMode&&(u.noiseMode=t.noiseMode),t.envelope==="percussive"?(u.decaySeconds=n.duration*.7,u.releaseSeconds=l):t.releaseSeconds&&(u.releaseSeconds=l),r.push({time:s,channel:o,command:"noteOn",data:u}),r.push({time:s+n.duration,channel:o,command:"noteOff",data:{}}),r}generateNoteSequence(e,t,n,s){const r=[];if(!t.noteSequence)return r;let o=s;const i=n.pitchStart,l=n.velocity??110;for(let u=0;u<t.noteSequence.intervals.length;u++){const d=i+t.noteSequence.intervals[u],c=t.noteSequence.noteDurations[u];r.push({time:o,channel:e,command:"noteOn",data:{midi:d,velocity:l}}),r.push({time:o+c,channel:e,command:"noteOff",data:{}}),o+=c}return r}generatePitchSweep(e,t,n,s,r){var o;const i=[];if(!((o=t.pitchSweep)!=null&&o.enabled))return i;const l=n.sweepDuration??s.duration,u=n.sweepCurve??t.pitchSweep.curveType??"exponential",d=n.velocity??110;return i.push({time:r,channel:e,command:"noteOn",data:{midi:n.pitchStart,velocity:d}}),i.push({time:r,channel:e,command:"setParam",data:{param:"pitchBend",value:n.pitchEnd,rampDuration:l,curve:u}}),i.push({time:r+l,channel:e,command:"noteOff",data:{}}),i}generateSimpleNote(e,t,n,s){const r=[],o=t.velocity??110,i=t.releaseSeconds;return r.push({time:s,channel:e,command:"noteOn",data:{midi:t.pitchStart,velocity:o}}),r.push({time:s+n,channel:e,command:"noteOff",data:i?{releaseSeconds:i}:{}}),r}calculatePitchShift(e,t){for(const n of e.channels){const s=e.channelParams[n];if(!(s!=null&&s.pitchStart))continue;const r=(s.pitchStart.min+s.pitchStart.max)/2,o=ra(r),i=t/o,l=sa(i);return Math.round(l)}return 0}clampMidi(e){return Math.max(0,Math.min(127,Math.round(e)))}}const je=.1,Rs=25,Ye=.3,xs=1789773,ye=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068],Je={K:{mode:"long",periodIndex:14,baseAmplitude:.75,decaySeconds:.22,releaseSeconds:.04,cutoffHz:3200},S:{mode:"short",periodIndex:4,baseAmplitude:.65,decaySeconds:.14,releaseSeconds:.03,cutoffHz:5200},H:{mode:"short",periodIndex:1,baseAmplitude:.45,decaySeconds:.06,releaseSeconds:.02,cutoffHz:7800},O:{mode:"short",periodIndex:2,baseAmplitude:.6,decaySeconds:.4,releaseSeconds:.06,cutoffHz:6800},T:{mode:"long",periodIndex:10,baseAmplitude:.6,decaySeconds:.26,releaseSeconds:.05,cutoffHz:3600},default:{mode:"short",periodIndex:3,baseAmplitude:.6,decaySeconds:.14,releaseSeconds:.03,cutoffHz:6e3}},Ps=69,Bs=440;function ie(a){return Bs*Math.pow(2,(a-Ps)/12)}function Es(a,e=.85){return Math.max(0,Math.min(1,(a??100)/127*e))}class Ee{constructor(e,t,n){this.context=e;const s=new AudioWorkletNode(e,t);s.connect(n),this.port=s.port,this.sampleRate=e.sampleRate,this.nodeStartTime=e.currentTime}scheduleMessage(e,t){const n=t-this.nodeStartTime,s=Math.max(0,Math.round(n*this.sampleRate));this.port.postMessage({...e,sampleFrame:s})}stop(){this.port.postMessage({type:"clear"})}}class Xe extends Ee{constructor(e,t){super(e,"square-processor",t),this.currentDuty=.5}noteOn(e,t){const n=e.detuneCents??0,s=Math.pow(2,n/1200),r={type:"noteOn",frequency:e.frequency*s,amplitude:e.amplitude??.8,duty:e.duty??this.currentDuty};e.slide&&(r.slide={targetFrequency:e.slide.targetFrequency,durationSamples:Math.round((e.slide.durationSeconds??0)*this.sampleRate)}),this.scheduleMessage(r,t)}noteOff(e,t){this.scheduleMessage({type:"noteOff"},t)}setParam(e,t){if(e.param==="duty"&&(this.currentDuty=Number(e.value??this.currentDuty)),e.param==="pitchBend"&&typeof e.value=="number"){const n=e.value>0?ie(e.value):0,s=Number(e.rampDuration??0),r=e.curve??"linear";this.scheduleMessage({type:"setParam",param:"pitchBend",value:n,rampDuration:s,curve:r},t);return}this.scheduleMessage({type:"setParam",param:e.param,value:e.value},t)}}class Ts extends Ee{constructor(e,t){super(e,"triangle-processor",t)}noteOn(e,t){const n={type:"noteOn",frequency:e.frequency,amplitude:e.amplitude??.7};this.scheduleMessage(n,t)}noteOff(e,t){this.scheduleMessage({type:"noteOff"},t)}setParam(e,t){if(e.param==="pitchBend"&&typeof e.value=="number"){const n=e.value>0?ie(e.value):0,s=Number(e.rampDuration??0),r=e.curve??"linear";this.scheduleMessage({type:"setParam",param:"pitchBend",value:n,rampDuration:s,curve:r},t);return}this.scheduleMessage({type:"setParam",param:e.param,value:e.value},t)}}class Is extends Ee{constructor(e,t){super(e,"noise-processor",t),this.periodIndex=0,this.mode="short"}noteOn(e,t){const n=Math.max(0,Math.min(ye.length-1,e.periodIndex??this.periodIndex)),s=ye[n]*16/xs,r=Math.max(1,Math.round(s*this.sampleRate)),o=Math.max(.001,e.decaySeconds??.12),i=Math.max(.001,e.releaseSeconds??.03),l=Math.max(1,Math.round(o*this.sampleRate)),u=Math.max(1,Math.round(i*this.sampleRate)),d=Math.max(0,Math.min(1,e.amplitude??.6)),c=e.mode==="long"?"long":"short",p=Math.max(100,Math.min(this.sampleRate/2,e.cutoffHz??6e3));this.periodIndex=n,this.mode=c,this.scheduleMessage({type:"noteOn",mode:c,amplitude:d,periodSamples:r,decaySamples:l,releaseSamples:u,cutoffHz:p},t)}noteOff(e,t){const n=Math.max(.001,Number((e==null?void 0:e.releaseSeconds)??.03)),s=Math.max(1,Math.round(n*this.sampleRate));this.scheduleMessage({type:"noteOff",releaseSamples:s},t)}setParam(e,t){if(!(!e||!e.param)){if(e.param==="mode"&&typeof e.value=="string"&&(this.mode=e.value==="long"?"long":"short"),e.param==="periodIndex"){const n=Number(e.value??this.periodIndex);this.periodIndex=Math.max(0,Math.min(ye.length-1,n))}this.scheduleMessage({type:"setParam",param:e.param,value:e.value},t)}}}const Qe=new WeakMap,ft=class _e{constructor(e,t={}){this.context=e,this.events=[],this.eventIndex=0,this.lookahead=je,this.leadTime=Ye,this.intervalHandle=null,this.startTime=0,this.lastEventTime=0,this.completionResolver=null,this.loopEnabled=!1,this.eventCallback=null,this.masterGainNode=e.createGain(),this.masterGainNode.gain.value=_e.BASE_GAIN;const n=t.gainNode??e.destination;this.masterGainNode.connect(n),this.workletBasePath=t.workletBasePath??"./worklets/"}async init(){const e=this.context,t=this.workletBasePath;let n=Qe.get(e);n||(n=new Set,Qe.set(e,n));const s=async r=>{if(n.has(r))return;const o=`${t}${r}`;try{await e.audioWorklet.addModule(o),n.add(r)}catch(i){const l=i instanceof Error?i.message:String(i);throw new Error(`Failed to load AudioWorklet "${r}" from "${o}". Verify that the processor file is hosted and workletBasePath is correct. Cause: ${l}`)}};await s("square-processor.js"),await s("triangle-processor.js"),await s("noise-processor.js"),this.channels={square1:new Xe(e,this.masterGainNode),square2:new Xe(e,this.masterGainNode),triangle:new Ts(e,this.masterGainNode),noise:new Is(e,this.masterGainNode)}}get masterGain(){return this.masterGainNode}stop(){this.intervalHandle!==null&&(clearInterval(this.intervalHandle),this.intervalHandle=null),Object.values(this.channels).forEach(e=>e.stop()),this.completionResolver&&(this.completionResolver(),this.completionResolver=null)}play(e,t={}){return this.preparePlayback(e,t,!1),new Promise(n=>{this.completionResolver=n,this.startScheduler()})}playLoop(e,t={}){this.preparePlayback(e,t,!0),this.completionResolver=null,this.startScheduler()}preparePlayback(e,t,n){this.stop(),this.events=e??[],this.lookahead=t.lookahead??je,this.leadTime=t.leadTime??Ye,this.loopEnabled=n,this.eventCallback=t.onEvent??null;const s=t.volume??1;this.masterGainNode.gain.value=_e.BASE_GAIN*s;const r=this.events.length?this.events[this.events.length-1].time:0;let o=Math.max(0,t.offset??0);o>0&&(n&&r>0?o=o%r:o=Math.min(o,r));const i=this.context.currentTime,l=t.startTime??i+this.leadTime;this.startTime=l-o,this.lastEventTime=r,this.eventIndex=this.resolveEventIndex(o)}startScheduler(){const e=()=>this.tick();this.intervalHandle=window.setInterval(e,Rs),e()}resolveEventIndex(e){if(e<=0)return 0;const t=.001;for(let n=0;n<this.events.length;n+=1)if(this.events[n].time+t>=e)return n;return this.events.length}tick(){const e=this.context.currentTime,t=e+this.lookahead;for(;this.eventIndex<this.events.length;){const n=this.events[this.eventIndex],s=this.startTime+n.time;if(s<=t)this.dispatchEvent(n,s),this.eventIndex+=1;else break}if(this.loopEnabled&&this.eventIndex>=this.events.length&&(this.startTime+=this.lastEventTime,this.eventIndex=0),!this.loopEnabled){const n=this.startTime+this.lastEventTime+1;this.eventIndex>=this.events.length&&e>=n&&this.stop()}}dispatchEvent(e,t){const n=e.data??{};switch(this.eventCallback&&this.eventCallback(e,t),e.channel){case"square1":case"square2":e.command==="noteOn"?this.channels[e.channel].noteOn(this.mapPitchData(n),t):e.command==="noteOff"?this.channels[e.channel].noteOff(n,t):e.command==="setParam"&&this.channels[e.channel].setParam(n,t);break;case"triangle":e.command==="noteOn"?this.channels.triangle.noteOn(this.mapPitchData(n),t):e.command==="noteOff"?this.channels.triangle.noteOff(n,t):e.command==="setParam"&&this.channels.triangle.setParam(n,t);break;case"noise":e.command==="noteOn"?this.channels.noise.noteOn(this.mapNoiseData(n),t):e.command==="noteOff"?this.channels.noise.noteOff(n,t):e.command==="setParam"&&this.channels.noise.setParam(n,t);break}}mapPitchData(e){const t=Number(e.midi??60),n=Number(e.detuneCents??0);let s=null;const r=e.slide;return r&&(typeof r.targetMidi=="number"?s={targetFrequency:ie(r.targetMidi),durationSeconds:Number(r.durationSeconds??0)}:typeof r.targetFrequency=="number"&&(s={targetFrequency:r.targetFrequency,durationSeconds:Number(r.durationSeconds??0)})),{frequency:ie(t),amplitude:Es(typeof e.velocity=="number"?e.velocity:void 0),duty:typeof e.duty=="number"?e.duty:void 0,detuneCents:n,slide:s}}mapNoiseData(e){const t=typeof e.velocity=="number"?e.velocity:100,n=Math.max(0,Math.min(1,t/127)),s=typeof e.instrument=="string"?e.instrument:"S",r=Je[s]??Je.default,o=Math.min(1,Math.max(0,(typeof e.amplitude=="number"?e.amplitude:r.baseAmplitude)*n)),i=typeof e.decaySeconds=="number"?e.decaySeconds:r.decaySeconds,l=typeof e.releaseSeconds=="number"?e.releaseSeconds:r.releaseSeconds,u=typeof e.periodIndex=="number"?e.periodIndex:typeof e.clockDivider=="number"?e.clockDivider:typeof e.period=="number"?e.period:r.periodIndex,d=typeof e.mode=="string"?e.mode:typeof e.noiseMode=="string"?e.noiseMode:r.mode,c=typeof e.cutoffHz=="number"?e.cutoffHz:r.cutoffHz;return{amplitude:o,decaySeconds:i,releaseSeconds:l,periodIndex:u,mode:d,cutoffHz:c}}};ft.BASE_GAIN=.16;let Ze=ft;const et=-6,Hs=1,Ks=.03,ee=.001;class Os{constructor(e,t,n,s,r){this.context=e,this.seSynth=t,this.getTimeline=n,this.bgmGain=s,this.getBgmBaseVolume=r,this.scheduledByType={},this.nextTriggerTime=null,this.flushHandle=null}async play(e,t={}){const n={duckingDb:t.duckingDb??et,volume:t.volume??Hs,quantize:t.quantize},s=e.meta.type;return this.scheduledByType[s]?Promise.resolve():new Promise((r,o)=>{const i=this.determineTargetTime(n),l={result:e,options:n,targetTime:i,resolve:r,reject:o};this.scheduledByType[s]=l,this.registerJob(l)})}resetDucking(){const e=this.context.currentTime,t=this.bgmGain.gain,n=this.getBgmBaseVolume();t.cancelScheduledValues(e),t.setValueAtTime(n,e)}cancelPendingJobs(){this.flushHandle!==null&&(clearTimeout(this.flushHandle),this.flushHandle=null);const e=Object.values(this.scheduledByType).filter(t=>t!=null);for(const t of e)t.resolve();this.scheduledByType={},this.nextTriggerTime=null}registerJob(e){if(this.nextTriggerTime===null||e.targetTime<this.nextTriggerTime-ee){this.nextTriggerTime=e.targetTime,this.alignJobsTo(this.nextTriggerTime),this.scheduleFlush();return}if(Math.abs(e.targetTime-this.nextTriggerTime)<=ee){e.targetTime=this.nextTriggerTime;return}e.targetTime=this.nextTriggerTime}alignJobsTo(e){for(const t of Object.values(this.scheduledByType))t&&(t.targetTime=e)}determineTargetTime(e){const t=this.context,n=t.currentTime;let s=n;if(e.quantize){const r=this.quantizeStart(e.quantize,n);r!==null&&(s=r)}return s<t.currentTime+ee&&(s=t.currentTime+ee),s}scheduleFlush(){if(this.nextTriggerTime===null)return;this.flushHandle!==null&&clearTimeout(this.flushHandle);const e=this.context.currentTime,t=this.nextTriggerTime-Ks,n=Math.max(0,(t-e)*1e3);this.flushHandle=window.setTimeout(()=>{this.flushHandle=null,this.flushScheduled()},n)}flushScheduled(){const e=this.nextTriggerTime;if(e===null)return;const t=Object.values(this.scheduledByType).filter(u=>u!=null);if(t.length===0){this.nextTriggerTime=null;return}const n=this.context,s=Math.max(e,n.currentTime+.005),r=t.reduce((u,d)=>Math.max(u,d.result.meta.duration),0),o=t.reduce((u,d)=>Math.min(u,d.options.duckingDb),et),i=this.resolveBatchVolume(t),l=this.mergeScheduledEvents(t,i);if(this.applyDucking(o,r,s),this.nextTriggerTime=null,this.scheduledByType={},l.length===0){t.forEach(u=>u.resolve());return}this.seSynth.play(l,{startTime:s,volume:i}).then(()=>{t.forEach(u=>u.resolve())},u=>{t.forEach(d=>d.reject(u))})}quantizeStart(e,t){const n=this.getTimeline();let s,r,o;if(n)s=n.meta.bpm,r=n.startTime,o=n.meta.loopInfo.totalBeats;else if(e.fallbackTempo!==void 0&&e.fallbackTempo>0)s=e.fallbackTempo,r=e.referenceTime??0,o=0;else return null;const i=60/s,l=4,u=this.resolveStepBeats(e.quantizeTo,l);if(u<=0)return null;const d=Math.max(0,(t-r)/i);let c=this.resolvePhaseBeat(e.phase??"next",d,u,l);if(c+=e.offsetBeats??0,e.loopAware&&o>0){for(;c*i+r<t-.001;)c+=u;const p=o;if(c>=p){c=c%p;const h=Math.ceil((d-c)/p);c+=h*p}}else{const p=u*i;let h=r+c*i;for(;h<t-.001;)h+=p,c+=u;return h}return r+c*i}resolveStepBeats(e,t){return e==="beat"?1:e==="half_beat"?.5:e==="measure"?t:typeof e=="object"&&e.subdivision>0?1/e.subdivision:0}resolvePhaseBeat(e,t,n,s){if(e==="current"){const i=Math.floor(t/n)*n;return i+1e-6<t?i+n:i}if(e==="next"||e==null)return Math.ceil((t-1e-6)/n)*n;const r=Math.max(0,e.measure),o=Math.max(0,e.beat??0);return r*s+o}applyDucking(e,t,n){if(!Number.isFinite(e)||e>=0)return;const s=this.bgmGain,r=this.context.currentTime,o=this.getBgmBaseVolume(),i=Math.pow(10,e/20),l=Math.max(0,o*i),u=Math.max(r,n-.005),d=u+.02,c=Math.max(d,n+t)+Math.max(.05,t*.5),p=s.gain;p.cancelScheduledValues(r),p.setValueAtTime(p.value,r),p.setValueAtTime(p.value,u),p.linearRampToValueAtTime(l,d),p.linearRampToValueAtTime(o,c)}resolveBatchVolume(e){return e.reduce((t,n)=>Math.max(t,n.options.volume),0)}mergeScheduledEvents(e,t){const n=[];for(const s of e){const r=this.resolveVolumeRatio(s.options.volume,t);for(const o of s.result.events)n.push(this.scaleEventForVolume(o,r))}return n.sort((s,r)=>s.time-r.time),n}resolveVolumeRatio(e,t){if(t<=0)return 0;const n=e/t;return!Number.isFinite(n)||n<=0?0:Math.min(1,n)}scaleEventForVolume(e,t){const n={...e,data:{...e.data}};if(e.command==="noteOn"&&typeof e.data.velocity=="number"){const s=e.data.velocity*t;n.data.velocity=Math.max(0,Math.min(127,s))}return n}}const As={duckingDb:-6,volume:1},ks="./worklets/",ws=44100,Fs=.2,Cs=.1;class Ds{constructor(e={}){this.options=e,this.bgmSynth=null,this.seSynth=null,this.bgmGainBase=1,this.seGainBase=1,this.seGenerator=new Ss,this.soundEffectController=null,this.activeTimeline=null,this.lastBgm=null,this.pausedOffsetSeconds=null,this.lastPlayOptions=null,e.audioContext?(this.context=e.audioContext,this.ownsContext=!1):(this.context=null,this.ownsContext=!0),this.gainNode=e.gainNode??null,this.workletBasePath=e.workletBasePath??ks,this.seDefaults={...As,...e.seDefaults??{}},this.bgmVolume=Math.max(0,e.bgmVolume??1)}async ensureReady(){const e=this.ensureContext(!0);return await this.ensureBgmSynth(e),await this.ensureSeSynth(e),await this.ensureSoundEffectController(e),e}async generateBgm(e){const t=await fs(e);return this.lastBgm=t,t}async playBgm(e,t={}){const n=await this.ensureReady(),s=t.loop??!0,r=Math.max(0,t.offset??0),o=t.leadTime??Fs,i=t.lookahead??Cs,l=t.startTime??n.currentTime+o,u=l-r,d=t.volume??this.bgmVolume;this.activeTimeline={startTime:u,loop:s,meta:e.meta},this.lastBgm=e;const c={startTime:l,offset:r,leadTime:o,lookahead:i,volume:d,onEvent:t.onEvent??void 0},p={...t,loop:s,offset:r,leadTime:o,lookahead:i,volume:d,onEvent:c.onEvent};delete p.startTime,this.lastPlayOptions=p,this.pausedOffsetSeconds=null,s?this.bgmSynth.playLoop(e.events,c):this.bgmSynth.play(e.events,c).catch(h=>{console.error("BGM playback error:",h)})}stopBgm(){var e,t;(e=this.bgmSynth)==null||e.stop(),(t=this.soundEffectController)==null||t.resetDucking(),this.activeTimeline=null,this.pausedOffsetSeconds=null}stopAllAudio(){var e;this.pauseBgm({captureOffset:!1}),(e=this.seSynth)==null||e.stop(),this.cancelScheduledSe(),this.pausedOffsetSeconds=null}pauseBgm(e={}){var t,n,s,r;const{captureOffset:o=!0}=e;if(o){const i=this.activeTimeline,l=this.context;if(i&&l){const u=Math.max(0,l.currentTime-i.startTime),d=((n=(t=i.meta)==null?void 0:t.loopInfo)==null?void 0:n.totalDuration)??0,c=d>0?u%d:u;this.pausedOffsetSeconds=c}else this.pausedOffsetSeconds=null}return(s=this.bgmSynth)==null||s.stop(),(r=this.soundEffectController)==null||r.resetDucking(),this.activeTimeline=null,this.pausedOffsetSeconds}async resumeBgm(e={}){const t=this.lastBgm;if(!t)throw new Error("No background music available to resume.");const{offsetSeconds:n,...s}=e,r=typeof n=="number"?Math.max(0,n):this.pausedOffsetSeconds??0;this.pausedOffsetSeconds=null;const o={...this.lastPlayOptions??{},...s};delete o.startTime,o.offset=r,await this.playBgm(t,o)}setBgmVolume(e){const t=Math.max(0,e);this.bgmVolume=t,this.bgmSynth&&this.context&&this.bgmSynth.masterGain.gain.setValueAtTime(this.bgmGainBase*t,this.context.currentTime)}configureSeDefaults(e){const t={...this.seDefaults,...e};e.volume!==void 0&&(t.volume=Math.max(0,e.volume),this.seSynth&&this.context&&this.seSynth.masterGain.gain.setValueAtTime(this.seGainBase*t.volume,this.context.currentTime)),this.seDefaults=t}generateSe(e){return this.seGenerator.generateSE(e)}async playSe(e,t={}){await this.ensureReady();const n={duckingDb:t.duckingDb??this.seDefaults.duckingDb,volume:Math.max(0,t.volume??this.seDefaults.volume),quantize:t.quantize??this.seDefaults.quantize};await this.soundEffectController.play(e,n)}async triggerSe(e){const t=this.generateSe({type:e.type,seed:e.seed,templateId:e.templateId,baseFrequency:e.baseFrequency});await this.playSe(t,{duckingDb:e.duckingDb,volume:e.volume,quantize:e.quantize})}cancelScheduledSe(){var e;(e=this.soundEffectController)==null||e.cancelPendingJobs()}getActiveTimeline(){return this.activeTimeline}getAudioContext(){return this.context}resumeAudioContext(){this.ensureContext(!0)}suspendAudioContext(){this.context&&this.context.state==="running"&&this.context.suspend()}async close(){this.stopAllAudio(),this.context&&this.ownsContext&&await this.context.close().catch(e=>{console.warn("AudioContext close failed:",e)}),this.context=null,this.bgmSynth=null,this.seSynth=null,this.soundEffectController=null,this.activeTimeline=null,this.lastBgm=null,this.lastPlayOptions=null,this.pausedOffsetSeconds=null}ensureContext(e){if(!this.context)try{this.context=new AudioContext({sampleRate:ws,latencyHint:"interactive"})}catch(t){const n=t instanceof Error?t.message:String(t);throw new Error(`AudioContext initialization failed. Ensure the page has a user interaction and autoplay is allowed. Cause: ${n}`)}if(e&&this.context.state==="suspended")try{this.context.resume()}catch(t){const n=t instanceof Error?t.message:String(t);throw new Error(`AudioContext resume failed. Try resuming after a user gesture or check browser policies. Cause: ${n}`)}return this.context}async ensureBgmSynth(e){this.bgmSynth||(this.bgmSynth=new Ze(e,{workletBasePath:this.workletBasePath,gainNode:this.gainNode??void 0}),await this.bgmSynth.init(),this.bgmGainBase=this.bgmSynth.masterGain.gain.value,this.bgmSynth.masterGain.gain.setValueAtTime(this.bgmGainBase*this.bgmVolume,e.currentTime))}async ensureSeSynth(e){this.seSynth||(this.seSynth=new Ze(e,{workletBasePath:this.workletBasePath,gainNode:this.gainNode??void 0}),await this.seSynth.init(),this.seGainBase=this.seSynth.masterGain.gain.value,this.seSynth.masterGain.gain.setValueAtTime(this.seGainBase*this.seDefaults.volume,e.currentTime))}async ensureSoundEffectController(e){if(!this.soundEffectController){if(!this.bgmSynth||!this.seSynth)throw new Error("Sound effect controller requires both BGM and SE synthesizers.");this.soundEffectController=new Os(e,this.seSynth,()=>this.activeTimeline,this.bgmSynth.masterGain,()=>{var t;const n=((t=this.lastPlayOptions)==null?void 0:t.volume)??this.bgmVolume;return this.bgmGainBase*n})}}}function Ls(a={}){return new Ds(a)}function Gs(a,e={}){const t=e.documentRef??document,n=e.cancelScheduledSe??!0,s=e.suspendAudioContext??!0,r=e.resumeAudioContext??!0;let o=!1,i=null;const l=()=>{var u,d;if(t.hidden){if(!(!e.shouldPause||e.shouldPause())){if(s)try{a.suspendAudioContext()}catch(p){console.warn("AudioContext suspend failed:",p)}return}if(a.getActiveTimeline()===null){if(i=null,o=!1,n&&a.cancelScheduledSe(),s)try{a.suspendAudioContext()}catch(p){console.warn("AudioContext suspend failed:",p)}return}if(i=a.pauseBgm(),o=!0,n&&a.cancelScheduledSe(),(u=e.onPause)==null||u.call(e,{offsetSeconds:i}),s)try{a.suspendAudioContext()}catch(p){console.warn("AudioContext suspend failed:",p)}return}const c=i;if(i=null,!o){if(r)try{a.resumeAudioContext()}catch(p){console.warn("AudioContext resume failed:",p)}(d=e.onResume)==null||d.call(e,{offsetSeconds:c,resumed:!1});return}o=!1,(async()=>{var p,h;try{r&&await a.resumeAudioContext(),await a.resumeBgm({offsetSeconds:c??void 0}),(p=e.onResume)==null||p.call(e,{offsetSeconds:c,resumed:!0})}catch(g){console.error("Visibility resume failed:",g),(h=e.onResume)==null||h.call(e,{offsetSeconds:c,resumed:!1})}})()};return t.addEventListener("visibilitychange",l),()=>{t.removeEventListener("visibilitychange",l)}}const U=document.getElementById("two-axis-panel"),N=document.getElementById("two-axis-canvas"),B=document.getElementById("play-pause-button"),te=document.getElementById("button-text"),Ns=document.getElementById("status-message"),qs=document.getElementById("sr-status"),ae=document.getElementById("copy-seed-container"),q=document.getElementById("copy-seed-button"),pe={square1:document.querySelector('[data-channel="square1"] .indicator-light'),square2:document.querySelector('[data-channel="square2"] .indicator-light'),triangle:document.querySelector('[data-channel="triangle"] .indicator-light'),noise:document.querySelector('[data-channel="noise"] .indicator-light')},vt={square1:"jump",square2:"select",triangle:"laser",noise:"explosion"},M={currentPosition:null,composition:null,isPlaying:!1,isGenerating:!1,channelActivity:{square1:0,square2:0,triangle:0,noise:0}};let P=null,Y=null;const V=new Map;let ne=null,j=!1;function yt(){const a=U.getBoundingClientRect(),e=window.devicePixelRatio||1;N.width=a.width*e,N.height=a.height*e,N.style.width=`${a.width}px`,N.style.height=`${a.height}px`;const t=N.getContext("2d");t&&(t.scale(e,e),_t(t,a.width,a.height))}function _t(a,e,t){a.clearRect(0,0,e,t),a.strokeStyle="rgba(255, 255, 255, 0.08)",a.lineWidth=1;for(let r=1;r<4;r++){const o=e/4*r;a.beginPath(),a.moveTo(o,0),a.lineTo(o,t),a.stroke()}for(let r=1;r<4;r++){const o=t/4*r;a.beginPath(),a.moveTo(0,o),a.lineTo(e,o),a.stroke()}a.strokeStyle="rgba(255, 255, 255, 0.15)",a.lineWidth=2;const n=e/2,s=t/2;if(a.beginPath(),a.moveTo(n,0),a.lineTo(n,t),a.stroke(),a.beginPath(),a.moveTo(0,s),a.lineTo(e,s),a.stroke(),M.currentPosition){const r=(M.currentPosition.percussiveMelodic+1)/2*e,o=(1-M.currentPosition.calmEnergetic)/2*t,i=a.createRadialGradient(r,o,0,r,o,30);i.addColorStop(0,"rgba(90, 155, 255, 0.6)"),i.addColorStop(1,"rgba(90, 155, 255, 0)"),a.fillStyle=i,a.fillRect(r-30,o-30,60,60),a.fillStyle="#5a9bff",a.beginPath(),a.arc(r,o,8,0,Math.PI*2),a.fill(),a.strokeStyle="#ffffff",a.lineWidth=2,a.beginPath(),a.arc(r,o,12,0,Math.PI*2),a.stroke()}}async function Te(a){if(M.isGenerating)return;const e=U.getBoundingClientRect();let t,n;if(a instanceof MouseEvent)t=a.clientX,n=a.clientY;else{const u=a.touches[0]||a.changedTouches[0];if(!u)return;t=u.clientX,n=u.clientY}const s=(t-e.left)/e.width*2-1,r=1-(n-e.top)/e.height*2,o=Math.max(-1,Math.min(1,s)),i=Math.max(-1,Math.min(1,r));M.currentPosition={percussiveMelodic:o,calmEnergetic:i};const l=N.getContext("2d");l&&_t(l,e.width,e.height),await Us({percussiveMelodic:o,calmEnergetic:i})}async function Ie(){return P||(ne==null||ne(),P=Ls(),ne=Gs(P,{shouldPause:()=>M.isPlaying,onPause:()=>{M.isPlaying?(He({skipSessionStop:!0,skipCancelSe:!0}),j=!0,T("Playback paused (tab inactive)")):j=!1},onResume:({resumed:a})=>{!j||!M.composition||(j=!1,a?(M.isPlaying=!0,D(),bt(),T("Playback resumed")):T("Playback resume failed"))}})),P.resumeAudioContext(),P}async function Us(a){He(),M.isGenerating=!0,D(),T(`Generating music at (${a.percussiveMelodic.toFixed(1)}, ${a.calmEnergetic.toFixed(1)})...`);try{const e={twoAxisStyle:a,lengthInMeasures:32},n=await(await Ie()).generateBgm(e);M.composition=n,T(`Generated: ${n.meta.mood} at ${n.meta.bpm} BPM in ${n.meta.key}`),await Mt()}catch(e){const t=e instanceof Error?e.message:String(e);T(`Error: ${t}`),console.error("Generation failed:",e)}finally{M.isGenerating=!1,D()}}async function Mt(a=0){if(!M.composition)return;const e=await Ie();M.isPlaying=!0,B.disabled=!1,D();const t=Math.max(0,a);V.clear();try{await e.playBgm(M.composition,{offset:t,loop:!0,onEvent:$s})}catch(n){throw console.error("Playback error:",n),M.isPlaying=!1,D(),n}bt()}function He(a={}){const{skipSessionStop:e=!1,skipCancelSe:t=!1}=a;e?t||P==null||P.cancelScheduledSe():P==null||P.stopAllAudio(),j=!1,Y!==null&&(cancelAnimationFrame(Y),Y=null),M.isPlaying=!1,V.clear(),Object.values(pe).forEach(n=>{n.classList.remove("active"),n.style.opacity="0.3",n.style.boxShadow="none"}),D()}async function Vs(a){try{const e=await Ie(),t=vt[a];await e.triggerSe({type:t,duckingDb:-4,quantize:{quantizeTo:"beat",phase:"next",loopAware:!0}}),T(`Scheduled ${t} sound effect`)}catch(e){console.error("Indicator sound effect trigger failed:",e),T("Sound effect trigger failed")}}function zs(){Object.keys(vt).forEach(a=>{const e=pe[a];e&&(e.style.cursor="pointer",e.title="Hidden SE trigger",e.addEventListener("click",t=>{t.stopPropagation(),Vs(a)}))})}function Ws(){M.isPlaying?(He(),T("Playback paused")):M.composition&&Mt().then(()=>T("Playback resumed"),a=>{console.error("Playback resume failed:",a),T("Playback resume failed")})}function $s(a,e){var s,r;const t=a.channel,n=`${t}-${((s=a.data)==null?void 0:s.midi)||0}`;if(a.command==="noteOn"){const o=((r=a.data)==null?void 0:r.velocity)||64;V.set(n,{channel:t,velocity:typeof o=="number"?o:64,endTime:e+2})}else a.command==="noteOff"&&V.delete(n)}function bt(){const a=()=>{const e=P==null?void 0:P.getAudioContext();if(!e||!M.isPlaying){Y=requestAnimationFrame(a);return}const t=e.currentTime,n={square1:0,square2:0,triangle:0,noise:0};V.forEach((s,r)=>{if(t<=s.endTime){const o=s.channel;o in n&&(n[o]=Math.max(n[o],s.velocity))}else V.delete(r)}),M.channelActivity=n,Object.entries(n).forEach(([s,r])=>{const o=pe[s];if(o){const i=r/127;r>0?(o.classList.add("active"),o.style.opacity=String(.5+i*.5),o.style.boxShadow=`0 0 ${20+i*30}px currentColor`):(o.classList.remove("active"),o.style.opacity="0.3",o.style.boxShadow="none")}}),Y=requestAnimationFrame(a)};a()}async function js(){if(!M.composition)return;const a=M.composition.meta.replayOptions;try{const e=JSON.stringify(a,null,2);await navigator.clipboard.writeText(e);const t=q.textContent;q.textContent="Copied!",q.classList.add("copied"),setTimeout(()=>{q.textContent=t,q.classList.remove("copied")},1500)}catch(e){console.error("Failed to copy seed to clipboard:",e),T("Failed to copy seed")}}function D(){M.isGenerating?(B.disabled=!0,B.classList.add("loading"),te.textContent="",ae.style.display="none"):M.isPlaying?(B.disabled=!1,B.classList.remove("loading"),te.textContent=" Pause",B.setAttribute("aria-label","Pause playback"),ae.style.display=M.composition?"block":"none"):M.composition?(B.disabled=!1,B.classList.remove("loading"),te.textContent=" Play",B.setAttribute("aria-label","Play playback"),ae.style.display="block"):(B.disabled=!0,B.classList.remove("loading"),te.textContent="Play",ae.style.display="none")}function T(a){Ns.textContent=a,qs.textContent=a}U.addEventListener("click",a=>void Te(a));U.addEventListener("touchstart",a=>{a.preventDefault(),Te(a)});B.addEventListener("click",()=>Ws());q.addEventListener("click",()=>void js());U.addEventListener("keydown",a=>{if(a.key==="Enter"||a.key===" "){a.preventDefault();const e=U.getBoundingClientRect(),t=e.left+e.width/2,n=e.top+e.height/2,s=new MouseEvent("click",{clientX:t,clientY:n});Te(s)}});window.addEventListener("resize",()=>{yt()});function Ys(){Object.values(pe).forEach(a=>{a.classList.remove("active"),a.style.opacity="0.3",a.style.boxShadow="none"})}yt();Ys();zs();D();
