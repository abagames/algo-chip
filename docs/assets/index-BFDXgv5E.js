(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();const bt={simple:[["C","G","Am","F"],["C","Em","F","G"],["Am","F","C","G"],["C","Am","Dm","G"],["C","F","G","C"]],town_peaceful:[["C","F","C","G"],["C","G","Em","Am"],["F","G","Em","Am"],["C","F","Am","G"],["C","G","F","C"]],heroic_fanfare:[["C","Am","F","G"],["C","G","Am","Em"],["F","C","G","Am"],["C","Dm","G","C"],["Am","F","G","C"]],playful:[["C","F","G","Am"],["C","Em","Am","F"],["F","G","C","Am"],["C","G","F","Em"],["Am","G","F","C"]]},St={castle_majestic:[["Em","C","G","D"],["Em","B7","Em","C"],["C","G","D","Em"],["Em","C","D","G"],["Em","Em","C","D"]],dark:[["Em","D","C","B7"],["Em","C","Am","B7"],["Em","Bm","C","G"],["Em","C","D","Bm"],["Em","G","F","B7"]],ending_sorrowful:[["Em","C","G","D"],["Em","Bm","C","G"],["Em","D","C","B7"],["Em","G","D","C"],["Em","C","Am","B7"]],final_battle_tense:[["Em","C","D","B7"],["Em","G","D","Em"],["C","D","Em","Em"],["Em","Bm","C","D"],["G","D","Em","C"]],mysterious:[["Em","Am","F","C"],["Am","Em","G","C"],["Em","F","G","Em"],["Dm","Am","G","C"],["Em","C","Am","Bm"]],epic_adventure:[["Em","C","G","D"],["G","Em","C","D"],["C","G","Am","Em"],["Em","D","C","G"],["Am","Em","G","D"]]},Rt={heroic:[["G","C","D","G"],["G","Em","C","D"],["C","D","G","G"],["G","B7","Em","C"],["Em","C","G","D"]],overworld_bright:[["G","D","Em","C"],["C","G","D","G"],["G","Em","Am","D"],["G","C","D","G"],["G","B7","Em","C"]],triumph:[["G","D","C","G"],["C","D","G","Em"],["G","C","Am","D"],["Em","C","D","G"],["G","D","Em","D"]],adventure:[["G","Em","C","D"],["Am","D","G","C"],["G","C","D","Em"],["C","Am","G","D"],["G","D","C","Am"]]},xt={C_Major:bt,E_Minor:St,G_Major:Rt},et=xt,Pt={slow:90,medium:120,fast:150},Et={upbeat:["overworld_bright","heroic"],sad:["ending_sorrowful","dark"],tense:["final_battle_tense","castle_majestic"],peaceful:["town_peaceful","simple"]},Bt={upbeat:"G_Major",sad:"E_Minor",tense:"E_Minor",peaceful:"C_Major"},j=Object.keys(et),Tt={G_Major:[0,2,4,5,7,9,11],E_Minor:[0,2,3,5,7,8,10],C_Major:[0,2,4,5,7,9,11]},Ie=[[{id:"Intro",measures:1},{id:"A",measures:3},{id:"B",measures:2},{id:"A",measures:2}],[{id:"A",measures:2},{id:"B",measures:2},{id:"A",measures:2},{id:"C",measures:2}],[{id:"Intro",measures:2},{id:"A",measures:2},{id:"Bridge",measures:2},{id:"A",measures:2}],[{id:"A",measures:4},{id:"B",measures:2},{id:"C",measures:2}]],At={tense:[0,3],upbeat:[1,2],sad:[2,3],peaceful:[1,2]},He={16:{upbeat:[{id:"A",measures:8},{id:"B",measures:8}],peaceful:[{id:"A",measures:8},{id:"B",measures:8}],tense:[{id:"A",measures:8},{id:"B",measures:8}],sad:[{id:"A",measures:8},{id:"B",measures:8}]},32:{upbeat:[{id:"A",measures:8},{id:"B",measures:8},{id:"C",measures:8},{id:"D",measures:8}],peaceful:[{id:"A",measures:16},{id:"B",measures:16}],tense:[{id:"A",measures:8},{id:"B",measures:8},{id:"A",measures:8},{id:"C",measures:8}],sad:[{id:"Intro",measures:4},{id:"A",measures:12},{id:"B",measures:8},{id:"A",measures:8}]},64:{upbeat:[{id:"A",measures:16},{id:"B",measures:16},{id:"C",measures:16},{id:"D",measures:16}],peaceful:[{id:"A",measures:16},{id:"B",measures:16},{id:"A",measures:16},{id:"C",measures:16}],tense:[{id:"Intro",measures:8},{id:"A",measures:16},{id:"B",measures:16},{id:"C",measures:12},{id:"A",measures:12}],sad:[{id:"Intro",measures:8},{id:"A",measures:20},{id:"B",measures:16},{id:"A",measures:20}]}},tt=new Set(["A"]),ge="steady",Ot=1,It={textureFocus:!1,loopCentric:!1,gradualBuild:!1,harmonicStatic:!1,percussiveLayering:!1,breakInsertion:!1,filterMotion:!1,syncopationBias:!1,atmosPad:!1},at={minimalTechno:{textureFocus:!0,loopCentric:!0,harmonicStatic:!0,percussiveLayering:!0,filterMotion:!0,syncopationBias:!0},progressiveHouse:{textureFocus:!0,loopCentric:!0,gradualBuild:!0,percussiveLayering:!0,breakInsertion:!0,filterMotion:!0,atmosPad:!0},retroLoopwave:{textureFocus:!0,loopCentric:!0,percussiveLayering:!0,filterMotion:!0,syncopationBias:!0},breakbeatJungle:{textureFocus:!0,percussiveLayering:!0,breakInsertion:!0,filterMotion:!0,syncopationBias:!0},lofiChillhop:{loopCentric:!0,harmonicStatic:!0,atmosPad:!0,textureFocus:!0}};function Ht(){return{...It}}function Ke(a,e){if(!e)return a;const t={...a};for(const s of Object.keys(a))e[s]!==void 0&&(t[s]=!!e[s]);return t}function Kt(a){let e={};if(a.stylePreset){const t=at[a.stylePreset];t&&(e={...e,...t})}return a.styleOverrides&&(e={...e,...a.styleOverrides}),e}function kt(a,e){let t=Ht();if(a.stylePreset){const h=at[a.stylePreset];h&&(t=Ke(t,h))}const s=e.reduce((h,g)=>h+g.measures,0),n=e.reduce((h,g)=>(h.set(g.templateId,(h.get(g.templateId)??0)+1),h),new Map),r=Array.from(n.values()).some(h=>h>=2),i=e.length?s/e.length:s;(r||i<=4)&&(t.loopCentric=!0),a.tempo!=="slow"&&s>=8&&(t.loopCentric=!0,t.percussiveLayering=!0),(a.mood==="tense"||a.mood==="sad")&&(t.textureFocus=!0),a.mood==="peaceful"&&(t.atmosPad=!0),(a.mood==="upbeat"||a.mood==="tense")&&(t.syncopationBias=!0),a.tempo==="fast"&&(t.filterMotion=!0,t.percussiveLayering=!0),s>=12&&(t.gradualBuild=!0);const o=new Set,l=new Set;let u=0;for(const h of e)h.chordProgression.forEach(g=>o.add(g)),l.add(h.chordProgression.join("|")),new Set(h.chordProgression).size<=1&&u++;const d=e.length>0&&u===e.length;l.size<=1&&(o.size<=2||d)&&(t.harmonicStatic=!0),s>=8&&a.tempo!=="slow"&&(t.breakInsertion=!0);const c=t.harmonicStatic;t=Ke(t,a.styleOverrides);const p=a.styleOverrides&&typeof a.styleOverrides.harmonicStatic=="boolean";return!c&&!p&&(t.harmonicStatic=!1),t}function O(a,e){const t=Math.imul(a??0,1664525)+Math.imul(e,1013904223)>>>0;return(Math.imul(t,22695477)+1>>>0)/4294967295}function Ft(a,e,t){const s=et[a];if(!s)throw new Error(`No chord motifs for key ${a}`);const n=[];for(const i of e)Array.isArray(s[i])&&n.push(...s[i]);const r=n.length?n:Object.values(s).flat();if(!r.length)throw new Error(`No chord progressions available for key ${a}`);return st(r,t,100).map(i=>[...i])}function ke(a,e){const t=a.match(/^([A-G])(#|b)?(.*)$/);if(!t)return a;const[,s,n="",r]=t,i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],o={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},l=s+n,u=o[l];if(u===void 0)return a;const d=(u+e+12)%12;return i[d]+r}function Ct(a){const e=a.match(/^([A-G](?:#|b)?)(m?)(.*)$/);if(!e)return a;const[,t,s,n]=e;return s==="m"?t+n:t+"m"+n}function wt(a){const e=[];return e.push(ke(a,7)),e.push(ke(a,5)),e.push(Ct(a)),e}function Dt(a,e){const t=3+Math.floor(e()*2),s=Array(t).fill(a);if(e()<.2){const n=wt(a),r=n[Math.floor(e()*n.length)];s.push(r)}return s}function Lt(a,e,t,s){const n=a.lengthInMeasures;let r;n in He?r=He[n][a.mood].map(v=>({...v})):r=Qt(a.mood,t);const i=r.reduce((v,y)=>v+y.measures,0);let o=[];if(n===i)o=r;else if(n>i){const v=Math.floor(n/i);for(let x=0;x<v;x++)o=o.concat(r);let y=n-v*i,S=0;for(;y>0;){const x=r[S%r.length],H=Math.min(x.measures,y);o.push({id:x.id,measures:H}),y-=H,S++}}else{let v=0;for(const y of r){if(v+y.measures>n){const S=Math.max(n-v,0);S>0&&o.push({id:y.id,measures:S});break}o.push(y),v+=y.measures}}const l=[];let u=0,d=0;const c=st(e,t,200+d),p=new Map,h=new Set;for(const v of c)v.forEach(y=>h.add(y));const g=(v=>{let y=(v??987654321)>>>0;return y===0&&(y=987654321),()=>(y=y*1664525+1013904223>>>0,y/4294967295)})(t),f=s.harmonicStatic===!0,m=f&&h.size<=1;for(const v of o){let y;if(m&&c.length>0)y=[c[0][0]];else if(f&&c.length>0){const R=c[d%c.length][0];y=Dt(R,g)}else y=c[d%c.length];const S=v.id,x=(p.get(S)??0)+1;p.set(S,x);const H=Ut(S,x,t);l.push({id:`${v.id}${l.filter(R=>R.id.startsWith(v.id)).length+1}`,startMeasure:u,measures:v.measures,chordProgression:y,templateId:S,occurrenceIndex:x,texture:H}),u+=v.measures,m||d++}return l}const Gt={Intro:["broken"],A:["broken","steady","broken"],B:["steady","steady","arpeggio"],Bridge:["arpeggio","steady"],C:["steady","arpeggio","steady"]},Nt={Intro:1,A:2,B:2,Bridge:4,C:2},Fe={firstOccurrence:.7,repeatOccurrence:.4},qt=.1;function Ut(a,e,t){const s=Gt[a]??[ge],n=s[(e-1)%s.length]??ge;if(n==="arpeggio"){const i=e===1,o=a.split("").reduce((d,c)=>d+c.charCodeAt(0),0),l=O(t,1e3+o*7+e*13),u=i?Fe.firstOccurrence:Fe.repeatOccurrence;if(l>u)return s.find(d=>d!=="arpeggio")??ge}const r=a.charCodeAt(0)*100+e;if(O(t,2e3+r)<qt){const i=["steady","broken","arpeggio"].filter(l=>l!==n),o=Math.floor(O(t,3e3+r)*i.length);return i[o]??n}return n}function Vt(a){return Nt[a]??Ot}function Wt(a){return Vt(a.templateId)}function le(a){return a.occurrenceIndex===1&&tt.has(a.templateId)}function K(a){return a.occurrenceIndex>1&&tt.has(a.templateId)}function jt(a,e,t){let s,n=50;switch(a){case"tense":s={echoProbability:.5,detuneProbability:.3,fastArpeggioProbability:.4},n=10;break;case"upbeat":s={echoProbability:.4,detuneProbability:.2,fastArpeggioProbability:.2},n=20;break;case"sad":s={echoProbability:.6,detuneProbability:.1,fastArpeggioProbability:.1},n=30;break;case"peaceful":s={echoProbability:.5,detuneProbability:.05,fastArpeggioProbability:.05},n=40;break;default:s={echoProbability:.3,detuneProbability:.3,fastArpeggioProbability:.3};break}const r=$t(s,e);return zt(r,t,n)}function zt(a,e,t){const s=r=>Math.min(.95,Math.max(.05,r)),n=r=>(O(e,t+r)-.5)*.2;return{echoProbability:s(a.echoProbability+n(1)),detuneProbability:s(a.detuneProbability+n(2)),fastArpeggioProbability:s(a.fastArpeggioProbability+n(3))}}function $t(a,e){const t={...a};return e.textureFocus&&(t.fastArpeggioProbability=Math.max(.05,t.fastArpeggioProbability*.6),t.echoProbability=Math.min(.95,t.echoProbability+.05)),e.loopCentric&&(t.detuneProbability=Math.max(.05,t.detuneProbability*.8)),e.gradualBuild&&(t.echoProbability=Math.min(.95,t.echoProbability+.1)),e.harmonicStatic&&(t.detuneProbability=Math.max(.05,t.detuneProbability*.7)),e.percussiveLayering&&(t.fastArpeggioProbability=Math.min(.9,t.fastArpeggioProbability+.05)),e.filterMotion&&(t.detuneProbability=Math.min(.9,t.detuneProbability+.1)),e.syncopationBias&&(t.echoProbability=Math.min(.9,t.echoProbability+.05)),e.atmosPad&&(t.echoProbability=Math.min(.95,t.echoProbability+.08)),e.breakInsertion&&(t.fastArpeggioProbability=Math.max(.05,t.fastArpeggioProbability*.9)),t}const Ce={standard:{id:"standard",description:"Classic melody + accompaniment + bass",voices:[{role:"melody",channel:"square1",priority:1,octaveOffset:0},{role:"accompaniment",channel:"square2",priority:1,octaveOffset:0},{role:"bass",channel:"triangle",priority:1,octaveOffset:0}]},swapped:{id:"swapped",description:"Swapped square channels for tonal variety",voices:[{role:"melody",channel:"square2",priority:1,octaveOffset:0},{role:"accompaniment",channel:"square1",priority:1,octaveOffset:0},{role:"bass",channel:"triangle",priority:1,octaveOffset:0}]},dualBass:{id:"dualBass",description:"Melody with dual bass (thick low end)",voices:[{role:"melody",channel:"square1",priority:1,octaveOffset:0},{role:"bass",channel:"square2",priority:1,octaveOffset:0,seedOffset:0},{role:"bassAlt",channel:"triangle",priority:.7,octaveOffset:-1,seedOffset:100}]},bassLed:{id:"bassLed",description:"Bass-focused with sparse melodic decoration",voices:[{role:"bass",channel:"triangle",priority:1,octaveOffset:-1,seedOffset:0},{role:"bassAlt",channel:"square2",priority:.8,octaveOffset:0,seedOffset:200},{role:"melody",channel:"square1",priority:.3,octaveOffset:0}]},layeredBass:{id:"layeredBass",description:"Layered bass with complementary square/triangle movement",voices:[{role:"bass",channel:"square1",priority:1,octaveOffset:0,seedOffset:0},{role:"bassAlt",channel:"triangle",priority:.85,octaveOffset:0,seedOffset:160},{role:"melody",channel:"square2",priority:1,octaveOffset:0}]},minimal:{id:"minimal",description:"Minimal techno: bass + sparse pad only",voices:[{role:"bass",channel:"square1",priority:1,octaveOffset:0},{role:"pad",channel:"triangle",priority:.4,octaveOffset:0}]},breakLayered:{id:"breakLayered",description:"Breakbeat layering: dual bass pressure with agile lead",voices:[{role:"bass",channel:"square1",priority:1,octaveOffset:0,seedOffset:0},{role:"bassAlt",channel:"triangle",priority:.95,octaveOffset:-1,seedOffset:140},{role:"melody",channel:"square2",priority:.85,octaveOffset:0,seedOffset:240}]},lofiPadLead:{id:"lofiPadLead",description:"Lo-fi pad-first texture with gentle lead flourishes",voices:[{role:"pad",channel:"triangle",priority:.9,octaveOffset:-1},{role:"accompaniment",channel:"square2",priority:1,octaveOffset:-1,seedOffset:60},{role:"melody",channel:"square1",priority:.45,octaveOffset:0,seedOffset:180}]},retroPulse:{id:"retroPulse",description:"Retro loopwave pulse arpeggios with anchored bass",voices:[{role:"melody",channel:"square1",priority:1,octaveOffset:0,seedOffset:80},{role:"accompaniment",channel:"square2",priority:.85,octaveOffset:0,seedOffset:140},{role:"bass",channel:"triangle",priority:.9,octaveOffset:-1,seedOffset:40}]}},Yt={minimalTechno:{standard:2,minimal:5,bassLed:3,dualBass:2,swapped:1,layeredBass:1},progressiveHouse:{standard:4,swapped:3,layeredBass:3,dualBass:2,bassLed:1,minimal:0},retroLoopwave:{standard:2,swapped:3,retroPulse:5,layeredBass:1,minimal:0,bassLed:1},breakbeatJungle:{breakLayered:5,dualBass:3,layeredBass:2,bassLed:2,standard:1,swapped:1,minimal:0},lofiChillhop:{lofiPadLead:5,minimal:3,standard:2,swapped:1,bassLed:1,layeredBass:0,dualBass:1}},we={standard:5,swapped:4,dualBass:2,bassLed:2,layeredBass:2,minimal:1,breakLayered:1,lofiPadLead:1,retroPulse:2};function Jt(a,e){const t=e?{...we,...Yt[e]}:we,s=Object.entries(t),n=s.reduce((o,[,l])=>o+l,0),r=O(a,100);let i=0;for(const[o,l]of s)if(i+=l/n,r<i)return Ce[o];return Ce.standard}function Xt(a){const e=Pt[a.tempo],t=Math.round((O(a.seed,1)-.5)*30),s=e+Math.max(-15,Math.min(15,t)),n=Et[a.mood],r=Zt(a.mood,a.seed),i=Tt[r];if(!i)throw new Error(`Scale not defined for key ${r}`);const o=Ft(r,n,a.seed),l=Kt(a),u=Lt(a,o,a.seed,l),d=kt(a,u),c=jt(a.mood,d,a.seed);ea(a.lengthInMeasures,u);const p=Jt(a.seed,a.stylePreset);return{bpm:s,key:r,scaleDegrees:i,sections:u,techniqueStrategy:c,styleIntent:d,voiceArrangement:p}}function Qt(a,e){const t=At[a]??Ie.map((n,r)=>r),s=t[Math.floor(O(e,60)*t.length)]??0;return Ie[s].map(n=>({...n}))}function st(a,e,t){const s=[...a];for(let n=s.length-1;n>0;n--){const r=Math.floor(O(e,t+n)*(n+1)),i=s[n];s[n]=s[r],s[r]=i}return s}function Zt(a,e){const t=Bt[a];if(t&&j.includes(t))return t;if(!j.length)throw new Error("Chord library is empty");const s=Math.floor(O(e,5)*j.length)%j.length;return j[s]}function ea(a,e){const t=e.reduce((s,n)=>s+n.measures,0);if(t!==a)throw new Error(`Section length mismatch. expected=${a}, actual=${t}`)}const ta={K:.25,S:.25,H:.125,O:.375,T:.5,N:.375},aa={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},Z={"":[0,4,7],m:[0,3,7],7:[0,4,7,10],m7:[0,3,7,10],maj7:[0,4,7,11],sus2:[0,2,7],sus4:[0,5,7],dim:[0,3,6],aug:[0,4,8]},_=4;function ue(a,e){const t=a.match(/^[A-G](#|b)?/i);if(!t)return e;const s=t[0].toUpperCase(),n=aa[s]??0;return e-e%12+n}function Me(a){const e=a.match(/^[A-G](?:#|b)?(.*)$/),t=(e==null?void 0:e[1])??"";return t in Z?Z[t]:t.startsWith("m")?Z.m:Z[""]}function de(a,e,t,s=0){const n=((a-1)%e.length+e.length)%e.length,r=Math.floor((a-1)/e.length)+s,i=e[n]+12*r;return t+i}function nt(a,e,t){const s=[];for(let n=0;n<a.length;n++){const r=a[n];if(r==="-")continue;const i=e+n/16*_;s.push({startBeat:i,durationBeats:ta[r]??.25,instrument:r,sectionId:t})}return s}function A(a,e,t=_){const s=Math.floor(e/t),n=a.sections.find(i=>s>=i.startMeasure&&s<i.startMeasure+i.measures);if(!n){const i=a.sections[0];return(i==null?void 0:i.chordProgression[0])??"C"}const r=Math.max(0,s-n.startMeasure);return n.chordProgression[r%n.chordProgression.length]}function sa(a){return 12*Math.log2(a)}function na(a){return 440*Math.pow(2,(a-69)/12)}function ra(a){return(a%12+12)%12}function B(a,e){const t=ue(e,a),s=Me(e);let n=a,r=1/0;for(const i of s)for(let o=-2;o<=2;o++){const l=t+i+o*12,u=Math.abs(l-a);u<r&&(n=l,r=u)}return n}const ia=new Set([0,3,4,5,7,8,9]);function J(a,e,t){if(t===void 0)return B(a,e);const s=ue(e,t),n=Me(e);let r=a,i=Number.POSITIVE_INFINITY;for(const o of n)for(let l=-2;l<=2;l++){const u=s+o+l*12,d=ra(u-t),c=ia.has(d)?0:10,p=Math.abs(u-a)*.1,h=Math.abs(u-t)*.05,g=c+p+h;g<i&&(i=g,r=u)}return r}const De={MIN:20,MAX_ACCENT:118},z={TRIANGLE_BASE:.75,TRIANGLE_NON_BASS:.9,BASS_BASE:.7,BASS_LOW_RANGE:.85,SQUARE_BASS:.82},oa={BASS_LOW_RANGE:52},Le={broken:74,steady:70,arpeggio:76,default:72},Ge={DOWNBEAT_BOOST:6,STRONG_BEAT_BOOST:3},la={PICKUP_BASE:72},I={EARLY_START:52,PAD_MIN:48,ARPEGGIO_SCALE:.75,BROKEN_SCALE:.9,STEADY_SCALE:.85},Ne={ECHO_SCALE:.6,DETUNE_SCALE:.7},L={KICK:120,TOM:116,LOW_NOISE:112,SNARE:115,HIHAT:118,OPEN_HAT:114},ua=[{id:"RM001",length:4,pattern:[4,4,4,4],tags:["start","straight","loop_safe","loop_safe"],variations:["RM002","RM003"]},{id:"RM002",length:4,pattern:[4,8,8,4,4],tags:["start","straight","loop_safe","kick"],variations:["RM003","RM004"]},{id:"RM003",length:4,pattern:[8,8,8,8,4,4],tags:["start","straight","loop_safe","sfx_long"],variations:["RM004","RM005"]},{id:"RM004",length:4,pattern:[4,8,8,4,4],tags:["start","straight","loop_safe"],variations:["RM005","RM006"]},{id:"RM005",length:4,pattern:[8,8,4,8,8,4],tags:["start","straight","loop_safe"],variations:["RM006","RM007"]},{id:"RM006",length:4,pattern:[8,8,4,8,8,4],tags:["start","syncopation","loop_safe","anacrusis"],variations:["RM007","RM008"]},{id:"RM007",length:4,pattern:[8,16,16,8,16,16,4,4],tags:["start","syncopation","loop_safe","anacrusis"],variations:["RM008","RM027"]},{id:"RM008",length:4,pattern:[4,8,8,4,8,8],tags:["start","syncopation","loop_safe","anacrusis"],variations:["RM027","RM028"]},{id:"RM009",length:4,pattern:[8,8,4,8,8,4],tags:["middle","straight","bridge"],variations:["RM010","RM011"]},{id:"RM010",length:4,pattern:[4,4,8,8,4],tags:["middle","straight","bridge"],variations:["RM011","RM012"]},{id:"RM011",length:4,pattern:[4,4,4,8,8],tags:["middle","straight","bridge"],variations:["RM012","RM013"]},{id:"RM012",length:8,pattern:[8,8,4,4,8,8,4,4,4,4],tags:["middle","syncopation","bridge"],variations:["RM013","RM014"]},{id:"RM013",length:8,pattern:[4,8,8,4,8,8,4,4,4,4],tags:["middle","syncopation","bridge"],variations:["RM014","RM015"]},{id:"RM014",length:8,pattern:[8,8,8,8,4,4,4,4,4,4],tags:["middle","syncopation","bridge"],variations:["RM015","RM016"]},{id:"RM015",length:8,pattern:[4,4,4,4,4,4,4,4],tags:["middle","sustain","open"],variations:["RM016","RM017"]},{id:"RM016",length:8,pattern:[4,8,8,4,4,4,8,8,4,4],tags:["middle","sustain","open"],variations:["RM017","RM018"]},{id:"RM017",length:4,pattern:[8,16,16,8,16,16,8,16,16,4],tags:["middle","swing_hint","bridge"],variations:["RM018","RM029"]},{id:"RM018",length:4,pattern:[8,16,16,4,8,16,16,4],tags:["middle","swing_hint","bridge"],variations:["RM029","RM030"]},{id:"RM019",length:4,pattern:[4,4,4,4],tags:["end","straight","loop_safe"],variations:["RM020","RM021"]},{id:"RM020",length:4,pattern:[8,8,4,8,8,4],tags:["end","straight","loop_safe"],variations:["RM021","RM022"]},{id:"RM021",length:4,pattern:[4,8,8,4,4],tags:["end","straight","loop_safe"],variations:["RM022","RM023"]},{id:"RM022",length:4,pattern:[4,4,4,4],tags:["end","cadence"],variations:["RM023","RM024"]},{id:"RM023",length:4,pattern:[8,8,4,4,4],tags:["end","cadence"],variations:["RM024","RM025"]},{id:"RM024",length:4,pattern:[4,8,8,4,4],tags:["end","cadence"],variations:["RM025","RM026"]},{id:"RM025",length:8,pattern:[4,4,4,4,4,4,4,4],tags:["end","cadence","loop_safe"],variations:["RM026","RM019"]},{id:"RM026",length:8,pattern:[8,8,4,4,4,8,8,4,4,4],tags:["end","cadence","loop_safe"],variations:["RM019","RM020"]},{id:"RM027",length:4,pattern:[8,8,8,8,8,8,4],tags:["start","staccato","anacrusis"],variations:["RM028","RM001"]},{id:"RM028",length:4,pattern:[8,8,8,8,4,8,8],tags:["start","staccato","anacrusis"],variations:["RM001","RM002"]},{id:"RM029",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM030","RM031"]},{id:"RM030",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM031","RM032"]},{id:"RM031",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM032","RM033"]},{id:"RM032",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM033","RM034"]},{id:"RM033",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM034","RM035"]},{id:"RM034",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM035","RM036"]},{id:"RM035",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM036","RM037"]},{id:"RM036",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM037","RM038"]},{id:"RM037",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM038","RM039"]},{id:"RM038",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM039","RM040"]},{id:"RM039",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM040","RM041"]},{id:"RM040",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM041","RM042"]},{id:"RM041",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM042","RM043"]},{id:"RM042",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM043","RM044"]},{id:"RM043",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM044","RM045"]},{id:"RM044",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM045","RM046"]},{id:"RM045",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM046","RM047"]},{id:"RM046",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM047","RM048"]},{id:"RM047",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM048","RM049"]},{id:"RM048",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM049","RM050"]},{id:"RM049",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM050","RM009"]},{id:"RM050",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM009","RM010"]},{id:"RM051",length:4,pattern:[8,8,4,8,8,4],tags:["start","accented","syncopation","loop_safe"],variations:["RM052","RM053"]},{id:"RM052",length:4,pattern:[4,8,8,4,4],tags:["middle","accented","bridge","loop_safe"],variations:["RM051","RM053"]},{id:"RM053",length:4,pattern:[8,8,8,8,4,4],tags:["end","accented","cadence","loop_safe"],variations:["RM051","RM052"]},{id:"RM054",length:4,pattern:[4,4,8,8,8,8],tags:["middle","accented","variation","loop_safe"],variations:["RM052","RM055"]},{id:"RM055",length:4,pattern:[4,8,8,8,8,4],tags:["start","accented","bridge","loop_safe"],variations:["RM051","RM054"]},{id:"RM056",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","straight","texture_loop","grid16","loop_safe"],variations:["RM057"]},{id:"RM057",length:4,pattern:[16,16,16,16,16,16,16,8,8,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe"],variations:["RM056"]},{id:"RM058",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","middle","texture_loop","grid16","loop_safe","simple"],variations:["RM059","RM060"]},{id:"RM059",length:4,pattern:[16,16,16,16,16,16,8,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM058","RM060"]},{id:"RM060",length:4,pattern:[16,16,8,16,16,16,16,8,16,16,16,16,8],tags:["middle","texture_loop","grid16","loop_safe","syncopation"],variations:["RM058","RM059"]},{id:"RM061",length:4,pattern:[8,8,8,8,8,8,8,8],tags:["start","middle","texture_loop","loop_safe","straight"],variations:["RM062"]},{id:"RM062",length:4,pattern:[8,8,8,16,16,8,8,8,16,16],tags:["middle","texture_loop","loop_safe","straight"],variations:["RM061"]},{id:"RM063",length:4,pattern:[16,16,16,16,8,16,16,16,16,8,16,16,16,16],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM064"]},{id:"RM064",length:4,pattern:[16,16,16,16,16,16,16,16,8,16,16,16,16,8],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM063"]},{id:"RM065",length:4,pattern:[4,16,16,16,16,4,16,16,16,16],tags:["start","middle","texture_loop","loop_safe","simple"],variations:["RM066"]},{id:"RM066",length:4,pattern:[4,16,16,16,16,8,8,16,16,16,16],tags:["middle","texture_loop","loop_safe"],variations:["RM065"]},{id:"RM067",length:4,pattern:[8,16,16,8,16,16,8,16,16,8,16,16],tags:["start","middle","texture_loop","loop_safe","straight"],variations:["RM068"]},{id:"RM068",length:4,pattern:[8,16,16,8,8,8,16,16,8,16,16],tags:["middle","texture_loop","loop_safe","syncopation"],variations:["RM067"]},{id:"RM069",length:4,pattern:[16,16,8,16,16,8,16,16,8,16,16,8],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM070"]},{id:"RM070",length:4,pattern:[16,16,8,8,16,16,8,16,16,8,16,16],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM069"]},{id:"RM071",length:4,pattern:[4,4,16,16,16,16,4],tags:["start","middle","texture_loop","loop_safe","accented"],variations:["RM072"]},{id:"RM072",length:4,pattern:[4,8,8,16,16,16,16,4],tags:["middle","end","texture_loop","loop_safe","accented"],variations:["RM071"]},{id:"RM073",length:8,pattern:[4,4,4,4,4,4,4,4],tags:["end","cadence","loop_safe","final"],variations:["RM074","RM075"]},{id:"RM074",length:8,pattern:[4,8,8,4,4,4,8,8,4,4],tags:["end","cadence","loop_safe","final"],variations:["RM073","RM075"]},{id:"RM075",length:8,pattern:[8,8,4,4,4,2,2],tags:["end","cadence","loop_safe","ritardando"],variations:["RM073","RM074"]},{id:"RM076",length:4,pattern:[8,8,8,8,4,4],tags:["start","anacrusis","staccato","loop_safe"],variations:["RM077","RM078"]},{id:"RM077",length:4,pattern:[16,16,16,16,8,8,4,4],tags:["start","anacrusis","drive","loop_safe"],variations:["RM076","RM078"]},{id:"RM078",length:4,pattern:[8,8,4,8,8,4],tags:["start","anacrusis","syncopation","loop_safe"],variations:["RM076","RM077"]},{id:"RM079",length:4,pattern:[8,16,16,4,8,16,16,4],tags:["middle","syncopation","drive","loop_safe"],variations:["RM080","RM081"]},{id:"RM080",length:4,pattern:[4,16,16,8,8,4,8],tags:["middle","syncopation","accented","loop_safe"],variations:["RM079","RM082"]},{id:"RM081",length:4,pattern:[16,16,8,16,16,8,16,16,8,4],tags:["start","syncopation","staccato","loop_safe"],variations:["RM079","RM082"]},{id:"RM082",length:4,pattern:[8,8,16,16,16,16,8,8,4],tags:["middle","syncopation","drive","loop_safe"],variations:["RM080","RM083"]},{id:"RM083",length:4,pattern:[4,8,16,16,8,8,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM082","RM084"]},{id:"RM084",length:8,pattern:[8,16,16,8,16,16,4,4,8,16,16,8,16,16,4,4],tags:["middle","syncopation","drive","loop_safe"],variations:["RM083","RM085"]},{id:"RM085",length:8,pattern:[4,8,8,4,4,8,8,4,4,4],tags:["end","syncopation","cadence","loop_safe"],variations:["RM084","RM079"]},{id:"RM086",length:8,pattern:[8,8,4,8,8,4,8,8,4,8,8,4],tags:["middle","bridge","syncopation","loop_safe"],variations:["RM087","RM088"]},{id:"RM087",length:8,pattern:[4,4,8,8,8,8,4,4,8,8,8,8],tags:["middle","bridge","straight","loop_safe"],variations:["RM086","RM089"]},{id:"RM088",length:8,pattern:[16,16,16,16,8,8,4,4,16,16,16,16,8,8,4,4],tags:["middle","bridge","drive","loop_safe"],variations:["RM086","RM089"]},{id:"RM089",length:8,pattern:[8,8,8,8,4,4,8,8,8,8,4,4],tags:["middle","bridge","sustain","loop_safe"],variations:["RM087","RM090"]},{id:"RM090",length:8,pattern:[4,8,8,4,4,8,8,4,4,4],tags:["middle","bridge","variation","loop_safe"],variations:["RM089","RM086"]},{id:"RM091",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM092",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","syncopation"]},{id:"RM093",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","simple"]},{id:"RM094",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","accented"]},{id:"RM095",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM096",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM097",length:4,pattern:[8,8,16,16,16,16,8,8,16,16,16,16],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","syncopation"]},{id:"RM098",length:4,pattern:[16,16,8,16,16,8,16,16,8,16,16,8],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","simple"]},{id:"RM099",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","accented"]},{id:"RM100",length:4,pattern:[8,16,16,16,16,8,16,16,16,16,8,8],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","open"]},{id:"RM101",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM102",length:4,pattern:[8,16,16,16,16,8,8,16,16,16,16,8],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","syncopation"]},{id:"RM103",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","simple"]},{id:"RM104",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","accented"]},{id:"RM105",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","open"]},{id:"RM106",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","straight"]},{id:"RM107",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","syncopation"]},{id:"RM108",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","simple"]},{id:"RM109",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","accented"]},{id:"RM110",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","open"]},{id:"RM111",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16}],tags:["middle","texture_loop","grid16","syncopation","percussive_layer"]},{id:"RM112",length:4,pattern:[{value:8,accent:!0},{value:16},{value:16},{value:8},{value:16},{value:16,accent:!0},{value:8},{value:16},{value:16},{value:8,rest:!0},{value:16},{value:16}],tags:["middle","texture_loop","grid16","percussive_layer","drive"]},{id:"RM113",length:4,pattern:[{value:4,accent:!0},{value:16},{value:16},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","syncopation","break"]},{id:"RM114",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0}],tags:["middle","loop_safe","grid16","syncopation","breakbeat"]},{id:"RM115",length:4,pattern:[{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:4},{value:16,rest:!0},{value:8,accent:!0},{value:16,rest:!0},{value:16},{value:16,rest:!0}],tags:["middle","loop_safe","swing_hint","rest_heavy","lofi"]},{id:"RM116",length:4,pattern:[{value:8,accent:!0},{value:16},{value:16},{value:8,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:8},{value:16,accent:!0},{value:16},{value:8,accent:!0},{value:16,rest:!0},{value:16,accent:!0}],tags:["middle","loop_safe","syncopation","grid16","breakbeat"]},{id:"RM117",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0}],tags:["middle","loop_safe","grid16","syncopation","breakbeat","variation"]},{id:"RM118",length:4,pattern:[{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:8,accent:!0},{value:8,rest:!0},{value:8},{value:16,rest:!0},{value:8},{value:16,rest:!0}],tags:["middle","loop_safe","swing_hint","rest_heavy","lofi"]},{id:"RM119",length:4,pattern:[{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:8}],tags:["start","loop_safe","swing_hint","rest_heavy","lofi","variation"]}],da=[{id:"MF001",pattern:[1,3,5],tags:["ascending","scalar","bright","heroic","start","loop_safe","short","slide"]},{id:"MF002",pattern:[1,4,5,7],tags:["ascending","scalar","bright","heroic","start","loop_safe","short","bend"]},{id:"MF003",pattern:[2,3,6,6,9],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF004",pattern:[1,3,6,6,7],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF005",pattern:[1,3,5,7,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF006",pattern:[1,3,4],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF007",pattern:[2,4,5,6],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF008",pattern:[1,2,5,5,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF009",pattern:[1,3,6,6,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF010",pattern:[1,3,5,6,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF011",pattern:[5,4,3],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF012",pattern:[5,5,3,3],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF013",pattern:[6,4,4,2,2],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF014",pattern:[4,4,4,2,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF015",pattern:[5,4,3,3,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF016",pattern:[5,4,2],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF017",pattern:[6,5,3,2],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF018",pattern:[5,3,3,1,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF019",pattern:[5,4,4,2,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF020",pattern:[5,4,3,2,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF021",pattern:[1,4,6],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF022",pattern:[1,5,6,6],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF023",pattern:[2,4,7,5,4],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF024",pattern:[1,4,7,5,2],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF025",pattern:[1,4,6,6,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF026",pattern:[1,4,5],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF027",pattern:[2,5,6,5],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF028",pattern:[1,3,6,4,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF029",pattern:[1,4,7,5,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF030",pattern:[1,4,6,5,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF031",pattern:[6,4,2],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF032",pattern:[6,5,2,4],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF033",pattern:[7,4,3,3,2],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF034",pattern:[5,4,3,3,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF035",pattern:[6,4,2,4,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF036",pattern:[6,4,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF037",pattern:[7,5,2,3],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF038",pattern:[6,3,2,2,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF039",pattern:[6,4,3,3,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF040",pattern:[6,4,2,3,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF041",pattern:[1,2,3],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF042",pattern:[1,3,3,6],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF043",pattern:[2,2,4,5,8],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF044",pattern:[1,2,4,5,6,6],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF045",pattern:[1,2,3,6,7,7],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF046",pattern:[1,2,2],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF047",pattern:[2,3,3,5],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF048",pattern:[1,1,3,4,7],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF049",pattern:[1,2,4,5,7,7],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF050",pattern:[1,2,3,5,7,6],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF051",pattern:[5,7,6],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF052",pattern:[5,8,6,5],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF053",pattern:[6,7,7,4,3],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF054",pattern:[4,7,7,4,1],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF055",pattern:[5,7,6,5,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF056",pattern:[5,7,5],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF057",pattern:[6,8,6,4],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF058",pattern:[5,6,6,3,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF059",pattern:[5,7,7,4,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF060",pattern:[5,7,6,4,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF061",pattern:[3,5,4],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF062",pattern:[3,6,4,7],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF063",pattern:[4,5,5,6,6],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF064",pattern:[2,5,5,6,4,3],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF065",pattern:[3,5,4,7,5,4],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF066",pattern:[3,5,3],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF067",pattern:[4,6,4,6],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF068",pattern:[3,4,4,5,5],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF069",pattern:[3,5,5,6,5,4],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF070",pattern:[3,5,4,6,5,3],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF071",pattern:[2,4,6],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF072",pattern:[2,5,6,6],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF073",pattern:[3,4,7,5,4],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF074",pattern:[1,4,7,5,2,1],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF075",pattern:[2,4,6,6,3,2],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF076",pattern:[2,4,5],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF077",pattern:[3,5,6,5],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF078",pattern:[2,3,6,4,3],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF079",pattern:[2,4,7,5,3,2],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF080",pattern:[2,4,6,5,3,1],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF081",pattern:[1,5,3],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF082",pattern:[1,6,3,7],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF083",pattern:[2,5,4,6,5],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF084",pattern:[1,5,4,6,3,7],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF085",pattern:[1,5,3,7,4,8],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF086",pattern:[1,5,2],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF087",pattern:[2,6,3,6],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF088",pattern:[1,4,3,5,4],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF089",pattern:[1,5,4,6,4,8],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF090",pattern:[1,5,3,6,4,7],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF091",pattern:[6,3,5],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF092",pattern:[6,4,5,3],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF093",pattern:[7,3,6,2,5],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF094",pattern:[5,3,6,2,3,1],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF095",pattern:[6,3,5,3,4,2],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF096",pattern:[6,3,4],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF097",pattern:[7,4,5,2],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF098",pattern:[6,2,5,1,4],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF099",pattern:[6,3,6,2,4,2],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF100",pattern:[6,3,5,2,4,1],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF101",pattern:[1,1,1,1],tags:["flat","static","texture_loop","loop_safe","simple","ostinato"]},{id:"MF102",pattern:[1,5,1,5],tags:["flat","texture_loop","loop_safe","ostinato","percussive_layer"]},{id:"MF103",pattern:[1,1,1,1],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF104",pattern:[1,1,1,2,1],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF105",pattern:[5,5,5,5],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF106",pattern:[1,2,1,2],tags:["flat","static","drone","loop_safe","ostinato","simple"]},{id:"MF107",pattern:[3,3,3,3],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF108",pattern:[1,3,1,3],tags:["flat","static","drone","loop_safe","ostinato"]},{id:"MF109",pattern:[1,1,5,1,1,5],tags:["flat","static","loop_safe","ostinato","percussive_layer"]},{id:"MF110",pattern:[1,1,1,1,1,1],tags:["flat","static","drone","loop_safe","simple","texture_loop"]},{id:"MF111",pattern:[5,6,7,1],tags:["mysterious","ascending","dark","start","loop_safe","short"]},{id:"MF112",pattern:[1,7,6,5],tags:["mysterious","descending","dark","middle","loop_safe","short"]},{id:"MF113",pattern:[3,1,6,5],tags:["mysterious","complex","dark","tense","loop_safe","short"]},{id:"MF114",pattern:[1,2,3,2,1],tags:["playful","neighbor","bright","simple","loop_safe","short"]},{id:"MF115",pattern:[5,4,3,4,5],tags:["playful","wave","bright","upbeat","loop_safe","short"]},{id:"MF116",pattern:[1,3,5,3,1],tags:["playful","arch","bright","simple","loop_safe","short"]},{id:"MF117",pattern:[1,5,1,5],tags:["epic","leaping","bright","heroic","loop_safe","short"]},{id:"MF118",pattern:[5,6,7,1,2],tags:["epic","ascending","bright","heroic","build","short"]},{id:"MF119",pattern:[1,3,5,7,1],tags:["epic","ascending","arpeggio","heroic","bright","short"]},{id:"MF120",pattern:[6,5,4,3],tags:["mysterious","descending","scalar","dark","loop_safe","short"]},{id:"MF121",pattern:[3,5,3,1],tags:["playful","wave","bright","simple","loop_safe","short"]},{id:"MF122",pattern:[5,3,1,5],tags:["epic","leaping","arpeggio","heroic","loop_safe","short"]},{id:"MF123",pattern:[1,6,5,1],tags:["mysterious","complex","dark","cadence","loop_safe","short"]},{id:"MF124",pattern:[2,3,4,5],tags:["playful","ascending","scalar","bright","loop_safe","short"]},{id:"MF125",pattern:[1,4,7,4,1],tags:["epic","arch","leaping","heroic","bright","extended"]},{id:"MF126",pattern:[5,7,6,5,3],tags:["mysterious","complex","dark","descending","loop_safe","extended"]},{id:"MF127",pattern:[1,1,3,3,5,5],tags:["playful","sequence","ascending","bright","loop_safe","extended"]},{id:"MF128",pattern:[1,7,1,5],tags:["epic","leaping","heroic","bright","loop_safe","short"]},{id:"MF129",pattern:[3,2,1,6],tags:["mysterious","descending","dark","tense","loop_safe","short"]},{id:"MF130",pattern:[5,5,6,6,7,7,1],tags:["epic","sequence","ascending","heroic","build","extended"]},{id:"MF131",pattern:[5,4,3,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF132",pattern:[6,5,4,2],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF133",pattern:[7,5,3,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF134",pattern:[5,3,2,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF135",pattern:[6,4,3,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF136",pattern:[1,2,3,5],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF137",pattern:[1,3,5,6],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF138",pattern:[2,3,4,6],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF139",pattern:[1,2,4,5],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF140",pattern:[3,4,5,7],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF141",pattern:[7,6,5,4,3],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF142",pattern:[5,4,3,2,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF143",pattern:[6,5,4,3,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF144",pattern:[7,5,4,2,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF145",pattern:[5,4,3,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF146",pattern:[1,2,1,3,1],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF147",pattern:[5,6,5,7,5],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF148",pattern:[1,3,1,2,1],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF149",pattern:[5,7,5,6,5],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF150",pattern:[1,4,1,3,1],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF151",pattern:[1,4,6,5,7,6,4],tags:["breakbeat","tense","leaping","loop_safe","short"]},{id:"MF152",pattern:[5,3,6,4,7,5],tags:["breakbeat","tense","sequence","loop_safe","short","variation"]},{id:"MF153",pattern:[1,5,4,6,3,7,5],tags:["breakbeat","upbeat","leaping","loop_safe","extended"]},{id:"MF154",pattern:[1,1,3,2,1],tags:["lofi","peaceful","stepwise","loop_safe","short"]},{id:"MF155",pattern:[5,4,4,3,2,2],tags:["lofi","peaceful","descending","loop_safe","long"]},{id:"MF156",pattern:[1,3,2,5,4,3,1],tags:["lofi","melancholic","stepwise","loop_safe","extended"]}],ca=[{id:"MR001",length:4,pattern:[{value:4},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["start","simple","drive","loop_safe"]},{id:"MR002",length:4,pattern:[{value:8},{value:8},{value:8},{value:8},{value:4},{value:4}],tags:["middle","syncopated","drive"]},{id:"MR003",length:4,pattern:[{value:4},{value:4},{value:4},{value:4}],tags:["start","legato","simple"]},{id:"MR004",length:4,pattern:[{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4}],tags:["middle","rest_heavy","staccato"]},{id:"MR005",length:4,pattern:[{value:8},{value:8},{value:4},{value:8},{value:8},{value:4}],tags:["middle","syncopated","drive"]},{id:"MR006",length:4,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["middle","legato","rest_heavy"]},{id:"MR007",length:4,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8}],tags:["start","staccato","drive"]},{id:"MR008",length:8,pattern:[{value:8},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4}],tags:["start","bridge","legato"]},{id:"MR009",length:4,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16},{value:16}],tags:["end","legato","loop_safe","cadence"]},{id:"MR010",length:4,pattern:[{value:8},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4}],tags:["end","syncopated","staccato","loop_safe","cadence"]},{id:"MR011",length:4,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:4}],tags:["start","legato","rest_heavy","loop_safe"]},{id:"MR012",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:8},{value:8},{value:8},{value:8}],tags:["middle","staccato","drive","syncopated"]},{id:"MR013",length:4,pattern:[{value:8,rest:!0},{value:8,rest:!0},{value:4},{value:8},{value:8},{value:4}],tags:["middle","rest_heavy","simple"]},{id:"MR014",length:4,pattern:[{value:4},{value:8},{value:8},{value:16,rest:!0},{value:16},{value:4},{value:8}],tags:["middle","syncopated","drive","accented"]},{id:"MR015",length:4,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:8},{value:8}],tags:["end","legato","rest_heavy","loop_safe"]},{id:"MR016",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:16,rest:!0},{value:16,rest:!0},{value:16},{value:16},{value:4},{value:4},{value:8},{value:8},{value:4}],tags:["bridge","legato","rest_heavy"]},{id:"MR017",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4}],tags:["bridge","syncopated","drive"]},{id:"MR018",length:8,pattern:[{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4}],tags:["end","legato","loop_safe","cadence"]},{id:"MR019",length:4,pattern:[{value:4},{value:8},{value:8},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16},{value:8},{value:8}],tags:["start","drive","accented"]},{id:"MR020",length:4,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:8},{value:8}],tags:["middle","rest_heavy","simple"]},{id:"MR021",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["middle","staccato","drive","syncopated"]},{id:"MR022",length:4,pattern:[{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:4},{value:8,rest:!0},{value:8}],tags:["end","legato","loop_safe"]},{id:"MR023",length:8,pattern:[{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["bridge","syncopated","drive","accented"]},{id:"MR024",length:8,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4}],tags:["bridge","legato","rest_heavy"]},{id:"MR025",length:8,pattern:[{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8,rest:!0},{value:4},{value:4},{value:8,rest:!0},{value:8,rest:!0},{value:4},{value:4}],tags:["end","legato","loop_safe","cadence"]},{id:"MR026",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["start","texture_loop","grid16","drive","loop_safe"]},{id:"MR027",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:8},{value:8},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR028",length:4,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8}],tags:["start","middle","texture_loop","simple","loop_safe","percussive_layer"]},{id:"MR029",length:4,pattern:[{value:8},{value:16},{value:16},{value:8},{value:8},{value:16},{value:16},{value:8},{value:8},{value:8}],tags:["middle","texture_loop","loop_safe","percussive_layer"]},{id:"MR030",length:4,pattern:[{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16}],tags:["start","middle","texture_loop","loop_safe","percussive_layer"]},{id:"MR031",length:4,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR032",length:4,pattern:[{value:8},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["middle","texture_loop","loop_safe","percussive_layer","syncopated"]},{id:"MR033",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:8},{value:16},{value:16},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR034",length:8,pattern:[{value:4},{value:4},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16},{value:4},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16},{value:4},{value:4},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16}],tags:["middle","end","staccato","rest_heavy","percussive_layer","loop_safe"]},{id:"MR035",length:4,pattern:[{value:8},{value:16,rest:!0},{value:16},{value:8},{value:16,rest:!0},{value:16},{value:8},{value:16,rest:!0},{value:16},{value:8},{value:16,rest:!0},{value:16}],tags:["start","middle","staccato","rest_heavy","percussive_layer","loop_safe"]},{id:"MR036",length:4,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:16},{value:16},{value:16},{value:16}],tags:["start","middle","rest_heavy","loop_safe","simple"]},{id:"MR037",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16}],tags:["middle","end","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR038",length:8,pattern:[{value:4},{value:4},{value:4},{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4}],tags:["start","drive","syncopated"]},{id:"MR039",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["start","simple","drive"]},{id:"MR040",length:8,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8}],tags:["start","legato","rest_heavy"]},{id:"MR041",length:8,pattern:[{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4}],tags:["start","syncopated","drive"]},{id:"MR042",length:8,pattern:[{value:4},{value:4},{value:8},{value:8},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["start","simple","legato"]},{id:"MR043",length:8,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:4},{value:4},{value:16},{value:16},{value:8},{value:4},{value:4},{value:4}],tags:["start","staccato","drive"]},{id:"MR044",length:8,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["start","rest_heavy","simple"]},{id:"MR045",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["start","syncopated","accented"]},{id:"MR046",length:8,pattern:[{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["middle","drive","syncopated"]},{id:"MR047",length:8,pattern:[{value:4},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","simple","legato"]},{id:"MR048",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","staccato","drive"]},{id:"MR049",length:8,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["middle","rest_heavy","legato"]},{id:"MR050",length:8,pattern:[{value:8},{value:16},{value:16},{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["middle","syncopated","accented"]},{id:"MR051",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4}],tags:["middle","simple","drive"]},{id:"MR052",length:8,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","staccato","syncopated"]},{id:"MR053",length:8,pattern:[{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","rest_heavy","staccato"]},{id:"MR054",length:8,pattern:[{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4}],tags:["end","legato","loop_safe","cadence"]},{id:"MR055",length:8,pattern:[{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4}],tags:["end","syncopated","loop_safe","cadence"]},{id:"MR056",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["end","simple","loop_safe","cadence"]},{id:"MR057",length:8,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR058",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8}],tags:["middle","texture_loop","simple","loop_safe","percussive_layer"]},{id:"MR059",length:8,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR060",length:8,pattern:[{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16}],tags:["middle","end","texture_loop","loop_safe","percussive_layer"]},{id:"MR061",length:8,pattern:[{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR062",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16}],tags:["middle","texture_loop","grid16","syncopated","drive"]},{id:"MR063",length:4,pattern:[{value:8,accent:!0},{value:16},{value:16},{value:8},{value:16},{value:16,accent:!0},{value:8},{value:16},{value:16},{value:8,rest:!0},{value:16},{value:16}],tags:["middle","texture_loop","grid16","percussive_layer","ostinato"]},{id:"MR064",length:4,pattern:[{value:4,accent:!0},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["start","texture_loop","grid16","percussive_layer","loop_safe"]}],pa=[{id:"DP001",length_beats:4,type:"beat",pattern:"K-H-S-H-K-H-S-H-",tags:["loop_safe"]},{id:"DP002",length_beats:4,type:"beat",pattern:"H-S-H-K-H-S-H-K-",tags:["loop_safe","variation"]},{id:"DP003",length_beats:4,type:"beat",pattern:"K---S---K-H-S-H",tags:["bridge"]},{id:"DP004",length_beats:4,type:"beat",pattern:"--S---K-H-S-HK-",tags:["bridge","variation"]},{id:"DP005",length_beats:4,type:"beat",pattern:"K-H-K---S-H-K---",tags:["build"]},{id:"DP006",length_beats:4,type:"beat",pattern:"H-K---S-H-K---K-",tags:["build","variation"]},{id:"DP007",length_beats:4,type:"beat",pattern:"K---S-H-K---S-H-",tags:["straight"]},{id:"DP008",length_beats:4,type:"beat",pattern:"--S-H-K---S-H-K-",tags:["straight","variation"]},{id:"DP009",length_beats:4,type:"beat",pattern:"K-H---S-K-H---S-",tags:["syncopation"]},{id:"DP010",length_beats:4,type:"beat",pattern:"H---S-K-H---S-K-",tags:["syncopation","variation"]},{id:"DP011",length_beats:4,type:"beat",pattern:"K---H-K-S---H-K-",tags:["open"]},{id:"DP012",length_beats:4,type:"beat",pattern:"--H-K-S---H-K-K-",tags:["open","variation"]},{id:"DP013",length_beats:4,type:"beat",pattern:"K-H-K-H-S-H-K-H-",tags:["loop_safe"]},{id:"DP014",length_beats:4,type:"beat",pattern:"H-K-H-S-H-K-H-K-",tags:["loop_safe","variation"]},{id:"DP015",length_beats:4,type:"beat",pattern:"K---S---K---H---",tags:["simple"]},{id:"DP016",length_beats:4,type:"beat",pattern:"--S---K---H---K-",tags:["simple","variation"]},{id:"DP017",length_beats:4,type:"beat",pattern:"K-H---K-S-H---K-",tags:["bridge"]},{id:"DP018",length_beats:4,type:"beat",pattern:"H---K-S-H---K-K-",tags:["bridge","variation"]},{id:"DP019",length_beats:4,type:"beat",pattern:"K--H-K--S-H-K--",tags:["swing_hint"]},{id:"DP020",length_beats:4,type:"beat",pattern:"-H-K--S-H-K--K-",tags:["swing_hint","variation"]},{id:"DP021",length_beats:4,type:"fill",pattern:"S-S-S-S-S-S-O---",tags:["cadence"]},{id:"DP022",length_beats:4,type:"fill",pattern:"S-S-S-S-O---S-S-",tags:["cadence","variation"]},{id:"DP023",length_beats:8,type:"fill",pattern:"S-S-S-S-S-S-O---S-S-S-S-S-S-O---",tags:["cadence","extended"]},{id:"DP024",length_beats:4,type:"fill",pattern:"KSKO-KSKO-KSKO-K",tags:["build"]},{id:"DP025",length_beats:4,type:"fill",pattern:"-KSKO-KSKO-KKSKO",tags:["build","variation"]},{id:"DP026",length_beats:8,type:"fill",pattern:"KSKO-KSKO-KSKO-KKSKO-KSKO-KSKO-K",tags:["build","extended"]},{id:"DP027",length_beats:4,type:"fill",pattern:"S-HS-HS-HS-HS-HS",tags:["bridge"]},{id:"DP028",length_beats:4,type:"fill",pattern:"-HS-HS-HS-HSS-HS",tags:["bridge","variation"]},{id:"DP029",length_beats:8,type:"fill",pattern:"S-HS-HS-HS-HS-HSS-HS-HS-HS-HS-HS",tags:["bridge","extended"]},{id:"DP030",length_beats:4,type:"fill",pattern:"K-SK-SK-SK-SK-SK",tags:["build"]},{id:"DP031",length_beats:4,type:"fill",pattern:"-SK-SK-SK-SKK-SK",tags:["build","variation"]},{id:"DP032",length_beats:8,type:"fill",pattern:"K-SK-SK-SK-SK-SKK-SK-SK-SK-SK-SK",tags:["build","extended"]},{id:"DP033",length_beats:4,type:"fill",pattern:"S--S-HHS--S-HHS-",tags:["break"]},{id:"DP034",length_beats:4,type:"fill",pattern:"-HHS--S-HHS-S--S",tags:["break","variation"]},{id:"DP035",length_beats:8,type:"fill",pattern:"S--S-HHS--S-HHS-S--S-HHS--S-HHS-",tags:["break","extended"]},{id:"DP036",length_beats:4,type:"fill",pattern:"K-K-K-K-S-S-S-S-",tags:["cadence"]},{id:"DP037",length_beats:4,type:"fill",pattern:"K-K-S-S-S-S-K-K-",tags:["cadence","variation"]},{id:"DP038",length_beats:8,type:"fill",pattern:"K-K-K-K-S-S-S-S-K-K-K-K-S-S-S-S-",tags:["cadence","extended"]},{id:"DP039",length_beats:4,type:"fill",pattern:"S-S-H-H-S-S-H-H-",tags:["bridge"]},{id:"DP040",length_beats:4,type:"fill",pattern:"H-H-S-S-H-H-S-S-",tags:["bridge","variation"]},{id:"DP041",length_beats:8,type:"fill",pattern:"S-S-H-H-S-S-H-H-S-S-H-H-S-S-H-H-",tags:["bridge","extended"]},{id:"DP042",length_beats:4,type:"fill",pattern:"KSTK-KSTK-KSTK-K",tags:["toms"]},{id:"DP043",length_beats:4,type:"fill",pattern:"-KSTK-KSTK-KKSTK",tags:["toms","variation"]},{id:"DP044",length_beats:8,type:"fill",pattern:"KSTK-KSTK-KSTK-KKSTK-KSTK-KSTK-K",tags:["toms","extended"]},{id:"DP045",length_beats:4,type:"fill",pattern:"S--S--S--S--S--S",tags:["loop_safe"]},{id:"DP046",length_beats:4,type:"fill",pattern:"--S--S--S--SS--S",tags:["loop_safe","variation"]},{id:"DP047",length_beats:8,type:"fill",pattern:"S--S--S--S--S--SS--S--S--S--S--S",tags:["loop_safe","extended"]},{id:"DP048",length_beats:4,type:"fill",pattern:"K-S-H-K-S-H-K-S-",tags:["bridge"]},{id:"DP049",length_beats:4,type:"fill",pattern:"H-K-S-H-K-S-K-S-",tags:["bridge","variation"]},{id:"DP050",length_beats:8,type:"fill",pattern:"K-S-H-K-S-H-K-S-K-S-H-K-S-H-K-S-",tags:["bridge","extended"]},{id:"DP051",length_beats:4,type:"beat",pattern:"K-H-K-H-K-H-K-H-",tags:["loop_safe","four_on_floor","straight","percussive_layer","texture_loop"]},{id:"DP052",length_beats:4,type:"beat",pattern:"K-HO-K-H-K-O-K-H-",tags:["loop_safe","four_on_floor","straight","variation","percussive_layer"]},{id:"DP053",length_beats:4,type:"beat",pattern:"K-HH-K-HH-K-HH-K-HH",tags:["loop_safe","grid16","texture_loop","percussive_layer"]},{id:"DP054",length_beats:4,type:"beat",pattern:"K--S--K-K--S--K-",tags:["rock","drive","loop_safe"]},{id:"DP055",length_beats:4,type:"beat",pattern:"K-K-S---K-K-S-K-",tags:["dance","syncopation","loop_safe"]},{id:"DP056",length_beats:4,type:"beat",pattern:"K-----S-K-----S-",tags:["ballad","simple","loop_safe"]},{id:"DP057",length_beats:4,type:"beat",pattern:"K-H-S-K-K-H-S-H-",tags:["rock","energetic","loop_safe","variation"]},{id:"DP058",length_beats:4,type:"beat",pattern:"K-S-K-S-K-S-K-S-",tags:["dance","four_on_floor","loop_safe"]},{id:"DP059",length_beats:4,type:"beat",pattern:"K---S-K-K---S---",tags:["syncopation","upbeat","loop_safe"]},{id:"DP060",length_beats:4,type:"beat",pattern:"K-H-S-H-K---S-H-",tags:["rock","variation","loop_safe"]},{id:"DP061",length_beats:4,type:"beat",pattern:"K-K---S-K-K-S---",tags:["dance","syncopation","tense","loop_safe"]},{id:"DP062",length_beats:4,type:"beat",pattern:"K-H-S---K-H-S-K-",tags:["rock","drive","loop_safe","variation"]},{id:"DP063",length_beats:4,type:"beat",pattern:"K-----S---K-S---",tags:["ballad","peaceful","simple","loop_safe"]},{id:"DP064",length_beats:4,type:"beat",pattern:"K-K-S-K-K-K-S-K-",tags:["dance","energetic","drive","loop_safe"]},{id:"DP065",length_beats:4,type:"beat",pattern:"K-H-S-K---H-S-H-",tags:["syncopation","rock","variation","loop_safe"]},{id:"DP066",length_beats:4,type:"beat",pattern:"K---S---K-K-S-K-",tags:["dance","syncopation","build","loop_safe"]},{id:"DP067",length_beats:4,type:"beat",pattern:"K-H-S-H-K-H-S---",tags:["rock","cadence","loop_safe"]},{id:"DP068",length_beats:4,type:"beat",pattern:"K-K-K-K-S-S-S-S-",tags:["experimental","build","tense","loop_safe"]},{id:"DP069",length_beats:4,type:"beat",pattern:"K-HO-K-HO-K-HO-K-HO",tags:["loop_safe","four_on_floor","texture_loop","percussive_layer","variation"]},{id:"DP070",length_beats:4,type:"beat",pattern:"K-HS-K-HK-HS-K-HK-HS",tags:["loop_safe","four_on_floor","grid16","percussive_layer","texture_loop"]},{id:"DP071",length_beats:4,type:"beat",pattern:"K-H-K-S-K-H-O-S-",tags:["loop_safe","four_on_floor","syncopation","percussive_layer","variation"]},{id:"DP072",length_beats:4,type:"beat",pattern:"K-HH-K-S-K-HH-K-S",tags:["loop_safe","four_on_floor","grid16","percussive_layer","build"]},{id:"DP073",length_beats:4,type:"beat",pattern:"KH-HSHKHOHSHKHSH",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP074",length_beats:4,type:"beat",pattern:"KH-HSH-KHSOHK-SH",tags:["loop_safe","grid16","syncopation","breakbeat","variation","percussive_layer"]},{id:"DP075",length_beats:4,type:"fill",pattern:"KHSHKHSHKTSHKHSH",tags:["break","breakbeat","drum_fill","grid16","syncopation"]},{id:"DP076",length_beats:4,type:"beat",pattern:"K--H-K--S-H--H--",tags:["loop_safe","swing_hint","simple","rest_heavy","lofi"]},{id:"DP077",length_beats:4,type:"beat",pattern:"K-H--K-HS--H--H-",tags:["loop_safe","swing_hint","rest_heavy","lofi","variation"]},{id:"DP078",length_beats:4,type:"beat",pattern:"K-HS-K-HSK-H-SH-",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP079",length_beats:4,type:"beat",pattern:"K-HO-KS-HK-S-HO-",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer","variation"]},{id:"DP080",length_beats:4,type:"fill",pattern:"KHSHKHSKTSHKHSS-",tags:["break","breakbeat","drum_fill","grid16","syncopation"]},{id:"DP081",length_beats:4,type:"beat",pattern:"K---H---S-H-----",tags:["loop_safe","swing_hint","rest_heavy","lofi"]},{id:"DP082",length_beats:4,type:"beat",pattern:"K--H---HS--H-K--",tags:["loop_safe","swing_hint","rest_heavy","lofi","variation"]},{id:"DP083",length_beats:4,type:"fill",pattern:"N---S---N---H---",tags:["lofi","drum_fill","rest_heavy","transition"]},{id:"DP084",length_beats:4,type:"beat",pattern:"KHHH-HSHKH-HSHK-",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP085",length_beats:4,type:"beat",pattern:"KH-HKHSH-HSHKHSO",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer","variation"]},{id:"DP086",length_beats:4,type:"beat",pattern:"K-HHKSH-HK-SHH-H",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP087",length_beats:4,type:"beat",pattern:"KHHSHK-HSHK-SHOH",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer","variation"]},{id:"DP088",length_beats:4,type:"fill",pattern:"KHSHSHKTSHSHKSH-",tags:["break","breakbeat","drum_fill","grid16","syncopation"]},{id:"DP089",length_beats:4,type:"fill",pattern:"KHSKHSKTSHSKHSKO",tags:["break","breakbeat","drum_fill","grid16","syncopation","variation"]}],ha=[{id:"BP_STEADY_ROOT_DRIVE",texture:"steady",steps:["root","root","fifth","root","fifth","root","fifth","approach"],tags:["default","loop_safe"]},{id:"BP_STEADY_UPWARD_WALK",texture:"steady",steps:["root","fifth","root","octave","fifth","root","octave","approach"],tags:["variation","section_end"]},{id:"BP_BROKEN_TRIAD_LIFT",texture:"broken",steps:["root","fifth","root","octave","root","fifth","root","approach"],tags:["default"]},{id:"BP_BROKEN_PICKUP_DROP",texture:"broken",steps:["root","octave","fifth","octaveHigh","root","fifth","octave","approach"],tags:["variation","pickup","section_end"]},{id:"BP_BREAK_OFFBEAT_DRIVE",texture:"broken",steps:["root","rest","octave","rest","fifth","approach","lowFifth","approach"],tags:["loop_safe","syncopated","breakbeat","variation","default"]},{id:"BP_BREAK_GHOST_RIDE",texture:"broken",steps:["root","octave","rest","fifth","rest","octave","lowFifth","approach"],tags:["loop_safe","breakbeat","syncopated","drive","default"]},{id:"BP_BREAK_SLIDE_UP",texture:"broken",steps:["root","approach","fifth","rest","root","octave","rest","approach"],tags:["loop_safe","breakbeat","variation"]},{id:"BP_LOFI_SWUNG_ROOT",texture:"steady",steps:["root","rest","rest","root","rest","fifth","rest","approach"],tags:["loop_safe","rest_heavy","swing_hint","lofi"]},{id:"BP_LOFI_DUSTY_STEP",texture:"steady",steps:["root","rest","rest","fifth","rest","rest","root","approach"],tags:["loop_safe","lofi","rest_heavy","swing_hint"]},{id:"BP_LOFI_WALKDOWN",texture:"steady",steps:["root","rest","third","rest","second","rest","root","approach"],tags:["loop_safe","lofi","rest_heavy","variation"]},{id:"BP_ARPEGGIO_GLIDE",texture:"arpeggio",steps:["root","octave","fifth","octaveHigh","root","fifth","octave","approach"],tags:["default","loop_safe"]},{id:"BP_ARPEGGIO_PULSE",texture:"arpeggio",steps:["root","fifth","octave","octaveHigh","root","fifth","octave","approach"],tags:["variation","transition","section_end"]},{id:"BP_STEADY_OFFBEAT_PUSH",texture:"steady",steps:["root","fifth","root","approach","fifth","root","octave","approach"],tags:["variation","syncopated","loop_safe"]},{id:"BP_BROKEN_LOW_SWING",texture:"broken",steps:["root","lowFifth","root","fifth","root","lowFifth","root","approach"],tags:["variation","loop_safe"]},{id:"BP_ARPEGGIO_SPREAD",texture:"arpeggio",steps:["root","octave","fifth","octaveHigh","fifth","octave","octaveHigh","approach"],tags:["variation","loop_safe"]},{id:"BP_STEADY_SUB_GRID",texture:"steady",steps:["root","root","root","root","root","root","root","root"],tags:["loop_safe","percussive_layer","four_on_floor","static"]},{id:"BP_STEADY_SUB_OFFSET",texture:"steady",steps:["root","root","root","fifth","root","root","root","approach"],tags:["loop_safe","percussive_layer","variation"]},{id:"BP_FOUR_ON_FLOOR_CLASSIC",texture:"steady",steps:["root","root","root","root","root","fifth","root","root"],tags:["loop_safe","four_on_floor","percussive_layer","static","drone"]},{id:"BP_FOUR_ON_FLOOR_GHOST",texture:"steady",steps:["root","root","fifth","root","root","root","fifth","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_FOUR_ON_FLOOR_OFFBEAT",texture:"steady",steps:["root","fifth","root","root","root","fifth","root","root"],tags:["loop_safe","four_on_floor","percussive_layer","syncopated"]},{id:"BP_FOUR_ON_FLOOR_OCTAVE_HIT",texture:"steady",steps:["root","root","root","octave","root","root","root","octave"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_FOUR_ON_FLOOR_ROLLING",texture:"steady",steps:["root","root","root","fifth","root","root","root","fifth"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_DRONE_STATIC_ROOT",texture:"steady",steps:["root","root","root","root","root","fifth","root","approach"],tags:["loop_safe","static","drone","four_on_floor","percussive_layer"]},{id:"BP_DRONE_LOW_PULSE",texture:"steady",steps:["root","lowFifth","root","lowFifth","root","lowFifth","root","lowFifth"],tags:["loop_safe","drone","percussive_layer"]},{id:"BP_DRONE_ACCENT_SPARK",texture:"steady",steps:["root","rest","octave","root","rest","fifth","root","approach"],tags:["loop_safe","drone","accent"]},{id:"BP_TECHNO_BOUNCE",texture:"broken",steps:["root","root","octave","root","root","root","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_TECHNO_SUB_EMPHASIS",texture:"steady",steps:["root","root","root","lowFifth","root","root","root","lowFifth"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_MINIMAL_BREATH",texture:"steady",steps:["root","root","root","root","fifth","root","root","root"],tags:["loop_safe","four_on_floor","percussive_layer","static"]},{id:"BP_WALKING_BASS",texture:"broken",steps:["root","second","third","fifth","root","seventh","octave","approach"],tags:["variation","walking","jazz_hint"]},{id:"BP_OCTAVE_JUMP",texture:"broken",steps:["root","octave","root","octave","fifth","octaveHigh","fifth","approach"],tags:["variation","energetic","jump"]},{id:"BP_CHROMATIC_WALK",texture:"broken",steps:["root","flatSecond","second","third","fifth","sixth","seventh","approach"],tags:["variation","chromatic","tense"]},{id:"BP_SYNCOPATED_GROOVE",texture:"broken",steps:["root","fifth","octave","root","fifth","octave","fifth","approach"],tags:["variation","syncopation","groove"]},{id:"BP_PEDAL_FIFTH",texture:"steady",steps:["root","fifth","root","fifth","root","fifth","root","fifth"],tags:["loop_safe","simple","rock"]},{id:"BP_ARPEGGIO_CASCADE",texture:"arpeggio",steps:["root","third","fifth","octave","fifth","third","root","approach"],tags:["variation","cascade","bright"]},{id:"BP_BOUNCY_RHYTHM",texture:"broken",steps:["root","root","fifth","fifth","octave","octave","fifth","approach"],tags:["variation","playful","bounce"]},{id:"BP_BROKEN_SYNCO_JUMP",texture:"broken",steps:["root","rest","octave","root","fifth","rest","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer","syncopated","default"]},{id:"BP_BROKEN_GRID_PULSE",texture:"broken",steps:["root","root","rest","root","octave","root","rest","root"],tags:["loop_safe","four_on_floor","percussive_layer","grid16"]},{id:"BP_BROKEN_TEXTURE_WAVE",texture:"broken",steps:["root","octave","fifth","root","root","octave","fifth","approach"],tags:["loop_safe","four_on_floor","percussive_layer","texture_loop"]},{id:"BP_BROKEN_DOUBLE_HIT",texture:"broken",steps:["root","root","octave","octave","fifth","fifth","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_BROKEN_OFFBEAT_DRIVE",texture:"broken",steps:["rest","root","rest","octave","rest","fifth","rest","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_BROKEN_SUB_BOUNCE",texture:"broken",steps:["root","lowFifth","octave","root","root","lowFifth","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer","static"]},{id:"BP_BROKEN_LIFT_DROP",texture:"broken",steps:["root","fifth","octave","octaveHigh","fifth","root","octave","approach"],tags:["loop_safe","four_on_floor","percussive_layer","variation"]},{id:"BP_BROKEN_STEADY_GRID",texture:"broken",steps:["root","root","root","octave","root","root","root","octave"],tags:["loop_safe","four_on_floor","percussive_layer","default"]}],ga={patterns:ha},ma=[{id:"TR_SECTION_NOISE_SWELL",pattern:"N---N---N---NNS-",length_beats:4,tags:["transition","section_end","noise_fx"],channel:"noise"},{id:"TR_SECTION_SNARE_RUSH",pattern:"--S-S-S-S-S-S-S-",length_beats:4,tags:["transition","section_end","drum_fill"],channel:"noise"},{id:"TR_LOOP_TIGHTENER",pattern:"K-HS-HK-HS-HK-H-",length_beats:4,tags:["transition","loop_out","drum_fill"],channel:"noise"},{id:"TR_SECTION_GHOST_ECHO",pattern:"N---S---N---S---",length_beats:4,tags:["transition","section_end","loop_out","noise_fx"],channel:"noise"},{id:"TR_BUILD_STUTTER_FILL",pattern:"K-SK-SK-SK-SK-S-",length_beats:4,tags:["transition","build","drum_fill"],channel:"noise"},{id:"TR_BREAKBEAT_SNARE_CHOP",pattern:"S--S-HS-S-HS-S--",length_beats:4,tags:["transition","section_end","break","breakbeat","drum_fill"],channel:"noise"},{id:"TR_LOFI_TAPE_SWELL",pattern:"N---H---S---H---",length_beats:4,tags:["transition","section_end","lofi","noise_fx","rest_heavy"],channel:"noise"}],fa={transitions:ma},va=ua,ya=da,_a=ca,Ma=pa,ba=ga,Sa=fa,rt=va,ne=ya,qe=new Map(ne.map(a=>[a.id,a])),it=_a,Ue=new Map(it.map(a=>[a.id,a])),re=Ma,Ra=new Map(re.map(a=>[a.id,a])),xa=ba.patterns??[],Ve=xa.reduce((a,e)=>{const t=a.get(e.texture)??[];return t.push(e),a.set(e.texture,t),a},new Map),me=Sa.transitions??[],be=["root","root","fifth","root","fifth","root","fifth","approach"],Pa={id:"BP_FALLBACK_STEADY",texture:"steady",steps:be,tags:["fallback"]},Ea={upbeat:["straight","syncopation"],sad:["straight","simple"],tense:["syncopation","accented"],peaceful:["straight","open"]},Ba={upbeat:["bright","ascending"],sad:["dark","descending"],tense:["dark","complex","leaping"],peaceful:["simple","arch","bright"]},Ta={upbeat:["syncopated","drive"],sad:["legato","rest_heavy"],tense:["syncopated","staccato"],peaceful:["legato","simple"]},X=new Map(rt.map(a=>[a.id,a])),Aa={dualBass:{preferBeatTags:["percussive_layer","syncopation"],preferFillTags:["drum_fill","build"]},bassLed:{preferBeatTags:["four_on_floor","drive"],preferFillTags:["build"],earlySparseMeasures:1},layeredBass:{preferBeatTags:["four_on_floor","loop_safe"],preferFillTags:["drum_fill"]},minimal:{preferBeatTags:["simple","open"],preferFillTags:["noise_fx"],avoidTags:["build","drive"],earlySparseMeasures:2},breakLayered:{preferBeatTags:["breakbeat","percussive_layer","grid16"],preferFillTags:["break","drum_fill","breakbeat"],avoidTags:["four_on_floor"]},lofiPadLead:{preferBeatTags:["lofi","rest_heavy","swing_hint"],preferFillTags:["noise_fx","lofi"],avoidTags:["breakbeat"],earlySparseMeasures:2},retroPulse:{preferBeatTags:["loop_safe","grid16","syncopation"],preferFillTags:["build","transition"],avoidTags:["rest_heavy"]}},Oa={dualBass:{density:.85,velocityScale:.9,offbeatAccentBoost:3},bassLed:{density:.6,sustainWholeMeasure:!1,offbeatAccentBoost:5},layeredBass:{density:.75,velocityScale:.95},minimal:{density:.5,sustainWholeMeasure:!0,velocityScale:.8},breakLayered:{density:.95,velocityScale:1.05,offbeatAccentBoost:6},lofiPadLead:{density:.55,sustainWholeMeasure:!0,velocityScale:.7},retroPulse:{density:.78,velocityScale:.95,offbeatAccentBoost:2}};function b(a,e,t=.4){if(!e.length)return a;const s=a.filter(n=>{const r=n.tags??[];return e.some(i=>r.includes(i))});return s.length===0||a.length>=4&&s.length<a.length*t?a:s}function We(a,e){const t=[...a];for(let s=t.length-1;s>0;s--){const n=Math.floor(e()*(s+1)),r=t[s];t[s]=t[n],t[n]=r}return t}function ot(a,e,t,s=.6){if(!e.length||a.length<=1)return a;const n=a.filter(c=>{const p=c.tags??[];return e.some(h=>p.includes(h))});if(!n.length||n.length===a.length)return a;const r=a.filter(c=>!n.includes(c)),i=We(n,t),o=We(r,t),l=Math.min(i.length,Math.max(1,Math.ceil(a.length*s))),u=i.slice(0,l),d=[...i.slice(l),...o];return[...u,...d]}const Q=1337;function ce(a){let e=(a??Q)>>>0;return e===0&&(e=Q),()=>(e=e*1664525+1013904223>>>0,e/4294967295)}function k(a,e,t){if(!a.length)throw new Error("No candidates available for selection");if(a.length===1)return a[0];let s=a[Math.floor(e()*a.length)];if(t&&a.length>1){let n=0;for(;(s==null?void 0:s.id)===t&&n<3;)s=a[Math.floor(e()*a.length)],n++}return s}function F(a,e){return e.length?e.every(t=>a.tags.includes(t)):!0}function Ia(a){return Math.abs(a%1)<1e-6}function Ha(a,e){return e.find(t=>a>=t.startBeat&&a<t.startBeat+t.durationBeats)}function lt(a,e){return a===0?"start":a===e-1?"end":"middle"}function Ka(a){try{return ht(a),!0}catch{return!1}}function ut(a,e,t,s,n,r,i){var o;const l=rt.filter(Ka),u=Ea[a.mood]??[],d=(f,m)=>f.filter(v=>m.some(y=>v.tags.includes(y))),c=l.filter(f=>F(f,n));let p=l.filter(f=>f.tags.includes(t));const h=d(p,u);if(h.length)p=h;else{const f=d(l,u);f.length&&(p=f)}if(e.loopCentric&&(p=b(p,["loop_safe","texture_loop"])),e.textureFocus&&(p=b(p,["texture_loop","straight","simple","grid16"])),e.percussiveLayering&&(p=b(p,["grid16","percussive_layer"])),e.syncopationBias&&(p=b(p,["syncopation"])),p.length||(p=l),n.length){const f=p.filter(m=>F(m,n));f.length?p=f:c.length&&(p=c)}if((o=s==null?void 0:s.variations)!=null&&o.length){const f=s.variations.map(m=>X.get(m)).filter(m=>!!m);if(f.length&&r()<.5){const m=C(f,i);return k(m,r,s.id)}}const g=C(p,i);return k(g,r,s==null?void 0:s.id)}function ka(a,e,t,s,n,r){const i=Ba[a.mood]??[];let o=ne.filter(u=>i.some(d=>u.tags.includes(d)));if(t.length){const u=o.filter(d=>F(d,t));if(u.length)o=u;else{const d=ne.filter(c=>F(c,t));d.length&&(o=d)}}o.length||(o=ne),e.textureFocus&&(o=b(o,["texture_loop","ostinato","loop_safe","short","static"])),e.harmonicStatic&&(o=ot(o,["scalar","stepwise","static"],s,.6)),e.gradualBuild&&(o=b(o,["ascending"]));const l=C(o,r);return k(l,s,n==null?void 0:n.id)}function Fa(a,e,t,s,n,r,i,o){const l=Ta[a.mood]??[];let u=it.filter(h=>Math.abs(h.length-s)<1e-6);if(!u.length)throw new Error(`No melody rhythm motifs of length ${s}`);let d=u.filter(h=>h.tags.includes(t));d.length||(d=u);let c=d.filter(h=>l.some(g=>h.tags.includes(g)));if(c.length||(c=d),e.loopCentric&&(c=b(c,["loop_safe","texture_loop"])),e.textureFocus&&(c=b(c,["texture_loop","grid16","simple"])),e.syncopationBias&&(c=b(c,["syncopated","drive"])),n.length){const h=c.filter(g=>F(g,n));h.length&&(c=h)}c=Ya(c,s);const p=C(c,o);return k(p,r,i)}function Ca(a,e,t,s,n){let r={broken:90,steady:86,arpeggio:92}[a.texture]??88;const i=e===0?6:0,o=a.measures-e<=1?4:0;if(n.textureFocus&&(r-=8),n.gradualBuild){const l=s>1?t/Math.max(1,s-1):0,u=Math.min(1,Math.max(0,l)),d=s<=16?.6:s<=32?.75:.9,c=Math.pow(u,d),p=s<=16?14:s<=32?18:20,h=Math.floor(c*p);r+=h}return n.loopCentric&&(r=Math.max(60,r-2)),Math.min(110,Math.max(58,r+i+o))}function wa(a,e,t,s,n){const r={upbeat:0,peaceful:-3,tense:-5,sad:-2},i={slow:-2,medium:0,fast:2},o={minimalTechno:-4,progressiveHouse:3,retroLoopwave:2,breakbeatJungle:-2,lofiChillhop:-5},l=(s.textureFocus?2:0)+(s.gradualBuild?1:0)+(s.loopCentric?-1:0)+(s.atmosPad?2:0)+(s.percussiveLayering?-2:0),u=r[a]??0,d=i[e]??0,c=t?o[t]??0:0,p=ce(n),h=Math.floor(p()*7)-3,g=72+u+d+c+l+h;return Math.max(63,Math.min(78,g))}function Da(a,e,t,s,n,r){if(!a)return r;const i={steady:0,broken:-3,arpeggio:4},o=Math.max(0,e);let l=i[a.texture]??0;if(n.textureFocus&&(l-=4),n.filterMotion&&(l+=1),le(a)&&o===0&&(l+=3),K(a)&&o===0&&(l-=2),n.gradualBuild){const h=t/Math.max(1,s-1),g=Math.round(Math.pow(h,.7)*8);l+=g}(a.measures>0?o/a.measures:0)>=.75&&(l-=2);const u=Math.min(a.occurrenceIndex-1,2)*2;l-=u,n.atmosPad&&(l-=1);const d=60,c=84,p=r+l;return Math.max(d,Math.min(c,p))}function La(a,e,t,s){if(e<=0)return;const n=e-.25;if(n<0)return;const r=t.pattern,i=r[r.length-1]??r[0]??1;a.push({channelRole:"melody",startBeat:n,durationBeats:.25,degree:i,velocity:la.PICKUP_BASE,sectionId:s})}function Ga(a,e,t,s){if(!e.length)return a;const n=[e[e.length-1]],r=n[0]+(t.textureFocus?2:1),i=n[0]-(t.loopCentric?1:2),o=new Set([a,n[0],r,i]),l=Array.from(o);return l[Math.floor(s()*l.length)]}function je(a,e,t,s,n){const r=a.variations??[];if(!r.length)return;const i=r.map(l=>X.get(l)).filter(l=>!!l).filter(l=>l.tags.includes(e)&&F(l,t));if(!i.length)return;const o=C(i,n);return k(o,s,a.id)}function Na(a,e,t,s,n){var r;const i=(r=n.steps)!=null&&r.length?n.steps:be,o=[],l=ue(t,40),u=s??t;for(let d=0;d<i.length;d++){const c=e+d*.5,p=pt(i[d],t,u,l);p!==null&&o.push({channelRole:"bass",startBeat:c,durationBeats:.5,degree:0,velocity:ct(a,d),sectionId:a.id,midiOverride:p})}return o}function dt(a,e,t,s,n,r,i){const o=(i==null?void 0:i.enforceDroneStatic)??!0,l=(i==null?void 0:i.preferredTags)??[],u=e===a.measures-1,d=n.get(a.id);if(d){if(u&&!(d.tags??[]).includes("section_end")){const h=G(a.texture,r,t,s,["section_end"],d.id);if(h)return s.add(h.id),h}return d}if(r.harmonicStatic){if(!o&&l.length){const g=G(a.texture,r,t,s,l,void 0);if(g)return n.set(a.id,g),s.add(g.id),g}const h=G(a.texture,r,t,s,["drone","static"],void 0);if(h&&o)return n.set(a.id,h),s.add(h.id),h}const c=le(a)?["pickup"]:[],p=G(a.texture,r,t,s,c,void 0)??G(a.texture,r,t,s,[],void 0)??Pa;if(n.set(a.id,p),s.add(p.id),u&&!(p.tags??[]).includes("section_end")){const h=G(a.texture,r,t,s,["section_end"],p.id);if(h)return s.add(h.id),h}return p}function G(a,e,t,s,n,r){let i=Ve.get(a)??[];if(!i.length&&a!=="steady"&&(i=Ve.get("steady")??[]),!i.length)return;if((e.loopCentric||e.harmonicStatic)&&(i=b(i,["loop_safe"])),e.syncopationBias&&(i=b(i,["syncopated"])),e.textureFocus&&(i=b(i,["default"])),e.percussiveLayering&&(i=b(i,["percussive_layer","four_on_floor"])),e.percussiveLayering&&e.syncopationBias&&e.breakInsertion&&(i=b(i,["breakbeat","variation"],.2)),e.atmosPad&&e.loopCentric&&(i=b(i,["lofi","rest_heavy"],.25)),e.harmonicStatic&&(i=ot(i,["drone","static"],t,.65)),n.length){const l=i.filter(u=>n.every(d=>(u.tags??[]).includes(d)));l.length&&(i=l)}if(!i.length)return;const o=C(i,s);return k(o,t,r)}function qa(a,e){const t=[];for(const s of e){let n=s.startBeat,r=0;const i=4;for(;r<i&&a.some(o=>Math.abs(o.startBeat-n)<.0625);)r++,n=s.startBeat+r*.0625;t.push({...s,startBeat:n})}return t}function Ua(a,e,t,s,n,r,i,o,l){if(!me.length)return;const u=["transition","section_end"];t&&u.push("loop_out");let d=me.filter(v=>v.length_beats<=_);d.length||(d=me);const c=l>1?o/Math.max(1,l-1):0,p=[];if(i.gradualBuild&&(c<.4?p.push("build"):c<.8?p.push("drum_fill"):p.push("loop_out")),i.breakInsertion&&c>=.5&&p.push("noise_fx"),i.percussiveLayering&&p.push("drum_fill"),p.length&&(d=b(d,p,.2)),u.length){const v=d.filter(y=>F(y,u));v.length&&(d=v)}if(!d.length)return;const h=C(d,r),g=k(h,s,n);if(!g)return;const f=g.length_beats>=_?e:e+Math.max(0,_-g.length_beats),m=nt(g.pattern,f,a.id);return{motifId:g.id,hits:m}}function ct(a,e){const t=Le[a.texture]??Le.default;return e===0?t+Ge.DOWNBEAT_BOOST:e%4===0?t+Ge.STRONG_BEAT_BOOST:t}function pt(a,e,t,s){switch(a){case"root":return B(s,e);case"fifth":return B(s+7,e);case"lowFifth":return B(s-5,e);case"octave":return B(s+12,e);case"octaveHigh":return B(s+19,e);case"approach":{const n=ue(t,s+5);return B(n-1,t)}case"rest":return null;default:return B(s,e)}}function ht(a){const e=a.pattern.map(s=>({durationBeats:Re(s)})),t=e.reduce((s,n)=>s+n.durationBeats,0);if(Math.abs(t-a.length)>1e-6)throw new Error(`Rhythm motif ${a.id} length mismatch. expected=${a.length}, got=${t}`);return e}function Va(a,e,t){if(a==="steady"){const s=[1,5];return s[Math.floor(t/2)%s.length]}else{const s=[1,3,5,7];return s[e%s.length]}}function Wa(a,e){return 58+(a==="start"&&e===0?6:0)}function ja(a,e,t,s,n,r,i){const o=[],l=ht(t);let u=0,d=0;const c=Oa[r];for(let p=0;p<l.length;p++){const h=l[p];if(u>=_)break;const g=_-u,f=Math.min(h.durationBeats,g),m=Va(a.texture,d,u),v=u%1>1e-6;let y=Wa(n,u);if(c!=null&&c.velocityScale&&(y=Math.round(y*c.velocityScale)),v&&c!=null&&c.offbeatAccentBoost&&(y+=c.offbeatAccentBoost),(c==null?void 0:c.density)!==void 0&&c.density<1){const S=Math.max(0,Math.min(1,c.density));if(i()>S){u+=f,d++;continue}}if(o.push({channelRole:"accompaniment",startBeat:e+u,durationBeats:f,degree:m,velocity:y,sectionId:a.id}),u+=f,d++,u>=_)break}if(n==="start"&&le(a)&&s.pattern.length&&e>=.5&&!((c==null?void 0:c.density)!==void 0&&c.density<.5)){const p=s.pattern[0];o.push({channelRole:"accompaniment",startBeat:Math.max(0,e-.5),durationBeats:.5,degree:p,velocity:I.EARLY_START,sectionId:a.id})}if(c!=null&&c.sustainWholeMeasure&&o.length){const p=o[0].degree,h=Math.max(I.PAD_MIN,Math.round(o.reduce((g,f)=>g+f.velocity,0)/o.length));return[{channelRole:"accompaniment",startBeat:e,durationBeats:_,degree:p,velocity:h,sectionId:a.id}]}return o}function za(a){const e=a.pattern.map(s=>({durationBeats:Re(s.value),rest:!!s.rest,accent:s.accent})),t=e.reduce((s,n)=>s+n.durationBeats,0);if(Math.abs(t-a.length)>1e-6)throw new Error(`Melody rhythm motif ${a.id} length mismatch. expected=${a.length}, got=${t}`);return e}function $a(a,e){const t=a.pattern??[];if(!t.length)return!1;const s=e>=4?.25:0;let n=0,r=!1,i=0;for(const o of t){const l=Re(o.value);if(o.rest){n+=l,i=0;continue}if(l>=.5){r=!0,i=0;continue}if(i+=l,i>1+1e-6)return!1}return n>=s?!0:r}function Ya(a,e){const t=a.filter(s=>$a(s,e));return t.length?t:a}function Se(a,e,t){a.has(e)||a.set(e,new Map);const s=a.get(e);return s.has(t)||s.set(t,{}),s.get(t)}function Ja(a,e,t,s){const n=a.get(e);if(!(!n||n.size===0))return n.get(1)}function Xa(a,e,t,s){a.has(e)||a.set(e,new Map);const n=a.get(e);t===1&&n.set(t,s)}function Qa(a,e){const t=ce(a.seed),s=a.seed??Date.now(),n=wa(a.mood,a.tempo,a.stylePreset,e.styleIntent,s);return{rng:t,compositionBaseRegister:n,sectionById:new Map(e.sections.map(r=>[r.id,r])),styleIntent:e.styleIntent,voiceArrangement:e.voiceArrangement,totalMeasures:a.lengthInMeasures,usedMotifs:{rhythms:new Set,melodies:new Set,drums:new Set,melodyRhythms:new Set,bassPatterns:new Set,transitions:new Set},caches:{template:new Map,hook:new Map,bassPattern:new Map},lastMotifs:{},motifUsage:{rhythm:{},melody:{},drums:{},melodyRhythm:{},bass:{},transitions:{}}}}function Za(a,e,t,s,n){a.startMeasure*_;const r=Math.max(1,Wt(a));let i=0;for(;i<a.measures;){const o=Math.min(r,a.measures-i),l=i===0,u=a.startMeasure+i,d=es(a,e,t,o,l,u,s,n);ts(d,e,t,s,n),i+=o}}function es(a,e,t,s,n,r,i,o){const l=Ja(i.caches.hook,a.templateId,a.occurrenceIndex,i.rng),u=lt(0,a.measures),d=[];r===i.totalMeasures-1?d.push("loop_safe"):r===i.totalMeasures-2&&!(K(a)&&n)&&d.push("cadence");let c,p,h;const g=ie(u,d);ie(u,d);const f=Se(i.caches.template,a.templateId,g);if(K(a)&&n&&l){const m=X.get(l.rhythmId),v=qe.get(l.melodyId);m&&(c=m),v&&(p=v)}if(!c){const m=f.rhythm;c=m?X.get(m):void 0,c||(c=ut(t,i.styleIntent,u,i.lastMotifs.rhythm,d,i.rng,i.usedMotifs.rhythms),f.rhythm=c.id)}if(!p){const m=f.melody;p=m?qe.get(m):void 0,p||(p=ka(t,i.styleIntent,d,i.rng,i.lastMotifs.melodyFragment,i.usedMotifs.melodies),f.melody=p.id)}if(K(a)&&n&&l){const m=Ue.get(l.melodyRhythmId);m&&(h=m)}if(!h){const m=f.melodyRhythm;h=m?Ue.get(m):void 0,h||(h=Fa(t,i.styleIntent,u,s*_,d,i.rng,void 0,i.usedMotifs.melodyRhythms),f.melodyRhythm=h.id)}return le(a)&&n&&Xa(i.caches.hook,a.templateId,a.occurrenceIndex,{rhythmId:c.id,melodyId:p.id,melodyRhythmId:h.id}),i.usedMotifs.rhythms.add(c.id),i.usedMotifs.melodies.add(p.id),i.usedMotifs.melodyRhythms.add(h.id),i.motifUsage.melodyRhythm[h.id]=(i.motifUsage.melodyRhythm[h.id]??0)+1,n&&o.sectionMotifPlan.push({sectionId:a.id,templateId:a.templateId,occurrenceIndex:a.occurrenceIndex,primaryRhythm:c.id,primaryMelody:p.id,primaryMelodyRhythm:h.id,reprisesHook:K(a)&&!!l&&(l==null?void 0:l.rhythmId)===c.id&&(l==null?void 0:l.melodyId)===p.id&&(l==null?void 0:l.melodyRhythmId)===h.id}),{section:a,phraseMeasures:s,isFirstPhrase:n,phraseStartMeasureIndex:r,cachedHook:l,baseRhythm:c,baseMelody:p,baseMelodyRhythm:h}}function ts(a,e,t,s,n){const{section:r,phraseMeasures:i,isFirstPhrase:o,baseMelody:l,baseMelodyRhythm:u}=a;r.startMeasure*_;const d=za(u);let c=0,p=0,h=0;for(let g=0;g<i;g++){const f=as(a,g,t,s);o&&g===0&&La(n.melody,f.measureStartBeat,l,r.id),ss(f,d,l,r,s,n.melody,{phraseBeatCursor:c,phraseStepIndex:p,melodyDegreeCursor:h});const m=(g+1)*_;for(;p<d.length&&c<m;){const v=d[p];v.rest||h++,c+=v.durationBeats,p++}ns(f,e,r,s,n.bass),rs(f,l,r,s,n.accompanimentSeeds),is(f,r,s,n.drums),s.lastMotifs.rhythm=f.rhythmMotif,s.lastMotifs.melodyFragment=l}}function as(a,e,t,s){const{section:n,isFirstPhrase:r,baseRhythm:i}=a,o=a.phraseStartMeasureIndex-n.startMeasure+e,l=n.startMeasure+o,u=n.startMeasure*_+o*_,d=lt(o,n.measures),c=[],p=K(n)&&o===0;l===s.totalMeasures-1?c.push("loop_safe"):l===s.totalMeasures-2&&!p&&c.push("cadence");const h=ie(d,c),g=Se(s.caches.template,n.templateId,h),f=t.sectionRepeatBias??.3,m=e>0||!r||n.occurrenceIndex>1,v=!K(n)&&m&&s.rng()>f;let y=g.rhythm?X.get(g.rhythm):void 0;if(!y)v?y=je(i,d,c,s.rng,s.usedMotifs.rhythms)??i:y=i;else if(v&&y.id===i.id){const S=je(i,d,c,s.rng,s.usedMotifs.rhythms);S&&(y=S)}return(!y.tags.includes(d)||!F(y,c))&&(y=ut(t,s.styleIntent,d,i,c,s.rng,s.usedMotifs.rhythms)),g.rhythm=y.id,s.motifUsage.rhythm[y.id]=(s.motifUsage.rhythm[y.id]??0)+1,s.usedMotifs.rhythms.add(y.id),{measureInSection:o,globalMeasureIndex:l,measureStartBeat:u,functionTag:d,requiredTags:c,isHookMeasure:p,phraseOffset:e,rhythmMotif:y}}function ss(a,e,t,s,n,r,i){const{measureStartBeat:o,measureInSection:l,globalMeasureIndex:u,phraseOffset:d}=a,c=(d+1)*_;for(;i.phraseStepIndex<e.length&&i.phraseBeatCursor<c;){const p=e[i.phraseStepIndex],h=i.phraseBeatCursor-d*_;if(!p.rest){let g=t.pattern[i.melodyDegreeCursor%t.pattern.length];i.phraseStepIndex===e.length-1&&(s.occurrenceIndex>1||l>0)&&!K(s)&&(g=Ga(g,t.pattern,n.styleIntent,n.rng));let f=Ca(s,l,u,n.totalMeasures,n.styleIntent);r.push({channelRole:"melody",startBeat:o+h,durationBeats:p.durationBeats,degree:g,velocity:f,sectionId:s.id}),i.melodyDegreeCursor++}i.phraseBeatCursor+=p.durationBeats,i.phraseStepIndex++}}function ns(a,e,t,s,n){const{measureStartBeat:r,measureInSection:i}=a;let o=s.caches.bassPattern.get(t.id);o||(o=dt(t,i,s.rng,s.usedMotifs.bassPatterns,s.caches.bassPattern,s.styleIntent),s.caches.bassPattern.set(t.id,o));const l=A(e,r),u=A(e,r+_);n.push(...Na(t,r,l,u,o))}function rs(a,e,t,s,n){const{measureStartBeat:r,rhythmMotif:i,functionTag:o}=a;n.push(...ja(t,r,i,e,o,s.voiceArrangement.id,s.rng))}function is(a,e,t,s){var n;const{measureStartBeat:r,measureInSection:i,requiredTags:o}=a,l=i===e.measures-1,u=l||e.measures>2&&i===e.measures-2,d=ie(`${i}:${u?"fill":"beat"}`,o),c=Se(t.caches.template,e.templateId,d);let p=c.drum?Ra.get(c.drum):void 0;if(p||(p=ps(i,e.measures,o,t.rng,t.lastMotifs.drumPatternId,t.usedMotifs.drums,u,t.styleIntent,t.voiceArrangement.id),p&&(c.drum=p.id)),p&&(t.motifUsage.drums[p.id]=(t.motifUsage.drums[p.id]??0)+1,t.usedMotifs.drums.add(p.id),s.push(...nt(p.pattern,r,e.id)),t.lastMotifs.drumPatternId=p.id),l){const h=e.id===((n=t.sectionById.get(Array.from(t.sectionById.keys()).pop()))==null?void 0:n.id),g=Ua(e,r,h,t.rng,t.lastMotifs.transitionId,t.usedMotifs.transitions,t.styleIntent,e.startMeasure+i,t.totalMeasures);g&&(t.motifUsage.transitions[g.motifId]=(t.motifUsage.transitions[g.motifId]??0)+1,t.usedMotifs.transitions.add(g.motifId),s.push(...qa(s,g.hits)),t.lastMotifs.transitionId=g.motifId)}}function os(a,e,t){return a.map(s=>{const n=t.sectionById.get(s.sectionId),r=Math.floor(s.startBeat/_),i=n?r-n.startMeasure:0,o=Da(n,i,r,t.totalMeasures,t.styleIntent,t.compositionBaseRegister),l=de(s.degree,e.scaleDegrees,o),u=A(e,s.startBeat),d=Ia(s.startBeat)?B(l,u):J(l,u);return{...s,midi:d}})}function ls(a,e,t){return a.map(s=>{const n=de(s.degree,e.scaleDegrees,67),r=A(e,s.startBeat),i=Ha(s.startBeat,t),o=J(n,r,i==null?void 0:i.midi);return{...s,midi:o}})}function us(a,e){return a.map(t=>{const s=t.midiOverride??de(t.degree,e.scaleDegrees,52,-1),n=A(e,t.startBeat),r=B(s,n);return{...t,midi:r}})}function ds(a,e){const t=Qa(a,e),s={melody:[],bass:[],accompanimentSeeds:[],drums:[],sectionMotifPlan:[]};for(const o of e.sections)Za(o,e,a,t,s);const n=os(s.melody,e,t),r=us(s.bass,e),i=ls(s.accompanimentSeeds,e,n);return{melody:n,bass:r,accompanimentSeeds:i,drums:s.drums,motifUsage:t.motifUsage,sectionMotifPlan:s.sectionMotifPlan}}function cs(a,e){const{voiceArrangement:t}=e,s=a.seed??Q,n=ds(a,e);if(t.id==="standard"||t.id==="swapped")return{tracks:[{role:"melody",notes:n.melody},{role:"bass",notes:n.bass},{role:"accompaniment",notes:n.accompanimentSeeds}],drums:n.drums,motifUsage:n.motifUsage,sectionMotifPlan:n.sectionMotifPlan};const r=[];for(const i of t.voices){let o;switch(i.role){case"bass":case"bassAlt":o=ms(i.role,i.priority,i.octaveOffset??0,i.seedOffset??0,a,e);break;case"pad":o=fs(i.priority,a,e,s+(i.seedOffset??0));break;case"melody":case"melodyAlt":case"accompaniment":if(i.role==="melody"&&t.id==="minimal")continue;i.role==="melody"?o=n.melody:o=n.accompanimentSeeds;break;default:o=[]}const l=o.map(u=>{let d,c=u.velocity;if((u.channelRole==="bass"||i.role==="bass"||i.role==="bassAlt")&&u.midiOverride!==void 0)d=u.midiOverride;else{Math.floor(u.startBeat/_);const p=i.role==="melody"||i.role==="melodyAlt"?72:67,h=de(u.degree,e.scaleDegrees,p),g=A(e,u.startBeat);d=B(h,g),i.octaveOffset&&(d+=i.octaveOffset*12)}return t.id==="layeredBass"&&(i.role==="bass"?c=Math.max(28,Math.round(c*.65)):i.role==="bassAlt"&&(c=Math.max(22,Math.round(c*.5)))),{...u,midi:d,velocity:c}});l.length>0&&r.push({role:i.role,notes:l})}return{tracks:r,drums:n.drums,motifUsage:n.motifUsage,sectionMotifPlan:n.sectionMotifPlan}}function Re(a){switch(a){case 2:return 2;case 4:return 1;case 8:return .5;case 16:return .25;default:return .25}}function ps(a,e,t,s,n,r,i,o,l){var u,d,c;const p=Aa[l];if(!i&&p!=null&&p.earlySparseMeasures&&a<p.earlySparseMeasures&&s()<.3)return;if(o.gradualBuild&&e>=8){const R=a/Math.max(1,e-1),W=Math.min(.35,6/Math.max(1,e)),w=Math.min(.7,14/Math.max(1,e));if(R<W){if(s()<.75)return}else if(R<w&&s()<.35)return}const h=o.breakInsertion?2:4,g=h>0&&e>=h&&(a+1)%h===0,f=i||g;let m=re.filter(R=>f?R.type==="fill":R.type==="beat");const v=m.filter(R=>R.length_beats<=_);if(v.length&&(m=v),t.length){const R=m.filter(W=>{const w=W.tags;return w?t.every(he=>w.includes(he)):!1});R.length&&(m=R)}m.length||(m=re.filter(R=>f?R.type==="fill":R.type==="beat")),m.length||(m=re);const y=o.percussiveLayering&&o.syncopationBias&&o.breakInsertion&&!o.loopCentric,S=o.atmosPad&&o.loopCentric&&o.harmonicStatic,x=o.loopCentric&&o.textureFocus&&o.percussiveLayering;if(f?(d=p==null?void 0:p.preferFillTags)!=null&&d.length&&(m=b(m,p.preferFillTags,.25)):(o.loopCentric&&(m=b(m,["loop_safe"])),o.syncopationBias&&(m=b(m,y?["breakbeat","syncopation","grid16"]:["syncopation"])),o.textureFocus&&(m=b(m,["texture_loop","straight","grid16"])),o.percussiveLayering&&(m=b(m,y?["breakbeat","percussive_layer","grid16"]:["percussive_layer","four_on_floor"])),S&&(m=b(m,["lofi","rest_heavy","swing_hint"],.3)),x&&(m=b(m,["loop_safe","grid16","texture_loop"],.25)),(u=p==null?void 0:p.preferBeatTags)!=null&&u.length&&(m=b(m,p.preferBeatTags,.25))),y&&(m=b(m,["breakbeat","grid16"],.2)),(c=p==null?void 0:p.avoidTags)!=null&&c.length){const R=m.filter(W=>{const w=W.tags;return w?!p.avoidTags.some(he=>w.includes(he)):!0});R.length&&(m=R)}const H=C(m,r);return k(H,s,n)}function C(a,e){if(!a.length)return a;const t=a.filter(s=>s.id?!e.has(s.id):!0);return t.length?t:a}function ie(a,e){if(!e.length)return a;const t=[...e].sort();return`${a}:${t.join("|")}`}function hs(a,e){const t=(a??Q)+e>>>0;return ce(t)}function gt(a,e,t,s,n){if(a>=1)return!0;if(s.gradualBuild){const r=e/Math.max(1,t-1),i=Math.min(1,a+r*.3);return n()<i}return n()<a}function gs(a,e,t,s,n,r,i=0){var o;const l=(o=n.steps)!=null&&o.length?n.steps:be,u=[],d=s??t;for(let c=0;c<l.length;c++){const p=e+c*.5,h=pt(l[c],t,d,r);h!==null&&u.push({channelRole:"bass",startBeat:p,durationBeats:.5,degree:0,velocity:ct(a,c),sectionId:a.id,midiOverride:h})}return u}function ms(a,e,t,s,n,r){const i=[],o=r.styleIntent,l=n.seed??Q,u=hs(l,s),d=new Set,c=new Map,p=40+t*12;for(const h of r.sections){const g=h.startMeasure*_;for(let f=0;f<h.measures;f++){if(!gt(e,f,h.measures,o,u))continue;const m=g+f*_,v=dt(h,f,u,d,c,o,a==="bassAlt"?{enforceDroneStatic:!1,preferredTags:["drone","accent"]}:void 0),y=A(r,m),S=A(r,m+_),x=gs(h,m,y,S,v,p,t);i.push(...x)}}return i}function fs(a,e,t,s){const n=ce(s),r=[];for(const i of t.sections){const o=i.startMeasure*_;for(let l=0;l<i.measures;l++){if(!gt(a,l,i.measures,t.styleIntent,n))continue;const u=o+l*_,d=l%2===0?1:5;r.push({channelRole:"accompaniment",startBeat:u,durationBeats:_,degree:d,velocity:I.PAD_MIN,sectionId:i.id})}}return r}const vs=42,ys=.5,_s=.015,Ms=.12,ze=1/16,bs={K:{mode:"long",spec:"long_period",periodIndex:3,releaseRange:[.045,.075],velocity:L.KICK,amplitude:1},T:{mode:"long",spec:"long_period",periodIndex:5,releaseRange:[.05,.09],velocity:L.TOM,amplitude:.92},N:{mode:"long",spec:"long_period",periodIndex:8,releaseRange:[.06,.1],velocity:L.LOW_NOISE,amplitude:.88},S:{mode:"short",spec:"short_period",periodIndex:1,releaseRange:[.02,.045],velocity:L.SNARE,amplitude:.9},H:{mode:"short",spec:"short_period",periodIndex:0,releaseRange:[.015,.03],velocity:L.HIHAT,amplitude:.86},O:{mode:"short",spec:"short_period",periodIndex:2,releaseRange:[.03,.055],velocity:L.OPEN_HAT,amplitude:.94}},Ss=5,Rs=.06;function xs(a){let e=a;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function xe(a,e,t,s){let n=1;const r=e==="bass"||e==="bassAlt",i=a==="square1"||a==="square2";r&&(n*=z.BASS_BASE,t<oa.BASS_LOW_RANGE&&(n*=z.BASS_LOW_RANGE)),a==="triangle"&&(n*=z.TRIANGLE_BASE,r||(n*=z.TRIANGLE_NON_BASS)),i&&r&&(n*=z.SQUARE_BASS);const o=Math.round(s*n);return Math.max(De.MIN,Math.min(De.MAX_ACCENT,o))}function Ps(a,e){const t={reverseProbability:.5,sustainProbability:.2,densityThresholds:{sparse:.45,normal:.85}};return a.textureFocus&&(t.reverseProbability=.35,t.sustainProbability=.12,t.densityThresholds={sparse:.3,normal:.7}),a.loopCentric&&(t.sustainProbability=Math.min(.35,t.sustainProbability+.1),t.densityThresholds={sparse:Math.min(.5,t.densityThresholds.sparse+.05),normal:Math.min(.95,t.densityThresholds.normal+.05)}),e==="arpeggio"&&a.gradualBuild&&(t.densityThresholds={sparse:.25,normal:.65}),t}function Es(a,e,t,s,n){const r=Math.abs(e.midi-a.midi),i=e.startBeat-(a.startBeat+t),o=r>0&&r<=Ss,l=i>=-.001&&i<=.5,u=t>=.5;if(!o||!l||!u)return!1;let d=.15;return s.atmosPad?d=.4:s.loopCentric&&s.textureFocus?d=.35:s.gradualBuild&&s.breakInsertion&&(d=.25),n()<d}function Bs(a,e,t){let s=a;return e==="slow"?s+=.02:e==="fast"&&(s-=.015),t>=4&&(s+=.01),Math.max(.02,Math.min(.12,s))}function Ts(a,e){if(!a)return!1;const t=`${a}|${e}`;return t==="H|H"||t==="H|O"||t==="O|H"}function As(a,e,t){const s=(a==null?void 0:a.releaseRange)??[_s,Ms],n=s[0]+t()*Math.max(0,s[1]-s[0]);return e.percussiveLayering?Math.max(s[0],n*.85):e.gradualBuild?Math.min(s[1],n*1.05):n}function Os(a){const e=a.length>0?a:[0,4,7],t=[];for(let s=0;s<4;s++){const n=e[s%e.length],r=Math.floor(s/e.length)*12;t.push(n+r)}return t}function Is(a,e,t){return a()<t?[...e].reverse():e}function Hs(a,e,t,s,n){const r=Ps(s,n),i=Math.max(I.PAD_MIN,Math.round(a.velocity*I.ARPEGGIO_SCALE));if(t()<r.sustainProbability){const p=J(a.midi,e,a.midi);return[{...a,startBeat:a.startBeat,durationBeats:Math.max(a.durationBeats,1),velocity:i,midi:p}]}const o=Is(t,Os(Me(e)),r.reverseProbability),l=t();let u;l<r.densityThresholds.sparse?u=2:l<r.densityThresholds.normal?u=4:u=1;const d=u===4?.25:u===2?.5:Math.max(a.durationBeats,1),c=[];for(let p=0;p<u;p++){const h=a.startBeat+d*p,g=o[p%o.length],f=B(a.midi+g,e),m=J(f,e,a.midi);c.push({channelRole:"accompaniment",startBeat:h,durationBeats:d,degree:a.degree,velocity:i,sectionId:a.sectionId,midi:m})}return c}function Ks(a){const e=[];for(const t of a){const s=[0,.5];for(const n of s)e.push({...t,startBeat:t.startBeat+n,durationBeats:.5,velocity:Math.max(I.PAD_MIN,Math.round(t.velocity*I.BROKEN_SCALE))})}return e}function ks(a){return a.map(e=>({...e,durationBeats:e.durationBeats>=1?e.durationBeats:1,velocity:Math.max(I.PAD_MIN,Math.round(e.velocity*I.STEADY_SCALE))}))}function Fs(a,e,t){return{rng:xs(a.seed??vs),sectionById:new Map(e.sections.map(s=>[s.id,s])),totalBeats:(a.lengthInMeasures??32)*_,styleIntent:e.styleIntent,tempoSetting:a.tempo??"medium",phase1:e,phase2:t}}function Cs(a,e,t){const s=[],n=e.channel;for(let r=0;r<a.notes.length;r++){const i=a.notes[r],o=t.sectionById.get(i.sectionId);o&&Math.max(0,Math.floor(i.startBeat/_)-o.startMeasure);const l={midi:i.midi,velocity:xe(n,e.role,i.midi,i.velocity)},u=a.notes[r+1];if(u&&Es(i,u,i.durationBeats,t.styleIntent,t.rng)){const d=Math.abs(u.midi-i.midi);l.slide={targetMidi:u.midi,durationSeconds:Bs(Rs,t.tempoSetting,d)}}Pe(s,i.startBeat,i.durationBeats,n,l,t.totalBeats)}return s}function ws(a,e,t){const s=[],n=e.channel;for(const r of a.notes)Pe(s,r.startBeat,r.durationBeats,n,{midi:r.midi,velocity:xe(n,e.role,r.midi,r.velocity)},t.totalBeats);return s}function Ds(a,e,t){var s;const n=[],r=e.channel,i=new Map;for(const l of a.notes){const u=Math.floor(l.startBeat/_),d=i.get(u)??[];d.push(l),i.set(u,d)}const o=Array.from(i.keys()).sort((l,u)=>l-u);for(const l of o){const u=i.get(l),d=u.length?t.sectionById.get(u[0].sectionId):void 0,c=(d==null?void 0:d.texture)??"steady",p=A(t.phase1,((s=u[0])==null?void 0:s.startBeat)??l*_);let h;c==="arpeggio"?h=u.flatMap(v=>Hs(v,p,t.rng,t.styleIntent,d==null?void 0:d.texture)):c==="broken"?h=Ks(u):h=ks(u);const g=[],f=[];for(const v of h)t.rng()<t.phase1.techniqueStrategy.echoProbability&&g.push({...v,startBeat:v.startBeat+.25,velocity:Math.round(v.velocity*Ne.ECHO_SCALE)}),t.rng()<t.phase1.techniqueStrategy.detuneProbability&&f.push({...v,startBeat:v.startBeat,velocity:Math.round(v.velocity*Ne.DETUNE_SCALE),midi:v.midi,detuneCents:12});const m=[...h,...g,...f].map(v=>{const y=A(t.phase1,v.startBeat),S=t.phase2.tracks.find(R=>R.role==="melody"),x=S?Us(v.startBeat,S.notes):void 0,H=J(v.midi,y,(x==null?void 0:x.midi)??v.midi);return{...v,midi:H}});for(const v of m)Pe(n,v.startBeat,v.durationBeats,r,{midi:v.midi,velocity:xe(r,e.role,v.midi,v.velocity),detuneCents:v.detuneCents},t.totalBeats)}return n}function Ls(a,e){const t=[];let s=null,n=null,r=null;const i=[...a].sort((o,l)=>o.startBeat-l.startBeat);for(const o of i){let l=o.startBeat;const u=bs[o.instrument];if(!u)continue;const d=Ts(r,o.instrument),c=d?0:ze;n!==null&&l-n<=c&&(l=n+Math.max(c,ze));const p=As(u,e.styleIntent,e.rng),h=Math.max(.01,Math.min(p*.7,p)),g=Math.min(o.durationBeats,ys);if(l>=e.totalBeats)continue;if(s!==null&&l<s)if(d&&t.length>=2){const m=t[t.length-1];m.command==="noteOff"&&(m.beatTime=l),s=l}else t.pop(),t.pop(),s=null,n=null;t.push({beatTime:l,channel:"noise",command:"noteOn",data:{noiseMode:u.spec,mode:u.spec,velocity:u.velocity,amplitude:u.amplitude,releaseSeconds:p,decaySeconds:h,periodIndex:u.periodIndex,clockDivider:u.periodIndex}});const f=Math.min(l+g,e.totalBeats);t.push({beatTime:f,channel:"noise",command:"noteOff",data:{}}),s=f,n=l,r=o.instrument}return t}function Gs(a,e,t){const s=e.role;return s==="melody"||s==="melodyAlt"?Cs(a,e,t):s==="bass"||s==="bassAlt"?ws(a,e,t):s==="accompaniment"||s==="pad"?Ds(a,e,t):[]}function Ns(a,e,t){const s=Fs(a,e,t),n=[];for(const o of t.tracks){const l=e.voiceArrangement.voices.find(d=>d.role===o.role);if(!l)continue;const u=Gs(o,l,s);n.push(...u)}const r=Ls(t.drums,s);n.push(...r),n.sort((o,l)=>o.beatTime-l.beatTime);const i=qs(n);return{events:n,diagnostics:i}}function Pe(a,e,t,s,n,r,i={}){if(e>=r)return;a.push({beatTime:e,channel:s,command:"noteOn",data:n});const o=Math.min(e+t,r);a.push({beatTime:o,channel:s,command:"noteOff",data:i})}function qs(a){const e=new Map,t={voiceAllocation:[]};for(const s of a){e.has(s.channel)||e.set(s.channel,0);const n=e.get(s.channel);s.command==="noteOn"?e.set(s.channel,n+1):s.command==="noteOff"&&n>0&&e.set(s.channel,n-1),t.voiceAllocation.push({beatTime:s.beatTime,channel:s.channel,activeCount:e.get(s.channel)})}return t}function Us(a,e){return e.find(t=>a>=t.startBeat&&a<t.startBeat+t.durationBeats)}const Vs=[{channel:"square1",param:"duty",value:.25},{channel:"square2",param:"duty",value:.5}],Ws=[{id:"DS_MEASURE_BOUNDARY_SWEEP",param:"duty",channels:["square1","square2"],minDurationBeats:1.5,requireMeasureBoundary:!0,steps:[.5,.75,.25]},{id:"DS_MINIMAL_LOW_PASS_THUMP",param:"duty",channels:["square1","square2"],minDurationBeats:2,requireMeasureBoundary:!0,steps:[.18,.38,.24]},{id:"DS_PROGRESSIVE_FILTER_RISE",param:"duty",channels:["square2"],minDurationBeats:4,steps:[.28,.46,.62,.76]},{id:"DS_PROGRESSIVE_PULSE_SQ1",param:"duty",channels:["square1"],minDurationBeats:3,steps:[.22,.4,.56]}],js=[{id:"GP_TRIANGLE_MEASURE_ACCENT",channel:"triangle",param:"gain",measureBoundaryValue:.9,defaultValue:.7},{id:"GP_NOISE_BREAK_SPILL",channel:"noise",param:"gain",measureBoundaryValue:.82,defaultValue:.7},{id:"GP_MINIMAL_BASS_SIDECHAIN",channel:"square2",param:"gain",measureBoundaryValue:.68,defaultValue:.56},{id:"GP_MINIMAL_PERC_FADE",channel:"noise",param:"gain",measureBoundaryValue:.7,defaultValue:.58},{id:"GP_PROGRESSIVE_PAD_SWELL",channel:"triangle",param:"gain",measureBoundaryValue:.88,defaultValue:.74},{id:"GP_PROGRESSIVE_SQUARE_GLIDE",channel:"square1",param:"gain",measureBoundaryValue:.8,defaultValue:.66}],zs={initialParams:Vs,dutySweeps:Ws,gainProfiles:js},fe=zs,$s={square1:{base:.68,peak:.9},square2:{base:.66,peak:.88},triangle:{base:.48,peak:.68},noise:{base:.74,peak:.82}};function Ys(a,e){const t=[],s=a.events.reduce((u,d)=>Math.max(u,d.beatTime),0),n=Math.max(1,Math.ceil(s/_));for(const u of fe.initialParams??[])t.push({beatTime:0,channel:u.channel,command:"setParam",data:{param:u.param,value:u.value}});const r=[...fe.dutySweeps??[]],i=[...fe.gainProfiles??[]];e.filterMotion&&r.push({id:"STYLE_FILTER_SWELL",param:"duty",channels:["square1","square2"],minDurationBeats:2,steps:[.2,.6,.4,.75]}),e.percussiveLayering&&i.push({id:"STYLE_NOISE_PUNCH",channel:"noise",param:"gain",measureBoundaryValue:.85,defaultValue:.78}),e.percussiveLayering&&!e.breakInsertion&&i.push({id:"STYLE_MINIMAL_SIDECHAIN_SQ1",channel:"square1",param:"gain",measureBoundaryValue:.74,defaultValue:.62},{id:"STYLE_MINIMAL_SIDECHAIN_SQ2",channel:"square2",param:"gain",measureBoundaryValue:.72,defaultValue:.6}),e.atmosPad&&i.push({id:"STYLE_TRIANGLE_PAD",channel:"triangle",param:"gain",measureBoundaryValue:.82,defaultValue:.72}),e.gradualBuild&&e.breakInsertion&&r.push({id:"STYLE_PROGRESSIVE_DUTY_SWELL",param:"duty",channels:["square2"],minDurationBeats:1,steps:[.32,.48,.58,.68]}),e.gradualBuild&&e.breakInsertion&&i.push({id:"STYLE_PROGRESSIVE_TRI_RISE",channel:"triangle",param:"gain",measureBoundaryValue:.9,defaultValue:.76});const o=new Set;for(const u of a.events){if(u.command!=="noteOn")continue;const d=Js(a.events,u),c=d?d.beatTime-u.beatTime:0;for(const p of r){if(!p.channels.includes(u.channel)||!d||c<p.minDurationBeats||p.requireMeasureBoundary&&!(ve(u.beatTime)||d&&ve(d.beatTime)))continue;const h=c/(p.steps.length+1);p.steps.forEach((g,f)=>{t.push({beatTime:u.beatTime+h*(f+1),channel:u.channel,command:"setParam",data:{param:p.param,value:g}})})}for(const p of i){if(u.channel!==p.channel)continue;const h=ve(u.beatTime)?p.measureBoundaryValue:p.defaultValue;t.push({beatTime:u.beatTime,channel:u.channel,command:"setParam",data:{param:p.param,value:h}})}if(e.breakInsertion&&u.channel==="noise"){const p=Math.floor(u.beatTime/_);if(!o.has(p)&&p>0&&(p+1)%8===0){o.add(p);const h=p*_;t.push({beatTime:h-.25>=0?h-.25:h,channel:"noise",command:"setParam",data:{param:"gain",value:.45}}),t.push({beatTime:h+1,channel:"noise",command:"setParam",data:{param:"gain",value:.78}});for(const g of["square1","square2"])t.push({beatTime:h-.25>=0?h-.25:h,channel:g,command:"setParam",data:{param:"gain",value:.55}}),t.push({beatTime:h+1,channel:g,command:"setParam",data:{param:"gain",value:.82}})}}}if(e.gradualBuild&&n>1){const u=Math.max(1,Math.floor(n/8));for(const[d,c]of Object.entries($s)){const p=d;for(let h=0;h<n;h+=u){const g=n>1?h/(n-1):1,f=Math.pow(g,e.loopCentric?.8:1),m=c.base+(c.peak-c.base)*f;t.push({beatTime:h*_,channel:p,command:"setParam",data:{param:"gain",value:Number(m.toFixed(3))}})}}}const l=[...a.events,...t];return l.sort((u,d)=>u.beatTime===d.beatTime?u.command===d.command?0:u.command==="setParam"?-1:d.command==="setParam"?1:0:u.beatTime-d.beatTime),{events:l}}function Js(a,e){if(e.command!=="noteOn")return;let t,s=1/0;for(const n of a)if(n.channel===e.channel&&n.command==="noteOff"&&n.beatTime>e.beatTime){const r=n.beatTime-e.beatTime;r<s&&(s=r,t=n)}return t}function ve(a){return Math.abs(a%_)<1e-6}function Xs(a,e,t,s,n){const r=60/a.bpm,i=e.map(l=>({time:l.beatTime*r,channel:l.channel,command:l.command,data:l.data}));i.sort((l,u)=>l.time-u.time);const o={voiceAllocation:t.voiceAllocation.map(l=>({time:l.beatTime*r,channel:l.channel,activeCount:l.activeCount})),loopWindow:Qs(i),motifUsage:s,sectionMotifPlan:n};return{events:i,diagnostics:o}}function Qs(a){if(!a.length)return{head:[],tail:[]};const e=.1,t=a[a.length-1].time,s=a.filter(n=>t-n.time<e);return{head:a.filter(n=>n.time<e),tail:s}}function Zs(a){return{percussiveMelodic:Math.max(-1,Math.min(1,a.percussiveMelodic)),calmEnergetic:Math.max(-1,Math.min(1,a.calmEnergetic))}}function en(a){const{percussiveMelodic:e,calmEnergetic:t}=a,s=Math.max(0,-e),n=Math.max(0,e),r=Math.max(0,-t),i=Math.max(0,t);return{percussiveLayering:s>.3,syncopationBias:s>.4,breakInsertion:s>.35&&i>.4,harmonicStatic:n>.4&&r>.3||s>.3&&r>.2,atmosPad:n>.3||r>.5||i>.55,filterMotion:n>.3||i>.5,loopCentric:r>.3,textureFocus:r>.4||s>.5&&r>.2,gradualBuild:i>.4}}function tn(a){return a.calmEnergetic<-.4?"slow":a.calmEnergetic>.4?"fast":"medium"}function an(a){const{percussiveMelodic:e,calmEnergetic:t}=a;let s="medium";t>.4&&(s="high"),t<-.4&&(s="low");let n="upbeat";return t<=-.5?n="peaceful":e<=-.4?n="tense":e>=.4?n="sad":t>=.4&&(n="upbeat"),{energy:s,mood:n}}const sn={"minimal-techno":{percussiveMelodic:-.4,calmEnergetic:-.3},"progressive-house":{percussiveMelodic:-.45,calmEnergetic:.6},"retro-loopwave":{percussiveMelodic:.3,calmEnergetic:-.2},"breakbeat-jungle":{percussiveMelodic:-.7,calmEnergetic:.7},"lofi-chillhop":{percussiveMelodic:.5,calmEnergetic:-.6}},Ee=["textureFocus","loopCentric","gradualBuild","harmonicStatic","percussiveLayering","breakInsertion","filterMotion","syncopationBias","atmosPad"],nn={textureFocus:!1,loopCentric:!1,gradualBuild:!1,harmonicStatic:!1,percussiveLayering:!1,breakInsertion:!1,filterMotion:!1,syncopationBias:!1,atmosPad:!1},rn={"minimal-techno":"minimalTechno","progressive-house":"progressiveHouse","retro-loopwave":"retroLoopwave","breakbeat-jungle":"breakbeatJungle","lofi-chillhop":"lofiChillhop"},on=.35,ln={percussiveMelodic:0,calmEnergetic:0};function un(a){let e=a>>>0;return e===0&&(e=1),()=>(e=e*1664525+1013904223>>>0,e/4294967295)}function dn(a,e,t){const s={...nn};for(const n of Ee){const r=a[n];typeof r=="boolean"?s[n]=r:t&&e?s[n]=e()>=.5:s[n]=!1}return s}function cn(a,e){const t={...a.intent};if(e.intent)for(const s of Ee){const n=e.intent[s];typeof n=="boolean"&&(t[s]=n)}return{tempo:e.tempo??a.tempo,intent:t,randomizeUnsetIntent:e.randomizeUnsetIntent??a.randomizeUnsetIntent}}function pn(a){let e,t=Number.POSITIVE_INFINITY;for(const[s,n]of Object.entries(sn)){const r=Math.hypot(a.percussiveMelodic-n.percussiveMelodic,a.calmEnergetic-n.calmEnergetic);r<t&&(t=r,e=s)}if(!(!e||t>on))return rn[e]??void 0}function hn(a){var e;const t=typeof a.lengthInMeasures=="number"&&a.lengthInMeasures>0?Math.trunc(a.lengthInMeasures):32,s=typeof a.seed=="number"&&Number.isFinite(a.seed)?Math.trunc(a.seed):Math.floor(Math.random()*4294967295),n=a.twoAxisStyle??ln,r=Zs(n);let i=en(r);if((e=a.overrides)!=null&&e.intent)for(const v of Ee){const y=a.overrides.intent[v];typeof y=="boolean"&&(i[v]=y)}const o=tn(r),l=an(r),u=l.mood;let d={tempo:o,intent:i,randomizeUnsetIntent:!1};a.overrides&&(d=cn(d,a.overrides));const c=d.randomizeUnsetIntent??!1,p=c?un(s):null,h=dn(d.intent,p,c);d={...d,intent:h,randomizeUnsetIntent:c};const g={mood:u,tempo:d.tempo??"medium",lengthInMeasures:t,seed:s,stylePreset:pn(r),styleOverrides:h},f={...d,tags:{mood:l.mood,energy:l.energy},twoAxisStyle:{...r}},m={lengthInMeasures:t,seed:s,twoAxisStyle:{...r}};return a.overrides&&(m.overrides=JSON.parse(JSON.stringify(a.overrides))),{pipeline:g,profile:f,replayOptions:m}}function gn(a){const{pipeline:e,profile:t,replayOptions:s}=fn(a),n=Xt(e),r=cs(e,n),i=Ns(e,n,r),o=Ys(i,n.styleIntent),l=Xs(n,o.events,i.diagnostics,r.motifUsage,r.sectionMotifPlan),u=e.lengthInMeasures*4,d=u/n.bpm*60;return{events:l.events,diagnostics:l.diagnostics,meta:{bpm:n.bpm,key:n.key,seed:e.seed,mood:e.mood,tempo:e.tempo,lengthInMeasures:e.lengthInMeasures,styleIntent:n.styleIntent,voiceArrangement:n.voiceArrangement,profile:t,replayOptions:s,loopInfo:{loopStartBeat:0,loopEndBeat:u,loopStartTime:0,loopEndTime:d,totalBeats:u,totalDuration:d}}}}async function mn(a){return gn(a)}function fn(a){return hn(a)}const vn=[{id:"SE_JUMP_01",type:"jump",description:"",channels:["square1"],durationRange:[.12,.25],channelParams:{square1:{pitchStart:{min:50,max:62},pitchEnd:{min:72,max:84},dutyCycle:[.25,.5],velocityRange:[96,122]}},pitchSweep:{enabled:!0,curveOptions:["linear","exponential"],durationRange:[.14,.26]}},{id:"SE_JUMP_02",type:"jump",description:"",channels:["square2"],durationRange:[.15,.3],channelParams:{square2:{pitchStart:{min:40,max:52},pitchEnd:{min:64,max:76},dutyCycle:[.5],velocityRange:[94,120]}},pitchSweep:{enabled:!0,curveOptions:["linear","exponential"],durationRange:[.16,.32]}},{id:"SE_COIN_01",type:"coin",description:"2",channels:["square1"],durationRange:[.18,.24],channelParams:{square1:{pitchStart:{min:72,max:84},dutyCycle:[.5],velocityRange:[102,124]}},noteSequence:{intervals:[0,4],noteDurations:[.04,.16]}},{id:"SE_COIN_02",type:"coin",description:"3",channels:["square1"],durationRange:[.2,.28],channelParams:{square1:{pitchStart:{min:76,max:84},dutyCycle:[.5]}},noteSequence:{intervals:[0,4,12],noteDurations:[.04,.04,.16]}},{id:"SE_EXPLOSION_01",type:"explosion",description:" + ",channels:["noise","triangle"],durationRange:[.8,1.2],channelParams:{noise:{noiseMode:"long",envelope:"percussive",velocityRange:[92,120],releaseRange:[.5,.8]},triangle:{pitchStart:{min:36,max:43},pitchEnd:{min:24,max:31}}},pitchSweep:{enabled:!0,curveType:"linear"}},{id:"SE_EXPLOSION_02",type:"explosion",description:"",channels:["noise"],durationRange:[.4,.6],channelParams:{noise:{noiseMode:"short",envelope:"percussive",velocityRange:[90,118],releaseRange:[.22,.4]}}},{id:"SE_HIT_01",type:"hit",description:"",channels:["square1"],durationRange:[.08,.12],channelParams:{square1:{pitchStart:{min:60,max:72},dutyCycle:[.125],envelope:"percussive",velocityRange:[100,126]}},noteSequence:{intervals:[0,-2,-5],noteDurations:[.03,.03,.03]}},{id:"SE_HIT_02",type:"hit",description:" + ",channels:["square1","noise"],durationRange:[.1,.15],channelParams:{square1:{pitchStart:{min:48,max:60},dutyCycle:[.125],velocityRange:[96,120]},noise:{noiseMode:"short",envelope:"percussive",velocityRange:[94,120],releaseRange:[.12,.2]}}},{id:"SE_POWERUP_01",type:"powerup",description:"",channels:["square1"],durationRange:[.33,.46],channelParams:{square1:{pitchStart:{min:60,max:67},dutyCycle:[.5]}},noteSequence:{intervals:[0,4,7,12],noteDurations:[.08,.08,.08,.13]}},{id:"SE_POWERUP_02",type:"powerup",description:"5",channels:["square2"],durationRange:[.4,.52],channelParams:{square2:{pitchStart:{min:64,max:72},dutyCycle:[.25]}},noteSequence:{intervals:[0,4,7,12,16],noteDurations:[.07,.07,.07,.07,.16]}},{id:"SE_SELECT_01",type:"select",description:"",channels:["square1"],durationRange:[.05,.08],channelParams:{square1:{pitchStart:{min:72,max:84},dutyCycle:[.25]}}},{id:"SE_SELECT_02",type:"select",description:"2",channels:["square1"],durationRange:[.06,.1],channelParams:{square1:{pitchStart:{min:72,max:84},dutyCycle:[.5]}},noteSequence:{intervals:[0,4],noteDurations:[.03,.04]}},{id:"SE_LASER_01",type:"laser",description:"",channels:["square1"],durationRange:[.1,.15],channelParams:{square1:{pitchStart:{min:72,max:84},pitchEnd:{min:48,max:60},dutyCycle:[.125,.25]}},pitchSweep:{enabled:!0,curveType:"exponential"}},{id:"SE_LASER_02",type:"laser",description:"",channels:["square2"],durationRange:[.12,.2],channelParams:{square2:{pitchStart:{min:76,max:88},pitchEnd:{min:52,max:64},dutyCycle:[.125]}},pitchSweep:{enabled:!0,curveType:"linear"}},{id:"SE_CLICK_01",type:"click",description:"",channels:["square1"],durationRange:[.02,.03],channelParams:{square1:{pitchStart:{min:84,max:96},dutyCycle:[.125],envelope:"percussive"}}},{id:"SE_CLICK_02",type:"click",description:"",channels:["square1"],durationRange:[.03,.04],channelParams:{square1:{pitchStart:{min:88,max:100},dutyCycle:[.125],envelope:"percussive"}}},{id:"SE_SYNTH_01",type:"synth",description:"",channels:["square1"],durationRange:[.15,.3],channelParams:{square1:{pitchStart:{min:48,max:72},dutyCycle:[.125,.25,.5]}}},{id:"SE_SYNTH_02",type:"synth",description:"",channels:["triangle"],durationRange:[.2,.4],channelParams:{triangle:{pitchStart:{min:60,max:84}}}},{id:"SE_TONE_01",type:"tone",description:"",channels:["square1"],durationRange:[.1,.2],channelParams:{square1:{pitchStart:{min:60,max:72},dutyCycle:[.5]}}},{id:"SE_TONE_02",type:"tone",description:"",channels:["triangle"],durationRange:[.12,.3],channelParams:{triangle:{pitchStart:{min:60,max:72}}}}],yn={templates:vn};function _n(){return yn.templates}function Mn(a){let e=a>>>0;return e===0&&(e=1),()=>(e=e*1664525+1013904223>>>0,e/4294967295)}class bn{constructor(){this.templates=_n()}generateSE(e){const t=e.seed??Math.floor(Math.random()*1e9),s=Mn(t),n=this.selectTemplate(e,s),r=this.concretizeParameters(n,s,e.baseFrequency),i=this.generateEvents(n,r,e.startTime??0),o={type:e.type,seed:t,startTime:e.startTime??0};return e.templateId&&(o.templateId=e.templateId),e.baseFrequency!==void 0&&(o.baseFrequency=e.baseFrequency),{events:i,meta:{type:e.type,templateId:n.id,seed:t,duration:r.duration,channels:n.channels,replayOptions:o}}}selectTemplate(e,t){if(e.templateId){const n=this.templates.find(r=>r.id===e.templateId);if(!n)throw new Error(`Template not found: ${e.templateId}`);return n}const s=this.templates.filter(n=>n.type===e.type);if(s.length===0)throw new Error(`No templates found for type: ${e.type}`);return s[Math.floor(t()*s.length)]}concretizeParameters(e,t,s){var n;const[r,i]=e.durationRange,o=r+t()*(i-r),l={};let u=0;s!==void 0&&(u=this.calculatePitchShift(e,s));for(const d of e.channels){const c=e.channelParams[d];if(!c)continue;const p=c.velocityRange?c.velocityRange:d==="noise"?[88,118]:[96,122],h=Math.round(Math.max(1,Math.min(127,this.sampleFloatRange(p,t)))),g=c.pitchStart?this.samplePitchRange(c.pitchStart,t):void 0,f=c.pitchEnd?this.samplePitchRange(c.pitchEnd,t):void 0;if(l[d]={pitchStart:g!==void 0?this.clampMidi(g+u):void 0,pitchEnd:f!==void 0?this.clampMidi(f+u):void 0,dutyCycle:c.dutyCycleRange?this.sampleFloatRange([c.dutyCycleRange.min,c.dutyCycleRange.max],t):c.dutyCycle?c.dutyCycle[Math.floor(t()*c.dutyCycle.length)]:void 0,noiseMode:c.noiseMode,envelope:c.envelope,velocity:h,releaseSeconds:c.releaseRange?this.sampleFloatRange(c.releaseRange,t):void 0},(n=e.pitchSweep)!=null&&n.enabled){const m=e.pitchSweep.curveOptions??(e.pitchSweep.curveType?[e.pitchSweep.curveType]:void 0);m&&(l[d].sweepCurve=this.weightedChoice(m,e.pitchSweep.curveWeights,t)??e.pitchSweep.curveType),e.pitchSweep.durationRange&&(l[d].sweepDuration=this.sampleFloatRange(e.pitchSweep.durationRange,t))}}return{duration:o,channelParams:l}}samplePitchRange(e,t){return Math.floor(e.min+t()*(e.max-e.min+1))}sampleFloatRange(e,t){return e[0]+t()*(e[1]-e[0])}weightedChoice(e,t,s){if(!t)return e[Math.floor(s()*e.length)];const n=e.reduce((i,o)=>i+(t[String(o)]||1),0);let r=s()*n;for(const i of e){const o=t[String(i)]||1;if(r<o)return i;r-=o}return e[e.length-1]}generateEvents(e,t,s){const n=[];for(const r of e.channels){const i=t.channelParams[r],o=this.generateChannelEvents(r,e,i,t,s);n.push(...o)}return n.sort((r,i)=>r.time-i.time),n}generateChannelEvents(e,t,s,n,r){return e.startsWith("square")?this.generateSquareEvents(e,t,s,n,r):e==="triangle"?this.generateTriangleEvents(e,t,s,n,r):e==="noise"?this.generateNoiseEvents(t,s,n,r):[]}generateSquareEvents(e,t,s,n,r){var i;const o=[];return s.dutyCycle!==void 0&&o.push({time:r,channel:e,command:"setParam",data:{param:"duty",value:s.dutyCycle}}),t.noteSequence?o.push(...this.generateNoteSequence(e,t,s,r)):(i=t.pitchSweep)!=null&&i.enabled?o.push(...this.generatePitchSweep(e,t,s,n,r)):s.pitchStart!==void 0&&o.push(...this.generateSimpleNote(e,s,n.duration,r)),o}generateTriangleEvents(e,t,s,n,r){var i;const o=[];return t.noteSequence?o.push(...this.generateNoteSequence(e,t,s,r)):(i=t.pitchSweep)!=null&&i.enabled?o.push(...this.generatePitchSweep(e,t,s,n,r)):s.pitchStart!==void 0&&o.push(...this.generateSimpleNote(e,s,n.duration,r)),o}generateNoiseEvents(e,t,s,n){const r=[],i="noise";t.noiseMode&&r.push({time:n,channel:i,command:"setParam",data:{param:"noiseMode",value:t.noiseMode}});const o=t.velocity??110,l=t.releaseSeconds??s.duration*.3,u={velocity:o};return t.noiseMode&&(u.noiseMode=t.noiseMode),t.envelope==="percussive"?(u.decaySeconds=s.duration*.7,u.releaseSeconds=l):t.releaseSeconds&&(u.releaseSeconds=l),r.push({time:n,channel:i,command:"noteOn",data:u}),r.push({time:n+s.duration,channel:i,command:"noteOff",data:{}}),r}generateNoteSequence(e,t,s,n){const r=[];if(!t.noteSequence)return r;let i=n;const o=s.pitchStart,l=s.velocity??110;for(let u=0;u<t.noteSequence.intervals.length;u++){const d=o+t.noteSequence.intervals[u],c=t.noteSequence.noteDurations[u];r.push({time:i,channel:e,command:"noteOn",data:{midi:d,velocity:l}}),r.push({time:i+c,channel:e,command:"noteOff",data:{}}),i+=c}return r}generatePitchSweep(e,t,s,n,r){var i;const o=[];if(!((i=t.pitchSweep)!=null&&i.enabled))return o;const l=s.sweepDuration??n.duration,u=s.sweepCurve??t.pitchSweep.curveType??"exponential",d=s.velocity??110;return o.push({time:r,channel:e,command:"noteOn",data:{midi:s.pitchStart,velocity:d}}),o.push({time:r,channel:e,command:"setParam",data:{param:"pitchBend",value:s.pitchEnd,rampDuration:l,curve:u}}),o.push({time:r+l,channel:e,command:"noteOff",data:{}}),o}generateSimpleNote(e,t,s,n){const r=[],i=t.velocity??110,o=t.releaseSeconds;return r.push({time:n,channel:e,command:"noteOn",data:{midi:t.pitchStart,velocity:i}}),r.push({time:n+s,channel:e,command:"noteOff",data:o?{releaseSeconds:o}:{}}),r}calculatePitchShift(e,t){for(const s of e.channels){const n=e.channelParams[s];if(!(n!=null&&n.pitchStart))continue;const r=(n.pitchStart.min+n.pitchStart.max)/2,i=na(r),o=t/i,l=sa(o);return Math.round(l)}return 0}clampMidi(e){return Math.max(0,Math.min(127,Math.round(e)))}}const $e=.1,Sn=25,Ye=.3,Rn=1789773,ye=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068],Je={K:{mode:"long",periodIndex:14,baseAmplitude:.75,decaySeconds:.22,releaseSeconds:.04,cutoffHz:3200},S:{mode:"short",periodIndex:4,baseAmplitude:.65,decaySeconds:.14,releaseSeconds:.03,cutoffHz:5200},H:{mode:"short",periodIndex:1,baseAmplitude:.45,decaySeconds:.06,releaseSeconds:.02,cutoffHz:7800},O:{mode:"short",periodIndex:2,baseAmplitude:.6,decaySeconds:.4,releaseSeconds:.06,cutoffHz:6800},T:{mode:"long",periodIndex:10,baseAmplitude:.6,decaySeconds:.26,releaseSeconds:.05,cutoffHz:3600},default:{mode:"short",periodIndex:3,baseAmplitude:.6,decaySeconds:.14,releaseSeconds:.03,cutoffHz:6e3}},xn=69,Pn=440;function oe(a){return Pn*Math.pow(2,(a-xn)/12)}function En(a,e=.85){return Math.max(0,Math.min(1,(a??100)/127*e))}class Be{constructor(e,t,s){this.context=e;const n=new AudioWorkletNode(e,t);n.connect(s),this.port=n.port,this.sampleRate=e.sampleRate}scheduleMessage(e,t){const s=Math.max(0,Math.round(t*this.sampleRate));this.port.postMessage({...e,sampleFrame:s})}stop(){this.port.postMessage({type:"clear"})}}class Xe extends Be{constructor(e,t){super(e,"square-processor",t),this.currentDuty=.5}noteOn(e,t){const s=e.detuneCents??0,n=Math.pow(2,s/1200),r={type:"noteOn",frequency:e.frequency*n,amplitude:e.amplitude??.8,duty:e.duty??this.currentDuty};e.slide&&(r.slide={targetFrequency:e.slide.targetFrequency,durationSamples:Math.round((e.slide.durationSeconds??0)*this.sampleRate)}),this.scheduleMessage(r,t)}noteOff(e,t){this.scheduleMessage({type:"noteOff"},t)}setParam(e,t){if(e.param==="duty"&&(this.currentDuty=Number(e.value??this.currentDuty)),e.param==="pitchBend"&&typeof e.value=="number"){const s=e.value>0?oe(e.value):0,n=Number(e.rampDuration??0),r=e.curve??"linear";this.scheduleMessage({type:"setParam",param:"pitchBend",value:s,rampDuration:n,curve:r},t);return}this.scheduleMessage({type:"setParam",param:e.param,value:e.value},t)}}class Bn extends Be{constructor(e,t){super(e,"triangle-processor",t)}noteOn(e,t){const s={type:"noteOn",frequency:e.frequency,amplitude:e.amplitude??.7};this.scheduleMessage(s,t)}noteOff(e,t){this.scheduleMessage({type:"noteOff"},t)}setParam(e,t){if(e.param==="pitchBend"&&typeof e.value=="number"){const s=e.value>0?oe(e.value):0,n=Number(e.rampDuration??0),r=e.curve??"linear";this.scheduleMessage({type:"setParam",param:"pitchBend",value:s,rampDuration:n,curve:r},t);return}this.scheduleMessage({type:"setParam",param:e.param,value:e.value},t)}}class Tn extends Be{constructor(e,t){super(e,"noise-processor",t),this.periodIndex=0,this.mode="short"}noteOn(e,t){const s=Math.max(0,Math.min(ye.length-1,e.periodIndex??this.periodIndex)),n=ye[s]*16/Rn,r=Math.max(1,Math.round(n*this.sampleRate)),i=Math.max(.001,e.decaySeconds??.12),o=Math.max(.001,e.releaseSeconds??.03),l=Math.max(1,Math.round(i*this.sampleRate)),u=Math.max(1,Math.round(o*this.sampleRate)),d=Math.max(0,Math.min(1,e.amplitude??.6)),c=e.mode==="long"?"long":"short",p=Math.max(100,Math.min(this.sampleRate/2,e.cutoffHz??6e3));this.periodIndex=s,this.mode=c,this.scheduleMessage({type:"noteOn",mode:c,amplitude:d,periodSamples:r,decaySamples:l,releaseSamples:u,cutoffHz:p},t)}noteOff(e,t){const s=Math.max(.001,Number((e==null?void 0:e.releaseSeconds)??.03)),n=Math.max(1,Math.round(s*this.sampleRate));this.scheduleMessage({type:"noteOff",releaseSamples:n},t)}setParam(e,t){if(!(!e||!e.param)){if(e.param==="mode"&&typeof e.value=="string"&&(this.mode=e.value==="long"?"long":"short"),e.param==="periodIndex"){const s=Number(e.value??this.periodIndex);this.periodIndex=Math.max(0,Math.min(ye.length-1,s))}this.scheduleMessage({type:"setParam",param:e.param,value:e.value},t)}}}const mt=class _e{constructor(e,t={}){this.context=e,this.events=[],this.eventIndex=0,this.lookahead=$e,this.leadTime=Ye,this.intervalHandle=null,this.startTime=0,this.lastEventTime=0,this.completionResolver=null,this.loopEnabled=!1,this.eventCallback=null,this.masterGainNode=e.createGain(),this.masterGainNode.gain.value=_e.BASE_GAIN,this.masterGainNode.connect(e.destination),this.workletBasePath=t.workletBasePath??"./worklets/"}async init(){const e=this.context,t=this.workletBasePath;await e.audioWorklet.addModule(`${t}square-processor.js`),await e.audioWorklet.addModule(`${t}triangle-processor.js`),await e.audioWorklet.addModule(`${t}noise-processor.js`),this.channels={square1:new Xe(e,this.masterGainNode),square2:new Xe(e,this.masterGainNode),triangle:new Bn(e,this.masterGainNode),noise:new Tn(e,this.masterGainNode)}}get masterGain(){return this.masterGainNode}stop(){this.intervalHandle!==null&&(clearInterval(this.intervalHandle),this.intervalHandle=null),Object.values(this.channels).forEach(e=>e.stop()),this.completionResolver&&(this.completionResolver(),this.completionResolver=null)}play(e,t={}){this.stop(),this.events=e??[],this.lookahead=t.lookahead??$e,this.leadTime=t.leadTime??Ye,this.loopEnabled=t.loop??!1,this.eventCallback=t.onEvent??null;const s=t.volume??1;this.masterGainNode.gain.value=_e.BASE_GAIN*s;const n=this.events.length?this.events[this.events.length-1].time:0;let r=Math.max(0,t.offset??0);r>0&&(this.loopEnabled&&n>0?r=r%n:r=Math.min(r,n));const i=this.context.currentTime,o=t.startTime??i+this.leadTime;this.startTime=o-r,this.lastEventTime=n,this.eventIndex=this.resolveEventIndex(r);const l=new Promise(d=>{this.completionResolver=d}),u=()=>this.tick();return this.intervalHandle=window.setInterval(u,Sn),u(),l}resolveEventIndex(e){if(e<=0)return 0;const t=.001;for(let s=0;s<this.events.length;s+=1)if(this.events[s].time+t>=e)return s;return this.events.length}tick(){const e=this.context.currentTime,t=e+this.lookahead;for(;this.eventIndex<this.events.length;){const s=this.events[this.eventIndex],n=this.startTime+s.time;if(n<=t)this.dispatchEvent(s,n),this.eventIndex+=1;else break}if(this.loopEnabled&&this.eventIndex>=this.events.length&&(this.startTime+=this.lastEventTime,this.eventIndex=0),!this.loopEnabled){const s=this.startTime+this.lastEventTime+1;this.eventIndex>=this.events.length&&e>=s&&this.stop()}}dispatchEvent(e,t){const s=e.data??{};switch(this.eventCallback&&this.eventCallback(e,t),e.channel){case"square1":case"square2":e.command==="noteOn"?this.channels[e.channel].noteOn(this.mapPitchData(s),t):e.command==="noteOff"?this.channels[e.channel].noteOff(s,t):e.command==="setParam"&&this.channels[e.channel].setParam(s,t);break;case"triangle":e.command==="noteOn"?this.channels.triangle.noteOn(this.mapPitchData(s),t):e.command==="noteOff"?this.channels.triangle.noteOff(s,t):e.command==="setParam"&&this.channels.triangle.setParam(s,t);break;case"noise":e.command==="noteOn"?this.channels.noise.noteOn(this.mapNoiseData(s),t):e.command==="noteOff"?this.channels.noise.noteOff(s,t):e.command==="setParam"&&this.channels.noise.setParam(s,t);break}}mapPitchData(e){const t=Number(e.midi??60),s=Number(e.detuneCents??0);let n=null;const r=e.slide;return r&&(typeof r.targetMidi=="number"?n={targetFrequency:oe(r.targetMidi),durationSeconds:Number(r.durationSeconds??0)}:typeof r.targetFrequency=="number"&&(n={targetFrequency:r.targetFrequency,durationSeconds:Number(r.durationSeconds??0)})),{frequency:oe(t),amplitude:En(typeof e.velocity=="number"?e.velocity:void 0),duty:typeof e.duty=="number"?e.duty:void 0,detuneCents:s,slide:n}}mapNoiseData(e){const t=typeof e.velocity=="number"?e.velocity:100,s=Math.max(0,Math.min(1,t/127)),n=typeof e.instrument=="string"?e.instrument:"S",r=Je[n]??Je.default,i=Math.min(1,Math.max(0,(typeof e.amplitude=="number"?e.amplitude:r.baseAmplitude)*s)),o=typeof e.decaySeconds=="number"?e.decaySeconds:r.decaySeconds,l=typeof e.releaseSeconds=="number"?e.releaseSeconds:r.releaseSeconds,u=typeof e.periodIndex=="number"?e.periodIndex:typeof e.clockDivider=="number"?e.clockDivider:typeof e.period=="number"?e.period:r.periodIndex,d=typeof e.mode=="string"?e.mode:typeof e.noiseMode=="string"?e.noiseMode:r.mode,c=typeof e.cutoffHz=="number"?e.cutoffHz:r.cutoffHz;return{amplitude:i,decaySeconds:o,releaseSeconds:l,periodIndex:u,mode:d,cutoffHz:c}}};mt.BASE_GAIN=.16;let Qe=mt;const Ze=-6,An=1,On=.03,ee=.001;class In{constructor(e,t,s,n){this.context=e,this.seSynth=t,this.getTimeline=s,this.bgmGain=n,this.scheduledByType={},this.nextTriggerTime=null,this.flushHandle=null,this.nominalGain=n.gain.value}async play(e,t={}){const s={duckingDb:t.duckingDb??Ze,volume:t.volume??An,quantize:t.quantize},n=e.meta.type;return this.scheduledByType[n]?Promise.resolve():new Promise((r,i)=>{const o=this.determineTargetTime(s),l={result:e,options:s,targetTime:o,resolve:r,reject:i};this.scheduledByType[n]=l,this.registerJob(l)})}resetDucking(){const e=this.context.currentTime,t=this.bgmGain.gain;t.cancelScheduledValues(e),t.setValueAtTime(this.nominalGain,e)}cancelPendingJobs(){this.flushHandle!==null&&(clearTimeout(this.flushHandle),this.flushHandle=null);const e=Object.values(this.scheduledByType).filter(t=>t!=null);for(const t of e)t.resolve();this.scheduledByType={},this.nextTriggerTime=null}registerJob(e){if(this.nextTriggerTime===null||e.targetTime<this.nextTriggerTime-ee){this.nextTriggerTime=e.targetTime,this.alignJobsTo(this.nextTriggerTime),this.scheduleFlush();return}if(Math.abs(e.targetTime-this.nextTriggerTime)<=ee){e.targetTime=this.nextTriggerTime;return}e.targetTime=this.nextTriggerTime}alignJobsTo(e){for(const t of Object.values(this.scheduledByType))t&&(t.targetTime=e)}determineTargetTime(e){const t=this.context,s=t.currentTime;let n=s;if(e.quantize){const r=this.quantizeStart(e.quantize,s);r!==null&&(n=r)}return n<t.currentTime+ee&&(n=t.currentTime+ee),n}scheduleFlush(){if(this.nextTriggerTime===null)return;this.flushHandle!==null&&clearTimeout(this.flushHandle);const e=this.context.currentTime,t=this.nextTriggerTime-On,s=Math.max(0,(t-e)*1e3);this.flushHandle=window.setTimeout(()=>{this.flushHandle=null,this.flushScheduled()},s)}flushScheduled(){const e=this.nextTriggerTime;if(e===null)return;const t=Object.values(this.scheduledByType).filter(o=>o!=null);if(t.length===0){this.nextTriggerTime=null;return}const s=this.context,n=Math.max(e,s.currentTime+.005),r=t.reduce((o,l)=>Math.max(o,l.result.meta.duration),0),i=t.reduce((o,l)=>Math.min(o,l.options.duckingDb),Ze);this.applyDucking(i,r,n),this.nextTriggerTime=null,this.scheduledByType={};for(const o of t)try{this.seSynth.play(o.result.events,{startTime:n,loop:!1,volume:o.options.volume}).then(o.resolve,o.reject)}catch(l){o.reject(l)}}quantizeStart(e,t){const s=this.getTimeline();if(!s)return null;const{meta:n,startTime:r}=s,i=60/n.bpm,o=4,l=n.loopInfo.totalBeats,u=this.resolveStepBeats(e.quantizeTo,o);if(u<=0)return null;const d=Math.max(0,(t-r)/i);let c=this.resolvePhaseBeat(e.phase??"next",d,u,o);if(c+=e.offsetBeats??0,e.loopAware&&l>0){for(;c*i+r<t-.001;)c+=u;const p=l;if(c>=p){c=c%p;const h=Math.ceil((d-c)/p);c+=h*p}}else{const p=u*i;let h=r+c*i;for(;h<t-.001;)h+=p,c+=u;return h}return r+c*i}resolveStepBeats(e,t){return e==="beat"?1:e==="half_beat"?.5:e==="measure"?t:typeof e=="object"&&e.subdivision>0?1/e.subdivision:0}resolvePhaseBeat(e,t,s,n){if(e==="current"){const o=Math.floor(t/s)*s;return o+1e-6<t?o+s:o}if(e==="next"||e==null)return Math.ceil((t-1e-6)/s)*s;const r=Math.max(0,e.measure),i=Math.max(0,e.beat??0);return r*n+i}applyDucking(e,t,s){if(!Number.isFinite(e)||e>=0)return;const n=this.bgmGain,r=this.context.currentTime,i=Math.pow(10,e/20),o=Math.max(0,this.nominalGain*i),l=Math.max(r,s-.005),u=l+.02,c=Math.max(u,s+t)+Math.max(.05,t*.5),p=n.gain;p.cancelScheduledValues(r),p.setValueAtTime(this.nominalGain,r),p.setValueAtTime(this.nominalGain,l),p.linearRampToValueAtTime(o,u),p.linearRampToValueAtTime(this.nominalGain,c)}}const Hn={duckingDb:-6,volume:1},Kn="./worklets/",kn=44100,Fn=.2,Cn=.1;class wn{constructor(e={}){this.options=e,this.bgmSynth=null,this.seSynth=null,this.bgmGainBase=1,this.seGainBase=1,this.seGenerator=new bn,this.soundEffectController=null,this.activeTimeline=null,this.lastBgm=null,this.pausedOffsetSeconds=null,this.lastPlayOptions=null,e.audioContext?(this.context=e.audioContext,this.ownsContext=!1):(this.context=null,this.ownsContext=!0),this.workletBasePath=e.workletBasePath??Kn,this.seDefaults={...Hn,...e.seDefaults??{}},this.bgmVolume=Math.max(0,e.bgmVolume??1)}async generateBgm(e){const t=await mn(e);return this.lastBgm=t,t}async playBgm(e,t={}){const s=await this.ensureContext(!0);await this.ensureBgmSynth(s),await this.ensureSeSynth(s),await this.ensureSoundEffectController(s);const n=t.loop??!0,r=Math.max(0,t.offset??0),i=t.leadTime??Fn,o=t.lookahead??Cn,l=t.startTime??s.currentTime+i,u=l-r,d=t.volume??this.bgmVolume;this.activeTimeline={startTime:u,loop:n,meta:e.meta},this.lastBgm=e;const c={...t,startTime:l,loop:n,offset:r,leadTime:i,lookahead:o,volume:d,onEvent:t.onEvent??void 0},p={...t,loop:n,offset:r,leadTime:i,lookahead:o,volume:d,onEvent:c.onEvent};delete p.startTime,this.lastPlayOptions=p,this.pausedOffsetSeconds=null,this.bgmSynth.play(e.events,c).catch(h=>{console.error("BGM playback error:",h)})}stopBgm(){var e,t;(e=this.bgmSynth)==null||e.stop(),(t=this.soundEffectController)==null||t.resetDucking(),this.activeTimeline=null,this.pausedOffsetSeconds=null}stopAllAudio(){var e;this.pauseBgm({captureOffset:!1}),(e=this.seSynth)==null||e.stop(),this.cancelScheduledSe(),this.pausedOffsetSeconds=null}pauseBgm(e={}){var s,n,r,i;const{captureOffset:t=!0}=e;if(t){const o=this.activeTimeline,l=this.context;if(o&&l){const u=Math.max(0,l.currentTime-o.startTime),d=((n=(s=o.meta)==null?void 0:s.loopInfo)==null?void 0:n.totalDuration)??0,c=d>0?u%d:u;this.pausedOffsetSeconds=c}else this.pausedOffsetSeconds=null}return(r=this.bgmSynth)==null||r.stop(),(i=this.soundEffectController)==null||i.resetDucking(),this.activeTimeline=null,this.pausedOffsetSeconds}async resumeBgm(e={}){const t=this.lastBgm;if(!t)throw new Error("No background music available to resume.");const{offsetSeconds:s,...n}=e,r=typeof s=="number"?Math.max(0,s):this.pausedOffsetSeconds??0;this.pausedOffsetSeconds=null;const i={...this.lastPlayOptions??{},...n};delete i.startTime,i.offset=r,await this.playBgm(t,i)}setBgmVolume(e){const t=Math.max(0,e);this.bgmVolume=t,this.bgmSynth&&this.context&&this.bgmSynth.masterGain.gain.setValueAtTime(this.bgmGainBase*t,this.context.currentTime)}configureSeDefaults(e){const t={...this.seDefaults,...e};e.volume!==void 0&&(t.volume=Math.max(0,e.volume),this.seSynth&&this.context&&this.seSynth.masterGain.gain.setValueAtTime(this.seGainBase*t.volume,this.context.currentTime)),this.seDefaults=t}generateSe(e){return this.seGenerator.generateSE(e)}async playSe(e,t={}){const s=await this.ensureContext(!0);await this.ensureBgmSynth(s),await this.ensureSeSynth(s),await this.ensureSoundEffectController(s);const n={duckingDb:t.duckingDb??this.seDefaults.duckingDb,volume:Math.max(0,t.volume??this.seDefaults.volume),quantize:t.quantize??this.seDefaults.quantize};await this.soundEffectController.play(e,n)}async triggerSe(e){const t=this.generateSe({type:e.type,seed:e.seed,templateId:e.templateId,baseFrequency:e.baseFrequency});await this.playSe(t,{duckingDb:e.duckingDb,volume:e.volume,quantize:e.quantize})}cancelScheduledSe(){var e;(e=this.soundEffectController)==null||e.cancelPendingJobs()}getActiveTimeline(){return this.activeTimeline}getAudioContext(){return this.context}async resumeAudioContext(){await this.ensureContext(!0)}async suspendAudioContext(){this.context&&this.context.state==="running"&&await this.context.suspend()}async close(){this.stopAllAudio(),this.context&&this.ownsContext&&await this.context.close().catch(e=>{console.warn("AudioContext close failed:",e)}),this.context=null,this.bgmSynth=null,this.seSynth=null,this.soundEffectController=null,this.activeTimeline=null,this.lastBgm=null,this.lastPlayOptions=null,this.pausedOffsetSeconds=null}async ensureContext(e){return this.context||(this.context=new AudioContext({sampleRate:kn,latencyHint:"interactive"})),e&&this.context.state==="suspended"&&await this.context.resume(),this.context}async ensureBgmSynth(e){this.bgmSynth||(this.bgmSynth=new Qe(e,{workletBasePath:this.workletBasePath}),await this.bgmSynth.init(),this.bgmGainBase=this.bgmSynth.masterGain.gain.value,this.bgmSynth.masterGain.gain.setValueAtTime(this.bgmGainBase*this.bgmVolume,e.currentTime))}async ensureSeSynth(e){this.seSynth||(this.seSynth=new Qe(e,{workletBasePath:this.workletBasePath}),await this.seSynth.init(),this.seGainBase=this.seSynth.masterGain.gain.value,this.seSynth.masterGain.gain.setValueAtTime(this.seGainBase*this.seDefaults.volume,e.currentTime))}async ensureSoundEffectController(e){if(!this.soundEffectController){if(!this.bgmSynth||!this.seSynth)throw new Error("Sound effect controller requires both BGM and SE synthesizers.");this.soundEffectController=new In(e,this.seSynth,()=>this.activeTimeline,this.bgmSynth.masterGain)}}}function Dn(a={}){return new wn(a)}function Ln(a,e={}){const t=e.documentRef??document,s=e.cancelScheduledSe??!0,n=e.suspendAudioContext??!0,r=e.resumeAudioContext??!0;let i=!1,o=null;const l=()=>{var d,c;if(t.hidden){if(!(e.shouldPause?e.shouldPause():!0)){n&&a.suspendAudioContext().catch(h=>{console.warn("AudioContext suspend failed:",h)});return}o=a.pauseBgm(),i=!0,s&&a.cancelScheduledSe(),(d=e.onPause)==null||d.call(e,{offsetSeconds:o}),n&&a.suspendAudioContext().catch(h=>{console.warn("AudioContext suspend failed:",h)});return}const u=o;if(o=null,!i){r&&a.resumeAudioContext().catch(p=>{console.warn("AudioContext resume failed:",p)}),(c=e.onResume)==null||c.call(e,{offsetSeconds:u,resumed:!1});return}i=!1,(async()=>{var p,h;try{r&&await a.resumeAudioContext(),await a.resumeBgm({offsetSeconds:u??void 0}),(p=e.onResume)==null||p.call(e,{offsetSeconds:u,resumed:!0})}catch(g){console.error("Visibility resume failed:",g),(h=e.onResume)==null||h.call(e,{offsetSeconds:u,resumed:!1})}})()};return t.addEventListener("visibilitychange",l),()=>{t.removeEventListener("visibilitychange",l)}}const U=document.getElementById("two-axis-panel"),N=document.getElementById("two-axis-canvas"),E=document.getElementById("play-pause-button"),te=document.getElementById("button-text"),Gn=document.getElementById("status-message"),Nn=document.getElementById("sr-status"),ae=document.getElementById("copy-seed-container"),q=document.getElementById("copy-seed-button"),pe={square1:document.querySelector('[data-channel="square1"] .indicator-light'),square2:document.querySelector('[data-channel="square2"] .indicator-light'),triangle:document.querySelector('[data-channel="triangle"] .indicator-light'),noise:document.querySelector('[data-channel="noise"] .indicator-light')},ft={square1:"jump",square2:"select",triangle:"laser",noise:"explosion"},M={currentPosition:null,composition:null,isPlaying:!1,isGenerating:!1,channelActivity:{square1:0,square2:0,triangle:0,noise:0}};let P=null,Y=null;const V=new Map;let se=null,$=!1;function vt(){const a=U.getBoundingClientRect(),e=window.devicePixelRatio||1;N.width=a.width*e,N.height=a.height*e,N.style.width=`${a.width}px`,N.style.height=`${a.height}px`;const t=N.getContext("2d");t&&(t.scale(e,e),yt(t,a.width,a.height))}function yt(a,e,t){a.clearRect(0,0,e,t),a.strokeStyle="rgba(255, 255, 255, 0.08)",a.lineWidth=1;for(let r=1;r<4;r++){const i=e/4*r;a.beginPath(),a.moveTo(i,0),a.lineTo(i,t),a.stroke()}for(let r=1;r<4;r++){const i=t/4*r;a.beginPath(),a.moveTo(0,i),a.lineTo(e,i),a.stroke()}a.strokeStyle="rgba(255, 255, 255, 0.15)",a.lineWidth=2;const s=e/2,n=t/2;if(a.beginPath(),a.moveTo(s,0),a.lineTo(s,t),a.stroke(),a.beginPath(),a.moveTo(0,n),a.lineTo(e,n),a.stroke(),M.currentPosition){const r=(M.currentPosition.percussiveMelodic+1)/2*e,i=(1-M.currentPosition.calmEnergetic)/2*t,o=a.createRadialGradient(r,i,0,r,i,30);o.addColorStop(0,"rgba(90, 155, 255, 0.6)"),o.addColorStop(1,"rgba(90, 155, 255, 0)"),a.fillStyle=o,a.fillRect(r-30,i-30,60,60),a.fillStyle="#5a9bff",a.beginPath(),a.arc(r,i,8,0,Math.PI*2),a.fill(),a.strokeStyle="#ffffff",a.lineWidth=2,a.beginPath(),a.arc(r,i,12,0,Math.PI*2),a.stroke()}}async function Te(a){if(M.isGenerating)return;const e=U.getBoundingClientRect();let t,s;if(a instanceof MouseEvent)t=a.clientX,s=a.clientY;else{const u=a.touches[0]||a.changedTouches[0];if(!u)return;t=u.clientX,s=u.clientY}const n=(t-e.left)/e.width*2-1,r=1-(s-e.top)/e.height*2,i=Math.max(-1,Math.min(1,n)),o=Math.max(-1,Math.min(1,r));M.currentPosition={percussiveMelodic:i,calmEnergetic:o};const l=N.getContext("2d");l&&yt(l,e.width,e.height),await qn({percussiveMelodic:i,calmEnergetic:o})}async function Ae(){return P||(se==null||se(),P=Dn(),se=Ln(P,{shouldPause:()=>M.isPlaying,onPause:()=>{M.isPlaying?(Oe({skipSessionStop:!0,skipCancelSe:!0}),$=!0,T("Playback paused (tab inactive)")):$=!1},onResume:({resumed:a})=>{!$||!M.composition||($=!1,a?(M.isPlaying=!0,D(),Mt(),T("Playback resumed")):T("Playback resume failed"))}})),await P.resumeAudioContext(),P}async function qn(a){Oe(),M.isGenerating=!0,D(),T(`Generating music at (${a.percussiveMelodic.toFixed(1)}, ${a.calmEnergetic.toFixed(1)})...`);try{const e={twoAxisStyle:a,lengthInMeasures:32},s=await(await Ae()).generateBgm(e);M.composition=s,T(`Generated: ${s.meta.mood} at ${s.meta.bpm} BPM in ${s.meta.key}`),await _t()}catch(e){const t=e instanceof Error?e.message:String(e);T(`Error: ${t}`),console.error("Generation failed:",e)}finally{M.isGenerating=!1,D()}}async function _t(a=0){if(!M.composition)return;const e=await Ae();M.isPlaying=!0,E.disabled=!1,D();const t=Math.max(0,a);V.clear();try{await e.playBgm(M.composition,{offset:t,loop:!0,onEvent:jn})}catch(s){throw console.error("Playback error:",s),M.isPlaying=!1,D(),s}Mt()}function Oe(a={}){const{skipSessionStop:e=!1,skipCancelSe:t=!1}=a;e?t||P==null||P.cancelScheduledSe():P==null||P.stopAllAudio(),$=!1,Y!==null&&(cancelAnimationFrame(Y),Y=null),M.isPlaying=!1,V.clear(),Object.values(pe).forEach(s=>{s.classList.remove("active"),s.style.opacity="0.3",s.style.boxShadow="none"}),D()}async function Un(a){try{const e=await Ae(),t=ft[a];await e.triggerSe({type:t,duckingDb:-4,quantize:{quantizeTo:"beat",phase:"next",loopAware:!0}}),T(`Scheduled ${t} sound effect`)}catch(e){console.error("Indicator sound effect trigger failed:",e),T("Sound effect trigger failed")}}function Vn(){Object.keys(ft).forEach(a=>{const e=pe[a];e&&(e.style.cursor="pointer",e.title="Hidden SE trigger",e.addEventListener("click",t=>{t.stopPropagation(),Un(a)}))})}function Wn(){M.isPlaying?(Oe(),T("Playback paused")):M.composition&&_t().then(()=>T("Playback resumed"),a=>{console.error("Playback resume failed:",a),T("Playback resume failed")})}function jn(a,e){var n,r;const t=a.channel,s=`${t}-${((n=a.data)==null?void 0:n.midi)||0}`;if(a.command==="noteOn"){const i=((r=a.data)==null?void 0:r.velocity)||64;V.set(s,{channel:t,velocity:typeof i=="number"?i:64,endTime:e+2})}else a.command==="noteOff"&&V.delete(s)}function Mt(){const a=()=>{const e=P==null?void 0:P.getAudioContext();if(!e||!M.isPlaying){Y=requestAnimationFrame(a);return}const t=e.currentTime,s={square1:0,square2:0,triangle:0,noise:0};V.forEach((n,r)=>{if(t<=n.endTime){const i=n.channel;i in s&&(s[i]=Math.max(s[i],n.velocity))}else V.delete(r)}),M.channelActivity=s,Object.entries(s).forEach(([n,r])=>{const i=pe[n];if(i){const o=r/127;r>0?(i.classList.add("active"),i.style.opacity=String(.5+o*.5),i.style.boxShadow=`0 0 ${20+o*30}px currentColor`):(i.classList.remove("active"),i.style.opacity="0.3",i.style.boxShadow="none")}}),Y=requestAnimationFrame(a)};a()}async function zn(){if(!M.composition)return;const a=M.composition.meta.replayOptions;try{const e=JSON.stringify(a,null,2);await navigator.clipboard.writeText(e);const t=q.textContent;q.textContent="Copied!",q.classList.add("copied"),setTimeout(()=>{q.textContent=t,q.classList.remove("copied")},1500)}catch(e){console.error("Failed to copy seed to clipboard:",e),T("Failed to copy seed")}}function D(){M.isGenerating?(E.disabled=!0,E.classList.add("loading"),te.textContent="",ae.style.display="none"):M.isPlaying?(E.disabled=!1,E.classList.remove("loading"),te.textContent=" Pause",E.setAttribute("aria-label","Pause playback"),ae.style.display=M.composition?"block":"none"):M.composition?(E.disabled=!1,E.classList.remove("loading"),te.textContent=" Play",E.setAttribute("aria-label","Play playback"),ae.style.display="block"):(E.disabled=!0,E.classList.remove("loading"),te.textContent="Play",ae.style.display="none")}function T(a){Gn.textContent=a,Nn.textContent=a}U.addEventListener("click",a=>void Te(a));U.addEventListener("touchstart",a=>{a.preventDefault(),Te(a)});E.addEventListener("click",()=>Wn());q.addEventListener("click",()=>void zn());U.addEventListener("keydown",a=>{if(a.key==="Enter"||a.key===" "){a.preventDefault();const e=U.getBoundingClientRect(),t=e.left+e.width/2,s=e.top+e.height/2,n=new MouseEvent("click",{clientX:t,clientY:s});Te(n)}});window.addEventListener("resize",()=>{vt()});function $n(){Object.values(pe).forEach(a=>{a.classList.remove("active"),a.style.opacity="0.3",a.style.boxShadow="none"})}vt();$n();Vn();D();
