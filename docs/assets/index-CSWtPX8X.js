(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=a(r);fetch(r.href,n)}})();const pt={simple:[["C","G","Am","F"],["C","Em","F","G"],["Am","F","C","G"],["C","Am","Dm","G"],["C","F","G","C"]],town_peaceful:[["C","F","C","G"],["C","G","Em","Am"],["F","G","Em","Am"],["C","F","Am","G"],["C","G","F","C"]],heroic_fanfare:[["C","Am","F","G"],["C","G","Am","Em"],["F","C","G","Am"],["C","Dm","G","C"],["Am","F","G","C"]],playful:[["C","F","G","Am"],["C","Em","Am","F"],["F","G","C","Am"],["C","G","F","Em"],["Am","G","F","C"]]},gt={castle_majestic:[["Em","C","G","D"],["Em","B7","Em","C"],["C","G","D","Em"],["Em","C","D","G"],["Em","Em","C","D"]],dark:[["Em","D","C","B7"],["Em","C","Am","B7"],["Em","Bm","C","G"],["Em","C","D","Bm"],["Em","G","F","B7"]],ending_sorrowful:[["Em","C","G","D"],["Em","Bm","C","G"],["Em","D","C","B7"],["Em","G","D","C"],["Em","C","Am","B7"]],final_battle_tense:[["Em","C","D","B7"],["Em","G","D","Em"],["C","D","Em","Em"],["Em","Bm","C","D"],["G","D","Em","C"]],mysterious:[["Em","Am","F","C"],["Am","Em","G","C"],["Em","F","G","Em"],["Dm","Am","G","C"],["Em","C","Am","Bm"]],epic_adventure:[["Em","C","G","D"],["G","Em","C","D"],["C","G","Am","Em"],["Em","D","C","G"],["Am","Em","G","D"]]},ht={heroic:[["G","C","D","G"],["G","Em","C","D"],["C","D","G","G"],["G","B7","Em","C"],["Em","C","G","D"]],overworld_bright:[["G","D","Em","C"],["C","G","D","G"],["G","Em","Am","D"],["G","C","D","G"],["G","B7","Em","C"]],triumph:[["G","D","C","G"],["C","D","G","Em"],["G","C","Am","D"],["Em","C","D","G"],["G","D","Em","D"]],adventure:[["G","Em","C","D"],["Am","D","G","C"],["G","C","D","Em"],["C","Am","G","D"],["G","D","C","Am"]]},vt={C_Major:pt,E_Minor:gt,G_Major:ht},$e=vt,ft={slow:90,medium:120,fast:150},mt={upbeat:["overworld_bright","heroic"],sad:["ending_sorrowful","dark"],tense:["final_battle_tense","castle_majestic"],peaceful:["town_peaceful","simple"]},yt={upbeat:"G_Major",sad:"E_Minor",tense:"E_Minor",peaceful:"C_Major"},W=Object.keys($e),_t={G_Major:[0,2,4,5,7,9,11],E_Minor:[0,2,3,5,7,8,10],C_Major:[0,2,4,5,7,9,11]},Pe=[[{id:"Intro",measures:1},{id:"A",measures:3},{id:"B",measures:2},{id:"A",measures:2}],[{id:"A",measures:2},{id:"B",measures:2},{id:"A",measures:2},{id:"C",measures:2}],[{id:"Intro",measures:2},{id:"A",measures:2},{id:"Bridge",measures:2},{id:"A",measures:2}],[{id:"A",measures:4},{id:"B",measures:2},{id:"C",measures:2}]],Mt={tense:[0,3],upbeat:[1,2],sad:[2,3],peaceful:[1,2]},Be={16:{upbeat:[{id:"A",measures:8},{id:"B",measures:8}],peaceful:[{id:"A",measures:8},{id:"B",measures:8}],tense:[{id:"A",measures:8},{id:"B",measures:8}],sad:[{id:"A",measures:8},{id:"B",measures:8}]},32:{upbeat:[{id:"A",measures:8},{id:"B",measures:8},{id:"C",measures:8},{id:"D",measures:8}],peaceful:[{id:"A",measures:16},{id:"B",measures:16}],tense:[{id:"A",measures:8},{id:"B",measures:8},{id:"A",measures:8},{id:"C",measures:8}],sad:[{id:"Intro",measures:4},{id:"A",measures:12},{id:"B",measures:8},{id:"A",measures:8}]},64:{upbeat:[{id:"A",measures:16},{id:"B",measures:16},{id:"C",measures:16},{id:"D",measures:16}],peaceful:[{id:"A",measures:16},{id:"B",measures:16},{id:"A",measures:16},{id:"C",measures:16}],tense:[{id:"Intro",measures:8},{id:"A",measures:16},{id:"B",measures:16},{id:"C",measures:12},{id:"A",measures:12}],sad:[{id:"Intro",measures:8},{id:"A",measures:20},{id:"B",measures:16},{id:"A",measures:20}]}},Ye=new Set(["A"]),ue="steady",bt=1,St={textureFocus:!1,loopCentric:!1,gradualBuild:!1,harmonicStatic:!1,percussiveLayering:!1,breakInsertion:!1,filterMotion:!1,syncopationBias:!1,atmosPad:!1},je={minimalTechno:{textureFocus:!0,loopCentric:!0,harmonicStatic:!0,percussiveLayering:!0,filterMotion:!0,syncopationBias:!0},progressiveHouse:{textureFocus:!0,loopCentric:!0,gradualBuild:!0,percussiveLayering:!0,breakInsertion:!0,filterMotion:!0,atmosPad:!0},retroLoopwave:{textureFocus:!0,loopCentric:!0,percussiveLayering:!0,filterMotion:!0,syncopationBias:!0},breakbeatJungle:{textureFocus:!0,percussiveLayering:!0,breakInsertion:!0,filterMotion:!0,syncopationBias:!0},lofiChillhop:{loopCentric:!0,harmonicStatic:!0,atmosPad:!0,textureFocus:!0}};function Rt(){return{...St}}function Ke(t,e){if(!e)return t;const a={...t};for(const s of Object.keys(t))e[s]!==void 0&&(a[s]=!!e[s]);return a}function xt(t){let e={};if(t.stylePreset){const a=je[t.stylePreset];a&&(e={...e,...a})}return t.styleOverrides&&(e={...e,...t.styleOverrides}),e}function Pt(t,e){let a=Rt();if(t.stylePreset){const g=je[t.stylePreset];g&&(a=Ke(a,g))}const s=e.reduce((g,h)=>g+h.measures,0),r=e.reduce((g,h)=>(g.set(h.templateId,(g.get(h.templateId)??0)+1),g),new Map),n=Array.from(r.values()).some(g=>g>=2),o=e.length?s/e.length:s;(n||o<=4)&&(a.loopCentric=!0),t.tempo!=="slow"&&s>=8&&(a.loopCentric=!0,a.percussiveLayering=!0),(t.mood==="tense"||t.mood==="sad")&&(a.textureFocus=!0),t.mood==="peaceful"&&(a.atmosPad=!0),(t.mood==="upbeat"||t.mood==="tense")&&(a.syncopationBias=!0),t.tempo==="fast"&&(a.filterMotion=!0,a.percussiveLayering=!0),s>=12&&(a.gradualBuild=!0);const i=new Set,l=new Set;let u=0;for(const g of e)g.chordProgression.forEach(h=>i.add(h)),l.add(g.chordProgression.join("|")),new Set(g.chordProgression).size<=1&&u++;const c=e.length>0&&u===e.length;l.size<=1&&(i.size<=2||c)&&(a.harmonicStatic=!0),s>=8&&t.tempo!=="slow"&&(a.breakInsertion=!0);const p=a.harmonicStatic;a=Ke(a,t.styleOverrides);const d=t.styleOverrides&&typeof t.styleOverrides.harmonicStatic=="boolean";return!p&&!d&&(a.harmonicStatic=!1),a}function E(t,e){const a=Math.imul(t??0,1664525)+Math.imul(e,1013904223)>>>0;return(Math.imul(a,22695477)+1>>>0)/4294967295}function Bt(t,e,a){const s=$e[t];if(!s)throw new Error(`No chord motifs for key ${t}`);const r=[];for(const o of e)Array.isArray(s[o])&&r.push(...s[o]);const n=r.length?r:Object.values(s).flat();if(!n.length)throw new Error(`No chord progressions available for key ${t}`);return ze(n,a,100).map(o=>[...o])}function He(t,e){const a=t.match(/^([A-G])(#|b)?(.*)$/);if(!a)return t;const[,s,r="",n]=a,o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],i={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},l=s+r,u=i[l];if(u===void 0)return t;const c=(u+e+12)%12;return o[c]+n}function Kt(t){const e=t.match(/^([A-G](?:#|b)?)(m?)(.*)$/);if(!e)return t;const[,a,s,r]=e;return s==="m"?a+r:a+"m"+r}function Ht(t){const e=[];return e.push(He(t,7)),e.push(He(t,5)),e.push(Kt(t)),e}function Et(t,e){const a=3+Math.floor(e()*2),s=Array(a).fill(t);if(e()<.2){const r=Ht(t),n=r[Math.floor(e()*r.length)];s.push(n)}return s}function It(t,e,a,s){const r=t.lengthInMeasures;let n;r in Be?n=Be[r][t.mood].map(m=>({...m})):n=Ut(t.mood,a);const o=n.reduce((m,y)=>m+y.measures,0);let i=[];if(r===o)i=n;else if(r>o){const m=Math.floor(r/o);for(let R=0;R<m;R++)i=i.concat(n);let y=r-m*o,M=0;for(;y>0;){const R=n[M%n.length],A=Math.min(R.measures,y);i.push({id:R.id,measures:A}),y-=A,M++}}else{let m=0;for(const y of n){if(m+y.measures>r){const M=Math.max(r-m,0);M>0&&i.push({id:y.id,measures:M});break}i.push(y),m+=y.measures}}const l=[];let u=0,c=0;const p=ze(e,a,200+c),d=new Map,g=new Set;for(const m of p)m.forEach(y=>g.add(y));const h=(m=>{let y=(m??987654321)>>>0;return y===0&&(y=987654321),()=>(y=y*1664525+1013904223>>>0,y/4294967295)})(a),f=s.harmonicStatic===!0,v=f&&g.size<=1;for(const m of i){let y;if(v&&p.length>0)y=[p[0][0]];else if(f&&p.length>0){const S=p[c%p.length][0];y=Et(S,h)}else y=p[c%p.length];const M=m.id,R=(d.get(M)??0)+1;d.set(M,R);const A=kt(M,R,a);l.push({id:`${m.id}${l.filter(S=>S.id.startsWith(m.id)).length+1}`,startMeasure:u,measures:m.measures,chordProgression:y,templateId:M,occurrenceIndex:R,texture:A}),u+=m.measures,v||c++}return l}const At={Intro:["broken"],A:["broken","steady","broken"],B:["steady","steady","arpeggio"],Bridge:["arpeggio","steady"],C:["steady","arpeggio","steady"]},Ft={Intro:1,A:2,B:2,Bridge:4,C:2},Ee={firstOccurrence:.7,repeatOccurrence:.4},Ot=.1;function kt(t,e,a){const s=At[t]??[ue],r=s[(e-1)%s.length]??ue;if(r==="arpeggio"){const o=e===1,i=t.split("").reduce((c,p)=>c+p.charCodeAt(0),0),l=E(a,1e3+i*7+e*13),u=o?Ee.firstOccurrence:Ee.repeatOccurrence;if(l>u)return s.find(c=>c!=="arpeggio")??ue}const n=t.charCodeAt(0)*100+e;if(E(a,2e3+n)<Ot){const o=["steady","broken","arpeggio"].filter(l=>l!==r),i=Math.floor(E(a,3e3+n)*o.length);return o[i]??r}return r}function Tt(t){return Ft[t]??bt}function Dt(t){return Tt(t.templateId)}function re(t){return t.occurrenceIndex===1&&Ye.has(t.templateId)}function F(t){return t.occurrenceIndex>1&&Ye.has(t.templateId)}function Ct(t,e,a){let s,r=50;switch(t){case"tense":s={echoProbability:.5,detuneProbability:.3,fastArpeggioProbability:.4},r=10;break;case"upbeat":s={echoProbability:.4,detuneProbability:.2,fastArpeggioProbability:.2},r=20;break;case"sad":s={echoProbability:.6,detuneProbability:.1,fastArpeggioProbability:.1},r=30;break;case"peaceful":s={echoProbability:.5,detuneProbability:.05,fastArpeggioProbability:.05},r=40;break;default:s={echoProbability:.3,detuneProbability:.3,fastArpeggioProbability:.3};break}const n=Lt(s,e);return wt(n,a,r)}function wt(t,e,a){const s=n=>Math.min(.95,Math.max(.05,n)),r=n=>(E(e,a+n)-.5)*.2;return{echoProbability:s(t.echoProbability+r(1)),detuneProbability:s(t.detuneProbability+r(2)),fastArpeggioProbability:s(t.fastArpeggioProbability+r(3))}}function Lt(t,e){const a={...t};return e.textureFocus&&(a.fastArpeggioProbability=Math.max(.05,a.fastArpeggioProbability*.6),a.echoProbability=Math.min(.95,a.echoProbability+.05)),e.loopCentric&&(a.detuneProbability=Math.max(.05,a.detuneProbability*.8)),e.gradualBuild&&(a.echoProbability=Math.min(.95,a.echoProbability+.1)),e.harmonicStatic&&(a.detuneProbability=Math.max(.05,a.detuneProbability*.7)),e.percussiveLayering&&(a.fastArpeggioProbability=Math.min(.9,a.fastArpeggioProbability+.05)),e.filterMotion&&(a.detuneProbability=Math.min(.9,a.detuneProbability+.1)),e.syncopationBias&&(a.echoProbability=Math.min(.9,a.echoProbability+.05)),e.atmosPad&&(a.echoProbability=Math.min(.95,a.echoProbability+.08)),e.breakInsertion&&(a.fastArpeggioProbability=Math.max(.05,a.fastArpeggioProbability*.9)),a}const Ie={standard:{id:"standard",description:"Classic melody + accompaniment + bass",voices:[{role:"melody",channel:"square1",priority:1,octaveOffset:0},{role:"accompaniment",channel:"square2",priority:1,octaveOffset:0},{role:"bass",channel:"triangle",priority:1,octaveOffset:0}]},swapped:{id:"swapped",description:"Swapped square channels for tonal variety",voices:[{role:"melody",channel:"square2",priority:1,octaveOffset:0},{role:"accompaniment",channel:"square1",priority:1,octaveOffset:0},{role:"bass",channel:"triangle",priority:1,octaveOffset:0}]},dualBass:{id:"dualBass",description:"Melody with dual bass (thick low end)",voices:[{role:"melody",channel:"square1",priority:1,octaveOffset:0},{role:"bass",channel:"square2",priority:1,octaveOffset:0,seedOffset:0},{role:"bassAlt",channel:"triangle",priority:.7,octaveOffset:-1,seedOffset:100}]},bassLed:{id:"bassLed",description:"Bass-focused with sparse melodic decoration",voices:[{role:"bass",channel:"triangle",priority:1,octaveOffset:-1,seedOffset:0},{role:"bassAlt",channel:"square2",priority:.8,octaveOffset:0,seedOffset:200},{role:"melody",channel:"square1",priority:.3,octaveOffset:0}]},layeredBass:{id:"layeredBass",description:"Layered bass with complementary square/triangle movement",voices:[{role:"bass",channel:"square1",priority:1,octaveOffset:0,seedOffset:0},{role:"bassAlt",channel:"triangle",priority:.85,octaveOffset:0,seedOffset:160},{role:"melody",channel:"square2",priority:1,octaveOffset:0}]},minimal:{id:"minimal",description:"Minimal techno: bass + sparse pad only",voices:[{role:"bass",channel:"square1",priority:1,octaveOffset:0},{role:"pad",channel:"triangle",priority:.4,octaveOffset:0}]},breakLayered:{id:"breakLayered",description:"Breakbeat layering: dual bass pressure with agile lead",voices:[{role:"bass",channel:"square1",priority:1,octaveOffset:0,seedOffset:0},{role:"bassAlt",channel:"triangle",priority:.95,octaveOffset:-1,seedOffset:140},{role:"melody",channel:"square2",priority:.85,octaveOffset:0,seedOffset:240}]},lofiPadLead:{id:"lofiPadLead",description:"Lo-fi pad-first texture with gentle lead flourishes",voices:[{role:"pad",channel:"triangle",priority:.9,octaveOffset:-1},{role:"accompaniment",channel:"square2",priority:1,octaveOffset:-1,seedOffset:60},{role:"melody",channel:"square1",priority:.45,octaveOffset:0,seedOffset:180}]},retroPulse:{id:"retroPulse",description:"Retro loopwave pulse arpeggios with anchored bass",voices:[{role:"melody",channel:"square1",priority:1,octaveOffset:0,seedOffset:80},{role:"accompaniment",channel:"square2",priority:.85,octaveOffset:0,seedOffset:140},{role:"bass",channel:"triangle",priority:.9,octaveOffset:-1,seedOffset:40}]}},Gt={minimalTechno:{standard:2,minimal:5,bassLed:3,dualBass:2,swapped:1,layeredBass:1},progressiveHouse:{standard:4,swapped:3,layeredBass:3,dualBass:2,bassLed:1,minimal:0},retroLoopwave:{standard:2,swapped:3,retroPulse:5,layeredBass:1,minimal:0,bassLed:1},breakbeatJungle:{breakLayered:5,dualBass:3,layeredBass:2,bassLed:2,standard:1,swapped:1,minimal:0},lofiChillhop:{lofiPadLead:5,minimal:3,standard:2,swapped:1,bassLed:1,layeredBass:0,dualBass:1}},Ae={standard:5,swapped:4,dualBass:2,bassLed:2,layeredBass:2,minimal:1,breakLayered:1,lofiPadLead:1,retroPulse:2};function Nt(t,e){const a=e?{...Ae,...Gt[e]}:Ae,s=Object.entries(a),r=s.reduce((i,[,l])=>i+l,0),n=E(t,100);let o=0;for(const[i,l]of s)if(o+=l/r,n<o)return Ie[i];return Ie.standard}function qt(t){const e=ft[t.tempo],a=Math.round((E(t.seed,1)-.5)*30),s=e+Math.max(-15,Math.min(15,a)),r=mt[t.mood],n=Vt(t.mood,t.seed),o=_t[n];if(!o)throw new Error(`Scale not defined for key ${n}`);const i=Bt(n,r,t.seed),l=xt(t),u=It(t,i,t.seed,l),c=Pt(t,u),p=Ct(t.mood,c,t.seed);Wt(t.lengthInMeasures,u);const d=Nt(t.seed,t.stylePreset);return{bpm:s,key:n,scaleDegrees:o,sections:u,techniqueStrategy:p,styleIntent:c,voiceArrangement:d}}function Ut(t,e){const a=Mt[t]??Pe.map((r,n)=>n),s=a[Math.floor(E(e,60)*a.length)]??0;return Pe[s].map(r=>({...r}))}function ze(t,e,a){const s=[...t];for(let r=s.length-1;r>0;r--){const n=Math.floor(E(e,a+r)*(r+1)),o=s[r];s[r]=s[n],s[n]=o}return s}function Vt(t,e){const a=yt[t];if(a&&W.includes(a))return a;if(!W.length)throw new Error("Chord library is empty");const s=Math.floor(E(e,5)*W.length)%W.length;return W[s]}function Wt(t,e){const a=e.reduce((s,r)=>s+r.measures,0);if(a!==t)throw new Error(`Section length mismatch. expected=${t}, actual=${a}`)}const $t={K:.25,S:.25,H:.125,O:.375,T:.5,N:.375},Yt={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},J={"":[0,4,7],m:[0,3,7],7:[0,4,7,10],m7:[0,3,7,10],maj7:[0,4,7,11],sus2:[0,2,7],sus4:[0,5,7],dim:[0,3,6],aug:[0,4,8]},_=4;function ne(t,e){const a=t.match(/^[A-G](#|b)?/i);if(!a)return e;const s=a[0].toUpperCase(),r=Yt[s]??0;return e-e%12+r}function ve(t){const e=t.match(/^[A-G](?:#|b)?(.*)$/),a=(e==null?void 0:e[1])??"";return a in J?J[a]:a.startsWith("m")?J.m:J[""]}function oe(t,e,a,s=0){const r=((t-1)%e.length+e.length)%e.length,n=Math.floor((t-1)/e.length)+s,o=e[r]+12*n;return a+o}function Xe(t,e,a){const s=[];for(let r=0;r<t.length;r++){const n=t[r];if(n==="-")continue;const o=e+r/16*_;s.push({startBeat:o,durationBeats:$t[n]??.25,instrument:n,sectionId:a})}return s}function K(t,e,a=_){const s=Math.floor(e/a),r=t.sections.find(o=>s>=o.startMeasure&&s<o.startMeasure+o.measures);if(!r){const o=t.sections[0];return(o==null?void 0:o.chordProgression[0])??"C"}const n=Math.max(0,s-r.startMeasure);return r.chordProgression[n%r.chordProgression.length]}function jt(t){return(t%12+12)%12}function B(t,e){const a=ne(e,t),s=ve(e);let r=t,n=1/0;for(const o of s)for(let i=-2;i<=2;i++){const l=a+o+i*12,u=Math.abs(l-t);u<n&&(r=l,n=u)}return r}const zt=new Set([0,3,4,5,7,8,9]);function j(t,e,a){if(a===void 0)return B(t,e);const s=ne(e,a),r=ve(e);let n=t,o=Number.POSITIVE_INFINITY;for(const i of r)for(let l=-2;l<=2;l++){const u=s+i+l*12,c=jt(u-a),p=zt.has(c)?0:10,d=Math.abs(u-t)*.1,g=Math.abs(u-a)*.05,h=p+d+g;h<o&&(o=h,n=u)}return n}const Fe={MIN:20,MAX_ACCENT:118},$={TRIANGLE_BASE:.75,TRIANGLE_NON_BASS:.9,BASS_BASE:.7,BASS_LOW_RANGE:.85,SQUARE_BASS:.82},Xt={BASS_LOW_RANGE:52},Oe={broken:74,steady:70,arpeggio:76,default:72},ke={DOWNBEAT_BOOST:6,STRONG_BEAT_BOOST:3},Jt={PICKUP_BASE:72},I={EARLY_START:52,PAD_MIN:48,ARPEGGIO_SCALE:.75,BROKEN_SCALE:.9,STEADY_SCALE:.85},Te={ECHO_SCALE:.6,DETUNE_SCALE:.7},w={KICK:120,TOM:116,LOW_NOISE:112,SNARE:115,HIHAT:118,OPEN_HAT:114},Qt=[{id:"RM001",length:4,pattern:[4,4,4,4],tags:["start","straight","loop_safe","loop_safe"],variations:["RM002","RM003"]},{id:"RM002",length:4,pattern:[4,8,8,4,4],tags:["start","straight","loop_safe","kick"],variations:["RM003","RM004"]},{id:"RM003",length:4,pattern:[8,8,8,8,4,4],tags:["start","straight","loop_safe","sfx_long"],variations:["RM004","RM005"]},{id:"RM004",length:4,pattern:[4,8,8,4,4],tags:["start","straight","loop_safe"],variations:["RM005","RM006"]},{id:"RM005",length:4,pattern:[8,8,4,8,8,4],tags:["start","straight","loop_safe"],variations:["RM006","RM007"]},{id:"RM006",length:4,pattern:[8,8,4,8,8,4],tags:["start","syncopation","loop_safe","anacrusis"],variations:["RM007","RM008"]},{id:"RM007",length:4,pattern:[8,16,16,8,16,16,4,4],tags:["start","syncopation","loop_safe","anacrusis"],variations:["RM008","RM027"]},{id:"RM008",length:4,pattern:[4,8,8,4,8,8],tags:["start","syncopation","loop_safe","anacrusis"],variations:["RM027","RM028"]},{id:"RM009",length:4,pattern:[8,8,4,8,8,4],tags:["middle","straight","bridge"],variations:["RM010","RM011"]},{id:"RM010",length:4,pattern:[4,4,8,8,4],tags:["middle","straight","bridge"],variations:["RM011","RM012"]},{id:"RM011",length:4,pattern:[4,4,4,8,8],tags:["middle","straight","bridge"],variations:["RM012","RM013"]},{id:"RM012",length:8,pattern:[8,8,4,4,8,8,4,4,4,4],tags:["middle","syncopation","bridge"],variations:["RM013","RM014"]},{id:"RM013",length:8,pattern:[4,8,8,4,8,8,4,4,4,4],tags:["middle","syncopation","bridge"],variations:["RM014","RM015"]},{id:"RM014",length:8,pattern:[8,8,8,8,4,4,4,4,4,4],tags:["middle","syncopation","bridge"],variations:["RM015","RM016"]},{id:"RM015",length:8,pattern:[4,4,4,4,4,4,4,4],tags:["middle","sustain","open"],variations:["RM016","RM017"]},{id:"RM016",length:8,pattern:[4,8,8,4,4,4,8,8,4,4],tags:["middle","sustain","open"],variations:["RM017","RM018"]},{id:"RM017",length:4,pattern:[8,16,16,8,16,16,8,16,16,4],tags:["middle","swing_hint","bridge"],variations:["RM018","RM029"]},{id:"RM018",length:4,pattern:[8,16,16,4,8,16,16,4],tags:["middle","swing_hint","bridge"],variations:["RM029","RM030"]},{id:"RM019",length:4,pattern:[4,4,4,4],tags:["end","straight","loop_safe"],variations:["RM020","RM021"]},{id:"RM020",length:4,pattern:[8,8,4,8,8,4],tags:["end","straight","loop_safe"],variations:["RM021","RM022"]},{id:"RM021",length:4,pattern:[4,8,8,4,4],tags:["end","straight","loop_safe"],variations:["RM022","RM023"]},{id:"RM022",length:4,pattern:[4,4,4,4],tags:["end","cadence"],variations:["RM023","RM024"]},{id:"RM023",length:4,pattern:[8,8,4,4,4],tags:["end","cadence"],variations:["RM024","RM025"]},{id:"RM024",length:4,pattern:[4,8,8,4,4],tags:["end","cadence"],variations:["RM025","RM026"]},{id:"RM025",length:8,pattern:[4,4,4,4,4,4,4,4],tags:["end","cadence","loop_safe"],variations:["RM026","RM019"]},{id:"RM026",length:8,pattern:[8,8,4,4,4,8,8,4,4,4],tags:["end","cadence","loop_safe"],variations:["RM019","RM020"]},{id:"RM027",length:4,pattern:[8,8,8,8,8,8,4],tags:["start","staccato","anacrusis"],variations:["RM028","RM001"]},{id:"RM028",length:4,pattern:[8,8,8,8,4,8,8],tags:["start","staccato","anacrusis"],variations:["RM001","RM002"]},{id:"RM029",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM030","RM031"]},{id:"RM030",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM031","RM032"]},{id:"RM031",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM032","RM033"]},{id:"RM032",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM033","RM034"]},{id:"RM033",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM034","RM035"]},{id:"RM034",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM035","RM036"]},{id:"RM035",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM036","RM037"]},{id:"RM036",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM037","RM038"]},{id:"RM037",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM038","RM039"]},{id:"RM038",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM039","RM040"]},{id:"RM039",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM040","RM041"]},{id:"RM040",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM041","RM042"]},{id:"RM041",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM042","RM043"]},{id:"RM042",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM043","RM044"]},{id:"RM043",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM044","RM045"]},{id:"RM044",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM045","RM046"]},{id:"RM045",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM046","RM047"]},{id:"RM046",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM047","RM048"]},{id:"RM047",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM048","RM049"]},{id:"RM048",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM049","RM050"]},{id:"RM049",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM050","RM009"]},{id:"RM050",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM009","RM010"]},{id:"RM051",length:4,pattern:[8,8,4,8,8,4],tags:["start","accented","syncopation","loop_safe"],variations:["RM052","RM053"]},{id:"RM052",length:4,pattern:[4,8,8,4,4],tags:["middle","accented","bridge","loop_safe"],variations:["RM051","RM053"]},{id:"RM053",length:4,pattern:[8,8,8,8,4,4],tags:["end","accented","cadence","loop_safe"],variations:["RM051","RM052"]},{id:"RM054",length:4,pattern:[4,4,8,8,8,8],tags:["middle","accented","variation","loop_safe"],variations:["RM052","RM055"]},{id:"RM055",length:4,pattern:[4,8,8,8,8,4],tags:["start","accented","bridge","loop_safe"],variations:["RM051","RM054"]},{id:"RM056",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","straight","texture_loop","grid16","loop_safe"],variations:["RM057"]},{id:"RM057",length:4,pattern:[16,16,16,16,16,16,16,8,8,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe"],variations:["RM056"]},{id:"RM058",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","middle","texture_loop","grid16","loop_safe","simple"],variations:["RM059","RM060"]},{id:"RM059",length:4,pattern:[16,16,16,16,16,16,8,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM058","RM060"]},{id:"RM060",length:4,pattern:[16,16,8,16,16,16,16,8,16,16,16,16,8],tags:["middle","texture_loop","grid16","loop_safe","syncopation"],variations:["RM058","RM059"]},{id:"RM061",length:4,pattern:[8,8,8,8,8,8,8,8],tags:["start","middle","texture_loop","loop_safe","straight"],variations:["RM062"]},{id:"RM062",length:4,pattern:[8,8,8,16,16,8,8,8,16,16],tags:["middle","texture_loop","loop_safe","straight"],variations:["RM061"]},{id:"RM063",length:4,pattern:[16,16,16,16,8,16,16,16,16,8,16,16,16,16],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM064"]},{id:"RM064",length:4,pattern:[16,16,16,16,16,16,16,16,8,16,16,16,16,8],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM063"]},{id:"RM065",length:4,pattern:[4,16,16,16,16,4,16,16,16,16],tags:["start","middle","texture_loop","loop_safe","simple"],variations:["RM066"]},{id:"RM066",length:4,pattern:[4,16,16,16,16,8,8,16,16,16,16],tags:["middle","texture_loop","loop_safe"],variations:["RM065"]},{id:"RM067",length:4,pattern:[8,16,16,8,16,16,8,16,16,8,16,16],tags:["start","middle","texture_loop","loop_safe","straight"],variations:["RM068"]},{id:"RM068",length:4,pattern:[8,16,16,8,8,8,16,16,8,16,16],tags:["middle","texture_loop","loop_safe","syncopation"],variations:["RM067"]},{id:"RM069",length:4,pattern:[16,16,8,16,16,8,16,16,8,16,16,8],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM070"]},{id:"RM070",length:4,pattern:[16,16,8,8,16,16,8,16,16,8,16,16],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM069"]},{id:"RM071",length:4,pattern:[4,4,16,16,16,16,4],tags:["start","middle","texture_loop","loop_safe","accented"],variations:["RM072"]},{id:"RM072",length:4,pattern:[4,8,8,16,16,16,16,4],tags:["middle","end","texture_loop","loop_safe","accented"],variations:["RM071"]},{id:"RM073",length:8,pattern:[4,4,4,4,4,4,4,4],tags:["end","cadence","loop_safe","final"],variations:["RM074","RM075"]},{id:"RM074",length:8,pattern:[4,8,8,4,4,4,8,8,4,4],tags:["end","cadence","loop_safe","final"],variations:["RM073","RM075"]},{id:"RM075",length:8,pattern:[8,8,4,4,4,2,2],tags:["end","cadence","loop_safe","ritardando"],variations:["RM073","RM074"]},{id:"RM076",length:4,pattern:[8,8,8,8,4,4],tags:["start","anacrusis","staccato","loop_safe"],variations:["RM077","RM078"]},{id:"RM077",length:4,pattern:[16,16,16,16,8,8,4,4],tags:["start","anacrusis","drive","loop_safe"],variations:["RM076","RM078"]},{id:"RM078",length:4,pattern:[8,8,4,8,8,4],tags:["start","anacrusis","syncopation","loop_safe"],variations:["RM076","RM077"]},{id:"RM079",length:4,pattern:[8,16,16,4,8,16,16,4],tags:["middle","syncopation","drive","loop_safe"],variations:["RM080","RM081"]},{id:"RM080",length:4,pattern:[4,16,16,8,8,4,8],tags:["middle","syncopation","accented","loop_safe"],variations:["RM079","RM082"]},{id:"RM081",length:4,pattern:[16,16,8,16,16,8,16,16,8,4],tags:["start","syncopation","staccato","loop_safe"],variations:["RM079","RM082"]},{id:"RM082",length:4,pattern:[8,8,16,16,16,16,8,8,4],tags:["middle","syncopation","drive","loop_safe"],variations:["RM080","RM083"]},{id:"RM083",length:4,pattern:[4,8,16,16,8,8,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM082","RM084"]},{id:"RM084",length:8,pattern:[8,16,16,8,16,16,4,4,8,16,16,8,16,16,4,4],tags:["middle","syncopation","drive","loop_safe"],variations:["RM083","RM085"]},{id:"RM085",length:8,pattern:[4,8,8,4,4,8,8,4,4,4],tags:["end","syncopation","cadence","loop_safe"],variations:["RM084","RM079"]},{id:"RM086",length:8,pattern:[8,8,4,8,8,4,8,8,4,8,8,4],tags:["middle","bridge","syncopation","loop_safe"],variations:["RM087","RM088"]},{id:"RM087",length:8,pattern:[4,4,8,8,8,8,4,4,8,8,8,8],tags:["middle","bridge","straight","loop_safe"],variations:["RM086","RM089"]},{id:"RM088",length:8,pattern:[16,16,16,16,8,8,4,4,16,16,16,16,8,8,4,4],tags:["middle","bridge","drive","loop_safe"],variations:["RM086","RM089"]},{id:"RM089",length:8,pattern:[8,8,8,8,4,4,8,8,8,8,4,4],tags:["middle","bridge","sustain","loop_safe"],variations:["RM087","RM090"]},{id:"RM090",length:8,pattern:[4,8,8,4,4,8,8,4,4,4],tags:["middle","bridge","variation","loop_safe"],variations:["RM089","RM086"]},{id:"RM091",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM092",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","syncopation"]},{id:"RM093",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","simple"]},{id:"RM094",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","accented"]},{id:"RM095",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM096",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM097",length:4,pattern:[8,8,16,16,16,16,8,8,16,16,16,16],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","syncopation"]},{id:"RM098",length:4,pattern:[16,16,8,16,16,8,16,16,8,16,16,8],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","simple"]},{id:"RM099",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","accented"]},{id:"RM100",length:4,pattern:[8,16,16,16,16,8,16,16,16,16,8,8],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","open"]},{id:"RM101",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM102",length:4,pattern:[8,16,16,16,16,8,8,16,16,16,16,8],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","syncopation"]},{id:"RM103",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","simple"]},{id:"RM104",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","accented"]},{id:"RM105",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","open"]},{id:"RM106",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","straight"]},{id:"RM107",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","syncopation"]},{id:"RM108",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","simple"]},{id:"RM109",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","accented"]},{id:"RM110",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","open"]},{id:"RM111",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16}],tags:["middle","texture_loop","grid16","syncopation","percussive_layer"]},{id:"RM112",length:4,pattern:[{value:8,accent:!0},{value:16},{value:16},{value:8},{value:16},{value:16,accent:!0},{value:8},{value:16},{value:16},{value:8,rest:!0},{value:16},{value:16}],tags:["middle","texture_loop","grid16","percussive_layer","drive"]},{id:"RM113",length:4,pattern:[{value:4,accent:!0},{value:16},{value:16},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","syncopation","break"]},{id:"RM114",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0}],tags:["middle","loop_safe","grid16","syncopation","breakbeat"]},{id:"RM115",length:4,pattern:[{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:4},{value:16,rest:!0},{value:8,accent:!0},{value:16,rest:!0},{value:16},{value:16,rest:!0}],tags:["middle","loop_safe","swing_hint","rest_heavy","lofi"]},{id:"RM116",length:4,pattern:[{value:8,accent:!0},{value:16},{value:16},{value:8,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:8},{value:16,accent:!0},{value:16},{value:8,accent:!0},{value:16,rest:!0},{value:16,accent:!0}],tags:["middle","loop_safe","syncopation","grid16","breakbeat"]},{id:"RM117",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0}],tags:["middle","loop_safe","grid16","syncopation","breakbeat","variation"]},{id:"RM118",length:4,pattern:[{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:8,accent:!0},{value:8,rest:!0},{value:8},{value:16,rest:!0},{value:8},{value:16,rest:!0}],tags:["middle","loop_safe","swing_hint","rest_heavy","lofi"]},{id:"RM119",length:4,pattern:[{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:8}],tags:["start","loop_safe","swing_hint","rest_heavy","lofi","variation"]}],Zt=[{id:"MF001",pattern:[1,3,5],tags:["ascending","scalar","bright","heroic","start","loop_safe","short","slide"]},{id:"MF002",pattern:[1,4,5,7],tags:["ascending","scalar","bright","heroic","start","loop_safe","short","bend"]},{id:"MF003",pattern:[2,3,6,6,9],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF004",pattern:[1,3,6,6,7],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF005",pattern:[1,3,5,7,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF006",pattern:[1,3,4],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF007",pattern:[2,4,5,6],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF008",pattern:[1,2,5,5,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF009",pattern:[1,3,6,6,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF010",pattern:[1,3,5,6,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF011",pattern:[5,4,3],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF012",pattern:[5,5,3,3],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF013",pattern:[6,4,4,2,2],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF014",pattern:[4,4,4,2,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF015",pattern:[5,4,3,3,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF016",pattern:[5,4,2],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF017",pattern:[6,5,3,2],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF018",pattern:[5,3,3,1,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF019",pattern:[5,4,4,2,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF020",pattern:[5,4,3,2,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF021",pattern:[1,4,6],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF022",pattern:[1,5,6,6],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF023",pattern:[2,4,7,5,4],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF024",pattern:[1,4,7,5,2],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF025",pattern:[1,4,6,6,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF026",pattern:[1,4,5],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF027",pattern:[2,5,6,5],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF028",pattern:[1,3,6,4,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF029",pattern:[1,4,7,5,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF030",pattern:[1,4,6,5,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF031",pattern:[6,4,2],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF032",pattern:[6,5,2,4],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF033",pattern:[7,4,3,3,2],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF034",pattern:[5,4,3,3,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF035",pattern:[6,4,2,4,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF036",pattern:[6,4,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF037",pattern:[7,5,2,3],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF038",pattern:[6,3,2,2,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF039",pattern:[6,4,3,3,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF040",pattern:[6,4,2,3,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF041",pattern:[1,2,3],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF042",pattern:[1,3,3,6],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF043",pattern:[2,2,4,5,8],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF044",pattern:[1,2,4,5,6,6],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF045",pattern:[1,2,3,6,7,7],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF046",pattern:[1,2,2],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF047",pattern:[2,3,3,5],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF048",pattern:[1,1,3,4,7],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF049",pattern:[1,2,4,5,7,7],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF050",pattern:[1,2,3,5,7,6],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF051",pattern:[5,7,6],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF052",pattern:[5,8,6,5],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF053",pattern:[6,7,7,4,3],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF054",pattern:[4,7,7,4,1],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF055",pattern:[5,7,6,5,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF056",pattern:[5,7,5],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF057",pattern:[6,8,6,4],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF058",pattern:[5,6,6,3,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF059",pattern:[5,7,7,4,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF060",pattern:[5,7,6,4,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF061",pattern:[3,5,4],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF062",pattern:[3,6,4,7],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF063",pattern:[4,5,5,6,6],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF064",pattern:[2,5,5,6,4,3],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF065",pattern:[3,5,4,7,5,4],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF066",pattern:[3,5,3],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF067",pattern:[4,6,4,6],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF068",pattern:[3,4,4,5,5],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF069",pattern:[3,5,5,6,5,4],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF070",pattern:[3,5,4,6,5,3],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF071",pattern:[2,4,6],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF072",pattern:[2,5,6,6],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF073",pattern:[3,4,7,5,4],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF074",pattern:[1,4,7,5,2,1],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF075",pattern:[2,4,6,6,3,2],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF076",pattern:[2,4,5],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF077",pattern:[3,5,6,5],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF078",pattern:[2,3,6,4,3],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF079",pattern:[2,4,7,5,3,2],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF080",pattern:[2,4,6,5,3,1],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF081",pattern:[1,5,3],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF082",pattern:[1,6,3,7],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF083",pattern:[2,5,4,6,5],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF084",pattern:[1,5,4,6,3,7],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF085",pattern:[1,5,3,7,4,8],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF086",pattern:[1,5,2],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF087",pattern:[2,6,3,6],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF088",pattern:[1,4,3,5,4],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF089",pattern:[1,5,4,6,4,8],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF090",pattern:[1,5,3,6,4,7],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF091",pattern:[6,3,5],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF092",pattern:[6,4,5,3],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF093",pattern:[7,3,6,2,5],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF094",pattern:[5,3,6,2,3,1],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF095",pattern:[6,3,5,3,4,2],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF096",pattern:[6,3,4],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF097",pattern:[7,4,5,2],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF098",pattern:[6,2,5,1,4],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF099",pattern:[6,3,6,2,4,2],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF100",pattern:[6,3,5,2,4,1],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF101",pattern:[1,1,1,1],tags:["flat","static","texture_loop","loop_safe","simple","ostinato"]},{id:"MF102",pattern:[1,5,1,5],tags:["flat","texture_loop","loop_safe","ostinato","percussive_layer"]},{id:"MF103",pattern:[1,1,1,1],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF104",pattern:[1,1,1,2,1],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF105",pattern:[5,5,5,5],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF106",pattern:[1,2,1,2],tags:["flat","static","drone","loop_safe","ostinato","simple"]},{id:"MF107",pattern:[3,3,3,3],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF108",pattern:[1,3,1,3],tags:["flat","static","drone","loop_safe","ostinato"]},{id:"MF109",pattern:[1,1,5,1,1,5],tags:["flat","static","loop_safe","ostinato","percussive_layer"]},{id:"MF110",pattern:[1,1,1,1,1,1],tags:["flat","static","drone","loop_safe","simple","texture_loop"]},{id:"MF111",pattern:[5,6,7,1],tags:["mysterious","ascending","dark","start","loop_safe","short"]},{id:"MF112",pattern:[1,7,6,5],tags:["mysterious","descending","dark","middle","loop_safe","short"]},{id:"MF113",pattern:[3,1,6,5],tags:["mysterious","complex","dark","tense","loop_safe","short"]},{id:"MF114",pattern:[1,2,3,2,1],tags:["playful","neighbor","bright","simple","loop_safe","short"]},{id:"MF115",pattern:[5,4,3,4,5],tags:["playful","wave","bright","upbeat","loop_safe","short"]},{id:"MF116",pattern:[1,3,5,3,1],tags:["playful","arch","bright","simple","loop_safe","short"]},{id:"MF117",pattern:[1,5,1,5],tags:["epic","leaping","bright","heroic","loop_safe","short"]},{id:"MF118",pattern:[5,6,7,1,2],tags:["epic","ascending","bright","heroic","build","short"]},{id:"MF119",pattern:[1,3,5,7,1],tags:["epic","ascending","arpeggio","heroic","bright","short"]},{id:"MF120",pattern:[6,5,4,3],tags:["mysterious","descending","scalar","dark","loop_safe","short"]},{id:"MF121",pattern:[3,5,3,1],tags:["playful","wave","bright","simple","loop_safe","short"]},{id:"MF122",pattern:[5,3,1,5],tags:["epic","leaping","arpeggio","heroic","loop_safe","short"]},{id:"MF123",pattern:[1,6,5,1],tags:["mysterious","complex","dark","cadence","loop_safe","short"]},{id:"MF124",pattern:[2,3,4,5],tags:["playful","ascending","scalar","bright","loop_safe","short"]},{id:"MF125",pattern:[1,4,7,4,1],tags:["epic","arch","leaping","heroic","bright","extended"]},{id:"MF126",pattern:[5,7,6,5,3],tags:["mysterious","complex","dark","descending","loop_safe","extended"]},{id:"MF127",pattern:[1,1,3,3,5,5],tags:["playful","sequence","ascending","bright","loop_safe","extended"]},{id:"MF128",pattern:[1,7,1,5],tags:["epic","leaping","heroic","bright","loop_safe","short"]},{id:"MF129",pattern:[3,2,1,6],tags:["mysterious","descending","dark","tense","loop_safe","short"]},{id:"MF130",pattern:[5,5,6,6,7,7,1],tags:["epic","sequence","ascending","heroic","build","extended"]},{id:"MF131",pattern:[5,4,3,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF132",pattern:[6,5,4,2],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF133",pattern:[7,5,3,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF134",pattern:[5,3,2,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF135",pattern:[6,4,3,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF136",pattern:[1,2,3,5],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF137",pattern:[1,3,5,6],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF138",pattern:[2,3,4,6],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF139",pattern:[1,2,4,5],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF140",pattern:[3,4,5,7],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF141",pattern:[7,6,5,4,3],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF142",pattern:[5,4,3,2,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF143",pattern:[6,5,4,3,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF144",pattern:[7,5,4,2,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF145",pattern:[5,4,3,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF146",pattern:[1,2,1,3,1],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF147",pattern:[5,6,5,7,5],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF148",pattern:[1,3,1,2,1],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF149",pattern:[5,7,5,6,5],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF150",pattern:[1,4,1,3,1],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF151",pattern:[1,4,6,5,7,6,4],tags:["breakbeat","tense","leaping","loop_safe","short"]},{id:"MF152",pattern:[5,3,6,4,7,5],tags:["breakbeat","tense","sequence","loop_safe","short","variation"]},{id:"MF153",pattern:[1,5,4,6,3,7,5],tags:["breakbeat","upbeat","leaping","loop_safe","extended"]},{id:"MF154",pattern:[1,1,3,2,1],tags:["lofi","peaceful","stepwise","loop_safe","short"]},{id:"MF155",pattern:[5,4,4,3,2,2],tags:["lofi","peaceful","descending","loop_safe","long"]},{id:"MF156",pattern:[1,3,2,5,4,3,1],tags:["lofi","melancholic","stepwise","loop_safe","extended"]}],ea=[{id:"MR001",length:4,pattern:[{value:4},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["start","simple","drive","loop_safe"]},{id:"MR002",length:4,pattern:[{value:8},{value:8},{value:8},{value:8},{value:4},{value:4}],tags:["middle","syncopated","drive"]},{id:"MR003",length:4,pattern:[{value:4},{value:4},{value:4},{value:4}],tags:["start","legato","simple"]},{id:"MR004",length:4,pattern:[{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4}],tags:["middle","rest_heavy","staccato"]},{id:"MR005",length:4,pattern:[{value:8},{value:8},{value:4},{value:8},{value:8},{value:4}],tags:["middle","syncopated","drive"]},{id:"MR006",length:4,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["middle","legato","rest_heavy"]},{id:"MR007",length:4,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8}],tags:["start","staccato","drive"]},{id:"MR008",length:8,pattern:[{value:8},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4}],tags:["start","bridge","legato"]},{id:"MR009",length:4,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16},{value:16}],tags:["end","legato","loop_safe","cadence"]},{id:"MR010",length:4,pattern:[{value:8},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4}],tags:["end","syncopated","staccato","loop_safe","cadence"]},{id:"MR011",length:4,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:4}],tags:["start","legato","rest_heavy","loop_safe"]},{id:"MR012",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:8},{value:8},{value:8},{value:8}],tags:["middle","staccato","drive","syncopated"]},{id:"MR013",length:4,pattern:[{value:8,rest:!0},{value:8,rest:!0},{value:4},{value:8},{value:8},{value:4}],tags:["middle","rest_heavy","simple"]},{id:"MR014",length:4,pattern:[{value:4},{value:8},{value:8},{value:16,rest:!0},{value:16},{value:4},{value:8}],tags:["middle","syncopated","drive","accented"]},{id:"MR015",length:4,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:8},{value:8}],tags:["end","legato","rest_heavy","loop_safe"]},{id:"MR016",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:16,rest:!0},{value:16,rest:!0},{value:16},{value:16},{value:4},{value:4},{value:8},{value:8},{value:4}],tags:["bridge","legato","rest_heavy"]},{id:"MR017",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4}],tags:["bridge","syncopated","drive"]},{id:"MR018",length:8,pattern:[{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4}],tags:["end","legato","loop_safe","cadence"]},{id:"MR019",length:4,pattern:[{value:4},{value:8},{value:8},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16},{value:8},{value:8}],tags:["start","drive","accented"]},{id:"MR020",length:4,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:8},{value:8}],tags:["middle","rest_heavy","simple"]},{id:"MR021",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["middle","staccato","drive","syncopated"]},{id:"MR022",length:4,pattern:[{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:4},{value:8,rest:!0},{value:8}],tags:["end","legato","loop_safe"]},{id:"MR023",length:8,pattern:[{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["bridge","syncopated","drive","accented"]},{id:"MR024",length:8,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4}],tags:["bridge","legato","rest_heavy"]},{id:"MR025",length:8,pattern:[{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8,rest:!0},{value:4},{value:4},{value:8,rest:!0},{value:8,rest:!0},{value:4},{value:4}],tags:["end","legato","loop_safe","cadence"]},{id:"MR026",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["start","texture_loop","grid16","drive","loop_safe"]},{id:"MR027",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:8},{value:8},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR028",length:4,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8}],tags:["start","middle","texture_loop","simple","loop_safe","percussive_layer"]},{id:"MR029",length:4,pattern:[{value:8},{value:16},{value:16},{value:8},{value:8},{value:16},{value:16},{value:8},{value:8},{value:8}],tags:["middle","texture_loop","loop_safe","percussive_layer"]},{id:"MR030",length:4,pattern:[{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16}],tags:["start","middle","texture_loop","loop_safe","percussive_layer"]},{id:"MR031",length:4,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR032",length:4,pattern:[{value:8},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["middle","texture_loop","loop_safe","percussive_layer","syncopated"]},{id:"MR033",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:8},{value:16},{value:16},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR034",length:8,pattern:[{value:4},{value:4},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16},{value:4},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16},{value:4},{value:4},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16}],tags:["middle","end","staccato","rest_heavy","percussive_layer","loop_safe"]},{id:"MR035",length:4,pattern:[{value:8},{value:16,rest:!0},{value:16},{value:8},{value:16,rest:!0},{value:16},{value:8},{value:16,rest:!0},{value:16},{value:8},{value:16,rest:!0},{value:16}],tags:["start","middle","staccato","rest_heavy","percussive_layer","loop_safe"]},{id:"MR036",length:4,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:16},{value:16},{value:16},{value:16}],tags:["start","middle","rest_heavy","loop_safe","simple"]},{id:"MR037",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16}],tags:["middle","end","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR038",length:8,pattern:[{value:4},{value:4},{value:4},{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4}],tags:["start","drive","syncopated"]},{id:"MR039",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["start","simple","drive"]},{id:"MR040",length:8,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8}],tags:["start","legato","rest_heavy"]},{id:"MR041",length:8,pattern:[{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4}],tags:["start","syncopated","drive"]},{id:"MR042",length:8,pattern:[{value:4},{value:4},{value:8},{value:8},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["start","simple","legato"]},{id:"MR043",length:8,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:4},{value:4},{value:16},{value:16},{value:8},{value:4},{value:4},{value:4}],tags:["start","staccato","drive"]},{id:"MR044",length:8,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["start","rest_heavy","simple"]},{id:"MR045",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["start","syncopated","accented"]},{id:"MR046",length:8,pattern:[{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["middle","drive","syncopated"]},{id:"MR047",length:8,pattern:[{value:4},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","simple","legato"]},{id:"MR048",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","staccato","drive"]},{id:"MR049",length:8,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["middle","rest_heavy","legato"]},{id:"MR050",length:8,pattern:[{value:8},{value:16},{value:16},{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["middle","syncopated","accented"]},{id:"MR051",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4}],tags:["middle","simple","drive"]},{id:"MR052",length:8,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","staccato","syncopated"]},{id:"MR053",length:8,pattern:[{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","rest_heavy","staccato"]},{id:"MR054",length:8,pattern:[{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4}],tags:["end","legato","loop_safe","cadence"]},{id:"MR055",length:8,pattern:[{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4}],tags:["end","syncopated","loop_safe","cadence"]},{id:"MR056",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["end","simple","loop_safe","cadence"]},{id:"MR057",length:8,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR058",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8}],tags:["middle","texture_loop","simple","loop_safe","percussive_layer"]},{id:"MR059",length:8,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR060",length:8,pattern:[{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16}],tags:["middle","end","texture_loop","loop_safe","percussive_layer"]},{id:"MR061",length:8,pattern:[{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR062",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16}],tags:["middle","texture_loop","grid16","syncopated","drive"]},{id:"MR063",length:4,pattern:[{value:8,accent:!0},{value:16},{value:16},{value:8},{value:16},{value:16,accent:!0},{value:8},{value:16},{value:16},{value:8,rest:!0},{value:16},{value:16}],tags:["middle","texture_loop","grid16","percussive_layer","ostinato"]},{id:"MR064",length:4,pattern:[{value:4,accent:!0},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["start","texture_loop","grid16","percussive_layer","loop_safe"]}],ta=[{id:"DP001",length_beats:4,type:"beat",pattern:"K-H-S-H-K-H-S-H-",tags:["loop_safe"]},{id:"DP002",length_beats:4,type:"beat",pattern:"H-S-H-K-H-S-H-K-",tags:["loop_safe","variation"]},{id:"DP003",length_beats:4,type:"beat",pattern:"K---S---K-H-S-H",tags:["bridge"]},{id:"DP004",length_beats:4,type:"beat",pattern:"--S---K-H-S-HK-",tags:["bridge","variation"]},{id:"DP005",length_beats:4,type:"beat",pattern:"K-H-K---S-H-K---",tags:["build"]},{id:"DP006",length_beats:4,type:"beat",pattern:"H-K---S-H-K---K-",tags:["build","variation"]},{id:"DP007",length_beats:4,type:"beat",pattern:"K---S-H-K---S-H-",tags:["straight"]},{id:"DP008",length_beats:4,type:"beat",pattern:"--S-H-K---S-H-K-",tags:["straight","variation"]},{id:"DP009",length_beats:4,type:"beat",pattern:"K-H---S-K-H---S-",tags:["syncopation"]},{id:"DP010",length_beats:4,type:"beat",pattern:"H---S-K-H---S-K-",tags:["syncopation","variation"]},{id:"DP011",length_beats:4,type:"beat",pattern:"K---H-K-S---H-K-",tags:["open"]},{id:"DP012",length_beats:4,type:"beat",pattern:"--H-K-S---H-K-K-",tags:["open","variation"]},{id:"DP013",length_beats:4,type:"beat",pattern:"K-H-K-H-S-H-K-H-",tags:["loop_safe"]},{id:"DP014",length_beats:4,type:"beat",pattern:"H-K-H-S-H-K-H-K-",tags:["loop_safe","variation"]},{id:"DP015",length_beats:4,type:"beat",pattern:"K---S---K---H---",tags:["simple"]},{id:"DP016",length_beats:4,type:"beat",pattern:"--S---K---H---K-",tags:["simple","variation"]},{id:"DP017",length_beats:4,type:"beat",pattern:"K-H---K-S-H---K-",tags:["bridge"]},{id:"DP018",length_beats:4,type:"beat",pattern:"H---K-S-H---K-K-",tags:["bridge","variation"]},{id:"DP019",length_beats:4,type:"beat",pattern:"K--H-K--S-H-K--",tags:["swing_hint"]},{id:"DP020",length_beats:4,type:"beat",pattern:"-H-K--S-H-K--K-",tags:["swing_hint","variation"]},{id:"DP021",length_beats:4,type:"fill",pattern:"S-S-S-S-S-S-O---",tags:["cadence"]},{id:"DP022",length_beats:4,type:"fill",pattern:"S-S-S-S-O---S-S-",tags:["cadence","variation"]},{id:"DP023",length_beats:8,type:"fill",pattern:"S-S-S-S-S-S-O---S-S-S-S-S-S-O---",tags:["cadence","extended"]},{id:"DP024",length_beats:4,type:"fill",pattern:"KSKO-KSKO-KSKO-K",tags:["build"]},{id:"DP025",length_beats:4,type:"fill",pattern:"-KSKO-KSKO-KKSKO",tags:["build","variation"]},{id:"DP026",length_beats:8,type:"fill",pattern:"KSKO-KSKO-KSKO-KKSKO-KSKO-KSKO-K",tags:["build","extended"]},{id:"DP027",length_beats:4,type:"fill",pattern:"S-HS-HS-HS-HS-HS",tags:["bridge"]},{id:"DP028",length_beats:4,type:"fill",pattern:"-HS-HS-HS-HSS-HS",tags:["bridge","variation"]},{id:"DP029",length_beats:8,type:"fill",pattern:"S-HS-HS-HS-HS-HSS-HS-HS-HS-HS-HS",tags:["bridge","extended"]},{id:"DP030",length_beats:4,type:"fill",pattern:"K-SK-SK-SK-SK-SK",tags:["build"]},{id:"DP031",length_beats:4,type:"fill",pattern:"-SK-SK-SK-SKK-SK",tags:["build","variation"]},{id:"DP032",length_beats:8,type:"fill",pattern:"K-SK-SK-SK-SK-SKK-SK-SK-SK-SK-SK",tags:["build","extended"]},{id:"DP033",length_beats:4,type:"fill",pattern:"S--S-HHS--S-HHS-",tags:["break"]},{id:"DP034",length_beats:4,type:"fill",pattern:"-HHS--S-HHS-S--S",tags:["break","variation"]},{id:"DP035",length_beats:8,type:"fill",pattern:"S--S-HHS--S-HHS-S--S-HHS--S-HHS-",tags:["break","extended"]},{id:"DP036",length_beats:4,type:"fill",pattern:"K-K-K-K-S-S-S-S-",tags:["cadence"]},{id:"DP037",length_beats:4,type:"fill",pattern:"K-K-S-S-S-S-K-K-",tags:["cadence","variation"]},{id:"DP038",length_beats:8,type:"fill",pattern:"K-K-K-K-S-S-S-S-K-K-K-K-S-S-S-S-",tags:["cadence","extended"]},{id:"DP039",length_beats:4,type:"fill",pattern:"S-S-H-H-S-S-H-H-",tags:["bridge"]},{id:"DP040",length_beats:4,type:"fill",pattern:"H-H-S-S-H-H-S-S-",tags:["bridge","variation"]},{id:"DP041",length_beats:8,type:"fill",pattern:"S-S-H-H-S-S-H-H-S-S-H-H-S-S-H-H-",tags:["bridge","extended"]},{id:"DP042",length_beats:4,type:"fill",pattern:"KSTK-KSTK-KSTK-K",tags:["toms"]},{id:"DP043",length_beats:4,type:"fill",pattern:"-KSTK-KSTK-KKSTK",tags:["toms","variation"]},{id:"DP044",length_beats:8,type:"fill",pattern:"KSTK-KSTK-KSTK-KKSTK-KSTK-KSTK-K",tags:["toms","extended"]},{id:"DP045",length_beats:4,type:"fill",pattern:"S--S--S--S--S--S",tags:["loop_safe"]},{id:"DP046",length_beats:4,type:"fill",pattern:"--S--S--S--SS--S",tags:["loop_safe","variation"]},{id:"DP047",length_beats:8,type:"fill",pattern:"S--S--S--S--S--SS--S--S--S--S--S",tags:["loop_safe","extended"]},{id:"DP048",length_beats:4,type:"fill",pattern:"K-S-H-K-S-H-K-S-",tags:["bridge"]},{id:"DP049",length_beats:4,type:"fill",pattern:"H-K-S-H-K-S-K-S-",tags:["bridge","variation"]},{id:"DP050",length_beats:8,type:"fill",pattern:"K-S-H-K-S-H-K-S-K-S-H-K-S-H-K-S-",tags:["bridge","extended"]},{id:"DP051",length_beats:4,type:"beat",pattern:"K-H-K-H-K-H-K-H-",tags:["loop_safe","four_on_floor","straight","percussive_layer","texture_loop"]},{id:"DP052",length_beats:4,type:"beat",pattern:"K-HO-K-H-K-O-K-H-",tags:["loop_safe","four_on_floor","straight","variation","percussive_layer"]},{id:"DP053",length_beats:4,type:"beat",pattern:"K-HH-K-HH-K-HH-K-HH",tags:["loop_safe","grid16","texture_loop","percussive_layer"]},{id:"DP054",length_beats:4,type:"beat",pattern:"K--S--K-K--S--K-",tags:["rock","drive","loop_safe"]},{id:"DP055",length_beats:4,type:"beat",pattern:"K-K-S---K-K-S-K-",tags:["dance","syncopation","loop_safe"]},{id:"DP056",length_beats:4,type:"beat",pattern:"K-----S-K-----S-",tags:["ballad","simple","loop_safe"]},{id:"DP057",length_beats:4,type:"beat",pattern:"K-H-S-K-K-H-S-H-",tags:["rock","energetic","loop_safe","variation"]},{id:"DP058",length_beats:4,type:"beat",pattern:"K-S-K-S-K-S-K-S-",tags:["dance","four_on_floor","loop_safe"]},{id:"DP059",length_beats:4,type:"beat",pattern:"K---S-K-K---S---",tags:["syncopation","upbeat","loop_safe"]},{id:"DP060",length_beats:4,type:"beat",pattern:"K-H-S-H-K---S-H-",tags:["rock","variation","loop_safe"]},{id:"DP061",length_beats:4,type:"beat",pattern:"K-K---S-K-K-S---",tags:["dance","syncopation","tense","loop_safe"]},{id:"DP062",length_beats:4,type:"beat",pattern:"K-H-S---K-H-S-K-",tags:["rock","drive","loop_safe","variation"]},{id:"DP063",length_beats:4,type:"beat",pattern:"K-----S---K-S---",tags:["ballad","peaceful","simple","loop_safe"]},{id:"DP064",length_beats:4,type:"beat",pattern:"K-K-S-K-K-K-S-K-",tags:["dance","energetic","drive","loop_safe"]},{id:"DP065",length_beats:4,type:"beat",pattern:"K-H-S-K---H-S-H-",tags:["syncopation","rock","variation","loop_safe"]},{id:"DP066",length_beats:4,type:"beat",pattern:"K---S---K-K-S-K-",tags:["dance","syncopation","build","loop_safe"]},{id:"DP067",length_beats:4,type:"beat",pattern:"K-H-S-H-K-H-S---",tags:["rock","cadence","loop_safe"]},{id:"DP068",length_beats:4,type:"beat",pattern:"K-K-K-K-S-S-S-S-",tags:["experimental","build","tense","loop_safe"]},{id:"DP069",length_beats:4,type:"beat",pattern:"K-HO-K-HO-K-HO-K-HO",tags:["loop_safe","four_on_floor","texture_loop","percussive_layer","variation"]},{id:"DP070",length_beats:4,type:"beat",pattern:"K-HS-K-HK-HS-K-HK-HS",tags:["loop_safe","four_on_floor","grid16","percussive_layer","texture_loop"]},{id:"DP071",length_beats:4,type:"beat",pattern:"K-H-K-S-K-H-O-S-",tags:["loop_safe","four_on_floor","syncopation","percussive_layer","variation"]},{id:"DP072",length_beats:4,type:"beat",pattern:"K-HH-K-S-K-HH-K-S",tags:["loop_safe","four_on_floor","grid16","percussive_layer","build"]},{id:"DP073",length_beats:4,type:"beat",pattern:"KH-HSHKHOHSHKHSH",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP074",length_beats:4,type:"beat",pattern:"KH-HSH-KHSOHK-SH",tags:["loop_safe","grid16","syncopation","breakbeat","variation","percussive_layer"]},{id:"DP075",length_beats:4,type:"fill",pattern:"KHSHKHSHKTSHKHSH",tags:["break","breakbeat","drum_fill","grid16","syncopation"]},{id:"DP076",length_beats:4,type:"beat",pattern:"K--H-K--S-H--H--",tags:["loop_safe","swing_hint","simple","rest_heavy","lofi"]},{id:"DP077",length_beats:4,type:"beat",pattern:"K-H--K-HS--H--H-",tags:["loop_safe","swing_hint","rest_heavy","lofi","variation"]},{id:"DP078",length_beats:4,type:"beat",pattern:"K-HS-K-HSK-H-SH-",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP079",length_beats:4,type:"beat",pattern:"K-HO-KS-HK-S-HO-",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer","variation"]},{id:"DP080",length_beats:4,type:"fill",pattern:"KHSHKHSKTSHKHSS-",tags:["break","breakbeat","drum_fill","grid16","syncopation"]},{id:"DP081",length_beats:4,type:"beat",pattern:"K---H---S-H-----",tags:["loop_safe","swing_hint","rest_heavy","lofi"]},{id:"DP082",length_beats:4,type:"beat",pattern:"K--H---HS--H-K--",tags:["loop_safe","swing_hint","rest_heavy","lofi","variation"]},{id:"DP083",length_beats:4,type:"fill",pattern:"N---S---N---H---",tags:["lofi","drum_fill","rest_heavy","transition"]},{id:"DP084",length_beats:4,type:"beat",pattern:"KHHH-HSHKH-HSHK-",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP085",length_beats:4,type:"beat",pattern:"KH-HKHSH-HSHKHSO",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer","variation"]},{id:"DP086",length_beats:4,type:"beat",pattern:"K-HHKSH-HK-SHH-H",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP087",length_beats:4,type:"beat",pattern:"KHHSHK-HSHK-SHOH",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer","variation"]},{id:"DP088",length_beats:4,type:"fill",pattern:"KHSHSHKTSHSHKSH-",tags:["break","breakbeat","drum_fill","grid16","syncopation"]},{id:"DP089",length_beats:4,type:"fill",pattern:"KHSKHSKTSHSKHSKO",tags:["break","breakbeat","drum_fill","grid16","syncopation","variation"]}],aa=[{id:"BP_STEADY_ROOT_DRIVE",texture:"steady",steps:["root","root","fifth","root","fifth","root","fifth","approach"],tags:["default","loop_safe"]},{id:"BP_STEADY_UPWARD_WALK",texture:"steady",steps:["root","fifth","root","octave","fifth","root","octave","approach"],tags:["variation","section_end"]},{id:"BP_BROKEN_TRIAD_LIFT",texture:"broken",steps:["root","fifth","root","octave","root","fifth","root","approach"],tags:["default"]},{id:"BP_BROKEN_PICKUP_DROP",texture:"broken",steps:["root","octave","fifth","octaveHigh","root","fifth","octave","approach"],tags:["variation","pickup","section_end"]},{id:"BP_BREAK_OFFBEAT_DRIVE",texture:"broken",steps:["root","rest","octave","rest","fifth","approach","lowFifth","approach"],tags:["loop_safe","syncopated","breakbeat","variation","default"]},{id:"BP_BREAK_GHOST_RIDE",texture:"broken",steps:["root","octave","rest","fifth","rest","octave","lowFifth","approach"],tags:["loop_safe","breakbeat","syncopated","drive","default"]},{id:"BP_BREAK_SLIDE_UP",texture:"broken",steps:["root","approach","fifth","rest","root","octave","rest","approach"],tags:["loop_safe","breakbeat","variation"]},{id:"BP_LOFI_SWUNG_ROOT",texture:"steady",steps:["root","rest","rest","root","rest","fifth","rest","approach"],tags:["loop_safe","rest_heavy","swing_hint","lofi"]},{id:"BP_LOFI_DUSTY_STEP",texture:"steady",steps:["root","rest","rest","fifth","rest","rest","root","approach"],tags:["loop_safe","lofi","rest_heavy","swing_hint"]},{id:"BP_LOFI_WALKDOWN",texture:"steady",steps:["root","rest","third","rest","second","rest","root","approach"],tags:["loop_safe","lofi","rest_heavy","variation"]},{id:"BP_ARPEGGIO_GLIDE",texture:"arpeggio",steps:["root","octave","fifth","octaveHigh","root","fifth","octave","approach"],tags:["default","loop_safe"]},{id:"BP_ARPEGGIO_PULSE",texture:"arpeggio",steps:["root","fifth","octave","octaveHigh","root","fifth","octave","approach"],tags:["variation","transition","section_end"]},{id:"BP_STEADY_OFFBEAT_PUSH",texture:"steady",steps:["root","fifth","root","approach","fifth","root","octave","approach"],tags:["variation","syncopated","loop_safe"]},{id:"BP_BROKEN_LOW_SWING",texture:"broken",steps:["root","lowFifth","root","fifth","root","lowFifth","root","approach"],tags:["variation","loop_safe"]},{id:"BP_ARPEGGIO_SPREAD",texture:"arpeggio",steps:["root","octave","fifth","octaveHigh","fifth","octave","octaveHigh","approach"],tags:["variation","loop_safe"]},{id:"BP_STEADY_SUB_GRID",texture:"steady",steps:["root","root","root","root","root","root","root","root"],tags:["loop_safe","percussive_layer","four_on_floor","static"]},{id:"BP_STEADY_SUB_OFFSET",texture:"steady",steps:["root","root","root","fifth","root","root","root","approach"],tags:["loop_safe","percussive_layer","variation"]},{id:"BP_FOUR_ON_FLOOR_CLASSIC",texture:"steady",steps:["root","root","root","root","root","fifth","root","root"],tags:["loop_safe","four_on_floor","percussive_layer","static","drone"]},{id:"BP_FOUR_ON_FLOOR_GHOST",texture:"steady",steps:["root","root","fifth","root","root","root","fifth","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_FOUR_ON_FLOOR_OFFBEAT",texture:"steady",steps:["root","fifth","root","root","root","fifth","root","root"],tags:["loop_safe","four_on_floor","percussive_layer","syncopated"]},{id:"BP_FOUR_ON_FLOOR_OCTAVE_HIT",texture:"steady",steps:["root","root","root","octave","root","root","root","octave"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_FOUR_ON_FLOOR_ROLLING",texture:"steady",steps:["root","root","root","fifth","root","root","root","fifth"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_DRONE_STATIC_ROOT",texture:"steady",steps:["root","root","root","root","root","fifth","root","approach"],tags:["loop_safe","static","drone","four_on_floor","percussive_layer"]},{id:"BP_DRONE_LOW_PULSE",texture:"steady",steps:["root","lowFifth","root","lowFifth","root","lowFifth","root","lowFifth"],tags:["loop_safe","drone","percussive_layer"]},{id:"BP_DRONE_ACCENT_SPARK",texture:"steady",steps:["root","rest","octave","root","rest","fifth","root","approach"],tags:["loop_safe","drone","accent"]},{id:"BP_TECHNO_BOUNCE",texture:"broken",steps:["root","root","octave","root","root","root","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_TECHNO_SUB_EMPHASIS",texture:"steady",steps:["root","root","root","lowFifth","root","root","root","lowFifth"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_MINIMAL_BREATH",texture:"steady",steps:["root","root","root","root","fifth","root","root","root"],tags:["loop_safe","four_on_floor","percussive_layer","static"]},{id:"BP_WALKING_BASS",texture:"broken",steps:["root","second","third","fifth","root","seventh","octave","approach"],tags:["variation","walking","jazz_hint"]},{id:"BP_OCTAVE_JUMP",texture:"broken",steps:["root","octave","root","octave","fifth","octaveHigh","fifth","approach"],tags:["variation","energetic","jump"]},{id:"BP_CHROMATIC_WALK",texture:"broken",steps:["root","flatSecond","second","third","fifth","sixth","seventh","approach"],tags:["variation","chromatic","tense"]},{id:"BP_SYNCOPATED_GROOVE",texture:"broken",steps:["root","fifth","octave","root","fifth","octave","fifth","approach"],tags:["variation","syncopation","groove"]},{id:"BP_PEDAL_FIFTH",texture:"steady",steps:["root","fifth","root","fifth","root","fifth","root","fifth"],tags:["loop_safe","simple","rock"]},{id:"BP_ARPEGGIO_CASCADE",texture:"arpeggio",steps:["root","third","fifth","octave","fifth","third","root","approach"],tags:["variation","cascade","bright"]},{id:"BP_BOUNCY_RHYTHM",texture:"broken",steps:["root","root","fifth","fifth","octave","octave","fifth","approach"],tags:["variation","playful","bounce"]},{id:"BP_BROKEN_SYNCO_JUMP",texture:"broken",steps:["root","rest","octave","root","fifth","rest","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer","syncopated","default"]},{id:"BP_BROKEN_GRID_PULSE",texture:"broken",steps:["root","root","rest","root","octave","root","rest","root"],tags:["loop_safe","four_on_floor","percussive_layer","grid16"]},{id:"BP_BROKEN_TEXTURE_WAVE",texture:"broken",steps:["root","octave","fifth","root","root","octave","fifth","approach"],tags:["loop_safe","four_on_floor","percussive_layer","texture_loop"]},{id:"BP_BROKEN_DOUBLE_HIT",texture:"broken",steps:["root","root","octave","octave","fifth","fifth","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_BROKEN_OFFBEAT_DRIVE",texture:"broken",steps:["rest","root","rest","octave","rest","fifth","rest","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_BROKEN_SUB_BOUNCE",texture:"broken",steps:["root","lowFifth","octave","root","root","lowFifth","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer","static"]},{id:"BP_BROKEN_LIFT_DROP",texture:"broken",steps:["root","fifth","octave","octaveHigh","fifth","root","octave","approach"],tags:["loop_safe","four_on_floor","percussive_layer","variation"]},{id:"BP_BROKEN_STEADY_GRID",texture:"broken",steps:["root","root","root","octave","root","root","root","octave"],tags:["loop_safe","four_on_floor","percussive_layer","default"]}],sa={patterns:aa},ra=[{id:"TR_SECTION_NOISE_SWELL",pattern:"N---N---N---NNS-",length_beats:4,tags:["transition","section_end","noise_fx"],channel:"noise"},{id:"TR_SECTION_SNARE_RUSH",pattern:"--S-S-S-S-S-S-S-",length_beats:4,tags:["transition","section_end","drum_fill"],channel:"noise"},{id:"TR_LOOP_TIGHTENER",pattern:"K-HS-HK-HS-HK-H-",length_beats:4,tags:["transition","loop_out","drum_fill"],channel:"noise"},{id:"TR_SECTION_GHOST_ECHO",pattern:"N---S---N---S---",length_beats:4,tags:["transition","section_end","loop_out","noise_fx"],channel:"noise"},{id:"TR_BUILD_STUTTER_FILL",pattern:"K-SK-SK-SK-SK-S-",length_beats:4,tags:["transition","build","drum_fill"],channel:"noise"},{id:"TR_BREAKBEAT_SNARE_CHOP",pattern:"S--S-HS-S-HS-S--",length_beats:4,tags:["transition","section_end","break","breakbeat","drum_fill"],channel:"noise"},{id:"TR_LOFI_TAPE_SWELL",pattern:"N---H---S---H---",length_beats:4,tags:["transition","section_end","lofi","noise_fx","rest_heavy"],channel:"noise"}],na={transitions:ra},oa=Qt,ia=Zt,la=ea,ua=ta,da=sa,ca=na,Je=oa,Z=ia,De=new Map(Z.map(t=>[t.id,t])),Qe=la,Ce=new Map(Qe.map(t=>[t.id,t])),ee=ua,pa=new Map(ee.map(t=>[t.id,t])),ga=da.patterns??[],we=ga.reduce((t,e)=>{const a=t.get(e.texture)??[];return a.push(e),t.set(e.texture,a),t},new Map),de=ca.transitions??[],fe=["root","root","fifth","root","fifth","root","fifth","approach"],ha={id:"BP_FALLBACK_STEADY",texture:"steady",steps:fe,tags:["fallback"]},va={upbeat:["straight","syncopation"],sad:["straight","simple"],tense:["syncopation","accented"],peaceful:["straight","open"]},fa={upbeat:["bright","ascending"],sad:["dark","descending"],tense:["dark","complex","leaping"],peaceful:["simple","arch","bright"]},ma={upbeat:["syncopated","drive"],sad:["legato","rest_heavy"],tense:["syncopated","staccato"],peaceful:["legato","simple"]},z=new Map(Je.map(t=>[t.id,t])),ya={dualBass:{preferBeatTags:["percussive_layer","syncopation"],preferFillTags:["drum_fill","build"]},bassLed:{preferBeatTags:["four_on_floor","drive"],preferFillTags:["build"],earlySparseMeasures:1},layeredBass:{preferBeatTags:["four_on_floor","loop_safe"],preferFillTags:["drum_fill"]},minimal:{preferBeatTags:["simple","open"],preferFillTags:["noise_fx"],avoidTags:["build","drive"],earlySparseMeasures:2},breakLayered:{preferBeatTags:["breakbeat","percussive_layer","grid16"],preferFillTags:["break","drum_fill","breakbeat"],avoidTags:["four_on_floor"]},lofiPadLead:{preferBeatTags:["lofi","rest_heavy","swing_hint"],preferFillTags:["noise_fx","lofi"],avoidTags:["breakbeat"],earlySparseMeasures:2},retroPulse:{preferBeatTags:["loop_safe","grid16","syncopation"],preferFillTags:["build","transition"],avoidTags:["rest_heavy"]}},_a={dualBass:{density:.85,velocityScale:.9,offbeatAccentBoost:3},bassLed:{density:.6,sustainWholeMeasure:!1,offbeatAccentBoost:5},layeredBass:{density:.75,velocityScale:.95},minimal:{density:.5,sustainWholeMeasure:!0,velocityScale:.8},breakLayered:{density:.95,velocityScale:1.05,offbeatAccentBoost:6},lofiPadLead:{density:.55,sustainWholeMeasure:!0,velocityScale:.7},retroPulse:{density:.78,velocityScale:.95,offbeatAccentBoost:2}};function b(t,e,a=.4){if(!e.length)return t;const s=t.filter(r=>{const n=r.tags??[];return e.some(o=>n.includes(o))});return s.length===0||t.length>=4&&s.length<t.length*a?t:s}function Le(t,e){const a=[...t];for(let s=a.length-1;s>0;s--){const r=Math.floor(e()*(s+1)),n=a[s];a[s]=a[r],a[r]=n}return a}function Ze(t,e,a,s=.6){if(!e.length||t.length<=1)return t;const r=t.filter(p=>{const d=p.tags??[];return e.some(g=>d.includes(g))});if(!r.length||r.length===t.length)return t;const n=t.filter(p=>!r.includes(p)),o=Le(r,a),i=Le(n,a),l=Math.min(o.length,Math.max(1,Math.ceil(t.length*s))),u=o.slice(0,l),c=[...o.slice(l),...i];return[...u,...c]}const X=1337;function ie(t){let e=(t??X)>>>0;return e===0&&(e=X),()=>(e=e*1664525+1013904223>>>0,e/4294967295)}function O(t,e,a){if(!t.length)throw new Error("No candidates available for selection");if(t.length===1)return t[0];let s=t[Math.floor(e()*t.length)];if(a&&t.length>1){let r=0;for(;(s==null?void 0:s.id)===a&&r<3;)s=t[Math.floor(e()*t.length)],r++}return s}function k(t,e){return e.length?e.every(a=>t.tags.includes(a)):!0}function Ma(t){return Math.abs(t%1)<1e-6}function ba(t,e){return e.find(a=>t>=a.startBeat&&t<a.startBeat+a.durationBeats)}function et(t,e){return t===0?"start":t===e-1?"end":"middle"}function Sa(t){try{return nt(t),!0}catch{return!1}}function tt(t,e,a,s,r,n,o){var i;const l=Je.filter(Sa),u=va[t.mood]??[],c=(f,v)=>f.filter(m=>v.some(y=>m.tags.includes(y))),p=l.filter(f=>k(f,r));let d=l.filter(f=>f.tags.includes(a));const g=c(d,u);if(g.length)d=g;else{const f=c(l,u);f.length&&(d=f)}if(e.loopCentric&&(d=b(d,["loop_safe","texture_loop"])),e.textureFocus&&(d=b(d,["texture_loop","straight","simple","grid16"])),e.percussiveLayering&&(d=b(d,["grid16","percussive_layer"])),e.syncopationBias&&(d=b(d,["syncopation"])),d.length||(d=l),r.length){const f=d.filter(v=>k(v,r));f.length?d=f:p.length&&(d=p)}if((i=s==null?void 0:s.variations)!=null&&i.length){const f=s.variations.map(v=>z.get(v)).filter(v=>!!v);if(f.length&&n()<.5){const v=T(f,o);return O(v,n,s.id)}}const h=T(d,o);return O(h,n,s==null?void 0:s.id)}function Ra(t,e,a,s,r,n){const o=fa[t.mood]??[];let i=Z.filter(u=>o.some(c=>u.tags.includes(c)));if(a.length){const u=i.filter(c=>k(c,a));if(u.length)i=u;else{const c=Z.filter(p=>k(p,a));c.length&&(i=c)}}i.length||(i=Z),e.textureFocus&&(i=b(i,["texture_loop","ostinato","loop_safe","short","static"])),e.harmonicStatic&&(i=Ze(i,["scalar","stepwise","static"],s,.6)),e.gradualBuild&&(i=b(i,["ascending"]));const l=T(i,n);return O(l,s,r==null?void 0:r.id)}function xa(t,e,a,s,r,n,o,i){const l=ma[t.mood]??[];let u=Qe.filter(g=>Math.abs(g.length-s)<1e-6);if(!u.length)throw new Error(`No melody rhythm motifs of length ${s}`);let c=u.filter(g=>g.tags.includes(a));c.length||(c=u);let p=c.filter(g=>l.some(h=>g.tags.includes(h)));if(p.length||(p=c),e.loopCentric&&(p=b(p,["loop_safe","texture_loop"])),e.textureFocus&&(p=b(p,["texture_loop","grid16","simple"])),e.syncopationBias&&(p=b(p,["syncopated","drive"])),r.length){const g=p.filter(h=>k(h,r));g.length&&(p=g)}p=wa(p,s);const d=T(p,i);return O(d,n,o)}function Pa(t,e,a,s,r){let n={broken:90,steady:86,arpeggio:92}[t.texture]??88;const o=e===0?6:0,i=t.measures-e<=1?4:0;if(r.textureFocus&&(n-=8),r.gradualBuild){const l=s>1?a/Math.max(1,s-1):0,u=Math.min(1,Math.max(0,l)),c=s<=16?.6:s<=32?.75:.9,p=Math.pow(u,c),d=s<=16?14:s<=32?18:20,g=Math.floor(p*d);n+=g}return r.loopCentric&&(n=Math.max(60,n-2)),Math.min(110,Math.max(58,n+o+i))}function Ba(t,e,a,s,r){const n={upbeat:0,peaceful:-3,tense:-5,sad:-2},o={slow:-2,medium:0,fast:2},i={minimalTechno:-4,progressiveHouse:3,retroLoopwave:2,breakbeatJungle:-2,lofiChillhop:-5},l=(s.textureFocus?2:0)+(s.gradualBuild?1:0)+(s.loopCentric?-1:0)+(s.atmosPad?2:0)+(s.percussiveLayering?-2:0),u=n[t]??0,c=o[e]??0,p=a?i[a]??0:0,d=ie(r),g=Math.floor(d()*7)-3,h=72+u+c+p+l+g;return Math.max(63,Math.min(78,h))}function Ka(t,e,a,s,r,n){if(!t)return n;const o={steady:0,broken:-3,arpeggio:4},i=Math.max(0,e);let l=o[t.texture]??0;if(r.textureFocus&&(l-=4),r.filterMotion&&(l+=1),re(t)&&i===0&&(l+=3),F(t)&&i===0&&(l-=2),r.gradualBuild){const g=a/Math.max(1,s-1),h=Math.round(Math.pow(g,.7)*8);l+=h}(t.measures>0?i/t.measures:0)>=.75&&(l-=2);const u=Math.min(t.occurrenceIndex-1,2)*2;l-=u,r.atmosPad&&(l-=1);const c=60,p=84,d=n+l;return Math.max(c,Math.min(p,d))}function Ha(t,e,a,s){if(e<=0)return;const r=e-.25;if(r<0)return;const n=a.pattern,o=n[n.length-1]??n[0]??1;t.push({channelRole:"melody",startBeat:r,durationBeats:.25,degree:o,velocity:Jt.PICKUP_BASE,sectionId:s})}function Ea(t,e,a,s){if(!e.length)return t;const r=[e[e.length-1]],n=r[0]+(a.textureFocus?2:1),o=r[0]-(a.loopCentric?1:2),i=new Set([t,r[0],n,o]),l=Array.from(i);return l[Math.floor(s()*l.length)]}function Ge(t,e,a,s,r){const n=t.variations??[];if(!n.length)return;const o=n.map(l=>z.get(l)).filter(l=>!!l).filter(l=>l.tags.includes(e)&&k(l,a));if(!o.length)return;const i=T(o,r);return O(i,s,t.id)}function Ia(t,e,a,s,r){var n;const o=(n=r.steps)!=null&&n.length?r.steps:fe,i=[],l=ne(a,40),u=s??a;for(let c=0;c<o.length;c++){const p=e+c*.5,d=rt(o[c],a,u,l);d!==null&&i.push({channelRole:"bass",startBeat:p,durationBeats:.5,degree:0,velocity:st(t,c),sectionId:t.id,midiOverride:d})}return i}function at(t,e,a,s,r,n,o){const i=(o==null?void 0:o.enforceDroneStatic)??!0,l=(o==null?void 0:o.preferredTags)??[],u=e===t.measures-1,c=r.get(t.id);if(c){if(u&&!(c.tags??[]).includes("section_end")){const g=L(t.texture,n,a,s,["section_end"],c.id);if(g)return s.add(g.id),g}return c}if(n.harmonicStatic){if(!i&&l.length){const h=L(t.texture,n,a,s,l,void 0);if(h)return r.set(t.id,h),s.add(h.id),h}const g=L(t.texture,n,a,s,["drone","static"],void 0);if(g&&i)return r.set(t.id,g),s.add(g.id),g}const p=re(t)?["pickup"]:[],d=L(t.texture,n,a,s,p,void 0)??L(t.texture,n,a,s,[],void 0)??ha;if(r.set(t.id,d),s.add(d.id),u&&!(d.tags??[]).includes("section_end")){const g=L(t.texture,n,a,s,["section_end"],d.id);if(g)return s.add(g.id),g}return d}function L(t,e,a,s,r,n){let o=we.get(t)??[];if(!o.length&&t!=="steady"&&(o=we.get("steady")??[]),!o.length)return;if((e.loopCentric||e.harmonicStatic)&&(o=b(o,["loop_safe"])),e.syncopationBias&&(o=b(o,["syncopated"])),e.textureFocus&&(o=b(o,["default"])),e.percussiveLayering&&(o=b(o,["percussive_layer","four_on_floor"])),e.percussiveLayering&&e.syncopationBias&&e.breakInsertion&&(o=b(o,["breakbeat","variation"],.2)),e.atmosPad&&e.loopCentric&&(o=b(o,["lofi","rest_heavy"],.25)),e.harmonicStatic&&(o=Ze(o,["drone","static"],a,.65)),r.length){const l=o.filter(u=>r.every(c=>(u.tags??[]).includes(c)));l.length&&(o=l)}if(!o.length)return;const i=T(o,s);return O(i,a,n)}function Aa(t,e){const a=[];for(const s of e){let r=s.startBeat,n=0;const o=4;for(;n<o&&t.some(i=>Math.abs(i.startBeat-r)<.0625);)n++,r=s.startBeat+n*.0625;a.push({...s,startBeat:r})}return a}function Fa(t,e,a,s,r,n,o,i,l){if(!de.length)return;const u=["transition","section_end"];a&&u.push("loop_out");let c=de.filter(m=>m.length_beats<=_);c.length||(c=de);const p=l>1?i/Math.max(1,l-1):0,d=[];if(o.gradualBuild&&(p<.4?d.push("build"):p<.8?d.push("drum_fill"):d.push("loop_out")),o.breakInsertion&&p>=.5&&d.push("noise_fx"),o.percussiveLayering&&d.push("drum_fill"),d.length&&(c=b(c,d,.2)),u.length){const m=c.filter(y=>k(y,u));m.length&&(c=m)}if(!c.length)return;const g=T(c,n),h=O(g,s,r);if(!h)return;const f=h.length_beats>=_?e:e+Math.max(0,_-h.length_beats),v=Xe(h.pattern,f,t.id);return{motifId:h.id,hits:v}}function st(t,e){const a=Oe[t.texture]??Oe.default;return e===0?a+ke.DOWNBEAT_BOOST:e%4===0?a+ke.STRONG_BEAT_BOOST:a}function rt(t,e,a,s){switch(t){case"root":return B(s,e);case"fifth":return B(s+7,e);case"lowFifth":return B(s-5,e);case"octave":return B(s+12,e);case"octaveHigh":return B(s+19,e);case"approach":{const r=ne(a,s+5);return B(r-1,a)}case"rest":return null;default:return B(s,e)}}function nt(t){const e=t.pattern.map(s=>({durationBeats:ye(s)})),a=e.reduce((s,r)=>s+r.durationBeats,0);if(Math.abs(a-t.length)>1e-6)throw new Error(`Rhythm motif ${t.id} length mismatch. expected=${t.length}, got=${a}`);return e}function Oa(t,e,a){if(t==="steady"){const s=[1,5];return s[Math.floor(a/2)%s.length]}else{const s=[1,3,5,7];return s[e%s.length]}}function ka(t,e){return 58+(t==="start"&&e===0?6:0)}function Ta(t,e,a,s,r,n,o){const i=[],l=nt(a);let u=0,c=0;const p=_a[n];for(let d=0;d<l.length;d++){const g=l[d];if(u>=_)break;const h=_-u,f=Math.min(g.durationBeats,h),v=Oa(t.texture,c,u),m=u%1>1e-6;let y=ka(r,u);if(p!=null&&p.velocityScale&&(y=Math.round(y*p.velocityScale)),m&&p!=null&&p.offbeatAccentBoost&&(y+=p.offbeatAccentBoost),(p==null?void 0:p.density)!==void 0&&p.density<1){const M=Math.max(0,Math.min(1,p.density));if(o()>M){u+=f,c++;continue}}if(i.push({channelRole:"accompaniment",startBeat:e+u,durationBeats:f,degree:v,velocity:y,sectionId:t.id}),u+=f,c++,u>=_)break}if(r==="start"&&re(t)&&s.pattern.length&&e>=.5&&!((p==null?void 0:p.density)!==void 0&&p.density<.5)){const d=s.pattern[0];i.push({channelRole:"accompaniment",startBeat:Math.max(0,e-.5),durationBeats:.5,degree:d,velocity:I.EARLY_START,sectionId:t.id})}if(p!=null&&p.sustainWholeMeasure&&i.length){const d=i[0].degree,g=Math.max(I.PAD_MIN,Math.round(i.reduce((h,f)=>h+f.velocity,0)/i.length));return[{channelRole:"accompaniment",startBeat:e,durationBeats:_,degree:d,velocity:g,sectionId:t.id}]}return i}function Da(t){const e=t.pattern.map(s=>({durationBeats:ye(s.value),rest:!!s.rest,accent:s.accent})),a=e.reduce((s,r)=>s+r.durationBeats,0);if(Math.abs(a-t.length)>1e-6)throw new Error(`Melody rhythm motif ${t.id} length mismatch. expected=${t.length}, got=${a}`);return e}function Ca(t,e){const a=t.pattern??[];if(!a.length)return!1;const s=e>=4?.25:0;let r=0,n=!1,o=0;for(const i of a){const l=ye(i.value);if(i.rest){r+=l,o=0;continue}if(l>=.5){n=!0,o=0;continue}if(o+=l,o>1+1e-6)return!1}return r>=s?!0:n}function wa(t,e){const a=t.filter(s=>Ca(s,e));return a.length?a:t}function me(t,e,a){t.has(e)||t.set(e,new Map);const s=t.get(e);return s.has(a)||s.set(a,{}),s.get(a)}function La(t,e,a,s){const r=t.get(e);if(!(!r||r.size===0))return r.get(1)}function Ga(t,e,a,s){t.has(e)||t.set(e,new Map);const r=t.get(e);a===1&&r.set(a,s)}function Na(t,e){const a=ie(t.seed),s=t.seed??Date.now(),r=Ba(t.mood,t.tempo,t.stylePreset,e.styleIntent,s);return{rng:a,compositionBaseRegister:r,sectionById:new Map(e.sections.map(n=>[n.id,n])),styleIntent:e.styleIntent,voiceArrangement:e.voiceArrangement,totalMeasures:t.lengthInMeasures,usedMotifs:{rhythms:new Set,melodies:new Set,drums:new Set,melodyRhythms:new Set,bassPatterns:new Set,transitions:new Set},caches:{template:new Map,hook:new Map,bassPattern:new Map},lastMotifs:{},motifUsage:{rhythm:{},melody:{},drums:{},melodyRhythm:{},bass:{},transitions:{}}}}function qa(t,e,a,s,r){t.startMeasure*_;const n=Math.max(1,Dt(t));let o=0;for(;o<t.measures;){const i=Math.min(n,t.measures-o),l=o===0,u=t.startMeasure+o,c=Ua(t,e,a,i,l,u,s,r);Va(c,e,a,s,r),o+=i}}function Ua(t,e,a,s,r,n,o,i){const l=La(o.caches.hook,t.templateId,t.occurrenceIndex,o.rng),u=et(0,t.measures),c=[];n===o.totalMeasures-1?c.push("loop_safe"):n===o.totalMeasures-2&&!(F(t)&&r)&&c.push("cadence");let p,d,g;const h=ae(u,c);ae(u,c);const f=me(o.caches.template,t.templateId,h);if(F(t)&&r&&l){const v=z.get(l.rhythmId),m=De.get(l.melodyId);v&&(p=v),m&&(d=m)}if(!p){const v=f.rhythm;p=v?z.get(v):void 0,p||(p=tt(a,o.styleIntent,u,o.lastMotifs.rhythm,c,o.rng,o.usedMotifs.rhythms),f.rhythm=p.id)}if(!d){const v=f.melody;d=v?De.get(v):void 0,d||(d=Ra(a,o.styleIntent,c,o.rng,o.lastMotifs.melodyFragment,o.usedMotifs.melodies),f.melody=d.id)}if(F(t)&&r&&l){const v=Ce.get(l.melodyRhythmId);v&&(g=v)}if(!g){const v=f.melodyRhythm;g=v?Ce.get(v):void 0,g||(g=xa(a,o.styleIntent,u,s*_,c,o.rng,void 0,o.usedMotifs.melodyRhythms),f.melodyRhythm=g.id)}return re(t)&&r&&Ga(o.caches.hook,t.templateId,t.occurrenceIndex,{rhythmId:p.id,melodyId:d.id,melodyRhythmId:g.id}),o.usedMotifs.rhythms.add(p.id),o.usedMotifs.melodies.add(d.id),o.usedMotifs.melodyRhythms.add(g.id),o.motifUsage.melodyRhythm[g.id]=(o.motifUsage.melodyRhythm[g.id]??0)+1,r&&i.sectionMotifPlan.push({sectionId:t.id,templateId:t.templateId,occurrenceIndex:t.occurrenceIndex,primaryRhythm:p.id,primaryMelody:d.id,primaryMelodyRhythm:g.id,reprisesHook:F(t)&&!!l&&(l==null?void 0:l.rhythmId)===p.id&&(l==null?void 0:l.melodyId)===d.id&&(l==null?void 0:l.melodyRhythmId)===g.id}),{section:t,phraseMeasures:s,isFirstPhrase:r,phraseStartMeasureIndex:n,cachedHook:l,baseRhythm:p,baseMelody:d,baseMelodyRhythm:g}}function Va(t,e,a,s,r){const{section:n,phraseMeasures:o,isFirstPhrase:i,baseMelody:l,baseMelodyRhythm:u}=t;n.startMeasure*_;const c=Da(u);let p=0,d=0,g=0;for(let h=0;h<o;h++){const f=Wa(t,h,a,s);i&&h===0&&Ha(r.melody,f.measureStartBeat,l,n.id),$a(f,c,l,n,s,r.melody,{phraseBeatCursor:p,phraseStepIndex:d,melodyDegreeCursor:g});const v=(h+1)*_;for(;d<c.length&&p<v;){const m=c[d];m.rest||g++,p+=m.durationBeats,d++}Ya(f,e,n,s,r.bass),ja(f,l,n,s,r.accompanimentSeeds),za(f,n,s,r.drums),s.lastMotifs.rhythm=f.rhythmMotif,s.lastMotifs.melodyFragment=l}}function Wa(t,e,a,s){const{section:r,isFirstPhrase:n,baseRhythm:o}=t,i=t.phraseStartMeasureIndex-r.startMeasure+e,l=r.startMeasure+i,u=r.startMeasure*_+i*_,c=et(i,r.measures),p=[],d=F(r)&&i===0;l===s.totalMeasures-1?p.push("loop_safe"):l===s.totalMeasures-2&&!d&&p.push("cadence");const g=ae(c,p),h=me(s.caches.template,r.templateId,g),f=a.sectionRepeatBias??.3,v=e>0||!n||r.occurrenceIndex>1,m=!F(r)&&v&&s.rng()>f;let y=h.rhythm?z.get(h.rhythm):void 0;if(!y)m?y=Ge(o,c,p,s.rng,s.usedMotifs.rhythms)??o:y=o;else if(m&&y.id===o.id){const M=Ge(o,c,p,s.rng,s.usedMotifs.rhythms);M&&(y=M)}return(!y.tags.includes(c)||!k(y,p))&&(y=tt(a,s.styleIntent,c,o,p,s.rng,s.usedMotifs.rhythms)),h.rhythm=y.id,s.motifUsage.rhythm[y.id]=(s.motifUsage.rhythm[y.id]??0)+1,s.usedMotifs.rhythms.add(y.id),{measureInSection:i,globalMeasureIndex:l,measureStartBeat:u,functionTag:c,requiredTags:p,isHookMeasure:d,phraseOffset:e,rhythmMotif:y}}function $a(t,e,a,s,r,n,o){const{measureStartBeat:i,measureInSection:l,globalMeasureIndex:u,phraseOffset:c}=t,p=(c+1)*_;for(;o.phraseStepIndex<e.length&&o.phraseBeatCursor<p;){const d=e[o.phraseStepIndex],g=o.phraseBeatCursor-c*_;if(!d.rest){let h=a.pattern[o.melodyDegreeCursor%a.pattern.length];o.phraseStepIndex===e.length-1&&(s.occurrenceIndex>1||l>0)&&!F(s)&&(h=Ea(h,a.pattern,r.styleIntent,r.rng));let f=Pa(s,l,u,r.totalMeasures,r.styleIntent);n.push({channelRole:"melody",startBeat:i+g,durationBeats:d.durationBeats,degree:h,velocity:f,sectionId:s.id}),o.melodyDegreeCursor++}o.phraseBeatCursor+=d.durationBeats,o.phraseStepIndex++}}function Ya(t,e,a,s,r){const{measureStartBeat:n,measureInSection:o}=t;let i=s.caches.bassPattern.get(a.id);i||(i=at(a,o,s.rng,s.usedMotifs.bassPatterns,s.caches.bassPattern,s.styleIntent),s.caches.bassPattern.set(a.id,i));const l=K(e,n),u=K(e,n+_);r.push(...Ia(a,n,l,u,i))}function ja(t,e,a,s,r){const{measureStartBeat:n,rhythmMotif:o,functionTag:i}=t;r.push(...Ta(a,n,o,e,i,s.voiceArrangement.id,s.rng))}function za(t,e,a,s){var r;const{measureStartBeat:n,measureInSection:o,requiredTags:i}=t,l=o===e.measures-1,u=l||e.measures>2&&o===e.measures-2,c=ae(`${o}:${u?"fill":"beat"}`,i),p=me(a.caches.template,e.templateId,c);let d=p.drum?pa.get(p.drum):void 0;if(d||(d=ts(o,e.measures,i,a.rng,a.lastMotifs.drumPatternId,a.usedMotifs.drums,u,a.styleIntent,a.voiceArrangement.id),d&&(p.drum=d.id)),d&&(a.motifUsage.drums[d.id]=(a.motifUsage.drums[d.id]??0)+1,a.usedMotifs.drums.add(d.id),s.push(...Xe(d.pattern,n,e.id)),a.lastMotifs.drumPatternId=d.id),l){const g=e.id===((r=a.sectionById.get(Array.from(a.sectionById.keys()).pop()))==null?void 0:r.id),h=Fa(e,n,g,a.rng,a.lastMotifs.transitionId,a.usedMotifs.transitions,a.styleIntent,e.startMeasure+o,a.totalMeasures);h&&(a.motifUsage.transitions[h.motifId]=(a.motifUsage.transitions[h.motifId]??0)+1,a.usedMotifs.transitions.add(h.motifId),s.push(...Aa(s,h.hits)),a.lastMotifs.transitionId=h.motifId)}}function Xa(t,e,a){return t.map(s=>{const r=a.sectionById.get(s.sectionId),n=Math.floor(s.startBeat/_),o=r?n-r.startMeasure:0,i=Ka(r,o,n,a.totalMeasures,a.styleIntent,a.compositionBaseRegister),l=oe(s.degree,e.scaleDegrees,i),u=K(e,s.startBeat),c=Ma(s.startBeat)?B(l,u):j(l,u);return{...s,midi:c}})}function Ja(t,e,a){return t.map(s=>{const r=oe(s.degree,e.scaleDegrees,67),n=K(e,s.startBeat),o=ba(s.startBeat,a),i=j(r,n,o==null?void 0:o.midi);return{...s,midi:i}})}function Qa(t,e){return t.map(a=>{const s=a.midiOverride??oe(a.degree,e.scaleDegrees,52,-1),r=K(e,a.startBeat),n=B(s,r);return{...a,midi:n}})}function Za(t,e){const a=Na(t,e),s={melody:[],bass:[],accompanimentSeeds:[],drums:[],sectionMotifPlan:[]};for(const i of e.sections)qa(i,e,t,a,s);const r=Xa(s.melody,e,a),n=Qa(s.bass,e),o=Ja(s.accompanimentSeeds,e,r);return{melody:r,bass:n,accompanimentSeeds:o,drums:s.drums,motifUsage:a.motifUsage,sectionMotifPlan:s.sectionMotifPlan}}function es(t,e){const{voiceArrangement:a}=e,s=t.seed??X,r=Za(t,e);if(a.id==="standard"||a.id==="swapped")return{tracks:[{role:"melody",notes:r.melody},{role:"bass",notes:r.bass},{role:"accompaniment",notes:r.accompanimentSeeds}],drums:r.drums,motifUsage:r.motifUsage,sectionMotifPlan:r.sectionMotifPlan};const n=[];for(const o of a.voices){let i;switch(o.role){case"bass":case"bassAlt":i=rs(o.role,o.priority,o.octaveOffset??0,o.seedOffset??0,t,e);break;case"pad":i=ns(o.priority,t,e,s+(o.seedOffset??0));break;case"melody":case"melodyAlt":case"accompaniment":if(o.role==="melody"&&a.id==="minimal")continue;o.role==="melody"?i=r.melody:i=r.accompanimentSeeds;break;default:i=[]}const l=i.map(u=>{let c,p=u.velocity;if((u.channelRole==="bass"||o.role==="bass"||o.role==="bassAlt")&&u.midiOverride!==void 0)c=u.midiOverride;else{Math.floor(u.startBeat/_);const d=o.role==="melody"||o.role==="melodyAlt"?72:67,g=oe(u.degree,e.scaleDegrees,d),h=K(e,u.startBeat);c=B(g,h),o.octaveOffset&&(c+=o.octaveOffset*12)}return a.id==="layeredBass"&&(o.role==="bass"?p=Math.max(28,Math.round(p*.65)):o.role==="bassAlt"&&(p=Math.max(22,Math.round(p*.5)))),{...u,midi:c,velocity:p}});l.length>0&&n.push({role:o.role,notes:l})}return{tracks:n,drums:r.drums,motifUsage:r.motifUsage,sectionMotifPlan:r.sectionMotifPlan}}function ye(t){switch(t){case 2:return 2;case 4:return 1;case 8:return .5;case 16:return .25;default:return .25}}function ts(t,e,a,s,r,n,o,i,l){var u,c,p;const d=ya[l];if(!o&&d!=null&&d.earlySparseMeasures&&t<d.earlySparseMeasures&&s()<.3)return;if(i.gradualBuild&&e>=8){const S=t/Math.max(1,e-1),V=Math.min(.35,6/Math.max(1,e)),D=Math.min(.7,14/Math.max(1,e));if(S<V){if(s()<.75)return}else if(S<D&&s()<.35)return}const g=i.breakInsertion?2:4,h=g>0&&e>=g&&(t+1)%g===0,f=o||h;let v=ee.filter(S=>f?S.type==="fill":S.type==="beat");const m=v.filter(S=>S.length_beats<=_);if(m.length&&(v=m),a.length){const S=v.filter(V=>{const D=V.tags;return D?a.every(le=>D.includes(le)):!1});S.length&&(v=S)}v.length||(v=ee.filter(S=>f?S.type==="fill":S.type==="beat")),v.length||(v=ee);const y=i.percussiveLayering&&i.syncopationBias&&i.breakInsertion&&!i.loopCentric,M=i.atmosPad&&i.loopCentric&&i.harmonicStatic,R=i.loopCentric&&i.textureFocus&&i.percussiveLayering;if(f?(c=d==null?void 0:d.preferFillTags)!=null&&c.length&&(v=b(v,d.preferFillTags,.25)):(i.loopCentric&&(v=b(v,["loop_safe"])),i.syncopationBias&&(v=b(v,y?["breakbeat","syncopation","grid16"]:["syncopation"])),i.textureFocus&&(v=b(v,["texture_loop","straight","grid16"])),i.percussiveLayering&&(v=b(v,y?["breakbeat","percussive_layer","grid16"]:["percussive_layer","four_on_floor"])),M&&(v=b(v,["lofi","rest_heavy","swing_hint"],.3)),R&&(v=b(v,["loop_safe","grid16","texture_loop"],.25)),(u=d==null?void 0:d.preferBeatTags)!=null&&u.length&&(v=b(v,d.preferBeatTags,.25))),y&&(v=b(v,["breakbeat","grid16"],.2)),(p=d==null?void 0:d.avoidTags)!=null&&p.length){const S=v.filter(V=>{const D=V.tags;return D?!d.avoidTags.some(le=>D.includes(le)):!0});S.length&&(v=S)}const A=T(v,n);return O(A,s,r)}function T(t,e){if(!t.length)return t;const a=t.filter(s=>s.id?!e.has(s.id):!0);return a.length?a:t}function ae(t,e){if(!e.length)return t;const a=[...e].sort();return`${t}:${a.join("|")}`}function as(t,e){const a=(t??X)+e>>>0;return ie(a)}function ot(t,e,a,s,r){if(t>=1)return!0;if(s.gradualBuild){const n=e/Math.max(1,a-1),o=Math.min(1,t+n*.3);return r()<o}return r()<t}function ss(t,e,a,s,r,n,o=0){var i;const l=(i=r.steps)!=null&&i.length?r.steps:fe,u=[],c=s??a;for(let p=0;p<l.length;p++){const d=e+p*.5,g=rt(l[p],a,c,n);g!==null&&u.push({channelRole:"bass",startBeat:d,durationBeats:.5,degree:0,velocity:st(t,p),sectionId:t.id,midiOverride:g})}return u}function rs(t,e,a,s,r,n){const o=[],i=n.styleIntent,l=r.seed??X,u=as(l,s),c=new Set,p=new Map,d=40+a*12;for(const g of n.sections){const h=g.startMeasure*_;for(let f=0;f<g.measures;f++){if(!ot(e,f,g.measures,i,u))continue;const v=h+f*_,m=at(g,f,u,c,p,i,t==="bassAlt"?{enforceDroneStatic:!1,preferredTags:["drone","accent"]}:void 0),y=K(n,v),M=K(n,v+_),R=ss(g,v,y,M,m,d,a);o.push(...R)}}return o}function ns(t,e,a,s){const r=ie(s),n=[];for(const o of a.sections){const i=o.startMeasure*_;for(let l=0;l<o.measures;l++){if(!ot(t,l,o.measures,a.styleIntent,r))continue;const u=i+l*_,c=l%2===0?1:5;n.push({channelRole:"accompaniment",startBeat:u,durationBeats:_,degree:c,velocity:I.PAD_MIN,sectionId:o.id})}}return n}const os=42,is=.5,ls=.015,us=.12,Ne=1/16,ds={K:{mode:"long",spec:"long_period",periodIndex:3,releaseRange:[.045,.075],velocity:w.KICK,amplitude:1},T:{mode:"long",spec:"long_period",periodIndex:5,releaseRange:[.05,.09],velocity:w.TOM,amplitude:.92},N:{mode:"long",spec:"long_period",periodIndex:8,releaseRange:[.06,.1],velocity:w.LOW_NOISE,amplitude:.88},S:{mode:"short",spec:"short_period",periodIndex:1,releaseRange:[.02,.045],velocity:w.SNARE,amplitude:.9},H:{mode:"short",spec:"short_period",periodIndex:0,releaseRange:[.015,.03],velocity:w.HIHAT,amplitude:.86},O:{mode:"short",spec:"short_period",periodIndex:2,releaseRange:[.03,.055],velocity:w.OPEN_HAT,amplitude:.94}},cs=5,ps=.06;function gs(t){let e=t;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function _e(t,e,a,s){let r=1;const n=e==="bass"||e==="bassAlt",o=t==="square1"||t==="square2";n&&(r*=$.BASS_BASE,a<Xt.BASS_LOW_RANGE&&(r*=$.BASS_LOW_RANGE)),t==="triangle"&&(r*=$.TRIANGLE_BASE,n||(r*=$.TRIANGLE_NON_BASS)),o&&n&&(r*=$.SQUARE_BASS);const i=Math.round(s*r);return Math.max(Fe.MIN,Math.min(Fe.MAX_ACCENT,i))}function hs(t,e){const a={reverseProbability:.5,sustainProbability:.2,densityThresholds:{sparse:.45,normal:.85}};return t.textureFocus&&(a.reverseProbability=.35,a.sustainProbability=.12,a.densityThresholds={sparse:.3,normal:.7}),t.loopCentric&&(a.sustainProbability=Math.min(.35,a.sustainProbability+.1),a.densityThresholds={sparse:Math.min(.5,a.densityThresholds.sparse+.05),normal:Math.min(.95,a.densityThresholds.normal+.05)}),e==="arpeggio"&&t.gradualBuild&&(a.densityThresholds={sparse:.25,normal:.65}),a}function vs(t,e,a,s,r){const n=Math.abs(e.midi-t.midi),o=e.startBeat-(t.startBeat+a),i=n>0&&n<=cs,l=o>=-.001&&o<=.5,u=a>=.5;if(!i||!l||!u)return!1;let c=.15;return s.atmosPad?c=.4:s.loopCentric&&s.textureFocus?c=.35:s.gradualBuild&&s.breakInsertion&&(c=.25),r()<c}function fs(t,e,a){let s=t;return e==="slow"?s+=.02:e==="fast"&&(s-=.015),a>=4&&(s+=.01),Math.max(.02,Math.min(.12,s))}function ms(t,e){if(!t)return!1;const a=`${t}|${e}`;return a==="H|H"||a==="H|O"||a==="O|H"}function ys(t,e,a){const s=(t==null?void 0:t.releaseRange)??[ls,us],r=s[0]+a()*Math.max(0,s[1]-s[0]);return e.percussiveLayering?Math.max(s[0],r*.85):e.gradualBuild?Math.min(s[1],r*1.05):r}function _s(t){const e=t.length>0?t:[0,4,7],a=[];for(let s=0;s<4;s++){const r=e[s%e.length],n=Math.floor(s/e.length)*12;a.push(r+n)}return a}function Ms(t,e,a){return t()<a?[...e].reverse():e}function bs(t,e,a,s,r){const n=hs(s,r),o=Math.max(I.PAD_MIN,Math.round(t.velocity*I.ARPEGGIO_SCALE));if(a()<n.sustainProbability){const d=j(t.midi,e,t.midi);return[{...t,startBeat:t.startBeat,durationBeats:Math.max(t.durationBeats,1),velocity:o,midi:d}]}const i=Ms(a,_s(ve(e)),n.reverseProbability),l=a();let u;l<n.densityThresholds.sparse?u=2:l<n.densityThresholds.normal?u=4:u=1;const c=u===4?.25:u===2?.5:Math.max(t.durationBeats,1),p=[];for(let d=0;d<u;d++){const g=t.startBeat+c*d,h=i[d%i.length],f=B(t.midi+h,e),v=j(f,e,t.midi);p.push({channelRole:"accompaniment",startBeat:g,durationBeats:c,degree:t.degree,velocity:o,sectionId:t.sectionId,midi:v})}return p}function Ss(t){const e=[];for(const a of t){const s=[0,.5];for(const r of s)e.push({...a,startBeat:a.startBeat+r,durationBeats:.5,velocity:Math.max(I.PAD_MIN,Math.round(a.velocity*I.BROKEN_SCALE))})}return e}function Rs(t){return t.map(e=>({...e,durationBeats:e.durationBeats>=1?e.durationBeats:1,velocity:Math.max(I.PAD_MIN,Math.round(e.velocity*I.STEADY_SCALE))}))}function xs(t,e,a){return{rng:gs(t.seed??os),sectionById:new Map(e.sections.map(s=>[s.id,s])),totalBeats:(t.lengthInMeasures??32)*_,styleIntent:e.styleIntent,tempoSetting:t.tempo??"medium",phase1:e,phase2:a}}function Ps(t,e,a){const s=[],r=e.channel;for(let n=0;n<t.notes.length;n++){const o=t.notes[n],i=a.sectionById.get(o.sectionId);i&&Math.max(0,Math.floor(o.startBeat/_)-i.startMeasure);const l={midi:o.midi,velocity:_e(r,e.role,o.midi,o.velocity)},u=t.notes[n+1];if(u&&vs(o,u,o.durationBeats,a.styleIntent,a.rng)){const c=Math.abs(u.midi-o.midi);l.slide={targetMidi:u.midi,durationSeconds:fs(ps,a.tempoSetting,c)}}Me(s,o.startBeat,o.durationBeats,r,l,a.totalBeats)}return s}function Bs(t,e,a){const s=[],r=e.channel;for(const n of t.notes)Me(s,n.startBeat,n.durationBeats,r,{midi:n.midi,velocity:_e(r,e.role,n.midi,n.velocity)},a.totalBeats);return s}function Ks(t,e,a){var s;const r=[],n=e.channel,o=new Map;for(const l of t.notes){const u=Math.floor(l.startBeat/_),c=o.get(u)??[];c.push(l),o.set(u,c)}const i=Array.from(o.keys()).sort((l,u)=>l-u);for(const l of i){const u=o.get(l),c=u.length?a.sectionById.get(u[0].sectionId):void 0,p=(c==null?void 0:c.texture)??"steady",d=K(a.phase1,((s=u[0])==null?void 0:s.startBeat)??l*_);let g;p==="arpeggio"?g=u.flatMap(m=>bs(m,d,a.rng,a.styleIntent,c==null?void 0:c.texture)):p==="broken"?g=Ss(u):g=Rs(u);const h=[],f=[];for(const m of g)a.rng()<a.phase1.techniqueStrategy.echoProbability&&h.push({...m,startBeat:m.startBeat+.25,velocity:Math.round(m.velocity*Te.ECHO_SCALE)}),a.rng()<a.phase1.techniqueStrategy.detuneProbability&&f.push({...m,startBeat:m.startBeat,velocity:Math.round(m.velocity*Te.DETUNE_SCALE),midi:m.midi,detuneCents:12});const v=[...g,...h,...f].map(m=>{const y=K(a.phase1,m.startBeat),M=a.phase2.tracks.find(S=>S.role==="melody"),R=M?Fs(m.startBeat,M.notes):void 0,A=j(m.midi,y,(R==null?void 0:R.midi)??m.midi);return{...m,midi:A}});for(const m of v)Me(r,m.startBeat,m.durationBeats,n,{midi:m.midi,velocity:_e(n,e.role,m.midi,m.velocity),detuneCents:m.detuneCents},a.totalBeats)}return r}function Hs(t,e){const a=[];let s=null,r=null,n=null;const o=[...t].sort((i,l)=>i.startBeat-l.startBeat);for(const i of o){let l=i.startBeat;const u=ds[i.instrument];if(!u)continue;const c=ms(n,i.instrument),p=c?0:Ne;r!==null&&l-r<=p&&(l=r+Math.max(p,Ne));const d=ys(u,e.styleIntent,e.rng),g=Math.max(.01,Math.min(d*.7,d)),h=Math.min(i.durationBeats,is);if(l>=e.totalBeats)continue;if(s!==null&&l<s)if(c&&a.length>=2){const v=a[a.length-1];v.command==="noteOff"&&(v.beatTime=l),s=l}else a.pop(),a.pop(),s=null,r=null;a.push({beatTime:l,channel:"noise",command:"noteOn",data:{noiseMode:u.spec,mode:u.spec,velocity:u.velocity,amplitude:u.amplitude,releaseSeconds:d,decaySeconds:g,periodIndex:u.periodIndex,clockDivider:u.periodIndex}});const f=Math.min(l+h,e.totalBeats);a.push({beatTime:f,channel:"noise",command:"noteOff",data:{}}),s=f,r=l,n=i.instrument}return a}function Es(t,e,a){const s=e.role;return s==="melody"||s==="melodyAlt"?Ps(t,e,a):s==="bass"||s==="bassAlt"?Bs(t,e,a):s==="accompaniment"||s==="pad"?Ks(t,e,a):[]}function Is(t,e,a){const s=xs(t,e,a),r=[];for(const i of a.tracks){const l=e.voiceArrangement.voices.find(c=>c.role===i.role);if(!l)continue;const u=Es(i,l,s);r.push(...u)}const n=Hs(a.drums,s);r.push(...n),r.sort((i,l)=>i.beatTime-l.beatTime);const o=As(r);return{events:r,diagnostics:o}}function Me(t,e,a,s,r,n){if(e>=n)return;t.push({beatTime:e,channel:s,command:"noteOn",data:r});const o=Math.min(e+a,n);t.push({beatTime:o,channel:s,command:"noteOff",data:r})}function As(t){const e=new Map,a={voiceAllocation:[]};for(const s of t){e.has(s.channel)||e.set(s.channel,0);const r=e.get(s.channel);s.command==="noteOn"?e.set(s.channel,r+1):s.command==="noteOff"&&r>0&&e.set(s.channel,r-1),a.voiceAllocation.push({beatTime:s.beatTime,channel:s.channel,activeCount:e.get(s.channel)})}return a}function Fs(t,e){return e.find(a=>t>=a.startBeat&&t<a.startBeat+a.durationBeats)}const Os=[{channel:"square1",param:"duty",value:.25},{channel:"square2",param:"duty",value:.5}],ks=[{id:"DS_MEASURE_BOUNDARY_SWEEP",param:"duty",channels:["square1","square2"],minDurationBeats:1.5,requireMeasureBoundary:!0,steps:[.5,.75,.25]},{id:"DS_MINIMAL_LOW_PASS_THUMP",param:"duty",channels:["square1","square2"],minDurationBeats:2,requireMeasureBoundary:!0,steps:[.18,.38,.24]},{id:"DS_PROGRESSIVE_FILTER_RISE",param:"duty",channels:["square2"],minDurationBeats:4,steps:[.28,.46,.62,.76]},{id:"DS_PROGRESSIVE_PULSE_SQ1",param:"duty",channels:["square1"],minDurationBeats:3,steps:[.22,.4,.56]}],Ts=[{id:"GP_TRIANGLE_MEASURE_ACCENT",channel:"triangle",param:"gain",measureBoundaryValue:.9,defaultValue:.7},{id:"GP_NOISE_BREAK_SPILL",channel:"noise",param:"gain",measureBoundaryValue:.82,defaultValue:.7},{id:"GP_MINIMAL_BASS_SIDECHAIN",channel:"square2",param:"gain",measureBoundaryValue:.68,defaultValue:.56},{id:"GP_MINIMAL_PERC_FADE",channel:"noise",param:"gain",measureBoundaryValue:.7,defaultValue:.58},{id:"GP_PROGRESSIVE_PAD_SWELL",channel:"triangle",param:"gain",measureBoundaryValue:.88,defaultValue:.74},{id:"GP_PROGRESSIVE_SQUARE_GLIDE",channel:"square1",param:"gain",measureBoundaryValue:.8,defaultValue:.66}],Ds={initialParams:Os,dutySweeps:ks,gainProfiles:Ts},ce=Ds,Cs={square1:{base:.68,peak:.9},square2:{base:.66,peak:.88},triangle:{base:.48,peak:.68},noise:{base:.74,peak:.82}};function ws(t,e){const a=[],s=t.events.reduce((u,c)=>Math.max(u,c.beatTime),0),r=Math.max(1,Math.ceil(s/_));for(const u of ce.initialParams??[])a.push({beatTime:0,channel:u.channel,command:"setParam",data:{param:u.param,value:u.value}});const n=[...ce.dutySweeps??[]],o=[...ce.gainProfiles??[]];e.filterMotion&&n.push({id:"STYLE_FILTER_SWELL",param:"duty",channels:["square1","square2"],minDurationBeats:2,steps:[.2,.6,.4,.75]}),e.percussiveLayering&&o.push({id:"STYLE_NOISE_PUNCH",channel:"noise",param:"gain",measureBoundaryValue:.85,defaultValue:.78}),e.percussiveLayering&&!e.breakInsertion&&o.push({id:"STYLE_MINIMAL_SIDECHAIN_SQ1",channel:"square1",param:"gain",measureBoundaryValue:.74,defaultValue:.62},{id:"STYLE_MINIMAL_SIDECHAIN_SQ2",channel:"square2",param:"gain",measureBoundaryValue:.72,defaultValue:.6}),e.atmosPad&&o.push({id:"STYLE_TRIANGLE_PAD",channel:"triangle",param:"gain",measureBoundaryValue:.82,defaultValue:.72}),e.gradualBuild&&e.breakInsertion&&n.push({id:"STYLE_PROGRESSIVE_DUTY_SWELL",param:"duty",channels:["square2"],minDurationBeats:1,steps:[.32,.58,.48,.68]}),e.gradualBuild&&e.breakInsertion&&o.push({id:"STYLE_PROGRESSIVE_TRI_RISE",channel:"triangle",param:"gain",measureBoundaryValue:.9,defaultValue:.76});const i=new Set;for(const u of t.events){if(u.command!=="noteOn")continue;const c=Ls(t.events,u),p=c?c.beatTime-u.beatTime:0;for(const d of n){if(!d.channels.includes(u.channel)||!c||p<d.minDurationBeats||d.requireMeasureBoundary&&!(pe(u.beatTime)||c&&pe(c.beatTime)))continue;const g=p/(d.steps.length+1);d.steps.forEach((h,f)=>{a.push({beatTime:u.beatTime+g*(f+1),channel:u.channel,command:"setParam",data:{param:d.param,value:h}})})}for(const d of o){if(u.channel!==d.channel)continue;const g=pe(u.beatTime)?d.measureBoundaryValue:d.defaultValue;a.push({beatTime:u.beatTime,channel:u.channel,command:"setParam",data:{param:d.param,value:g}})}if(e.breakInsertion&&u.channel==="noise"){const d=Math.floor(u.beatTime/_);if(!i.has(d)&&d>0&&(d+1)%8===0){i.add(d);const g=d*_;a.push({beatTime:g-.25>=0?g-.25:g,channel:"noise",command:"setParam",data:{param:"gain",value:.45}}),a.push({beatTime:g+1,channel:"noise",command:"setParam",data:{param:"gain",value:.78}});for(const h of["square1","square2"])a.push({beatTime:g-.25>=0?g-.25:g,channel:h,command:"setParam",data:{param:"gain",value:.55}}),a.push({beatTime:g+1,channel:h,command:"setParam",data:{param:"gain",value:.82}})}}}if(e.gradualBuild&&r>1){const u=Math.max(1,Math.floor(r/8));for(const[c,p]of Object.entries(Cs)){const d=c;for(let g=0;g<r;g+=u){const h=r>1?g/(r-1):1,f=Math.pow(h,e.loopCentric?.8:1),v=p.base+(p.peak-p.base)*f;a.push({beatTime:g*_,channel:d,command:"setParam",data:{param:"gain",value:Number(v.toFixed(3))}})}}}const l=[...t.events,...a];return l.sort((u,c)=>u.beatTime===c.beatTime?u.command===c.command?0:u.command==="setParam"?-1:c.command==="setParam"?1:0:u.beatTime-c.beatTime),{events:l}}function Ls(t,e){for(const a of t)if(a.channel===e.channel&&a.command==="noteOff"&&a.data===e.data&&a.beatTime>e.beatTime)return a}function pe(t){return Math.abs(t%_)<1e-6}function Gs(t,e,a,s,r){const n=60/t.bpm,o=e.map(l=>({time:l.beatTime*n,channel:l.channel,command:l.command,data:l.data}));o.sort((l,u)=>l.time-u.time);const i={voiceAllocation:a.voiceAllocation.map(l=>({time:l.beatTime*n,channel:l.channel,activeCount:l.activeCount})),loopWindow:Ns(o),motifUsage:s,sectionMotifPlan:r};return{events:o,diagnostics:i}}function Ns(t){if(!t.length)return{head:[],tail:[]};const e=.1,a=t[t.length-1].time,s=t.filter(r=>a-r.time<e);return{head:t.filter(r=>r.time<e),tail:s}}function qs(t){return{percussiveMelodic:Math.max(-1,Math.min(1,t.percussiveMelodic)),calmEnergetic:Math.max(-1,Math.min(1,t.calmEnergetic))}}function Us(t){const{percussiveMelodic:e,calmEnergetic:a}=t,s=Math.max(0,-e),r=Math.max(0,e),n=Math.max(0,-a),o=Math.max(0,a);return{percussiveLayering:s>.3,syncopationBias:s>.4,breakInsertion:s>.35&&o>.4,harmonicStatic:r>.4&&n>.3||s>.3&&n>.2,atmosPad:r>.3||n>.5||o>.55,filterMotion:r>.3||o>.5,loopCentric:n>.3,textureFocus:n>.4||s>.5&&n>.2,gradualBuild:o>.4}}function Vs(t){const{percussiveMelodic:e,calmEnergetic:a}=t;let s="mixed";e>.5&&a>.3?s="ascending":e>.4&&(s="stepwise");const r=-e+a*.5;let n="medium";r>.6?n="high":r<-.4&&(n="low");let o="balanced";return a>.5?o="aggressive":a<-.5&&(o="soft"),{melodyContour:s,drumDensity:n,velocityCurve:o}}function Ws(t){return t.calmEnergetic*20}function $s(t){return t.calmEnergetic<-.4?"slow":t.calmEnergetic>.4?"fast":"medium"}function Ys(t){const{percussiveMelodic:e,calmEnergetic:a}=t;let s="medium";a>.4&&(s="high"),a<-.4&&(s="low");let r="upbeat";return a<=-.5?r="peaceful":e<=-.4?r="tense":e>=.4?r="sad":a>=.4&&(r="upbeat"),{energy:s,mood:r}}const js={"minimal-techno":{percussiveMelodic:-.4,calmEnergetic:-.3},"progressive-house":{percussiveMelodic:-.45,calmEnergetic:.6},"retro-loopwave":{percussiveMelodic:.3,calmEnergetic:-.2},"breakbeat-jungle":{percussiveMelodic:-.7,calmEnergetic:.7},"lofi-chillhop":{percussiveMelodic:.5,calmEnergetic:-.6}},be=["textureFocus","loopCentric","gradualBuild","harmonicStatic","percussiveLayering","breakInsertion","filterMotion","syncopationBias","atmosPad"],zs={textureFocus:!1,loopCentric:!1,gradualBuild:!1,harmonicStatic:!1,percussiveLayering:!1,breakInsertion:!1,filterMotion:!1,syncopationBias:!1,atmosPad:!1},Xs={"minimal-techno":"minimalTechno","progressive-house":"progressiveHouse","retro-loopwave":"retroLoopwave","breakbeat-jungle":"breakbeatJungle","lofi-chillhop":"lofiChillhop"},Js=.35,Qs={percussiveMelodic:0,calmEnergetic:0};function Zs(t){let e=t>>>0;return e===0&&(e=1),()=>(e=e*1664525+1013904223>>>0,e/4294967295)}function er(t,e,a){const s={...zs};for(const r of be){const n=t[r];typeof n=="boolean"?s[r]=n:a&&e?s[r]=e()>=.5:s[r]=!1}return s}function tr(t,e){return{melodyContour:e.melodyContour??(t==null?void 0:t.melodyContour),drumDensity:e.drumDensity??(t==null?void 0:t.drumDensity),velocityCurve:e.velocityCurve??(t==null?void 0:t.velocityCurve)}}function ar(t,e){var a,s,r,n;const o={tempo:e.tempo??t.tempo,bpmBias:e.bpmBias??t.bpmBias,motifTags:{include:((a=e.motifTags)==null?void 0:a.include)??t.motifTags.include??[],exclude:((s=e.motifTags)==null?void 0:s.exclude)??t.motifTags.exclude??[]},intent:{...t.intent},expression:tr(t.expression,e.expression??{}),randomizeUnsetIntent:e.randomizeUnsetIntent??t.randomizeUnsetIntent};if((r=e.motifTags)!=null&&r.include&&(o.motifTags.include=e.motifTags.include.slice()),(n=e.motifTags)!=null&&n.exclude&&(o.motifTags.exclude=e.motifTags.exclude.slice()),e.intent)for(const i of be){const l=e.intent[i];typeof l=="boolean"&&(o.intent[i]=l)}return o}function sr(t){let e,a=Number.POSITIVE_INFINITY;for(const[s,r]of Object.entries(js)){const n=Math.hypot(t.percussiveMelodic-r.percussiveMelodic,t.calmEnergetic-r.calmEnergetic);n<a&&(a=n,e=s)}if(!(!e||a>Js))return Xs[e]??void 0}function rr(t){var e;const a=t.lengthInMeasures>0?Math.trunc(t.lengthInMeasures):32,s=typeof t.seed=="number"&&Number.isFinite(t.seed)?Math.trunc(t.seed):Math.floor(Math.random()*4294967295),r=t.twoAxisStyle??Qs,n=qs(r);let o=Us(n);if((e=t.overrides)!=null&&e.intent)for(const M of be){const R=t.overrides.intent[M];typeof R=="boolean"&&(o[M]=R)}const i=Vs(n),l=Ws(n),u=$s(n),c=Ys(n),p=c.mood;let d={tempo:u,bpmBias:l,motifTags:{include:[],exclude:[]},intent:o,expression:i,randomizeUnsetIntent:!1};t.overrides&&(d=ar(d,t.overrides));const g=d.randomizeUnsetIntent??!1,h=g?Zs(s):null,f=er(d.intent,h,g);d={...d,intent:f,randomizeUnsetIntent:g};const v={mood:p,tempo:d.tempo??"medium",lengthInMeasures:a,seed:s,stylePreset:sr(n),styleOverrides:f},m={...d,tags:{mood:c.mood,energy:c.energy},twoAxisStyle:{...n}},y={lengthInMeasures:a,seed:s,twoAxisStyle:{...n}};return t.overrides&&(y.overrides=JSON.parse(JSON.stringify(t.overrides))),{legacy:v,profile:m,replayOptions:y}}function nr(t){const{legacy:e,profile:a,replayOptions:s}=ir(t),r=qt(e),n=es(e,r),o=Is(e,r,n),i=ws(o,r.styleIntent),l=Gs(r,i.events,o.diagnostics,n.motifUsage,n.sectionMotifPlan),u=e.lengthInMeasures*4,c=u/r.bpm*60;return{events:l.events,diagnostics:l.diagnostics,meta:{bpm:r.bpm,key:r.key,seed:e.seed,mood:e.mood,tempo:e.tempo,lengthInMeasures:e.lengthInMeasures,styleIntent:r.styleIntent,voiceArrangement:r.voiceArrangement,profile:a,replayOptions:s,loopInfo:{loopStartBeat:0,loopEndBeat:u,loopStartTime:0,loopEndTime:c,totalBeats:u,totalDuration:c}}}}async function or(t){return nr(t)}function ir(t){return rr(t)}const qe=.1,lr=25,Ue=.3,ur=1789773,ge=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068],Ve={K:{mode:"long",periodIndex:14,baseAmplitude:.75,decaySeconds:.22,releaseSeconds:.04,cutoffHz:3200},S:{mode:"short",periodIndex:4,baseAmplitude:.65,decaySeconds:.14,releaseSeconds:.03,cutoffHz:5200},H:{mode:"short",periodIndex:1,baseAmplitude:.45,decaySeconds:.06,releaseSeconds:.02,cutoffHz:7800},O:{mode:"short",periodIndex:2,baseAmplitude:.6,decaySeconds:.4,releaseSeconds:.06,cutoffHz:6800},T:{mode:"long",periodIndex:10,baseAmplitude:.6,decaySeconds:.26,releaseSeconds:.05,cutoffHz:3600},default:{mode:"short",periodIndex:3,baseAmplitude:.6,decaySeconds:.14,releaseSeconds:.03,cutoffHz:6e3}},dr=69,cr=440;function se(t){return cr*Math.pow(2,(t-dr)/12)}function pr(t,e=.85){return Math.max(0,Math.min(1,(t??100)/127*e))}class Se{constructor(e,a,s){this.context=e;const r=new AudioWorkletNode(e,a);r.connect(s),this.port=r.port,this.sampleRate=e.sampleRate}scheduleMessage(e,a){const s=Math.max(0,Math.round(a*this.sampleRate));this.port.postMessage({...e,sampleFrame:s})}stop(){this.port.postMessage({type:"clear"})}}class We extends Se{constructor(e,a){super(e,"square-processor",a),this.currentDuty=.5}noteOn(e,a){const s=e.detuneCents??0,r=Math.pow(2,s/1200),n={type:"noteOn",frequency:e.frequency*r,amplitude:e.amplitude??.8,duty:e.duty??this.currentDuty};e.slide&&(n.slide={targetFrequency:e.slide.targetFrequency,durationSamples:Math.round((e.slide.durationSeconds??0)*this.sampleRate)}),this.scheduleMessage(n,a)}noteOff(e,a){this.scheduleMessage({type:"noteOff"},a)}setParam(e,a){if(e.param==="duty"&&(this.currentDuty=Number(e.value??this.currentDuty)),e.param==="pitchBend"&&typeof e.value=="number"){const s=e.value>0?se(e.value):0,r=Number(e.rampDuration??0),n=e.curve??"linear";this.scheduleMessage({type:"setParam",param:"pitchBend",value:s,rampDuration:r,curve:n},a);return}this.scheduleMessage({type:"setParam",param:e.param,value:e.value},a)}}class gr extends Se{constructor(e,a){super(e,"triangle-processor",a)}noteOn(e,a){const s={type:"noteOn",frequency:e.frequency,amplitude:e.amplitude??.7};this.scheduleMessage(s,a)}noteOff(e,a){this.scheduleMessage({type:"noteOff"},a)}setParam(e,a){if(e.param==="pitchBend"&&typeof e.value=="number"){const s=e.value>0?se(e.value):0,r=Number(e.rampDuration??0),n=e.curve??"linear";this.scheduleMessage({type:"setParam",param:"pitchBend",value:s,rampDuration:r,curve:n},a);return}this.scheduleMessage({type:"setParam",param:e.param,value:e.value},a)}}class hr extends Se{constructor(e,a){super(e,"noise-processor",a),this.periodIndex=0,this.mode="short"}noteOn(e,a){const s=Math.max(0,Math.min(ge.length-1,e.periodIndex??this.periodIndex)),r=ge[s]*16/ur,n=Math.max(1,Math.round(r*this.sampleRate)),o=Math.max(.001,e.decaySeconds??.12),i=Math.max(.001,e.releaseSeconds??.03),l=Math.max(1,Math.round(o*this.sampleRate)),u=Math.max(1,Math.round(i*this.sampleRate)),c=Math.max(0,Math.min(1,e.amplitude??.6)),p=e.mode==="long"?"long":"short",d=Math.max(100,Math.min(this.sampleRate/2,e.cutoffHz??6e3));this.periodIndex=s,this.mode=p,this.scheduleMessage({type:"noteOn",mode:p,amplitude:c,periodSamples:n,decaySamples:l,releaseSamples:u,cutoffHz:d},a)}noteOff(e,a){const s=Math.max(.001,Number((e==null?void 0:e.releaseSeconds)??.03)),r=Math.max(1,Math.round(s*this.sampleRate));this.scheduleMessage({type:"noteOff",releaseSamples:r},a)}setParam(e,a){if(!(!e||!e.param)){if(e.param==="mode"&&typeof e.value=="string"&&(this.mode=e.value==="long"?"long":"short"),e.param==="periodIndex"){const s=Number(e.value??this.periodIndex);this.periodIndex=Math.max(0,Math.min(ge.length-1,s))}this.scheduleMessage({type:"setParam",param:e.param,value:e.value},a)}}}const it=class he{constructor(e,a={}){this.context=e,this.events=[],this.eventIndex=0,this.lookahead=qe,this.leadTime=Ue,this.intervalHandle=null,this.startTime=0,this.lastEventTime=0,this.completionResolver=null,this.loopEnabled=!1,this.eventCallback=null,this.masterGainNode=e.createGain(),this.masterGainNode.gain.value=he.BASE_GAIN,this.masterGainNode.connect(e.destination),this.workletBasePath=a.workletBasePath??"./worklets/"}async init(){const e=this.context,a=this.workletBasePath;await e.audioWorklet.addModule(`${a}square-processor.js`),await e.audioWorklet.addModule(`${a}triangle-processor.js`),await e.audioWorklet.addModule(`${a}noise-processor.js`),this.channels={square1:new We(e,this.masterGainNode),square2:new We(e,this.masterGainNode),triangle:new gr(e,this.masterGainNode),noise:new hr(e,this.masterGainNode)}}get masterGain(){return this.masterGainNode}stop(){this.intervalHandle!==null&&(clearInterval(this.intervalHandle),this.intervalHandle=null),Object.values(this.channels).forEach(e=>e.stop()),this.completionResolver&&(this.completionResolver(),this.completionResolver=null)}play(e,a={}){this.stop(),this.events=e??[],this.eventIndex=0,this.lookahead=a.lookahead??qe,this.leadTime=a.leadTime??Ue,this.loopEnabled=a.loop??!1,this.eventCallback=a.onEvent??null;const s=a.volume??1;this.masterGainNode.gain.value=he.BASE_GAIN*s;const r=this.context.currentTime;this.startTime=a.startTime??r+this.leadTime,this.lastEventTime=this.events.length?this.events[this.events.length-1].time:0;const n=new Promise(i=>{this.completionResolver=i}),o=()=>this.tick();return this.intervalHandle=window.setInterval(o,lr),o(),n}tick(){const e=this.context.currentTime,a=e+this.lookahead;for(;this.eventIndex<this.events.length;){const s=this.events[this.eventIndex],r=this.startTime+s.time;if(r<=a)this.dispatchEvent(s,r),this.eventIndex+=1;else break}if(this.loopEnabled&&this.eventIndex>=this.events.length&&(this.startTime+=this.lastEventTime,this.eventIndex=0),!this.loopEnabled){const s=this.startTime+this.lastEventTime+1;this.eventIndex>=this.events.length&&e>=s&&this.stop()}}dispatchEvent(e,a){const s=e.data??{};switch(this.eventCallback&&this.eventCallback(e,a),e.channel){case"square1":case"square2":e.command==="noteOn"?this.channels[e.channel].noteOn(this.mapPitchData(s),a):e.command==="noteOff"?this.channels[e.channel].noteOff(s,a):e.command==="setParam"&&this.channels[e.channel].setParam(s,a);break;case"triangle":e.command==="noteOn"?this.channels.triangle.noteOn(this.mapPitchData(s),a):e.command==="noteOff"?this.channels.triangle.noteOff(s,a):e.command==="setParam"&&this.channels.triangle.setParam(s,a);break;case"noise":e.command==="noteOn"?this.channels.noise.noteOn(this.mapNoiseData(s),a):e.command==="noteOff"?this.channels.noise.noteOff(s,a):e.command==="setParam"&&this.channels.noise.setParam(s,a);break}}mapPitchData(e){const a=Number(e.midi??60),s=Number(e.detuneCents??0);let r=null;const n=e.slide;return n&&(typeof n.targetMidi=="number"?r={targetFrequency:se(n.targetMidi),durationSeconds:Number(n.durationSeconds??0)}:typeof n.targetFrequency=="number"&&(r={targetFrequency:n.targetFrequency,durationSeconds:Number(n.durationSeconds??0)})),{frequency:se(a),amplitude:pr(typeof e.velocity=="number"?e.velocity:void 0),duty:typeof e.duty=="number"?e.duty:void 0,detuneCents:s,slide:r}}mapNoiseData(e){const a=typeof e.velocity=="number"?e.velocity:100,s=Math.max(0,Math.min(1,a/127)),r=typeof e.instrument=="string"?e.instrument:"S",n=Ve[r]??Ve.default,o=Math.min(1,Math.max(0,(typeof e.amplitude=="number"?e.amplitude:n.baseAmplitude)*s)),i=typeof e.decaySeconds=="number"?e.decaySeconds:n.decaySeconds,l=typeof e.releaseSeconds=="number"?e.releaseSeconds:n.releaseSeconds,u=typeof e.periodIndex=="number"?e.periodIndex:typeof e.clockDivider=="number"?e.clockDivider:typeof e.period=="number"?e.period:n.periodIndex,c=typeof e.mode=="string"?e.mode:typeof e.noiseMode=="string"?e.noiseMode:n.mode,p=typeof e.cutoffHz=="number"?e.cutoffHz:n.cutoffHz;return{amplitude:o,decaySeconds:i,releaseSeconds:l,periodIndex:u,mode:c,cutoffHz:p}}};it.BASE_GAIN=.7;let vr=it;async function fr(t){return await or(t)}const N=document.getElementById("two-axis-panel"),G=document.getElementById("two-axis-canvas"),P=document.getElementById("play-pause-button"),Q=document.getElementById("button-text"),mr=document.getElementById("status-message"),yr=document.getElementById("sr-status"),Re={square1:document.querySelector('[data-channel="square1"] .indicator-light'),square2:document.querySelector('[data-channel="square2"] .indicator-light'),triangle:document.querySelector('[data-channel="triangle"] .indicator-light'),noise:document.querySelector('[data-channel="noise"] .indicator-light')},x={currentPosition:null,composition:null,isPlaying:!1,isGenerating:!1,channelActivity:{square1:0,square2:0,triangle:0,noise:0}};let H=null,C=null,te=null,q=new Map;function lt(){const t=N.getBoundingClientRect(),e=window.devicePixelRatio||1;G.width=t.width*e,G.height=t.height*e,G.style.width=`${t.width}px`,G.style.height=`${t.height}px`;const a=G.getContext("2d");a&&(a.scale(e,e),ut(a,t.width,t.height))}function ut(t,e,a){t.clearRect(0,0,e,a),t.strokeStyle="rgba(255, 255, 255, 0.08)",t.lineWidth=1;for(let n=1;n<4;n++){const o=e/4*n;t.beginPath(),t.moveTo(o,0),t.lineTo(o,a),t.stroke()}for(let n=1;n<4;n++){const o=a/4*n;t.beginPath(),t.moveTo(0,o),t.lineTo(e,o),t.stroke()}t.strokeStyle="rgba(255, 255, 255, 0.15)",t.lineWidth=2;const s=e/2,r=a/2;if(t.beginPath(),t.moveTo(s,0),t.lineTo(s,a),t.stroke(),t.beginPath(),t.moveTo(0,r),t.lineTo(e,r),t.stroke(),x.currentPosition){const n=(x.currentPosition.percussiveMelodic+1)/2*e,o=(1-x.currentPosition.calmEnergetic)/2*a,i=t.createRadialGradient(n,o,0,n,o,30);i.addColorStop(0,"rgba(90, 155, 255, 0.6)"),i.addColorStop(1,"rgba(90, 155, 255, 0)"),t.fillStyle=i,t.fillRect(n-30,o-30,60,60),t.fillStyle="#5a9bff",t.beginPath(),t.arc(n,o,8,0,Math.PI*2),t.fill(),t.strokeStyle="#ffffff",t.lineWidth=2,t.beginPath(),t.arc(n,o,12,0,Math.PI*2),t.stroke()}}async function xe(t){if(x.isGenerating)return;const e=N.getBoundingClientRect();let a,s;if(t instanceof MouseEvent)a=t.clientX,s=t.clientY;else{const u=t.touches[0]||t.changedTouches[0];if(!u)return;a=u.clientX,s=u.clientY}const r=(a-e.left)/e.width*2-1,n=1-(s-e.top)/e.height*2,o=Math.max(-1,Math.min(1,r)),i=Math.max(-1,Math.min(1,n));x.currentPosition={percussiveMelodic:o,calmEnergetic:i};const l=G.getContext("2d");l&&ut(l,e.width,e.height),await _r({percussiveMelodic:o,calmEnergetic:i})}async function _r(t){ct(),x.isGenerating=!0,U(),Y(`Generating music at (${t.percussiveMelodic.toFixed(1)}, ${t.calmEnergetic.toFixed(1)})...`);try{const a=await fr({twoAxisStyle:t,lengthInMeasures:16});x.composition=a,Y(`Generated: ${a.meta.mood} at ${a.meta.bpm} BPM in ${a.meta.key}`),await Mr(),await dt(a.events)}catch(e){const a=e instanceof Error?e.message:String(e);Y(`Error: ${a}`),console.error("Generation failed:",e)}finally{x.isGenerating=!1,U()}}async function Mr(){H||(H=new AudioContext({sampleRate:44100,latencyHint:"interactive"})),H.state==="suspended"&&await H.resume(),C||(C=new vr(H),await C.init())}async function dt(t){if(!H||!C)return;x.isPlaying=!0,P.disabled=!1,U();const a=H.currentTime+.2;q.clear(),C.play(t,{startTime:a,loop:!0,onEvent:Sr}).catch(s=>{console.error("Playback error:",s),x.isPlaying=!1,U()}),Rr()}function ct(){C&&C.stop(),te!==null&&(cancelAnimationFrame(te),te=null),x.isPlaying=!1,q.clear(),Object.values(Re).forEach(t=>{t.classList.remove("active"),t.style.opacity="0.3",t.style.boxShadow="none"}),U()}function br(){x.isPlaying?(ct(),Y("Playback paused")):x.composition&&(dt(x.composition.events),Y("Playback resumed"))}function Sr(t,e){var r,n;const a=t.channel,s=`${a}-${((r=t.data)==null?void 0:r.midi)||0}`;if(t.command==="noteOn"){const o=((n=t.data)==null?void 0:n.velocity)||64;q.set(s,{channel:a,velocity:typeof o=="number"?o:64,endTime:e+2})}else t.command==="noteOff"&&q.delete(s)}function Rr(){const t=()=>{if(!H||!x.isPlaying)return;const e=H.currentTime,a={square1:0,square2:0,triangle:0,noise:0};q.forEach((s,r)=>{if(e<=s.endTime){const n=s.channel;n in a&&(a[n]=Math.max(a[n],s.velocity))}else q.delete(r)}),x.channelActivity=a,Object.entries(a).forEach(([s,r])=>{const n=Re[s];if(n){const o=r/127;r>0?(n.classList.add("active"),n.style.opacity=String(.5+o*.5),n.style.boxShadow=`0 0 ${20+o*30}px currentColor`):(n.classList.remove("active"),n.style.opacity="0.3",n.style.boxShadow="none")}}),te=requestAnimationFrame(t)};t()}function U(){x.isGenerating?(P.disabled=!0,P.classList.add("loading"),Q.textContent=""):x.isPlaying?(P.disabled=!1,P.classList.remove("loading"),Q.textContent=" Pause",P.setAttribute("aria-label","Pause playback")):x.composition?(P.disabled=!1,P.classList.remove("loading"),Q.textContent=" Play",P.setAttribute("aria-label","Play playback")):(P.disabled=!0,P.classList.remove("loading"),Q.textContent="Play")}function Y(t){mr.textContent=t,yr.textContent=t}N.addEventListener("click",t=>void xe(t));N.addEventListener("touchstart",t=>{t.preventDefault(),xe(t)});P.addEventListener("click",()=>br());N.addEventListener("keydown",t=>{if(t.key==="Enter"||t.key===" "){t.preventDefault();const e=N.getBoundingClientRect(),a=e.left+e.width/2,s=e.top+e.height/2,r=new MouseEvent("click",{clientX:a,clientY:s});xe(r)}});window.addEventListener("resize",()=>{lt()});function xr(){Object.values(Re).forEach(t=>{t.classList.remove("active"),t.style.opacity="0.3",t.style.boxShadow="none"})}lt();xr();U();
