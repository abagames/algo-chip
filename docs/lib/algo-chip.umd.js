(function(T,V){typeof exports=="object"&&typeof module<"u"?V(exports):typeof define=="function"&&define.amd?define(["exports"],V):(T=typeof globalThis<"u"?globalThis:T||self,V(T.AlgoChip={}))})(this,function(T){"use strict";const fe={C_Major:{simple:[["C","G","Am","F"],["C","Em","F","G"],["Am","F","C","G"],["C","Am","Dm","G"],["C","F","G","C"]],town_peaceful:[["C","F","C","G"],["C","G","Em","Am"],["F","G","Em","Am"],["C","F","Am","G"],["C","G","F","C"]],heroic_fanfare:[["C","Am","F","G"],["C","G","Am","Em"],["F","C","G","Am"],["C","Dm","G","C"],["Am","F","G","C"]],playful:[["C","F","G","Am"],["C","Em","Am","F"],["F","G","C","Am"],["C","G","F","Em"],["Am","G","F","C"]]},E_Minor:{castle_majestic:[["Em","C","G","D"],["Em","B7","Em","C"],["C","G","D","Em"],["Em","C","D","G"],["Em","Em","C","D"]],dark:[["Em","D","C","B7"],["Em","C","Am","B7"],["Em","Bm","C","G"],["Em","C","D","Bm"],["Em","G","F","B7"]],ending_sorrowful:[["Em","C","G","D"],["Em","Bm","C","G"],["Em","D","C","B7"],["Em","G","D","C"],["Em","C","Am","B7"]],final_battle_tense:[["Em","C","D","B7"],["Em","G","D","Em"],["C","D","Em","Em"],["Em","Bm","C","D"],["G","D","Em","C"]],mysterious:[["Em","Am","F","C"],["Am","Em","G","C"],["Em","F","G","Em"],["Dm","Am","G","C"],["Em","C","Am","Bm"]],epic_adventure:[["Em","C","G","D"],["G","Em","C","D"],["C","G","Am","Em"],["Em","D","C","G"],["Am","Em","G","D"]]},G_Major:{heroic:[["G","C","D","G"],["G","Em","C","D"],["C","D","G","G"],["G","B7","Em","C"],["Em","C","G","D"]],overworld_bright:[["G","D","Em","C"],["C","G","D","G"],["G","Em","Am","D"],["G","C","D","G"],["G","B7","Em","C"]],triumph:[["G","D","C","G"],["C","D","G","Em"],["G","C","Am","D"],["Em","C","D","G"],["G","D","Em","D"]],adventure:[["G","Em","C","D"],["Am","D","G","C"],["G","C","D","Em"],["C","Am","G","D"],["G","D","C","Am"]]}},Qe={slow:90,medium:120,fast:150},Ze={upbeat:["overworld_bright","heroic"],sad:["ending_sorrowful","dark"],tense:["final_battle_tense","castle_majestic"],peaceful:["town_peaceful","simple"]},et={upbeat:"G_Major",sad:"E_Minor",tense:"E_Minor",peaceful:"C_Major"},N=Object.keys(fe),tt={G_Major:[0,2,4,5,7,9,11],E_Minor:[0,2,3,5,7,8,10],C_Major:[0,2,4,5,7,9,11]},ve=[[{id:"Intro",measures:1},{id:"A",measures:3},{id:"B",measures:2},{id:"A",measures:2}],[{id:"A",measures:2},{id:"B",measures:2},{id:"A",measures:2},{id:"C",measures:2}],[{id:"Intro",measures:2},{id:"A",measures:2},{id:"Bridge",measures:2},{id:"A",measures:2}],[{id:"A",measures:4},{id:"B",measures:2},{id:"C",measures:2}]],at={tense:[0,3],upbeat:[1,2],sad:[2,3],peaceful:[1,2]},me={16:{upbeat:[{id:"A",measures:8},{id:"B",measures:8}],peaceful:[{id:"A",measures:8},{id:"B",measures:8}],tense:[{id:"A",measures:8},{id:"B",measures:8}],sad:[{id:"A",measures:8},{id:"B",measures:8}]},32:{upbeat:[{id:"A",measures:8},{id:"B",measures:8},{id:"C",measures:8},{id:"D",measures:8}],peaceful:[{id:"A",measures:16},{id:"B",measures:16}],tense:[{id:"A",measures:8},{id:"B",measures:8},{id:"A",measures:8},{id:"C",measures:8}],sad:[{id:"Intro",measures:4},{id:"A",measures:12},{id:"B",measures:8},{id:"A",measures:8}]},64:{upbeat:[{id:"A",measures:16},{id:"B",measures:16},{id:"C",measures:16},{id:"D",measures:16}],peaceful:[{id:"A",measures:16},{id:"B",measures:16},{id:"A",measures:16},{id:"C",measures:16}],tense:[{id:"Intro",measures:8},{id:"A",measures:16},{id:"B",measures:16},{id:"C",measures:12},{id:"A",measures:12}],sad:[{id:"Intro",measures:8},{id:"A",measures:20},{id:"B",measures:16},{id:"A",measures:20}]}},_e=new Set(["A"]),ee="steady",st=1,rt={textureFocus:!1,loopCentric:!1,gradualBuild:!1,harmonicStatic:!1,percussiveLayering:!1,breakInsertion:!1,filterMotion:!1,syncopationBias:!1,atmosPad:!1},ye={minimalTechno:{textureFocus:!0,loopCentric:!0,harmonicStatic:!0,percussiveLayering:!0,filterMotion:!0,syncopationBias:!0},progressiveHouse:{textureFocus:!0,loopCentric:!0,gradualBuild:!0,percussiveLayering:!0,breakInsertion:!0,filterMotion:!0,atmosPad:!0},retroLoopwave:{textureFocus:!0,loopCentric:!0,percussiveLayering:!0,filterMotion:!0,syncopationBias:!0},breakbeatJungle:{textureFocus:!0,percussiveLayering:!0,breakInsertion:!0,filterMotion:!0,syncopationBias:!0},lofiChillhop:{loopCentric:!0,harmonicStatic:!0,atmosPad:!0,textureFocus:!0}};function nt(){return{...rt}}function Me(a,e){if(!e)return a;const t={...a};for(const s of Object.keys(a))e[s]!==void 0&&(t[s]=!!e[s]);return t}function ot(a){let e={};if(a.stylePreset){const t=ye[a.stylePreset];t&&(e={...e,...t})}return a.styleOverrides&&(e={...e,...a.styleOverrides}),e}function it(a,e){let t=nt();if(a.stylePreset){const p=ye[a.stylePreset];p&&(t=Me(t,p))}const s=e.reduce((p,g)=>p+g.measures,0),r=e.reduce((p,g)=>(p.set(g.templateId,(p.get(g.templateId)??0)+1),p),new Map),o=Array.from(r.values()).some(p=>p>=2),n=e.length?s/e.length:s;(o||n<=4)&&(t.loopCentric=!0),a.tempo!=="slow"&&s>=8&&(t.loopCentric=!0,t.percussiveLayering=!0),(a.mood==="tense"||a.mood==="sad")&&(t.textureFocus=!0),a.mood==="peaceful"&&(t.atmosPad=!0),(a.mood==="upbeat"||a.mood==="tense")&&(t.syncopationBias=!0),a.tempo==="fast"&&(t.filterMotion=!0,t.percussiveLayering=!0),s>=12&&(t.gradualBuild=!0);const i=new Set,u=new Set;let l=0;for(const p of e)p.chordProgression.forEach(f=>i.add(f)),u.add(p.chordProgression.join("|")),new Set(p.chordProgression).size<=1&&l++;const c=e.length>0&&l===e.length;u.size<=1&&(i.size<=2||c)&&(t.harmonicStatic=!0),s>=8&&a.tempo!=="slow"&&(t.breakInsertion=!0);const d=t.harmonicStatic;t=Me(t,a.styleOverrides);const h=a.styleOverrides&&typeof a.styleOverrides.harmonicStatic=="boolean";return!d&&!h&&(t.harmonicStatic=!1),t}function O(a,e){const t=Math.imul(a??0,1664525)+Math.imul(e,1013904223)>>>0;return(Math.imul(t,22695477)+1>>>0)/4294967295}function lt(a,e,t){const s=fe[a];if(!s)throw new Error(`No chord motifs for key ${a}`);const r=[];for(const n of e)Array.isArray(s[n])&&r.push(...s[n]);const o=r.length?r:Object.values(s).flat();if(!o.length)throw new Error(`No chord progressions available for key ${a}`);return Pe(o,t,100).map(n=>[...n])}function be(a,e){const t=a.match(/^([A-G])(#|b)?(.*)$/);if(!t)return a;const[,s,r="",o]=t,n=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],i={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},u=s+r,l=i[u];if(l===void 0)return a;const c=(l+e+12)%12;return n[c]+o}function ut(a){const e=a.match(/^([A-G](?:#|b)?)(m?)(.*)$/);if(!e)return a;const[,t,s,r]=e;return s==="m"?t+r:t+"m"+r}function dt(a){const e=[];return e.push(be(a,7)),e.push(be(a,5)),e.push(ut(a)),e}function ct(a,e){const t=3+Math.floor(e()*2),s=Array(t).fill(a);if(e()<.2){const r=dt(a),o=r[Math.floor(e()*r.length)];s.push(o)}return s}function pt(a,e,t,s){const r=a.lengthInMeasures;let o;r in me?o=me[r][a.mood].map(_=>({..._})):o=Pt(a.mood,t);const n=o.reduce((_,M)=>_+M.measures,0);let i=[];if(r===n)i=o;else if(r>n){const _=Math.floor(r/n);for(let E=0;E<_;E++)i=i.concat(o);let M=r-_*n,R=0;for(;M>0;){const E=o[R%o.length],S=Math.min(E.measures,M);i.push({id:E.id,measures:S}),M-=S,R++}}else{let _=0;for(const M of o){if(_+M.measures>r){const R=Math.max(r-_,0);R>0&&i.push({id:M.id,measures:R});break}i.push(M),_+=M.measures}}const u=[];let l=0,c=0;const d=Pe(e,t,200+c),h=new Map,p=new Set;for(const _ of d)_.forEach(M=>p.add(M));const f=(_=>{let M=(_??987654321)>>>0;return M===0&&(M=987654321),()=>(M=M*1664525+1013904223>>>0,M/4294967295)})(t),v=s.harmonicStatic===!0,m=v&&p.size<=1;for(const _ of i){let M;if(m&&d.length>0)M=[d[0][0]];else if(v&&d.length>0){const x=d[c%d.length][0];M=ct(x,f)}else M=d[c%d.length];const R=_.id,E=(h.get(R)??0)+1;h.set(R,E);const S=vt(R,E,t);u.push({id:`${_.id}${u.filter(x=>x.id.startsWith(_.id)).length+1}`,startMeasure:l,measures:_.measures,chordProgression:M,templateId:R,occurrenceIndex:E,texture:S}),l+=_.measures,m||c++}return u}const ht={Intro:["broken"],A:["broken","steady","broken"],B:["steady","steady","arpeggio"],Bridge:["arpeggio","steady"],C:["steady","arpeggio","steady"]},gt={Intro:1,A:2,B:2,Bridge:4,C:2},Se={firstOccurrence:.7,repeatOccurrence:.4},ft=.1;function vt(a,e,t){const s=ht[a]??[ee],r=s[(e-1)%s.length]??ee;if(r==="arpeggio"){const i=e===1,u=a.split("").reduce((d,h)=>d+h.charCodeAt(0),0),l=O(t,1e3+u*7+e*13),c=i?Se.firstOccurrence:Se.repeatOccurrence;if(l>c)return s.find(h=>h!=="arpeggio")??ee}const o=a.charCodeAt(0)*100+e;if(O(t,2e3+o)<ft){const u=["steady","broken","arpeggio"].filter(c=>c!==r),l=Math.floor(O(t,3e3+o)*u.length);return u[l]??r}return r}function mt(a){return gt[a]??st}function _t(a){return mt(a.templateId)}function Y(a){return a.occurrenceIndex===1&&_e.has(a.templateId)}function H(a){return a.occurrenceIndex>1&&_e.has(a.templateId)}function yt(a,e,t){let s,r=50;switch(a){case"tense":s={echoProbability:.5,detuneProbability:.3,fastArpeggioProbability:.4},r=10;break;case"upbeat":s={echoProbability:.4,detuneProbability:.2,fastArpeggioProbability:.2},r=20;break;case"sad":s={echoProbability:.6,detuneProbability:.1,fastArpeggioProbability:.1},r=30;break;case"peaceful":s={echoProbability:.5,detuneProbability:.05,fastArpeggioProbability:.05},r=40;break;default:s={echoProbability:.3,detuneProbability:.3,fastArpeggioProbability:.3};break}const o=bt(s,e);return Mt(o,t,r)}function Mt(a,e,t){const s=o=>Math.min(.95,Math.max(.05,o)),r=o=>(O(e,t+o)-.5)*.2;return{echoProbability:s(a.echoProbability+r(1)),detuneProbability:s(a.detuneProbability+r(2)),fastArpeggioProbability:s(a.fastArpeggioProbability+r(3))}}function bt(a,e){const t={...a};return e.textureFocus&&(t.fastArpeggioProbability=Math.max(.05,t.fastArpeggioProbability*.6),t.echoProbability=Math.min(.95,t.echoProbability+.05)),e.loopCentric&&(t.detuneProbability=Math.max(.05,t.detuneProbability*.8)),e.gradualBuild&&(t.echoProbability=Math.min(.95,t.echoProbability+.1)),e.harmonicStatic&&(t.detuneProbability=Math.max(.05,t.detuneProbability*.7)),e.percussiveLayering&&(t.fastArpeggioProbability=Math.min(.9,t.fastArpeggioProbability+.05)),e.filterMotion&&(t.detuneProbability=Math.min(.9,t.detuneProbability+.1)),e.syncopationBias&&(t.echoProbability=Math.min(.9,t.echoProbability+.05)),e.atmosPad&&(t.echoProbability=Math.min(.95,t.echoProbability+.08)),e.breakInsertion&&(t.fastArpeggioProbability=Math.max(.05,t.fastArpeggioProbability*.9)),t}const Re={standard:{id:"standard",description:"Classic melody + accompaniment + bass",voices:[{role:"melody",channel:"square1",priority:1,octaveOffset:0},{role:"accompaniment",channel:"square2",priority:1,octaveOffset:0},{role:"bass",channel:"triangle",priority:1,octaveOffset:0}]},swapped:{id:"swapped",description:"Swapped square channels for tonal variety",voices:[{role:"melody",channel:"square2",priority:1,octaveOffset:0},{role:"accompaniment",channel:"square1",priority:1,octaveOffset:0},{role:"bass",channel:"triangle",priority:1,octaveOffset:0}]},dualBass:{id:"dualBass",description:"Melody with dual bass (thick low end)",voices:[{role:"melody",channel:"square1",priority:1,octaveOffset:0},{role:"bass",channel:"square2",priority:1,octaveOffset:0,seedOffset:0},{role:"bassAlt",channel:"triangle",priority:.7,octaveOffset:-1,seedOffset:100}]},bassLed:{id:"bassLed",description:"Bass-focused with sparse melodic decoration",voices:[{role:"bass",channel:"triangle",priority:1,octaveOffset:-1,seedOffset:0},{role:"bassAlt",channel:"square2",priority:.8,octaveOffset:0,seedOffset:200},{role:"melody",channel:"square1",priority:.3,octaveOffset:0}]},layeredBass:{id:"layeredBass",description:"Layered bass with complementary square/triangle movement",voices:[{role:"bass",channel:"square1",priority:1,octaveOffset:0,seedOffset:0},{role:"bassAlt",channel:"triangle",priority:.85,octaveOffset:0,seedOffset:160},{role:"melody",channel:"square2",priority:1,octaveOffset:0}]},minimal:{id:"minimal",description:"Minimal techno: bass + sparse pad only",voices:[{role:"bass",channel:"square1",priority:1,octaveOffset:0},{role:"pad",channel:"triangle",priority:.4,octaveOffset:0}]},breakLayered:{id:"breakLayered",description:"Breakbeat layering: dual bass pressure with agile lead",voices:[{role:"bass",channel:"square1",priority:1,octaveOffset:0,seedOffset:0},{role:"bassAlt",channel:"triangle",priority:.95,octaveOffset:-1,seedOffset:140},{role:"melody",channel:"square2",priority:.85,octaveOffset:0,seedOffset:240}]},lofiPadLead:{id:"lofiPadLead",description:"Lo-fi pad-first texture with gentle lead flourishes",voices:[{role:"pad",channel:"triangle",priority:.9,octaveOffset:-1},{role:"accompaniment",channel:"square2",priority:1,octaveOffset:-1,seedOffset:60},{role:"melody",channel:"square1",priority:.45,octaveOffset:0,seedOffset:180}]},retroPulse:{id:"retroPulse",description:"Retro loopwave pulse arpeggios with anchored bass",voices:[{role:"melody",channel:"square1",priority:1,octaveOffset:0,seedOffset:80},{role:"accompaniment",channel:"square2",priority:.85,octaveOffset:0,seedOffset:140},{role:"bass",channel:"triangle",priority:.9,octaveOffset:-1,seedOffset:40}]}},St={minimalTechno:{standard:2,minimal:5,bassLed:3,dualBass:2,swapped:1,layeredBass:1},progressiveHouse:{standard:4,swapped:3,layeredBass:3,dualBass:2,bassLed:1,minimal:0},retroLoopwave:{standard:2,swapped:3,retroPulse:5,layeredBass:1,minimal:0,bassLed:1},breakbeatJungle:{breakLayered:5,dualBass:3,layeredBass:2,bassLed:2,standard:1,swapped:1,minimal:0},lofiChillhop:{lofiPadLead:5,minimal:3,standard:2,swapped:1,bassLed:1,layeredBass:0,dualBass:1}},Ee={standard:5,swapped:4,dualBass:2,bassLed:2,layeredBass:2,minimal:1,breakLayered:1,lofiPadLead:1,retroPulse:2};function Rt(a,e){const t=e?{...Ee,...St[e]}:Ee,s=Object.entries(t),r=s.reduce((i,[,u])=>i+u,0),o=O(a,100);let n=0;for(const[i,u]of s)if(n+=u/r,o<n)return Re[i];return Re.standard}function Et(a){const e=Qe[a.tempo],t=Math.round((O(a.seed,1)-.5)*30),s=e+Math.max(-15,Math.min(15,t)),r=Ze[a.mood],o=Bt(a.mood,a.seed),n=tt[o];if(!n)throw new Error(`Scale not defined for key ${o}`);const i=lt(o,r,a.seed),u=ot(a),l=pt(a,i,a.seed,u),c=it(a,l),d=yt(a.mood,c,a.seed);Tt(a.lengthInMeasures,l);const h=Rt(a.seed,a.stylePreset);return{bpm:s,key:o,scaleDegrees:n,sections:l,techniqueStrategy:d,styleIntent:c,voiceArrangement:h}}function Pt(a,e){const t=at[a]??ve.map((r,o)=>o),s=t[Math.floor(O(e,60)*t.length)]??0;return ve[s].map(r=>({...r}))}function Pe(a,e,t){const s=[...a];for(let r=s.length-1;r>0;r--){const o=Math.floor(O(e,t+r)*(r+1)),n=s[r];s[r]=s[o],s[o]=n}return s}function Bt(a,e){const t=et[a];if(t&&N.includes(t))return t;if(!N.length)throw new Error("Chord library is empty");const s=Math.floor(O(e,5)*N.length)%N.length;return N[s]}function Tt(a,e){const t=e.reduce((s,r)=>s+r.measures,0);if(t!==a)throw new Error(`Section length mismatch. expected=${a}, actual=${t}`)}const Ot={K:.25,S:.25,H:.125,O:.375,T:.5,N:.375},At={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},W={"":[0,4,7],m:[0,3,7],7:[0,4,7,10],m7:[0,3,7,10],maj7:[0,4,7,11],sus2:[0,2,7],sus4:[0,5,7],dim:[0,3,6],aug:[0,4,8]},y=4;function j(a,e){const t=a.match(/^[A-G](#|b)?/i);if(!t)return e;const s=t[0].toUpperCase(),r=At[s]??0;return e-e%12+r}function te(a){const e=a.match(/^[A-G](?:#|b)?(.*)$/),t=(e==null?void 0:e[1])??"";return t in W?W[t]:t.startsWith("m")?W.m:W[""]}function z(a,e,t,s=0){const r=((a-1)%e.length+e.length)%e.length,o=Math.floor((a-1)/e.length)+s,n=e[r]+12*o;return t+n}function Be(a,e,t){const s=[];for(let o=0;o<a.length;o++){const n=a[o];if(n==="-")continue;const i=e+o/16*y;s.push({startBeat:i,durationBeats:Ot[n]??.25,instrument:n,sectionId:t})}return s}function B(a,e,t=y){const s=Math.floor(e/t),r=a.sections.find(n=>s>=n.startMeasure&&s<n.startMeasure+n.measures);if(!r){const n=a.sections[0];return(n==null?void 0:n.chordProgression[0])??"C"}const o=Math.max(0,s-r.startMeasure);return r.chordProgression[o%r.chordProgression.length]}function xt(a){return 12*Math.log2(a)}function Ht(a){return 440*Math.pow(2,(a-69)/12)}function Kt(a){return(a%12+12)%12}function P(a,e){const t=j(e,a),s=te(e);let r=a,o=1/0;for(const n of s)for(let i=-2;i<=2;i++){const u=t+n+i*12,l=Math.abs(u-a);l<o&&(r=u,o=l)}return r}const Ft=new Set([0,3,4,5,7,8,9]);function L(a,e,t){if(t===void 0)return P(a,e);const s=j(e,t),r=te(e);let o=a,n=Number.POSITIVE_INFINITY;for(const i of r)for(let u=-2;u<=2;u++){const l=s+i+u*12,c=Kt(l-t),d=Ft.has(c)?0:10,h=Math.abs(l-a)*.1,p=Math.abs(l-t)*.05,g=d+h+p;g<n&&(n=g,o=l)}return o}const Te={MIN:20,MAX_ACCENT:118},w={TRIANGLE_BASE:.75,TRIANGLE_NON_BASS:.9,BASS_BASE:.7,BASS_LOW_RANGE:.85,SQUARE_BASS:.82},It={BASS_LOW_RANGE:52},Oe={broken:74,steady:70,arpeggio:76,default:72},Ae={DOWNBEAT_BOOST:6,STRONG_BEAT_BOOST:3},Ct={PICKUP_BASE:72},A={EARLY_START:52,PAD_MIN:48,ARPEGGIO_SCALE:.75,BROKEN_SCALE:.9,STEADY_SCALE:.85},xe={ECHO_SCALE:.6,DETUNE_SCALE:.7},D={KICK:120,TOM:116,LOW_NOISE:112,SNARE:115,HIHAT:118,OPEN_HAT:114},Dt=[{id:"RM001",length:4,pattern:[4,4,4,4],tags:["start","straight","loop_safe","loop_safe"],variations:["RM002","RM003"]},{id:"RM002",length:4,pattern:[4,8,8,4,4],tags:["start","straight","loop_safe","kick"],variations:["RM003","RM004"]},{id:"RM003",length:4,pattern:[8,8,8,8,4,4],tags:["start","straight","loop_safe","sfx_long"],variations:["RM004","RM005"]},{id:"RM004",length:4,pattern:[4,8,8,4,4],tags:["start","straight","loop_safe"],variations:["RM005","RM006"]},{id:"RM005",length:4,pattern:[8,8,4,8,8,4],tags:["start","straight","loop_safe"],variations:["RM006","RM007"]},{id:"RM006",length:4,pattern:[8,8,4,8,8,4],tags:["start","syncopation","loop_safe","anacrusis"],variations:["RM007","RM008"]},{id:"RM007",length:4,pattern:[8,16,16,8,16,16,4,4],tags:["start","syncopation","loop_safe","anacrusis"],variations:["RM008","RM027"]},{id:"RM008",length:4,pattern:[4,8,8,4,8,8],tags:["start","syncopation","loop_safe","anacrusis"],variations:["RM027","RM028"]},{id:"RM009",length:4,pattern:[8,8,4,8,8,4],tags:["middle","straight","bridge"],variations:["RM010","RM011"]},{id:"RM010",length:4,pattern:[4,4,8,8,4],tags:["middle","straight","bridge"],variations:["RM011","RM012"]},{id:"RM011",length:4,pattern:[4,4,4,8,8],tags:["middle","straight","bridge"],variations:["RM012","RM013"]},{id:"RM012",length:8,pattern:[8,8,4,4,8,8,4,4,4,4],tags:["middle","syncopation","bridge"],variations:["RM013","RM014"]},{id:"RM013",length:8,pattern:[4,8,8,4,8,8,4,4,4,4],tags:["middle","syncopation","bridge"],variations:["RM014","RM015"]},{id:"RM014",length:8,pattern:[8,8,8,8,4,4,4,4,4,4],tags:["middle","syncopation","bridge"],variations:["RM015","RM016"]},{id:"RM015",length:8,pattern:[4,4,4,4,4,4,4,4],tags:["middle","sustain","open"],variations:["RM016","RM017"]},{id:"RM016",length:8,pattern:[4,8,8,4,4,4,8,8,4,4],tags:["middle","sustain","open"],variations:["RM017","RM018"]},{id:"RM017",length:4,pattern:[8,16,16,8,16,16,8,16,16,4],tags:["middle","swing_hint","bridge"],variations:["RM018","RM029"]},{id:"RM018",length:4,pattern:[8,16,16,4,8,16,16,4],tags:["middle","swing_hint","bridge"],variations:["RM029","RM030"]},{id:"RM019",length:4,pattern:[4,4,4,4],tags:["end","straight","loop_safe"],variations:["RM020","RM021"]},{id:"RM020",length:4,pattern:[8,8,4,8,8,4],tags:["end","straight","loop_safe"],variations:["RM021","RM022"]},{id:"RM021",length:4,pattern:[4,8,8,4,4],tags:["end","straight","loop_safe"],variations:["RM022","RM023"]},{id:"RM022",length:4,pattern:[4,4,4,4],tags:["end","cadence"],variations:["RM023","RM024"]},{id:"RM023",length:4,pattern:[8,8,4,4,4],tags:["end","cadence"],variations:["RM024","RM025"]},{id:"RM024",length:4,pattern:[4,8,8,4,4],tags:["end","cadence"],variations:["RM025","RM026"]},{id:"RM025",length:8,pattern:[4,4,4,4,4,4,4,4],tags:["end","cadence","loop_safe"],variations:["RM026","RM019"]},{id:"RM026",length:8,pattern:[8,8,4,4,4,8,8,4,4,4],tags:["end","cadence","loop_safe"],variations:["RM019","RM020"]},{id:"RM027",length:4,pattern:[8,8,8,8,8,8,4],tags:["start","staccato","anacrusis"],variations:["RM028","RM001"]},{id:"RM028",length:4,pattern:[8,8,8,8,4,8,8],tags:["start","staccato","anacrusis"],variations:["RM001","RM002"]},{id:"RM029",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM030","RM031"]},{id:"RM030",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM031","RM032"]},{id:"RM031",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM032","RM033"]},{id:"RM032",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM033","RM034"]},{id:"RM033",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM034","RM035"]},{id:"RM034",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM035","RM036"]},{id:"RM035",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM036","RM037"]},{id:"RM036",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM037","RM038"]},{id:"RM037",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM038","RM039"]},{id:"RM038",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM039","RM040"]},{id:"RM039",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM040","RM041"]},{id:"RM040",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM041","RM042"]},{id:"RM041",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM042","RM043"]},{id:"RM042",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM043","RM044"]},{id:"RM043",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM044","RM045"]},{id:"RM044",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM045","RM046"]},{id:"RM045",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM046","RM047"]},{id:"RM046",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM047","RM048"]},{id:"RM047",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM048","RM049"]},{id:"RM048",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM049","RM050"]},{id:"RM049",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM050","RM009"]},{id:"RM050",length:8,pattern:[8,8,4,8,8,4,8,8,4,4,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM009","RM010"]},{id:"RM051",length:4,pattern:[8,8,4,8,8,4],tags:["start","accented","syncopation","loop_safe"],variations:["RM052","RM053"]},{id:"RM052",length:4,pattern:[4,8,8,4,4],tags:["middle","accented","bridge","loop_safe"],variations:["RM051","RM053"]},{id:"RM053",length:4,pattern:[8,8,8,8,4,4],tags:["end","accented","cadence","loop_safe"],variations:["RM051","RM052"]},{id:"RM054",length:4,pattern:[4,4,8,8,8,8],tags:["middle","accented","variation","loop_safe"],variations:["RM052","RM055"]},{id:"RM055",length:4,pattern:[4,8,8,8,8,4],tags:["start","accented","bridge","loop_safe"],variations:["RM051","RM054"]},{id:"RM056",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","straight","texture_loop","grid16","loop_safe"],variations:["RM057"]},{id:"RM057",length:4,pattern:[16,16,16,16,16,16,16,8,8,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe"],variations:["RM056"]},{id:"RM058",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","middle","texture_loop","grid16","loop_safe","simple"],variations:["RM059","RM060"]},{id:"RM059",length:4,pattern:[16,16,16,16,16,16,8,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM058","RM060"]},{id:"RM060",length:4,pattern:[16,16,8,16,16,16,16,8,16,16,16,16,8],tags:["middle","texture_loop","grid16","loop_safe","syncopation"],variations:["RM058","RM059"]},{id:"RM061",length:4,pattern:[8,8,8,8,8,8,8,8],tags:["start","middle","texture_loop","loop_safe","straight"],variations:["RM062"]},{id:"RM062",length:4,pattern:[8,8,8,16,16,8,8,8,16,16],tags:["middle","texture_loop","loop_safe","straight"],variations:["RM061"]},{id:"RM063",length:4,pattern:[16,16,16,16,8,16,16,16,16,8,16,16,16,16],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM064"]},{id:"RM064",length:4,pattern:[16,16,16,16,16,16,16,16,8,16,16,16,16,8],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM063"]},{id:"RM065",length:4,pattern:[4,16,16,16,16,4,16,16,16,16],tags:["start","middle","texture_loop","loop_safe","simple"],variations:["RM066"]},{id:"RM066",length:4,pattern:[4,16,16,16,16,8,8,16,16,16,16],tags:["middle","texture_loop","loop_safe"],variations:["RM065"]},{id:"RM067",length:4,pattern:[8,16,16,8,16,16,8,16,16,8,16,16],tags:["start","middle","texture_loop","loop_safe","straight"],variations:["RM068"]},{id:"RM068",length:4,pattern:[8,16,16,8,8,8,16,16,8,16,16],tags:["middle","texture_loop","loop_safe","syncopation"],variations:["RM067"]},{id:"RM069",length:4,pattern:[16,16,8,16,16,8,16,16,8,16,16,8],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM070"]},{id:"RM070",length:4,pattern:[16,16,8,8,16,16,8,16,16,8,16,16],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"],variations:["RM069"]},{id:"RM071",length:4,pattern:[4,4,16,16,16,16,4],tags:["start","middle","texture_loop","loop_safe","accented"],variations:["RM072"]},{id:"RM072",length:4,pattern:[4,8,8,16,16,16,16,4],tags:["middle","end","texture_loop","loop_safe","accented"],variations:["RM071"]},{id:"RM073",length:8,pattern:[4,4,4,4,4,4,4,4],tags:["end","cadence","loop_safe","final"],variations:["RM074","RM075"]},{id:"RM074",length:8,pattern:[4,8,8,4,4,4,8,8,4,4],tags:["end","cadence","loop_safe","final"],variations:["RM073","RM075"]},{id:"RM075",length:8,pattern:[8,8,4,4,4,2,2],tags:["end","cadence","loop_safe","ritardando"],variations:["RM073","RM074"]},{id:"RM076",length:4,pattern:[8,8,8,8,4,4],tags:["start","anacrusis","staccato","loop_safe"],variations:["RM077","RM078"]},{id:"RM077",length:4,pattern:[16,16,16,16,8,8,4,4],tags:["start","anacrusis","drive","loop_safe"],variations:["RM076","RM078"]},{id:"RM078",length:4,pattern:[8,8,4,8,8,4],tags:["start","anacrusis","syncopation","loop_safe"],variations:["RM076","RM077"]},{id:"RM079",length:4,pattern:[8,16,16,4,8,16,16,4],tags:["middle","syncopation","drive","loop_safe"],variations:["RM080","RM081"]},{id:"RM080",length:4,pattern:[4,16,16,8,8,4,8],tags:["middle","syncopation","accented","loop_safe"],variations:["RM079","RM082"]},{id:"RM081",length:4,pattern:[16,16,8,16,16,8,16,16,8,4],tags:["start","syncopation","staccato","loop_safe"],variations:["RM079","RM082"]},{id:"RM082",length:4,pattern:[8,8,16,16,16,16,8,8,4],tags:["middle","syncopation","drive","loop_safe"],variations:["RM080","RM083"]},{id:"RM083",length:4,pattern:[4,8,16,16,8,8,4],tags:["middle","syncopation","bridge","loop_safe"],variations:["RM082","RM084"]},{id:"RM084",length:8,pattern:[8,16,16,8,16,16,4,4,8,16,16,8,16,16,4,4],tags:["middle","syncopation","drive","loop_safe"],variations:["RM083","RM085"]},{id:"RM085",length:8,pattern:[4,8,8,4,4,8,8,4,4,4],tags:["end","syncopation","cadence","loop_safe"],variations:["RM084","RM079"]},{id:"RM086",length:8,pattern:[8,8,4,8,8,4,8,8,4,8,8,4],tags:["middle","bridge","syncopation","loop_safe"],variations:["RM087","RM088"]},{id:"RM087",length:8,pattern:[4,4,8,8,8,8,4,4,8,8,8,8],tags:["middle","bridge","straight","loop_safe"],variations:["RM086","RM089"]},{id:"RM088",length:8,pattern:[16,16,16,16,8,8,4,4,16,16,16,16,8,8,4,4],tags:["middle","bridge","drive","loop_safe"],variations:["RM086","RM089"]},{id:"RM089",length:8,pattern:[8,8,8,8,4,4,8,8,8,8,4,4],tags:["middle","bridge","sustain","loop_safe"],variations:["RM087","RM090"]},{id:"RM090",length:8,pattern:[4,8,8,4,4,8,8,4,4,4],tags:["middle","bridge","variation","loop_safe"],variations:["RM089","RM086"]},{id:"RM091",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM092",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","syncopation"]},{id:"RM093",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","simple"]},{id:"RM094",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","accented"]},{id:"RM095",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM096",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM097",length:4,pattern:[8,8,16,16,16,16,8,8,16,16,16,16],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","syncopation"]},{id:"RM098",length:4,pattern:[16,16,8,16,16,8,16,16,8,16,16,8],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","simple"]},{id:"RM099",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","accented"]},{id:"RM100",length:4,pattern:[8,16,16,16,16,8,16,16,16,16,8,8],tags:["start","texture_loop","grid16","percussive_layer","loop_safe","open"]},{id:"RM101",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","straight"]},{id:"RM102",length:4,pattern:[8,16,16,16,16,8,8,16,16,16,16,8],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","syncopation"]},{id:"RM103",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","simple"]},{id:"RM104",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","accented"]},{id:"RM105",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["end","texture_loop","grid16","percussive_layer","loop_safe","open"]},{id:"RM106",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","straight"]},{id:"RM107",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","syncopation"]},{id:"RM108",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","simple"]},{id:"RM109",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","accented"]},{id:"RM110",length:4,pattern:[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],tags:["middle","texture_loop","grid16","percussive_layer","open"]},{id:"RM111",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16}],tags:["middle","texture_loop","grid16","syncopation","percussive_layer"]},{id:"RM112",length:4,pattern:[{value:8,accent:!0},{value:16},{value:16},{value:8},{value:16},{value:16,accent:!0},{value:8},{value:16},{value:16},{value:8,rest:!0},{value:16},{value:16}],tags:["middle","texture_loop","grid16","percussive_layer","drive"]},{id:"RM113",length:4,pattern:[{value:4,accent:!0},{value:16},{value:16},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","syncopation","break"]},{id:"RM114",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0}],tags:["middle","loop_safe","grid16","syncopation","breakbeat"]},{id:"RM115",length:4,pattern:[{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:4},{value:16,rest:!0},{value:8,accent:!0},{value:16,rest:!0},{value:16},{value:16,rest:!0}],tags:["middle","loop_safe","swing_hint","rest_heavy","lofi"]},{id:"RM116",length:4,pattern:[{value:8,accent:!0},{value:16},{value:16},{value:8,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:8},{value:16,accent:!0},{value:16},{value:8,accent:!0},{value:16,rest:!0},{value:16,accent:!0}],tags:["middle","loop_safe","syncopation","grid16","breakbeat"]},{id:"RM117",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16},{value:16,accent:!0},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0}],tags:["middle","loop_safe","grid16","syncopation","breakbeat","variation"]},{id:"RM118",length:4,pattern:[{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:8,accent:!0},{value:8,rest:!0},{value:8},{value:16,rest:!0},{value:8},{value:16,rest:!0}],tags:["middle","loop_safe","swing_hint","rest_heavy","lofi"]},{id:"RM119",length:4,pattern:[{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:8},{value:16,rest:!0},{value:8,accent:!0},{value:16,rest:!0},{value:8},{value:8}],tags:["start","loop_safe","swing_hint","rest_heavy","lofi","variation"]}],kt=[{id:"MF001",pattern:[1,3,5],tags:["ascending","scalar","bright","heroic","start","loop_safe","short","slide"]},{id:"MF002",pattern:[1,4,5,7],tags:["ascending","scalar","bright","heroic","start","loop_safe","short","bend"]},{id:"MF003",pattern:[2,3,6,6,9],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF004",pattern:[1,3,6,6,7],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF005",pattern:[1,3,5,7,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF006",pattern:[1,3,4],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF007",pattern:[2,4,5,6],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF008",pattern:[1,2,5,5,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF009",pattern:[1,3,6,6,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF010",pattern:[1,3,5,6,8],tags:["ascending","scalar","bright","heroic","start","loop_safe","short"]},{id:"MF011",pattern:[5,4,3],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF012",pattern:[5,5,3,3],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF013",pattern:[6,4,4,2,2],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF014",pattern:[4,4,4,2,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF015",pattern:[5,4,3,3,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF016",pattern:[5,4,2],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF017",pattern:[6,5,3,2],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF018",pattern:[5,3,3,1,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF019",pattern:[5,4,4,2,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF020",pattern:[5,4,3,2,1],tags:["descending","scalar","dark","melancholic","cadence","short"]},{id:"MF021",pattern:[1,4,6],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF022",pattern:[1,5,6,6],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF023",pattern:[2,4,7,5,4],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF024",pattern:[1,4,7,5,2],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF025",pattern:[1,4,6,6,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF026",pattern:[1,4,5],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF027",pattern:[2,5,6,5],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF028",pattern:[1,3,6,4,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF029",pattern:[1,4,7,5,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF030",pattern:[1,4,6,5,3],tags:["arch","leaping","bright","complex","middle","short"]},{id:"MF031",pattern:[6,4,2],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF032",pattern:[6,5,2,4],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF033",pattern:[7,4,3,3,2],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF034",pattern:[5,4,3,3,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF035",pattern:[6,4,2,4,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF036",pattern:[6,4,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF037",pattern:[7,5,2,3],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF038",pattern:[6,3,2,2,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF039",pattern:[6,4,3,3,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF040",pattern:[6,4,2,3,1],tags:["valley","neighbor","dark","complex","middle","short"]},{id:"MF041",pattern:[1,2,3],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF042",pattern:[1,3,3,6],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF043",pattern:[2,2,4,5,8],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF044",pattern:[1,2,4,5,6,6],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF045",pattern:[1,2,3,6,7,7],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF046",pattern:[1,2,2],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF047",pattern:[2,3,3,5],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF048",pattern:[1,1,3,4,7],tags:["ascending","arpeggio","bright","simple","start","short"]},{id:"MF049",pattern:[1,2,4,5,7,7],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF050",pattern:[1,2,3,5,7,6],tags:["ascending","arpeggio","bright","simple","start","extended"]},{id:"MF051",pattern:[5,7,6],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF052",pattern:[5,8,6,5],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF053",pattern:[6,7,7,4,3],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF054",pattern:[4,7,7,4,1],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF055",pattern:[5,7,6,5,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF056",pattern:[5,7,5],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF057",pattern:[6,8,6,4],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF058",pattern:[5,6,6,3,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF059",pattern:[5,7,7,4,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF060",pattern:[5,7,6,4,2],tags:["descending","arpeggio","dark","heroic","bridge","short"]},{id:"MF061",pattern:[3,5,4],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF062",pattern:[3,6,4,7],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF063",pattern:[4,5,5,6,6],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF064",pattern:[2,5,5,6,4,3],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF065",pattern:[3,5,4,7,5,4],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF066",pattern:[3,5,3],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF067",pattern:[4,6,4,6],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF068",pattern:[3,4,4,5,5],tags:["wave","scalar","peaceful","simple","loop_safe","short"]},{id:"MF069",pattern:[3,5,5,6,5,4],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF070",pattern:[3,5,4,6,5,3],tags:["wave","scalar","peaceful","simple","loop_safe","extended"]},{id:"MF071",pattern:[2,4,6],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF072",pattern:[2,5,6,6],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF073",pattern:[3,4,7,5,4],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF074",pattern:[1,4,7,5,2,1],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF075",pattern:[2,4,6,6,3,2],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF076",pattern:[2,4,5],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF077",pattern:[3,5,6,5],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF078",pattern:[2,3,6,4,3],tags:["ascending","sequence","tense","complex","build","short"]},{id:"MF079",pattern:[2,4,7,5,3,2],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF080",pattern:[2,4,6,5,3,1],tags:["ascending","sequence","tense","complex","build","extended"]},{id:"MF081",pattern:[1,5,3],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF082",pattern:[1,6,3,7],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF083",pattern:[2,5,4,6,5],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF084",pattern:[1,5,4,6,3,7],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF085",pattern:[1,5,3,7,4,8],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF086",pattern:[1,5,2],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF087",pattern:[2,6,3,6],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF088",pattern:[1,4,3,5,4],tags:["arch","leaping","upbeat","bright","start","short"]},{id:"MF089",pattern:[1,5,4,6,4,8],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF090",pattern:[1,5,3,6,4,7],tags:["arch","leaping","upbeat","bright","start","extended"]},{id:"MF091",pattern:[6,3,5],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF092",pattern:[6,4,5,3],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF093",pattern:[7,3,6,2,5],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF094",pattern:[5,3,6,2,3,1],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF095",pattern:[6,3,5,3,4,2],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF096",pattern:[6,3,4],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF097",pattern:[7,4,5,2],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF098",pattern:[6,2,5,1,4],tags:["valley","leaping","tense","dark","cadence","loop_safe","short"]},{id:"MF099",pattern:[6,3,6,2,4,2],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF100",pattern:[6,3,5,2,4,1],tags:["valley","leaping","tense","dark","cadence","loop_safe","extended"]},{id:"MF101",pattern:[1,1,1,1],tags:["flat","static","texture_loop","loop_safe","simple","ostinato"]},{id:"MF102",pattern:[1,5,1,5],tags:["flat","texture_loop","loop_safe","ostinato","percussive_layer"]},{id:"MF103",pattern:[1,1,1,1],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF104",pattern:[1,1,1,2,1],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF105",pattern:[5,5,5,5],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF106",pattern:[1,2,1,2],tags:["flat","static","drone","loop_safe","ostinato","simple"]},{id:"MF107",pattern:[3,3,3,3],tags:["flat","static","drone","loop_safe","simple"]},{id:"MF108",pattern:[1,3,1,3],tags:["flat","static","drone","loop_safe","ostinato"]},{id:"MF109",pattern:[1,1,5,1,1,5],tags:["flat","static","loop_safe","ostinato","percussive_layer"]},{id:"MF110",pattern:[1,1,1,1,1,1],tags:["flat","static","drone","loop_safe","simple","texture_loop"]},{id:"MF111",pattern:[5,6,7,1],tags:["mysterious","ascending","dark","start","loop_safe","short"]},{id:"MF112",pattern:[1,7,6,5],tags:["mysterious","descending","dark","middle","loop_safe","short"]},{id:"MF113",pattern:[3,1,6,5],tags:["mysterious","complex","dark","tense","loop_safe","short"]},{id:"MF114",pattern:[1,2,3,2,1],tags:["playful","neighbor","bright","simple","loop_safe","short"]},{id:"MF115",pattern:[5,4,3,4,5],tags:["playful","wave","bright","upbeat","loop_safe","short"]},{id:"MF116",pattern:[1,3,5,3,1],tags:["playful","arch","bright","simple","loop_safe","short"]},{id:"MF117",pattern:[1,5,1,5],tags:["epic","leaping","bright","heroic","loop_safe","short"]},{id:"MF118",pattern:[5,6,7,1,2],tags:["epic","ascending","bright","heroic","build","short"]},{id:"MF119",pattern:[1,3,5,7,1],tags:["epic","ascending","arpeggio","heroic","bright","short"]},{id:"MF120",pattern:[6,5,4,3],tags:["mysterious","descending","scalar","dark","loop_safe","short"]},{id:"MF121",pattern:[3,5,3,1],tags:["playful","wave","bright","simple","loop_safe","short"]},{id:"MF122",pattern:[5,3,1,5],tags:["epic","leaping","arpeggio","heroic","loop_safe","short"]},{id:"MF123",pattern:[1,6,5,1],tags:["mysterious","complex","dark","cadence","loop_safe","short"]},{id:"MF124",pattern:[2,3,4,5],tags:["playful","ascending","scalar","bright","loop_safe","short"]},{id:"MF125",pattern:[1,4,7,4,1],tags:["epic","arch","leaping","heroic","bright","extended"]},{id:"MF126",pattern:[5,7,6,5,3],tags:["mysterious","complex","dark","descending","loop_safe","extended"]},{id:"MF127",pattern:[1,1,3,3,5,5],tags:["playful","sequence","ascending","bright","loop_safe","extended"]},{id:"MF128",pattern:[1,7,1,5],tags:["epic","leaping","heroic","bright","loop_safe","short"]},{id:"MF129",pattern:[3,2,1,6],tags:["mysterious","descending","dark","tense","loop_safe","short"]},{id:"MF130",pattern:[5,5,6,6,7,7,1],tags:["epic","sequence","ascending","heroic","build","extended"]},{id:"MF131",pattern:[5,4,3,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF132",pattern:[6,5,4,2],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF133",pattern:[7,5,3,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF134",pattern:[5,3,2,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF135",pattern:[6,4,3,1],tags:["mysterious","descending","dark","start","loop_safe","short"]},{id:"MF136",pattern:[1,2,3,5],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF137",pattern:[1,3,5,6],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF138",pattern:[2,3,4,6],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF139",pattern:[1,2,4,5],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF140",pattern:[3,4,5,7],tags:["mysterious","ascending","dark","middle","stepwise","short"]},{id:"MF141",pattern:[7,6,5,4,3],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF142",pattern:[5,4,3,2,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF143",pattern:[6,5,4,3,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF144",pattern:[7,5,4,2,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF145",pattern:[5,4,3,1],tags:["mysterious","descending","dark","end","static","short"]},{id:"MF146",pattern:[1,2,1,3,1],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF147",pattern:[5,6,5,7,5],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF148",pattern:[1,3,1,2,1],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF149",pattern:[5,7,5,6,5],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF150",pattern:[1,4,1,3,1],tags:["mysterious","texture_loop","ostinato","loop_safe","short","dark"]},{id:"MF151",pattern:[1,4,6,5,7,6,4],tags:["breakbeat","tense","leaping","loop_safe","short"]},{id:"MF152",pattern:[5,3,6,4,7,5],tags:["breakbeat","tense","sequence","loop_safe","short","variation"]},{id:"MF153",pattern:[1,5,4,6,3,7,5],tags:["breakbeat","upbeat","leaping","loop_safe","extended"]},{id:"MF154",pattern:[1,1,3,2,1],tags:["lofi","peaceful","stepwise","loop_safe","short"]},{id:"MF155",pattern:[5,4,4,3,2,2],tags:["lofi","peaceful","descending","loop_safe","long"]},{id:"MF156",pattern:[1,3,2,5,4,3,1],tags:["lofi","melancholic","stepwise","loop_safe","extended"]}],Nt=[{id:"MR001",length:4,pattern:[{value:4},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["start","simple","drive","loop_safe"]},{id:"MR002",length:4,pattern:[{value:8},{value:8},{value:8},{value:8},{value:4},{value:4}],tags:["middle","syncopated","drive"]},{id:"MR003",length:4,pattern:[{value:4},{value:4},{value:4},{value:4}],tags:["start","legato","simple"]},{id:"MR004",length:4,pattern:[{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4}],tags:["middle","rest_heavy","staccato"]},{id:"MR005",length:4,pattern:[{value:8},{value:8},{value:4},{value:8},{value:8},{value:4}],tags:["middle","syncopated","drive"]},{id:"MR006",length:4,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["middle","legato","rest_heavy"]},{id:"MR007",length:4,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8}],tags:["start","staccato","drive"]},{id:"MR008",length:8,pattern:[{value:8},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4}],tags:["start","bridge","legato"]},{id:"MR009",length:4,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16},{value:16}],tags:["end","legato","loop_safe","cadence"]},{id:"MR010",length:4,pattern:[{value:8},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4}],tags:["end","syncopated","staccato","loop_safe","cadence"]},{id:"MR011",length:4,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:4}],tags:["start","legato","rest_heavy","loop_safe"]},{id:"MR012",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:8},{value:8},{value:8},{value:8}],tags:["middle","staccato","drive","syncopated"]},{id:"MR013",length:4,pattern:[{value:8,rest:!0},{value:8,rest:!0},{value:4},{value:8},{value:8},{value:4}],tags:["middle","rest_heavy","simple"]},{id:"MR014",length:4,pattern:[{value:4},{value:8},{value:8},{value:16,rest:!0},{value:16},{value:4},{value:8}],tags:["middle","syncopated","drive","accented"]},{id:"MR015",length:4,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:8},{value:8}],tags:["end","legato","rest_heavy","loop_safe"]},{id:"MR016",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:16,rest:!0},{value:16,rest:!0},{value:16},{value:16},{value:4},{value:4},{value:8},{value:8},{value:4}],tags:["bridge","legato","rest_heavy"]},{id:"MR017",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4}],tags:["bridge","syncopated","drive"]},{id:"MR018",length:8,pattern:[{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4}],tags:["end","legato","loop_safe","cadence"]},{id:"MR019",length:4,pattern:[{value:4},{value:8},{value:8},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16},{value:8},{value:8}],tags:["start","drive","accented"]},{id:"MR020",length:4,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:8},{value:8}],tags:["middle","rest_heavy","simple"]},{id:"MR021",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["middle","staccato","drive","syncopated"]},{id:"MR022",length:4,pattern:[{value:4},{value:8,rest:!0},{value:16,rest:!0},{value:16},{value:4},{value:8,rest:!0},{value:8}],tags:["end","legato","loop_safe"]},{id:"MR023",length:8,pattern:[{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8}],tags:["bridge","syncopated","drive","accented"]},{id:"MR024",length:8,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4}],tags:["bridge","legato","rest_heavy"]},{id:"MR025",length:8,pattern:[{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8,rest:!0},{value:4},{value:4},{value:8,rest:!0},{value:8,rest:!0},{value:4},{value:4}],tags:["end","legato","loop_safe","cadence"]},{id:"MR026",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["start","texture_loop","grid16","drive","loop_safe"]},{id:"MR027",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:8},{value:8},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR028",length:4,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8}],tags:["start","middle","texture_loop","simple","loop_safe","percussive_layer"]},{id:"MR029",length:4,pattern:[{value:8},{value:16},{value:16},{value:8},{value:8},{value:16},{value:16},{value:8},{value:8},{value:8}],tags:["middle","texture_loop","loop_safe","percussive_layer"]},{id:"MR030",length:4,pattern:[{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16}],tags:["start","middle","texture_loop","loop_safe","percussive_layer"]},{id:"MR031",length:4,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR032",length:4,pattern:[{value:8},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["middle","texture_loop","loop_safe","percussive_layer","syncopated"]},{id:"MR033",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:8},{value:16},{value:16},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["start","middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR034",length:8,pattern:[{value:4},{value:4},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16},{value:4},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16},{value:4},{value:4},{value:16,rest:!0},{value:16},{value:16,rest:!0},{value:16}],tags:["middle","end","staccato","rest_heavy","percussive_layer","loop_safe"]},{id:"MR035",length:4,pattern:[{value:8},{value:16,rest:!0},{value:16},{value:8},{value:16,rest:!0},{value:16},{value:8},{value:16,rest:!0},{value:16},{value:8},{value:16,rest:!0},{value:16}],tags:["start","middle","staccato","rest_heavy","percussive_layer","loop_safe"]},{id:"MR036",length:4,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:16},{value:16},{value:16},{value:16}],tags:["start","middle","rest_heavy","loop_safe","simple"]},{id:"MR037",length:4,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16}],tags:["middle","end","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR038",length:8,pattern:[{value:4},{value:4},{value:4},{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4}],tags:["start","drive","syncopated"]},{id:"MR039",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["start","simple","drive"]},{id:"MR040",length:8,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8}],tags:["start","legato","rest_heavy"]},{id:"MR041",length:8,pattern:[{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4}],tags:["start","syncopated","drive"]},{id:"MR042",length:8,pattern:[{value:4},{value:4},{value:8},{value:8},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["start","simple","legato"]},{id:"MR043",length:8,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:4},{value:4},{value:16},{value:16},{value:8},{value:4},{value:4},{value:4}],tags:["start","staccato","drive"]},{id:"MR044",length:8,pattern:[{value:8,rest:!0},{value:8},{value:4},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["start","rest_heavy","simple"]},{id:"MR045",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["start","syncopated","accented"]},{id:"MR046",length:8,pattern:[{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["middle","drive","syncopated"]},{id:"MR047",length:8,pattern:[{value:4},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","simple","legato"]},{id:"MR048",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","staccato","drive"]},{id:"MR049",length:8,pattern:[{value:4},{value:8,rest:!0},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["middle","rest_heavy","legato"]},{id:"MR050",length:8,pattern:[{value:8},{value:16},{value:16},{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4}],tags:["middle","syncopated","accented"]},{id:"MR051",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:4}],tags:["middle","simple","drive"]},{id:"MR052",length:8,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","staccato","syncopated"]},{id:"MR053",length:8,pattern:[{value:8,rest:!0},{value:8},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["middle","rest_heavy","staccato"]},{id:"MR054",length:8,pattern:[{value:4},{value:4},{value:8},{value:8},{value:4},{value:4},{value:8},{value:8},{value:4},{value:4}],tags:["end","legato","loop_safe","cadence"]},{id:"MR055",length:8,pattern:[{value:8},{value:8},{value:4},{value:8},{value:8},{value:4},{value:8,rest:!0},{value:8},{value:4},{value:4},{value:4}],tags:["end","syncopated","loop_safe","cadence"]},{id:"MR056",length:8,pattern:[{value:4},{value:8},{value:8},{value:4},{value:4},{value:4},{value:4},{value:4},{value:4}],tags:["end","simple","loop_safe","cadence"]},{id:"MR057",length:8,pattern:[{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR058",length:8,pattern:[{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8},{value:8}],tags:["middle","texture_loop","simple","loop_safe","percussive_layer"]},{id:"MR059",length:8,pattern:[{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR060",length:8,pattern:[{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16},{value:8},{value:16},{value:16}],tags:["middle","end","texture_loop","loop_safe","percussive_layer"]},{id:"MR061",length:8,pattern:[{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16},{value:4},{value:16},{value:16},{value:16},{value:16}],tags:["middle","texture_loop","grid16","loop_safe","percussive_layer"]},{id:"MR062",length:4,pattern:[{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16},{value:16,rest:!0},{value:16,accent:!0},{value:16}],tags:["middle","texture_loop","grid16","syncopated","drive"]},{id:"MR063",length:4,pattern:[{value:8,accent:!0},{value:16},{value:16},{value:8},{value:16},{value:16,accent:!0},{value:8},{value:16},{value:16},{value:8,rest:!0},{value:16},{value:16}],tags:["middle","texture_loop","grid16","percussive_layer","ostinato"]},{id:"MR064",length:4,pattern:[{value:4,accent:!0},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16},{value:16}],tags:["start","texture_loop","grid16","percussive_layer","loop_safe"]}],Lt=[{id:"DP001",length_beats:4,type:"beat",pattern:"K-H-S-H-K-H-S-H-",tags:["loop_safe"]},{id:"DP002",length_beats:4,type:"beat",pattern:"H-S-H-K-H-S-H-K-",tags:["loop_safe","variation"]},{id:"DP003",length_beats:4,type:"beat",pattern:"K---S---K-H-S-H",tags:["bridge"]},{id:"DP004",length_beats:4,type:"beat",pattern:"--S---K-H-S-HK-",tags:["bridge","variation"]},{id:"DP005",length_beats:4,type:"beat",pattern:"K-H-K---S-H-K---",tags:["build"]},{id:"DP006",length_beats:4,type:"beat",pattern:"H-K---S-H-K---K-",tags:["build","variation"]},{id:"DP007",length_beats:4,type:"beat",pattern:"K---S-H-K---S-H-",tags:["straight"]},{id:"DP008",length_beats:4,type:"beat",pattern:"--S-H-K---S-H-K-",tags:["straight","variation"]},{id:"DP009",length_beats:4,type:"beat",pattern:"K-H---S-K-H---S-",tags:["syncopation"]},{id:"DP010",length_beats:4,type:"beat",pattern:"H---S-K-H---S-K-",tags:["syncopation","variation"]},{id:"DP011",length_beats:4,type:"beat",pattern:"K---H-K-S---H-K-",tags:["open"]},{id:"DP012",length_beats:4,type:"beat",pattern:"--H-K-S---H-K-K-",tags:["open","variation"]},{id:"DP013",length_beats:4,type:"beat",pattern:"K-H-K-H-S-H-K-H-",tags:["loop_safe"]},{id:"DP014",length_beats:4,type:"beat",pattern:"H-K-H-S-H-K-H-K-",tags:["loop_safe","variation"]},{id:"DP015",length_beats:4,type:"beat",pattern:"K---S---K---H---",tags:["simple"]},{id:"DP016",length_beats:4,type:"beat",pattern:"--S---K---H---K-",tags:["simple","variation"]},{id:"DP017",length_beats:4,type:"beat",pattern:"K-H---K-S-H---K-",tags:["bridge"]},{id:"DP018",length_beats:4,type:"beat",pattern:"H---K-S-H---K-K-",tags:["bridge","variation"]},{id:"DP019",length_beats:4,type:"beat",pattern:"K--H-K--S-H-K--",tags:["swing_hint"]},{id:"DP020",length_beats:4,type:"beat",pattern:"-H-K--S-H-K--K-",tags:["swing_hint","variation"]},{id:"DP021",length_beats:4,type:"fill",pattern:"S-S-S-S-S-S-O---",tags:["cadence"]},{id:"DP022",length_beats:4,type:"fill",pattern:"S-S-S-S-O---S-S-",tags:["cadence","variation"]},{id:"DP023",length_beats:8,type:"fill",pattern:"S-S-S-S-S-S-O---S-S-S-S-S-S-O---",tags:["cadence","extended"]},{id:"DP024",length_beats:4,type:"fill",pattern:"KSKO-KSKO-KSKO-K",tags:["build"]},{id:"DP025",length_beats:4,type:"fill",pattern:"-KSKO-KSKO-KKSKO",tags:["build","variation"]},{id:"DP026",length_beats:8,type:"fill",pattern:"KSKO-KSKO-KSKO-KKSKO-KSKO-KSKO-K",tags:["build","extended"]},{id:"DP027",length_beats:4,type:"fill",pattern:"S-HS-HS-HS-HS-HS",tags:["bridge"]},{id:"DP028",length_beats:4,type:"fill",pattern:"-HS-HS-HS-HSS-HS",tags:["bridge","variation"]},{id:"DP029",length_beats:8,type:"fill",pattern:"S-HS-HS-HS-HS-HSS-HS-HS-HS-HS-HS",tags:["bridge","extended"]},{id:"DP030",length_beats:4,type:"fill",pattern:"K-SK-SK-SK-SK-SK",tags:["build"]},{id:"DP031",length_beats:4,type:"fill",pattern:"-SK-SK-SK-SKK-SK",tags:["build","variation"]},{id:"DP032",length_beats:8,type:"fill",pattern:"K-SK-SK-SK-SK-SKK-SK-SK-SK-SK-SK",tags:["build","extended"]},{id:"DP033",length_beats:4,type:"fill",pattern:"S--S-HHS--S-HHS-",tags:["break"]},{id:"DP034",length_beats:4,type:"fill",pattern:"-HHS--S-HHS-S--S",tags:["break","variation"]},{id:"DP035",length_beats:8,type:"fill",pattern:"S--S-HHS--S-HHS-S--S-HHS--S-HHS-",tags:["break","extended"]},{id:"DP036",length_beats:4,type:"fill",pattern:"K-K-K-K-S-S-S-S-",tags:["cadence"]},{id:"DP037",length_beats:4,type:"fill",pattern:"K-K-S-S-S-S-K-K-",tags:["cadence","variation"]},{id:"DP038",length_beats:8,type:"fill",pattern:"K-K-K-K-S-S-S-S-K-K-K-K-S-S-S-S-",tags:["cadence","extended"]},{id:"DP039",length_beats:4,type:"fill",pattern:"S-S-H-H-S-S-H-H-",tags:["bridge"]},{id:"DP040",length_beats:4,type:"fill",pattern:"H-H-S-S-H-H-S-S-",tags:["bridge","variation"]},{id:"DP041",length_beats:8,type:"fill",pattern:"S-S-H-H-S-S-H-H-S-S-H-H-S-S-H-H-",tags:["bridge","extended"]},{id:"DP042",length_beats:4,type:"fill",pattern:"KSTK-KSTK-KSTK-K",tags:["toms"]},{id:"DP043",length_beats:4,type:"fill",pattern:"-KSTK-KSTK-KKSTK",tags:["toms","variation"]},{id:"DP044",length_beats:8,type:"fill",pattern:"KSTK-KSTK-KSTK-KKSTK-KSTK-KSTK-K",tags:["toms","extended"]},{id:"DP045",length_beats:4,type:"fill",pattern:"S--S--S--S--S--S",tags:["loop_safe"]},{id:"DP046",length_beats:4,type:"fill",pattern:"--S--S--S--SS--S",tags:["loop_safe","variation"]},{id:"DP047",length_beats:8,type:"fill",pattern:"S--S--S--S--S--SS--S--S--S--S--S",tags:["loop_safe","extended"]},{id:"DP048",length_beats:4,type:"fill",pattern:"K-S-H-K-S-H-K-S-",tags:["bridge"]},{id:"DP049",length_beats:4,type:"fill",pattern:"H-K-S-H-K-S-K-S-",tags:["bridge","variation"]},{id:"DP050",length_beats:8,type:"fill",pattern:"K-S-H-K-S-H-K-S-K-S-H-K-S-H-K-S-",tags:["bridge","extended"]},{id:"DP051",length_beats:4,type:"beat",pattern:"K-H-K-H-K-H-K-H-",tags:["loop_safe","four_on_floor","straight","percussive_layer","texture_loop"]},{id:"DP052",length_beats:4,type:"beat",pattern:"K-HO-K-H-K-O-K-H-",tags:["loop_safe","four_on_floor","straight","variation","percussive_layer"]},{id:"DP053",length_beats:4,type:"beat",pattern:"K-HH-K-HH-K-HH-K-HH",tags:["loop_safe","grid16","texture_loop","percussive_layer"]},{id:"DP054",length_beats:4,type:"beat",pattern:"K--S--K-K--S--K-",tags:["rock","drive","loop_safe"]},{id:"DP055",length_beats:4,type:"beat",pattern:"K-K-S---K-K-S-K-",tags:["dance","syncopation","loop_safe"]},{id:"DP056",length_beats:4,type:"beat",pattern:"K-----S-K-----S-",tags:["ballad","simple","loop_safe"]},{id:"DP057",length_beats:4,type:"beat",pattern:"K-H-S-K-K-H-S-H-",tags:["rock","energetic","loop_safe","variation"]},{id:"DP058",length_beats:4,type:"beat",pattern:"K-S-K-S-K-S-K-S-",tags:["dance","four_on_floor","loop_safe"]},{id:"DP059",length_beats:4,type:"beat",pattern:"K---S-K-K---S---",tags:["syncopation","upbeat","loop_safe"]},{id:"DP060",length_beats:4,type:"beat",pattern:"K-H-S-H-K---S-H-",tags:["rock","variation","loop_safe"]},{id:"DP061",length_beats:4,type:"beat",pattern:"K-K---S-K-K-S---",tags:["dance","syncopation","tense","loop_safe"]},{id:"DP062",length_beats:4,type:"beat",pattern:"K-H-S---K-H-S-K-",tags:["rock","drive","loop_safe","variation"]},{id:"DP063",length_beats:4,type:"beat",pattern:"K-----S---K-S---",tags:["ballad","peaceful","simple","loop_safe"]},{id:"DP064",length_beats:4,type:"beat",pattern:"K-K-S-K-K-K-S-K-",tags:["dance","energetic","drive","loop_safe"]},{id:"DP065",length_beats:4,type:"beat",pattern:"K-H-S-K---H-S-H-",tags:["syncopation","rock","variation","loop_safe"]},{id:"DP066",length_beats:4,type:"beat",pattern:"K---S---K-K-S-K-",tags:["dance","syncopation","build","loop_safe"]},{id:"DP067",length_beats:4,type:"beat",pattern:"K-H-S-H-K-H-S---",tags:["rock","cadence","loop_safe"]},{id:"DP068",length_beats:4,type:"beat",pattern:"K-K-K-K-S-S-S-S-",tags:["experimental","build","tense","loop_safe"]},{id:"DP069",length_beats:4,type:"beat",pattern:"K-HO-K-HO-K-HO-K-HO",tags:["loop_safe","four_on_floor","texture_loop","percussive_layer","variation"]},{id:"DP070",length_beats:4,type:"beat",pattern:"K-HS-K-HK-HS-K-HK-HS",tags:["loop_safe","four_on_floor","grid16","percussive_layer","texture_loop"]},{id:"DP071",length_beats:4,type:"beat",pattern:"K-H-K-S-K-H-O-S-",tags:["loop_safe","four_on_floor","syncopation","percussive_layer","variation"]},{id:"DP072",length_beats:4,type:"beat",pattern:"K-HH-K-S-K-HH-K-S",tags:["loop_safe","four_on_floor","grid16","percussive_layer","build"]},{id:"DP073",length_beats:4,type:"beat",pattern:"KH-HSHKHOHSHKHSH",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP074",length_beats:4,type:"beat",pattern:"KH-HSH-KHSOHK-SH",tags:["loop_safe","grid16","syncopation","breakbeat","variation","percussive_layer"]},{id:"DP075",length_beats:4,type:"fill",pattern:"KHSHKHSHKTSHKHSH",tags:["break","breakbeat","drum_fill","grid16","syncopation"]},{id:"DP076",length_beats:4,type:"beat",pattern:"K--H-K--S-H--H--",tags:["loop_safe","swing_hint","simple","rest_heavy","lofi"]},{id:"DP077",length_beats:4,type:"beat",pattern:"K-H--K-HS--H--H-",tags:["loop_safe","swing_hint","rest_heavy","lofi","variation"]},{id:"DP078",length_beats:4,type:"beat",pattern:"K-HS-K-HSK-H-SH-",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP079",length_beats:4,type:"beat",pattern:"K-HO-KS-HK-S-HO-",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer","variation"]},{id:"DP080",length_beats:4,type:"fill",pattern:"KHSHKHSKTSHKHSS-",tags:["break","breakbeat","drum_fill","grid16","syncopation"]},{id:"DP081",length_beats:4,type:"beat",pattern:"K---H---S-H-----",tags:["loop_safe","swing_hint","rest_heavy","lofi"]},{id:"DP082",length_beats:4,type:"beat",pattern:"K--H---HS--H-K--",tags:["loop_safe","swing_hint","rest_heavy","lofi","variation"]},{id:"DP083",length_beats:4,type:"fill",pattern:"N---S---N---H---",tags:["lofi","drum_fill","rest_heavy","transition"]},{id:"DP084",length_beats:4,type:"beat",pattern:"KHHH-HSHKH-HSHK-",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP085",length_beats:4,type:"beat",pattern:"KH-HKHSH-HSHKHSO",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer","variation"]},{id:"DP086",length_beats:4,type:"beat",pattern:"K-HHKSH-HK-SHH-H",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer"]},{id:"DP087",length_beats:4,type:"beat",pattern:"KHHSHK-HSHK-SHOH",tags:["loop_safe","grid16","syncopation","breakbeat","percussive_layer","variation"]},{id:"DP088",length_beats:4,type:"fill",pattern:"KHSHSHKTSHSHKSH-",tags:["break","breakbeat","drum_fill","grid16","syncopation"]},{id:"DP089",length_beats:4,type:"fill",pattern:"KHSKHSKTSHSKHSKO",tags:["break","breakbeat","drum_fill","grid16","syncopation","variation"]}],wt={patterns:[{id:"BP_STEADY_ROOT_DRIVE",texture:"steady",steps:["root","root","fifth","root","fifth","root","fifth","approach"],tags:["default","loop_safe"]},{id:"BP_STEADY_UPWARD_WALK",texture:"steady",steps:["root","fifth","root","octave","fifth","root","octave","approach"],tags:["variation","section_end"]},{id:"BP_BROKEN_TRIAD_LIFT",texture:"broken",steps:["root","fifth","root","octave","root","fifth","root","approach"],tags:["default"]},{id:"BP_BROKEN_PICKUP_DROP",texture:"broken",steps:["root","octave","fifth","octaveHigh","root","fifth","octave","approach"],tags:["variation","pickup","section_end"]},{id:"BP_BREAK_OFFBEAT_DRIVE",texture:"broken",steps:["root","rest","octave","rest","fifth","approach","lowFifth","approach"],tags:["loop_safe","syncopated","breakbeat","variation","default"]},{id:"BP_BREAK_GHOST_RIDE",texture:"broken",steps:["root","octave","rest","fifth","rest","octave","lowFifth","approach"],tags:["loop_safe","breakbeat","syncopated","drive","default"]},{id:"BP_BREAK_SLIDE_UP",texture:"broken",steps:["root","approach","fifth","rest","root","octave","rest","approach"],tags:["loop_safe","breakbeat","variation"]},{id:"BP_LOFI_SWUNG_ROOT",texture:"steady",steps:["root","rest","rest","root","rest","fifth","rest","approach"],tags:["loop_safe","rest_heavy","swing_hint","lofi"]},{id:"BP_LOFI_DUSTY_STEP",texture:"steady",steps:["root","rest","rest","fifth","rest","rest","root","approach"],tags:["loop_safe","lofi","rest_heavy","swing_hint"]},{id:"BP_LOFI_WALKDOWN",texture:"steady",steps:["root","rest","third","rest","second","rest","root","approach"],tags:["loop_safe","lofi","rest_heavy","variation"]},{id:"BP_ARPEGGIO_GLIDE",texture:"arpeggio",steps:["root","octave","fifth","octaveHigh","root","fifth","octave","approach"],tags:["default","loop_safe"]},{id:"BP_ARPEGGIO_PULSE",texture:"arpeggio",steps:["root","fifth","octave","octaveHigh","root","fifth","octave","approach"],tags:["variation","transition","section_end"]},{id:"BP_STEADY_OFFBEAT_PUSH",texture:"steady",steps:["root","fifth","root","approach","fifth","root","octave","approach"],tags:["variation","syncopated","loop_safe"]},{id:"BP_BROKEN_LOW_SWING",texture:"broken",steps:["root","lowFifth","root","fifth","root","lowFifth","root","approach"],tags:["variation","loop_safe"]},{id:"BP_ARPEGGIO_SPREAD",texture:"arpeggio",steps:["root","octave","fifth","octaveHigh","fifth","octave","octaveHigh","approach"],tags:["variation","loop_safe"]},{id:"BP_STEADY_SUB_GRID",texture:"steady",steps:["root","root","root","root","root","root","root","root"],tags:["loop_safe","percussive_layer","four_on_floor","static"]},{id:"BP_STEADY_SUB_OFFSET",texture:"steady",steps:["root","root","root","fifth","root","root","root","approach"],tags:["loop_safe","percussive_layer","variation"]},{id:"BP_FOUR_ON_FLOOR_CLASSIC",texture:"steady",steps:["root","root","root","root","root","fifth","root","root"],tags:["loop_safe","four_on_floor","percussive_layer","static","drone"]},{id:"BP_FOUR_ON_FLOOR_GHOST",texture:"steady",steps:["root","root","fifth","root","root","root","fifth","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_FOUR_ON_FLOOR_OFFBEAT",texture:"steady",steps:["root","fifth","root","root","root","fifth","root","root"],tags:["loop_safe","four_on_floor","percussive_layer","syncopated"]},{id:"BP_FOUR_ON_FLOOR_OCTAVE_HIT",texture:"steady",steps:["root","root","root","octave","root","root","root","octave"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_FOUR_ON_FLOOR_ROLLING",texture:"steady",steps:["root","root","root","fifth","root","root","root","fifth"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_DRONE_STATIC_ROOT",texture:"steady",steps:["root","root","root","root","root","fifth","root","approach"],tags:["loop_safe","static","drone","four_on_floor","percussive_layer"]},{id:"BP_DRONE_LOW_PULSE",texture:"steady",steps:["root","lowFifth","root","lowFifth","root","lowFifth","root","lowFifth"],tags:["loop_safe","drone","percussive_layer"]},{id:"BP_DRONE_ACCENT_SPARK",texture:"steady",steps:["root","rest","octave","root","rest","fifth","root","approach"],tags:["loop_safe","drone","accent"]},{id:"BP_TECHNO_BOUNCE",texture:"broken",steps:["root","root","octave","root","root","root","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_TECHNO_SUB_EMPHASIS",texture:"steady",steps:["root","root","root","lowFifth","root","root","root","lowFifth"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_MINIMAL_BREATH",texture:"steady",steps:["root","root","root","root","fifth","root","root","root"],tags:["loop_safe","four_on_floor","percussive_layer","static"]},{id:"BP_WALKING_BASS",texture:"broken",steps:["root","second","third","fifth","root","seventh","octave","approach"],tags:["variation","walking","jazz_hint"]},{id:"BP_OCTAVE_JUMP",texture:"broken",steps:["root","octave","root","octave","fifth","octaveHigh","fifth","approach"],tags:["variation","energetic","jump"]},{id:"BP_CHROMATIC_WALK",texture:"broken",steps:["root","flatSecond","second","third","fifth","sixth","seventh","approach"],tags:["variation","chromatic","tense"]},{id:"BP_SYNCOPATED_GROOVE",texture:"broken",steps:["root","fifth","octave","root","fifth","octave","fifth","approach"],tags:["variation","syncopation","groove"]},{id:"BP_PEDAL_FIFTH",texture:"steady",steps:["root","fifth","root","fifth","root","fifth","root","fifth"],tags:["loop_safe","simple","rock"]},{id:"BP_ARPEGGIO_CASCADE",texture:"arpeggio",steps:["root","third","fifth","octave","fifth","third","root","approach"],tags:["variation","cascade","bright"]},{id:"BP_BOUNCY_RHYTHM",texture:"broken",steps:["root","root","fifth","fifth","octave","octave","fifth","approach"],tags:["variation","playful","bounce"]},{id:"BP_BROKEN_SYNCO_JUMP",texture:"broken",steps:["root","rest","octave","root","fifth","rest","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer","syncopated","default"]},{id:"BP_BROKEN_GRID_PULSE",texture:"broken",steps:["root","root","rest","root","octave","root","rest","root"],tags:["loop_safe","four_on_floor","percussive_layer","grid16"]},{id:"BP_BROKEN_TEXTURE_WAVE",texture:"broken",steps:["root","octave","fifth","root","root","octave","fifth","approach"],tags:["loop_safe","four_on_floor","percussive_layer","texture_loop"]},{id:"BP_BROKEN_DOUBLE_HIT",texture:"broken",steps:["root","root","octave","octave","fifth","fifth","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_BROKEN_OFFBEAT_DRIVE",texture:"broken",steps:["rest","root","rest","octave","rest","fifth","rest","root"],tags:["loop_safe","four_on_floor","percussive_layer"]},{id:"BP_BROKEN_SUB_BOUNCE",texture:"broken",steps:["root","lowFifth","octave","root","root","lowFifth","octave","root"],tags:["loop_safe","four_on_floor","percussive_layer","static"]},{id:"BP_BROKEN_LIFT_DROP",texture:"broken",steps:["root","fifth","octave","octaveHigh","fifth","root","octave","approach"],tags:["loop_safe","four_on_floor","percussive_layer","variation"]},{id:"BP_BROKEN_STEADY_GRID",texture:"broken",steps:["root","root","root","octave","root","root","root","octave"],tags:["loop_safe","four_on_floor","percussive_layer","default"]}]},Gt={transitions:[{id:"TR_SECTION_NOISE_SWELL",pattern:"N---N---N---NNS-",length_beats:4,tags:["transition","section_end","noise_fx"],channel:"noise"},{id:"TR_SECTION_SNARE_RUSH",pattern:"--S-S-S-S-S-S-S-",length_beats:4,tags:["transition","section_end","drum_fill"],channel:"noise"},{id:"TR_LOOP_TIGHTENER",pattern:"K-HS-HK-HS-HK-H-",length_beats:4,tags:["transition","loop_out","drum_fill"],channel:"noise"},{id:"TR_SECTION_GHOST_ECHO",pattern:"N---S---N---S---",length_beats:4,tags:["transition","section_end","loop_out","noise_fx"],channel:"noise"},{id:"TR_BUILD_STUTTER_FILL",pattern:"K-SK-SK-SK-SK-S-",length_beats:4,tags:["transition","build","drum_fill"],channel:"noise"},{id:"TR_BREAKBEAT_SNARE_CHOP",pattern:"S--S-HS-S-HS-S--",length_beats:4,tags:["transition","section_end","break","breakbeat","drum_fill"],channel:"noise"},{id:"TR_LOFI_TAPE_SWELL",pattern:"N---H---S---H---",length_beats:4,tags:["transition","section_end","lofi","noise_fx","rest_heavy"],channel:"noise"}]},qt=Dt,Ut=kt,Vt=Nt,Yt=Lt,Wt=wt,jt=Gt,He=qt,$=Ut,Ke=new Map($.map(a=>[a.id,a])),Fe=Vt,Ie=new Map(Fe.map(a=>[a.id,a])),J=Yt,zt=new Map(J.map(a=>[a.id,a])),Ce=(Wt.patterns??[]).reduce((a,e)=>{const t=a.get(e.texture)??[];return t.push(e),a.set(e.texture,t),a},new Map),ae=jt.transitions??[],se=["root","root","fifth","root","fifth","root","fifth","approach"],$t={id:"BP_FALLBACK_STEADY",texture:"steady",steps:se,tags:["fallback"]},Jt={upbeat:["straight","syncopation"],sad:["straight","simple"],tense:["syncopation","accented"],peaceful:["straight","open"]},Xt={upbeat:["bright","ascending"],sad:["dark","descending"],tense:["dark","complex","leaping"],peaceful:["simple","arch","bright"]},Qt={upbeat:["syncopated","drive"],sad:["legato","rest_heavy"],tense:["syncopated","staccato"],peaceful:["legato","simple"]},G=new Map(He.map(a=>[a.id,a])),Zt={dualBass:{preferBeatTags:["percussive_layer","syncopation"],preferFillTags:["drum_fill","build"]},bassLed:{preferBeatTags:["four_on_floor","drive"],preferFillTags:["build"],earlySparseMeasures:1},layeredBass:{preferBeatTags:["four_on_floor","loop_safe"],preferFillTags:["drum_fill"]},minimal:{preferBeatTags:["simple","open"],preferFillTags:["noise_fx"],avoidTags:["build","drive"],earlySparseMeasures:2},breakLayered:{preferBeatTags:["breakbeat","percussive_layer","grid16"],preferFillTags:["break","drum_fill","breakbeat"],avoidTags:["four_on_floor"]},lofiPadLead:{preferBeatTags:["lofi","rest_heavy","swing_hint"],preferFillTags:["noise_fx","lofi"],avoidTags:["breakbeat"],earlySparseMeasures:2},retroPulse:{preferBeatTags:["loop_safe","grid16","syncopation"],preferFillTags:["build","transition"],avoidTags:["rest_heavy"]}},ea={dualBass:{density:.85,velocityScale:.9,offbeatAccentBoost:3},bassLed:{density:.6,sustainWholeMeasure:!1,offbeatAccentBoost:5},layeredBass:{density:.75,velocityScale:.95},minimal:{density:.5,sustainWholeMeasure:!0,velocityScale:.8},breakLayered:{density:.95,velocityScale:1.05,offbeatAccentBoost:6},lofiPadLead:{density:.55,sustainWholeMeasure:!0,velocityScale:.7},retroPulse:{density:.78,velocityScale:.95,offbeatAccentBoost:2}};function b(a,e,t=.4){if(!e.length)return a;const s=a.filter(r=>{const o=r.tags??[];return e.some(n=>o.includes(n))});return s.length===0||a.length>=4&&s.length<a.length*t?a:s}function De(a,e){const t=[...a];for(let s=t.length-1;s>0;s--){const r=Math.floor(e()*(s+1)),o=t[s];t[s]=t[r],t[r]=o}return t}function ke(a,e,t,s=.6){if(!e.length||a.length<=1)return a;const r=a.filter(d=>{const h=d.tags??[];return e.some(p=>h.includes(p))});if(!r.length||r.length===a.length)return a;const o=a.filter(d=>!r.includes(d)),n=De(r,t),i=De(o,t),u=Math.min(n.length,Math.max(1,Math.ceil(a.length*s))),l=n.slice(0,u),c=[...n.slice(u),...i];return[...l,...c]}const q=1337;function X(a){let e=(a??q)>>>0;return e===0&&(e=q),()=>(e=e*1664525+1013904223>>>0,e/4294967295)}function K(a,e,t){if(!a.length)throw new Error("No candidates available for selection");if(a.length===1)return a[0];let s=a[Math.floor(e()*a.length)];if(t&&a.length>1){let r=0;for(;(s==null?void 0:s.id)===t&&r<3;)s=a[Math.floor(e()*a.length)],r++}return s}function F(a,e){return e.length?e.every(t=>a.tags.includes(t)):!0}function ta(a){return Math.abs(a%1)<1e-6}function aa(a,e){return e.find(t=>a>=t.startBeat&&a<t.startBeat+t.durationBeats)}function Ne(a,e){return a===0?"start":a===e-1?"end":"middle"}function sa(a){try{return Ve(a),!0}catch{return!1}}function Le(a,e,t,s,r,o,n){var g;const i=He.filter(sa),u=Jt[a.mood]??[],l=(f,v)=>f.filter(m=>v.some(_=>m.tags.includes(_))),c=i.filter(f=>F(f,r));let d=i.filter(f=>f.tags.includes(t));const h=l(d,u);if(h.length)d=h;else{const f=l(i,u);f.length&&(d=f)}if(e.loopCentric&&(d=b(d,["loop_safe","texture_loop"])),e.textureFocus&&(d=b(d,["texture_loop","straight","simple","grid16"])),e.percussiveLayering&&(d=b(d,["grid16","percussive_layer"])),e.syncopationBias&&(d=b(d,["syncopation"])),d.length||(d=i),r.length){const f=d.filter(v=>F(v,r));f.length?d=f:c.length&&(d=c)}if((g=s==null?void 0:s.variations)!=null&&g.length){const f=s.variations.map(v=>G.get(v)).filter(v=>!!v);if(f.length&&o()<.5){const v=I(f,n);return K(v,o,s.id)}}const p=I(d,n);return K(p,o,s==null?void 0:s.id)}function ra(a,e,t,s,r,o){const n=Xt[a.mood]??[];let i=$.filter(l=>n.some(c=>l.tags.includes(c)));if(t.length){const l=i.filter(c=>F(c,t));if(l.length)i=l;else{const c=$.filter(d=>F(d,t));c.length&&(i=c)}}i.length||(i=$),e.textureFocus&&(i=b(i,["texture_loop","ostinato","loop_safe","short","static"])),e.harmonicStatic&&(i=ke(i,["scalar","stepwise","static"],s,.6)),e.gradualBuild&&(i=b(i,["ascending"]));const u=I(i,o);return K(u,s,r==null?void 0:r.id)}function na(a,e,t,s,r,o,n,i){const l=Qt[a.mood]??[];let c=Fe.filter(g=>Math.abs(g.length-s)<1e-6);if(!c.length)throw new Error(`No melody rhythm motifs of length ${s}`);let d=c.filter(g=>g.tags.includes(t));d.length||(d=c);let h=d.filter(g=>l.some(f=>g.tags.includes(f)));if(h.length||(h=d),e.loopCentric&&(h=b(h,["loop_safe","texture_loop"])),e.textureFocus&&(h=b(h,["texture_loop","grid16","simple"])),e.syncopationBias&&(h=b(h,["syncopated","drive"])),r.length){const g=h.filter(f=>F(f,r));g.length&&(h=g)}h=ya(h,s);const p=I(h,i);return K(p,o,n)}function oa(a,e,t,s,r){let n={broken:90,steady:86,arpeggio:92}[a.texture]??88;const i=e===0?6:0,u=a.measures-e<=1?4:0;if(r.textureFocus&&(n-=8),r.gradualBuild){const l=s>1?t/Math.max(1,s-1):0,c=Math.min(1,Math.max(0,l)),d=s<=16?.6:s<=32?.75:.9,h=Math.pow(c,d),p=s<=16?14:s<=32?18:20,g=Math.floor(h*p);n+=g}return r.loopCentric&&(n=Math.max(60,n-2)),Math.min(110,Math.max(58,n+i+u))}function ia(a,e,t,s,r){const n={upbeat:0,peaceful:-3,tense:-5,sad:-2},i={slow:-2,medium:0,fast:2},u={minimalTechno:-4,progressiveHouse:3,retroLoopwave:2,breakbeatJungle:-2,lofiChillhop:-5},l=(s.textureFocus?2:0)+(s.gradualBuild?1:0)+(s.loopCentric?-1:0)+(s.atmosPad?2:0)+(s.percussiveLayering?-2:0),c=n[a]??0,d=i[e]??0,h=t?u[t]??0:0,p=X(r),g=Math.floor(p()*7)-3,f=72+c+d+h+l+g;return Math.max(63,Math.min(78,f))}function la(a,e,t,s,r,o){if(!a)return o;const n={steady:0,broken:-3,arpeggio:4},i=Math.max(0,e);let u=n[a.texture]??0;if(r.textureFocus&&(u-=4),r.filterMotion&&(u+=1),Y(a)&&i===0&&(u+=3),H(a)&&i===0&&(u-=2),r.gradualBuild){const g=t/Math.max(1,s-1),f=Math.round(Math.pow(g,.7)*8);u+=f}(a.measures>0?i/a.measures:0)>=.75&&(u-=2);const c=Math.min(a.occurrenceIndex-1,2)*2;u-=c,r.atmosPad&&(u-=1);const d=60,h=84,p=o+u;return Math.max(d,Math.min(h,p))}function ua(a,e,t,s){if(e<=0)return;const r=e-.25;if(r<0)return;const o=t.pattern,n=o[o.length-1]??o[0]??1;a.push({channelRole:"melody",startBeat:r,durationBeats:.25,degree:n,velocity:Ct.PICKUP_BASE,sectionId:s})}function da(a,e,t,s){if(!e.length)return a;const r=[e[e.length-1]],o=r[0]+(t.textureFocus?2:1),n=r[0]-(t.loopCentric?1:2),i=new Set([a,r[0],o,n]),u=Array.from(i);return u[Math.floor(s()*u.length)]}function we(a,e,t,s,r){const o=a.variations??[];if(!o.length)return;const n=o.map(u=>G.get(u)).filter(u=>!!u).filter(u=>u.tags.includes(e)&&F(u,t));if(!n.length)return;const i=I(n,r);return K(i,s,a.id)}function ca(a,e,t,s,r){var l;const o=(l=r.steps)!=null&&l.length?r.steps:se,n=[],i=j(t,40),u=s??t;for(let c=0;c<o.length;c++){const d=e+c*.5,h=Ue(o[c],t,u,i);h!==null&&n.push({channelRole:"bass",startBeat:d,durationBeats:.5,degree:0,velocity:qe(a,c),sectionId:a.id,midiOverride:h})}return n}function Ge(a,e,t,s,r,o,n){const i=(n==null?void 0:n.enforceDroneStatic)??!0,u=(n==null?void 0:n.preferredTags)??[],l=e===a.measures-1,c=r.get(a.id);if(c){if(l&&!(c.tags??[]).includes("section_end")){const p=k(a.texture,o,t,s,["section_end"],c.id);if(p)return s.add(p.id),p}return c}if(o.harmonicStatic){if(!i&&u.length){const g=k(a.texture,o,t,s,u,void 0);if(g)return r.set(a.id,g),s.add(g.id),g}const p=k(a.texture,o,t,s,["drone","static"],void 0);if(p&&i)return r.set(a.id,p),s.add(p.id),p}const d=Y(a)?["pickup"]:[],h=k(a.texture,o,t,s,d,void 0)??k(a.texture,o,t,s,[],void 0)??$t;if(r.set(a.id,h),s.add(h.id),l&&!(h.tags??[]).includes("section_end")){const p=k(a.texture,o,t,s,["section_end"],h.id);if(p)return s.add(p.id),p}return h}function k(a,e,t,s,r,o){let n=Ce.get(a)??[];if(!n.length&&a!=="steady"&&(n=Ce.get("steady")??[]),!n.length)return;if((e.loopCentric||e.harmonicStatic)&&(n=b(n,["loop_safe"])),e.syncopationBias&&(n=b(n,["syncopated"])),e.textureFocus&&(n=b(n,["default"])),e.percussiveLayering&&(n=b(n,["percussive_layer","four_on_floor"])),e.percussiveLayering&&e.syncopationBias&&e.breakInsertion&&(n=b(n,["breakbeat","variation"],.2)),e.atmosPad&&e.loopCentric&&(n=b(n,["lofi","rest_heavy"],.25)),e.harmonicStatic&&(n=ke(n,["drone","static"],t,.65)),r.length){const u=n.filter(l=>r.every(c=>(l.tags??[]).includes(c)));u.length&&(n=u)}if(!n.length)return;const i=I(n,s);return K(i,t,o)}function pa(a,e){const s=[];for(const r of e){let o=r.startBeat,n=0;const i=4;for(;n<i&&a.some(l=>Math.abs(l.startBeat-o)<.0625);)n++,o=r.startBeat+n*.0625;s.push({...r,startBeat:o})}return s}function ha(a,e,t,s,r,o,n,i,u){if(!ae.length)return;const l=["transition","section_end"];t&&l.push("loop_out");let c=ae.filter(m=>m.length_beats<=y);c.length||(c=ae);const d=u>1?i/Math.max(1,u-1):0,h=[];if(n.gradualBuild&&(d<.4?h.push("build"):d<.8?h.push("drum_fill"):h.push("loop_out")),n.breakInsertion&&d>=.5&&h.push("noise_fx"),n.percussiveLayering&&h.push("drum_fill"),h.length&&(c=b(c,h,.2)),l.length){const m=c.filter(_=>F(_,l));m.length&&(c=m)}if(!c.length)return;const p=I(c,o),g=K(p,s,r);if(!g)return;const f=g.length_beats>=y?e:e+Math.max(0,y-g.length_beats),v=Be(g.pattern,f,a.id);return{motifId:g.id,hits:v}}function qe(a,e){const t=Oe[a.texture]??Oe.default;return e===0?t+Ae.DOWNBEAT_BOOST:e%4===0?t+Ae.STRONG_BEAT_BOOST:t}function Ue(a,e,t,s){switch(a){case"root":return P(s,e);case"fifth":return P(s+7,e);case"lowFifth":return P(s-5,e);case"octave":return P(s+12,e);case"octaveHigh":return P(s+19,e);case"approach":{const r=j(t,s+5);return P(r-1,t)}case"rest":return null;default:return P(s,e)}}function Ve(a){const e=a.pattern.map(r=>({durationBeats:ne(r)})),t=e.reduce((r,o)=>r+o.durationBeats,0);if(Math.abs(t-a.length)>1e-6)throw new Error(`Rhythm motif ${a.id} length mismatch. expected=${a.length}, got=${t}`);return e}function ga(a,e,t){if(a==="steady"){const s=[1,5];return s[Math.floor(t/2)%s.length]}else{const s=[1,3,5,7];return s[e%s.length]}}function fa(a,e){return 58+(a==="start"&&e===0?6:0)}function va(a,e,t,s,r,o,n){const i=[],u=Ve(t);let l=0,c=0;const d=ea[o];for(let h=0;h<u.length;h++){const p=u[h];if(l>=y)break;const g=y-l,f=Math.min(p.durationBeats,g),v=ga(a.texture,c,l),m=l%1>1e-6;let _=fa(r,l);if(d!=null&&d.velocityScale&&(_=Math.round(_*d.velocityScale)),m&&(d!=null&&d.offbeatAccentBoost)&&(_+=d.offbeatAccentBoost),(d==null?void 0:d.density)!==void 0&&d.density<1){const M=Math.max(0,Math.min(1,d.density));if(n()>M){l+=f,c++;continue}}if(i.push({channelRole:"accompaniment",startBeat:e+l,durationBeats:f,degree:v,velocity:_,sectionId:a.id}),l+=f,c++,l>=y)break}if(r==="start"&&Y(a)&&s.pattern.length&&e>=.5&&!((d==null?void 0:d.density)!==void 0&&d.density<.5)){const h=s.pattern[0];i.push({channelRole:"accompaniment",startBeat:Math.max(0,e-.5),durationBeats:.5,degree:h,velocity:A.EARLY_START,sectionId:a.id})}if(d!=null&&d.sustainWholeMeasure&&i.length){const h=i[0].degree,p=Math.max(A.PAD_MIN,Math.round(i.reduce((g,f)=>g+f.velocity,0)/i.length));return[{channelRole:"accompaniment",startBeat:e,durationBeats:y,degree:h,velocity:p,sectionId:a.id}]}return i}function ma(a){const e=a.pattern.map(r=>({durationBeats:ne(r.value),rest:!!r.rest,accent:r.accent})),t=e.reduce((r,o)=>r+o.durationBeats,0);if(Math.abs(t-a.length)>1e-6)throw new Error(`Melody rhythm motif ${a.id} length mismatch. expected=${a.length}, got=${t}`);return e}function _a(a,e){const t=a.pattern??[];if(!t.length)return!1;const s=e>=4?.25:0;let r=0,o=!1,n=0;for(const i of t){const u=ne(i.value);if(i.rest){r+=u,n=0;continue}if(u>=.5){o=!0,n=0;continue}if(n+=u,n>1+1e-6)return!1}return r>=s?!0:o}function ya(a,e){const t=a.filter(s=>_a(s,e));return t.length?t:a}function re(a,e,t){a.has(e)||a.set(e,new Map);const s=a.get(e);return s.has(t)||s.set(t,{}),s.get(t)}function Ma(a,e,t,s){const r=a.get(e);if(!(!r||r.size===0))return r.get(1)}function ba(a,e,t,s){a.has(e)||a.set(e,new Map);const r=a.get(e);t===1&&r.set(t,s)}function Sa(a,e){const t=X(a.seed),s=a.seed??Date.now(),r=ia(a.mood,a.tempo,a.stylePreset,e.styleIntent,s);return{rng:t,compositionBaseRegister:r,sectionById:new Map(e.sections.map(o=>[o.id,o])),styleIntent:e.styleIntent,voiceArrangement:e.voiceArrangement,totalMeasures:a.lengthInMeasures,usedMotifs:{rhythms:new Set,melodies:new Set,drums:new Set,melodyRhythms:new Set,bassPatterns:new Set,transitions:new Set},caches:{template:new Map,hook:new Map,bassPattern:new Map},lastMotifs:{},motifUsage:{rhythm:{},melody:{},drums:{},melodyRhythm:{},bass:{},transitions:{}}}}function Ra(a,e,t,s,r){a.startMeasure*y;const o=Math.max(1,_t(a));let n=0;for(;n<a.measures;){const i=Math.min(o,a.measures-n),u=n===0,l=a.startMeasure+n,c=Ea(a,e,t,i,u,l,s,r);Pa(c,e,t,s,r),n+=i}}function Ea(a,e,t,s,r,o,n,i){const u=Ma(n.caches.hook,a.templateId,a.occurrenceIndex,n.rng),l=Ne(0,a.measures),c=[];o===n.totalMeasures-1?c.push("loop_safe"):o===n.totalMeasures-2&&!(H(a)&&r)&&c.push("cadence");let d,h,p;const g=Q(l,c);Q(l,c);const f=re(n.caches.template,a.templateId,g);if(H(a)&&r&&u){const v=G.get(u.rhythmId),m=Ke.get(u.melodyId);v&&(d=v),m&&(h=m)}if(!d){const v=f.rhythm;d=v?G.get(v):void 0,d||(d=Le(t,n.styleIntent,l,n.lastMotifs.rhythm,c,n.rng,n.usedMotifs.rhythms),f.rhythm=d.id)}if(!h){const v=f.melody;h=v?Ke.get(v):void 0,h||(h=ra(t,n.styleIntent,c,n.rng,n.lastMotifs.melodyFragment,n.usedMotifs.melodies),f.melody=h.id)}if(H(a)&&r&&u){const v=Ie.get(u.melodyRhythmId);v&&(p=v)}if(!p){const v=f.melodyRhythm;p=v?Ie.get(v):void 0,p||(p=na(t,n.styleIntent,l,s*y,c,n.rng,void 0,n.usedMotifs.melodyRhythms),f.melodyRhythm=p.id)}return Y(a)&&r&&ba(n.caches.hook,a.templateId,a.occurrenceIndex,{rhythmId:d.id,melodyId:h.id,melodyRhythmId:p.id}),n.usedMotifs.rhythms.add(d.id),n.usedMotifs.melodies.add(h.id),n.usedMotifs.melodyRhythms.add(p.id),n.motifUsage.melodyRhythm[p.id]=(n.motifUsage.melodyRhythm[p.id]??0)+1,r&&i.sectionMotifPlan.push({sectionId:a.id,templateId:a.templateId,occurrenceIndex:a.occurrenceIndex,primaryRhythm:d.id,primaryMelody:h.id,primaryMelodyRhythm:p.id,reprisesHook:H(a)&&!!u&&(u==null?void 0:u.rhythmId)===d.id&&(u==null?void 0:u.melodyId)===h.id&&(u==null?void 0:u.melodyRhythmId)===p.id}),{section:a,phraseMeasures:s,isFirstPhrase:r,phraseStartMeasureIndex:o,cachedHook:u,baseRhythm:d,baseMelody:h,baseMelodyRhythm:p}}function Pa(a,e,t,s,r){const{section:o,phraseMeasures:n,isFirstPhrase:i,baseMelody:u,baseMelodyRhythm:l}=a;o.startMeasure*y;const c=ma(l);let d=0,h=0,p=0;for(let g=0;g<n;g++){const f=Ba(a,g,t,s);i&&g===0&&ua(r.melody,f.measureStartBeat,u,o.id),Ta(f,c,u,o,s,r.melody,{phraseBeatCursor:d,phraseStepIndex:h,melodyDegreeCursor:p});const v=(g+1)*y;for(;h<c.length&&d<v;){const m=c[h];m.rest||p++,d+=m.durationBeats,h++}Oa(f,e,o,s,r.bass),Aa(f,u,o,s,r.accompanimentSeeds),xa(f,o,s,r.drums),s.lastMotifs.rhythm=f.rhythmMotif,s.lastMotifs.melodyFragment=u}}function Ba(a,e,t,s){const{section:r,isFirstPhrase:o,baseRhythm:n}=a,i=a.phraseStartMeasureIndex-r.startMeasure+e,u=r.startMeasure+i,l=r.startMeasure*y+i*y,c=Ne(i,r.measures),d=[],h=H(r)&&i===0;u===s.totalMeasures-1?d.push("loop_safe"):u===s.totalMeasures-2&&!h&&d.push("cadence");const p=Q(c,d),g=re(s.caches.template,r.templateId,p),f=t.sectionRepeatBias??.3,v=e>0||!o||r.occurrenceIndex>1,m=!H(r)&&v&&s.rng()>f;let _=g.rhythm?G.get(g.rhythm):void 0;if(!_)m?_=we(n,c,d,s.rng,s.usedMotifs.rhythms)??n:_=n;else if(m&&_.id===n.id){const M=we(n,c,d,s.rng,s.usedMotifs.rhythms);M&&(_=M)}return(!_.tags.includes(c)||!F(_,d))&&(_=Le(t,s.styleIntent,c,n,d,s.rng,s.usedMotifs.rhythms)),g.rhythm=_.id,s.motifUsage.rhythm[_.id]=(s.motifUsage.rhythm[_.id]??0)+1,s.usedMotifs.rhythms.add(_.id),{measureInSection:i,globalMeasureIndex:u,measureStartBeat:l,functionTag:c,requiredTags:d,isHookMeasure:h,phraseOffset:e,rhythmMotif:_}}function Ta(a,e,t,s,r,o,n){const{measureStartBeat:i,measureInSection:u,globalMeasureIndex:l,phraseOffset:c}=a,d=(c+1)*y;for(;n.phraseStepIndex<e.length&&n.phraseBeatCursor<d;){const h=e[n.phraseStepIndex],p=n.phraseBeatCursor-c*y;if(!h.rest){let g=t.pattern[n.melodyDegreeCursor%t.pattern.length];n.phraseStepIndex===e.length-1&&(s.occurrenceIndex>1||u>0)&&!H(s)&&(g=da(g,t.pattern,r.styleIntent,r.rng));let v=oa(s,u,l,r.totalMeasures,r.styleIntent);o.push({channelRole:"melody",startBeat:i+p,durationBeats:h.durationBeats,degree:g,velocity:v,sectionId:s.id}),n.melodyDegreeCursor++}n.phraseBeatCursor+=h.durationBeats,n.phraseStepIndex++}}function Oa(a,e,t,s,r){const{measureStartBeat:o,measureInSection:n}=a;let i=s.caches.bassPattern.get(t.id);i||(i=Ge(t,n,s.rng,s.usedMotifs.bassPatterns,s.caches.bassPattern,s.styleIntent),s.caches.bassPattern.set(t.id,i));const u=B(e,o),l=B(e,o+y);r.push(...ca(t,o,u,l,i))}function Aa(a,e,t,s,r){const{measureStartBeat:o,rhythmMotif:n,functionTag:i}=a;r.push(...va(t,o,n,e,i,s.voiceArrangement.id,s.rng))}function xa(a,e,t,s){var h;const{measureStartBeat:r,measureInSection:o,requiredTags:n}=a,i=o===e.measures-1,u=i||e.measures>2&&o===e.measures-2,l=Q(`${o}:${u?"fill":"beat"}`,n),c=re(t.caches.template,e.templateId,l);let d=c.drum?zt.get(c.drum):void 0;if(d||(d=Da(o,e.measures,n,t.rng,t.lastMotifs.drumPatternId,t.usedMotifs.drums,u,t.styleIntent,t.voiceArrangement.id),d&&(c.drum=d.id)),d&&(t.motifUsage.drums[d.id]=(t.motifUsage.drums[d.id]??0)+1,t.usedMotifs.drums.add(d.id),s.push(...Be(d.pattern,r,e.id)),t.lastMotifs.drumPatternId=d.id),i){const p=e.id===((h=t.sectionById.get(Array.from(t.sectionById.keys()).pop()))==null?void 0:h.id),g=ha(e,r,p,t.rng,t.lastMotifs.transitionId,t.usedMotifs.transitions,t.styleIntent,e.startMeasure+o,t.totalMeasures);g&&(t.motifUsage.transitions[g.motifId]=(t.motifUsage.transitions[g.motifId]??0)+1,t.usedMotifs.transitions.add(g.motifId),s.push(...pa(s,g.hits)),t.lastMotifs.transitionId=g.motifId)}}function Ha(a,e,t){return a.map(s=>{const r=t.sectionById.get(s.sectionId),o=Math.floor(s.startBeat/y),n=r?o-r.startMeasure:0,i=la(r,n,o,t.totalMeasures,t.styleIntent,t.compositionBaseRegister),u=z(s.degree,e.scaleDegrees,i),l=B(e,s.startBeat),c=ta(s.startBeat)?P(u,l):L(u,l);return{...s,midi:c}})}function Ka(a,e,t){return a.map(s=>{const r=z(s.degree,e.scaleDegrees,67),o=B(e,s.startBeat),n=aa(s.startBeat,t),i=L(r,o,n==null?void 0:n.midi);return{...s,midi:i}})}function Fa(a,e){return a.map(t=>{const r=t.midiOverride??z(t.degree,e.scaleDegrees,52,-1),o=B(e,t.startBeat),n=P(r,o);return{...t,midi:n}})}function Ia(a,e){const t=Sa(a,e),s={melody:[],bass:[],accompanimentSeeds:[],drums:[],sectionMotifPlan:[]};for(const i of e.sections)Ra(i,e,a,t,s);const r=Ha(s.melody,e,t),o=Fa(s.bass,e),n=Ka(s.accompanimentSeeds,e,r);return{melody:r,bass:o,accompanimentSeeds:n,drums:s.drums,motifUsage:t.motifUsage,sectionMotifPlan:s.sectionMotifPlan}}function Ca(a,e){const{voiceArrangement:t}=e,s=a.seed??q,r=Ia(a,e);if(t.id==="standard"||t.id==="swapped")return{tracks:[{role:"melody",notes:r.melody},{role:"bass",notes:r.bass},{role:"accompaniment",notes:r.accompanimentSeeds}],drums:r.drums,motifUsage:r.motifUsage,sectionMotifPlan:r.sectionMotifPlan};const o=[];for(const n of t.voices){let i;switch(n.role){case"bass":case"bassAlt":i=La(n.role,n.priority,n.octaveOffset??0,n.seedOffset??0,a,e);break;case"pad":i=wa(n.priority,a,e,s+(n.seedOffset??0));break;case"melody":case"melodyAlt":case"accompaniment":if(n.role==="melody"&&t.id==="minimal")continue;n.role==="melody"?i=r.melody:i=r.accompanimentSeeds;break;default:i=[]}const u=i.map(l=>{let c,d=l.velocity;if((l.channelRole==="bass"||n.role==="bass"||n.role==="bassAlt")&&l.midiOverride!==void 0)c=l.midiOverride;else{Math.floor(l.startBeat/y);const h=n.role==="melody"||n.role==="melodyAlt"?72:67,p=z(l.degree,e.scaleDegrees,h),g=B(e,l.startBeat);c=P(p,g),n.octaveOffset&&(c+=n.octaveOffset*12)}return t.id==="layeredBass"&&(n.role==="bass"?d=Math.max(28,Math.round(d*.65)):n.role==="bassAlt"&&(d=Math.max(22,Math.round(d*.5)))),{...l,midi:c,velocity:d}});u.length>0&&o.push({role:n.role,notes:u})}return{tracks:o,drums:r.drums,motifUsage:r.motifUsage,sectionMotifPlan:r.sectionMotifPlan}}function ne(a){switch(a){case 2:return 2;case 4:return 1;case 8:return .5;case 16:return .25;default:return .25}}function Da(a,e,t,s,r,o,n,i,u){var M,R,E;const l=Zt[u];if(!n&&(l!=null&&l.earlySparseMeasures)&&a<l.earlySparseMeasures&&s()<.3)return;if(i.gradualBuild&&e>=8){const S=a/Math.max(1,e-1),x=Math.min(.35,6/Math.max(1,e)),C=Math.min(.7,14/Math.max(1,e));if(S<x){if(s()<.75)return}else if(S<C&&s()<.35)return}const c=i.breakInsertion?2:4,d=c>0&&e>=c&&(a+1)%c===0,h=n||d;let p=J.filter(S=>h?S.type==="fill":S.type==="beat");const g=p.filter(S=>S.length_beats<=y);if(g.length&&(p=g),t.length){const S=p.filter(x=>{const C=x.tags;return C?t.every(ge=>C.includes(ge)):!1});S.length&&(p=S)}p.length||(p=J.filter(S=>h?S.type==="fill":S.type==="beat")),p.length||(p=J);const f=i.percussiveLayering&&i.syncopationBias&&i.breakInsertion&&!i.loopCentric,v=i.atmosPad&&i.loopCentric&&i.harmonicStatic,m=i.loopCentric&&i.textureFocus&&i.percussiveLayering;if(h?(R=l==null?void 0:l.preferFillTags)!=null&&R.length&&(p=b(p,l.preferFillTags,.25)):(i.loopCentric&&(p=b(p,["loop_safe"])),i.syncopationBias&&(p=b(p,f?["breakbeat","syncopation","grid16"]:["syncopation"])),i.textureFocus&&(p=b(p,["texture_loop","straight","grid16"])),i.percussiveLayering&&(p=b(p,f?["breakbeat","percussive_layer","grid16"]:["percussive_layer","four_on_floor"])),v&&(p=b(p,["lofi","rest_heavy","swing_hint"],.3)),m&&(p=b(p,["loop_safe","grid16","texture_loop"],.25)),(M=l==null?void 0:l.preferBeatTags)!=null&&M.length&&(p=b(p,l.preferBeatTags,.25))),f&&(p=b(p,["breakbeat","grid16"],.2)),(E=l==null?void 0:l.avoidTags)!=null&&E.length){const S=p.filter(x=>{const C=x.tags;return C?!l.avoidTags.some(ge=>C.includes(ge)):!0});S.length&&(p=S)}const _=I(p,o);return K(_,s,r)}function I(a,e){if(!a.length)return a;const t=a.filter(s=>s.id?!e.has(s.id):!0);return t.length?t:a}function Q(a,e){if(!e.length)return a;const t=[...e].sort();return`${a}:${t.join("|")}`}function ka(a,e){const t=(a??q)+e>>>0;return X(t)}function Ye(a,e,t,s,r){if(a>=1)return!0;if(s.gradualBuild){const o=e/Math.max(1,t-1),n=Math.min(1,a+o*.3);return r()<n}return r()<a}function Na(a,e,t,s,r,o,n=0){var c;const i=(c=r.steps)!=null&&c.length?r.steps:se,u=[],l=s??t;for(let d=0;d<i.length;d++){const h=e+d*.5,p=Ue(i[d],t,l,o);p!==null&&u.push({channelRole:"bass",startBeat:h,durationBeats:.5,degree:0,velocity:qe(a,d),sectionId:a.id,midiOverride:p})}return u}function La(a,e,t,s,r,o){const n=[],i=o.styleIntent,u=r.seed??q,l=ka(u,s),c=new Set,d=new Map,p=40+t*12;for(const g of o.sections){const f=g.startMeasure*y;for(let v=0;v<g.measures;v++){if(!Ye(e,v,g.measures,i,l))continue;const m=f+v*y,_=Ge(g,v,l,c,d,i,a==="bassAlt"?{enforceDroneStatic:!1,preferredTags:["drone","accent"]}:void 0),M=B(o,m),R=B(o,m+y),E=Na(g,m,M,R,_,p,t);n.push(...E)}}return n}function wa(a,e,t,s){const r=X(s),o=[];for(const n of t.sections){const i=n.startMeasure*y;for(let u=0;u<n.measures;u++){if(!Ye(a,u,n.measures,t.styleIntent,r))continue;const l=i+u*y,c=u%2===0?1:5;o.push({channelRole:"accompaniment",startBeat:l,durationBeats:y,degree:c,velocity:A.PAD_MIN,sectionId:n.id})}}return o}const Ga=42,qa=.5,Ua=.015,Va=.12,We=1/16,Ya={K:{mode:"long",spec:"long_period",periodIndex:3,releaseRange:[.045,.075],velocity:D.KICK,amplitude:1},T:{mode:"long",spec:"long_period",periodIndex:5,releaseRange:[.05,.09],velocity:D.TOM,amplitude:.92},N:{mode:"long",spec:"long_period",periodIndex:8,releaseRange:[.06,.1],velocity:D.LOW_NOISE,amplitude:.88},S:{mode:"short",spec:"short_period",periodIndex:1,releaseRange:[.02,.045],velocity:D.SNARE,amplitude:.9},H:{mode:"short",spec:"short_period",periodIndex:0,releaseRange:[.015,.03],velocity:D.HIHAT,amplitude:.86},O:{mode:"short",spec:"short_period",periodIndex:2,releaseRange:[.03,.055],velocity:D.OPEN_HAT,amplitude:.94}},Wa=5,ja=.06;function za(a){let e=a;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function oe(a,e,t,s){let r=1;const o=e==="bass"||e==="bassAlt",n=a==="square1"||a==="square2";o&&(r*=w.BASS_BASE,t<It.BASS_LOW_RANGE&&(r*=w.BASS_LOW_RANGE)),a==="triangle"&&(r*=w.TRIANGLE_BASE,o||(r*=w.TRIANGLE_NON_BASS)),n&&o&&(r*=w.SQUARE_BASS);const i=Math.round(s*r);return Math.max(Te.MIN,Math.min(Te.MAX_ACCENT,i))}function $a(a,e){const t={reverseProbability:.5,sustainProbability:.2,densityThresholds:{sparse:.45,normal:.85}};return a.textureFocus&&(t.reverseProbability=.35,t.sustainProbability=.12,t.densityThresholds={sparse:.3,normal:.7}),a.loopCentric&&(t.sustainProbability=Math.min(.35,t.sustainProbability+.1),t.densityThresholds={sparse:Math.min(.5,t.densityThresholds.sparse+.05),normal:Math.min(.95,t.densityThresholds.normal+.05)}),e==="arpeggio"&&a.gradualBuild&&(t.densityThresholds={sparse:.25,normal:.65}),t}function Ja(a,e,t,s,r){const o=Math.abs(e.midi-a.midi),n=e.startBeat-(a.startBeat+t),i=o>0&&o<=Wa,u=n>=-.001&&n<=.5,l=t>=.5;if(!i||!u||!l)return!1;let c=.15;return s.atmosPad?c=.4:s.loopCentric&&s.textureFocus?c=.35:s.gradualBuild&&s.breakInsertion&&(c=.25),r()<c}function Xa(a,e,t){let s=a;return e==="slow"?s+=.02:e==="fast"&&(s-=.015),t>=4&&(s+=.01),Math.max(.02,Math.min(.12,s))}function Qa(a,e){if(!a)return!1;const t=`${a}|${e}`;return t==="H|H"||t==="H|O"||t==="O|H"}function Za(a,e,t){const s=(a==null?void 0:a.releaseRange)??[Ua,Va],r=s[0]+t()*Math.max(0,s[1]-s[0]);return e.percussiveLayering?Math.max(s[0],r*.85):e.gradualBuild?Math.min(s[1],r*1.05):r}function es(a){const e=a.length>0?a:[0,4,7],t=[];for(let s=0;s<4;s++){const r=e[s%e.length],o=Math.floor(s/e.length)*12;t.push(r+o)}return t}function ts(a,e,t){return a()<t?[...e].reverse():e}function as(a,e,t,s,r){const o=$a(s,r),n=Math.max(A.PAD_MIN,Math.round(a.velocity*A.ARPEGGIO_SCALE));if(t()<o.sustainProbability){const h=L(a.midi,e,a.midi);return[{...a,startBeat:a.startBeat,durationBeats:Math.max(a.durationBeats,1),velocity:n,midi:h}]}const i=ts(t,es(te(e)),o.reverseProbability),u=t();let l;u<o.densityThresholds.sparse?l=2:u<o.densityThresholds.normal?l=4:l=1;const c=l===4?.25:l===2?.5:Math.max(a.durationBeats,1),d=[];for(let h=0;h<l;h++){const p=a.startBeat+c*h,g=i[h%i.length],f=P(a.midi+g,e),v=L(f,e,a.midi);d.push({channelRole:"accompaniment",startBeat:p,durationBeats:c,degree:a.degree,velocity:n,sectionId:a.sectionId,midi:v})}return d}function ss(a){const e=[];for(const t of a){const s=[0,.5];for(const r of s)e.push({...t,startBeat:t.startBeat+r,durationBeats:.5,velocity:Math.max(A.PAD_MIN,Math.round(t.velocity*A.BROKEN_SCALE))})}return e}function rs(a){return a.map(e=>({...e,durationBeats:e.durationBeats>=1?e.durationBeats:1,velocity:Math.max(A.PAD_MIN,Math.round(e.velocity*A.STEADY_SCALE))}))}function ns(a,e,t){return{rng:za(a.seed??Ga),sectionById:new Map(e.sections.map(s=>[s.id,s])),totalBeats:(a.lengthInMeasures??32)*y,styleIntent:e.styleIntent,tempoSetting:a.tempo??"medium",phase1:e,phase2:t}}function os(a,e,t){const s=[],r=e.channel;for(let o=0;o<a.notes.length;o++){const n=a.notes[o],i=t.sectionById.get(n.sectionId);i&&Math.max(0,Math.floor(n.startBeat/y)-i.startMeasure);const u={midi:n.midi,velocity:oe(r,e.role,n.midi,n.velocity)},l=a.notes[o+1];if(l&&Ja(n,l,n.durationBeats,t.styleIntent,t.rng)){const c=Math.abs(l.midi-n.midi);u.slide={targetMidi:l.midi,durationSeconds:Xa(ja,t.tempoSetting,c)}}ie(s,n.startBeat,n.durationBeats,r,u,t.totalBeats)}return s}function is(a,e,t){const s=[],r=e.channel;for(const o of a.notes)ie(s,o.startBeat,o.durationBeats,r,{midi:o.midi,velocity:oe(r,e.role,o.midi,o.velocity)},t.totalBeats);return s}function ls(a,e,t){var i;const s=[],r=e.channel,o=new Map;for(const u of a.notes){const l=Math.floor(u.startBeat/y),c=o.get(l)??[];c.push(u),o.set(l,c)}const n=Array.from(o.keys()).sort((u,l)=>u-l);for(const u of n){const l=o.get(u),c=l.length?t.sectionById.get(l[0].sectionId):void 0,d=(c==null?void 0:c.texture)??"steady",h=B(t.phase1,((i=l[0])==null?void 0:i.startBeat)??u*y);let p;d==="arpeggio"?p=l.flatMap(m=>as(m,h,t.rng,t.styleIntent,c==null?void 0:c.texture)):d==="broken"?p=ss(l):p=rs(l);const g=[],f=[];for(const m of p)t.rng()<t.phase1.techniqueStrategy.echoProbability&&g.push({...m,startBeat:m.startBeat+.25,velocity:Math.round(m.velocity*xe.ECHO_SCALE)}),t.rng()<t.phase1.techniqueStrategy.detuneProbability&&f.push({...m,startBeat:m.startBeat,velocity:Math.round(m.velocity*xe.DETUNE_SCALE),midi:m.midi,detuneCents:12});const v=[...p,...g,...f].map(m=>{const _=B(t.phase1,m.startBeat),M=t.phase2.tracks.find(S=>S.role==="melody"),R=M?hs(m.startBeat,M.notes):void 0,E=L(m.midi,_,(R==null?void 0:R.midi)??m.midi);return{...m,midi:E}});for(const m of v)ie(s,m.startBeat,m.durationBeats,r,{midi:m.midi,velocity:oe(r,e.role,m.midi,m.velocity),detuneCents:m.detuneCents},t.totalBeats)}return s}function us(a,e){const t=[];let s=null,r=null,o=null;const n=[...a].sort((i,u)=>i.startBeat-u.startBeat);for(const i of n){let u=i.startBeat;const l=Ya[i.instrument];if(!l)continue;const c=Qa(o,i.instrument),d=c?0:We;r!==null&&u-r<=d&&(u=r+Math.max(d,We));const h=Za(l,e.styleIntent,e.rng),p=Math.max(.01,Math.min(h*.7,h)),g=Math.min(i.durationBeats,qa);if(u>=e.totalBeats)continue;if(s!==null&&u<s)if(c&&t.length>=2){const v=t[t.length-1];v.command==="noteOff"&&(v.beatTime=u),s=u}else t.pop(),t.pop(),s=null,r=null;t.push({beatTime:u,channel:"noise",command:"noteOn",data:{noiseMode:l.spec,mode:l.spec,velocity:l.velocity,amplitude:l.amplitude,releaseSeconds:h,decaySeconds:p,periodIndex:l.periodIndex,clockDivider:l.periodIndex}});const f=Math.min(u+g,e.totalBeats);t.push({beatTime:f,channel:"noise",command:"noteOff",data:{}}),s=f,r=u,o=i.instrument}return t}function ds(a,e,t){const s=e.role;return s==="melody"||s==="melodyAlt"?os(a,e,t):s==="bass"||s==="bassAlt"?is(a,e,t):s==="accompaniment"||s==="pad"?ls(a,e,t):[]}function cs(a,e,t){const s=ns(a,e,t),r=[];for(const i of t.tracks){const u=e.voiceArrangement.voices.find(c=>c.role===i.role);if(!u)continue;const l=ds(i,u,s);r.push(...l)}const o=us(t.drums,s);r.push(...o),r.sort((i,u)=>i.beatTime-u.beatTime);const n=ps(r);return{events:r,diagnostics:n}}function ie(a,e,t,s,r,o,n={}){if(e>=o)return;a.push({beatTime:e,channel:s,command:"noteOn",data:r});const i=Math.min(e+t,o);a.push({beatTime:i,channel:s,command:"noteOff",data:n})}function ps(a){const e=new Map,t={voiceAllocation:[]};for(const s of a){e.has(s.channel)||e.set(s.channel,0);const r=e.get(s.channel);s.command==="noteOn"?e.set(s.channel,r+1):s.command==="noteOff"&&r>0&&e.set(s.channel,r-1),t.voiceAllocation.push({beatTime:s.beatTime,channel:s.channel,activeCount:e.get(s.channel)})}return t}function hs(a,e){return e.find(t=>a>=t.startBeat&&a<t.startBeat+t.durationBeats)}const le={initialParams:[{channel:"square1",param:"duty",value:.25},{channel:"square2",param:"duty",value:.5}],dutySweeps:[{id:"DS_MEASURE_BOUNDARY_SWEEP",param:"duty",channels:["square1","square2"],minDurationBeats:1.5,requireMeasureBoundary:!0,steps:[.5,.75,.25]},{id:"DS_MINIMAL_LOW_PASS_THUMP",param:"duty",channels:["square1","square2"],minDurationBeats:2,requireMeasureBoundary:!0,steps:[.18,.38,.24]},{id:"DS_PROGRESSIVE_FILTER_RISE",param:"duty",channels:["square2"],minDurationBeats:4,steps:[.28,.46,.62,.76]},{id:"DS_PROGRESSIVE_PULSE_SQ1",param:"duty",channels:["square1"],minDurationBeats:3,steps:[.22,.4,.56]}],gainProfiles:[{id:"GP_TRIANGLE_MEASURE_ACCENT",channel:"triangle",param:"gain",measureBoundaryValue:.9,defaultValue:.7},{id:"GP_NOISE_BREAK_SPILL",channel:"noise",param:"gain",measureBoundaryValue:.82,defaultValue:.7},{id:"GP_MINIMAL_BASS_SIDECHAIN",channel:"square2",param:"gain",measureBoundaryValue:.68,defaultValue:.56},{id:"GP_MINIMAL_PERC_FADE",channel:"noise",param:"gain",measureBoundaryValue:.7,defaultValue:.58},{id:"GP_PROGRESSIVE_PAD_SWELL",channel:"triangle",param:"gain",measureBoundaryValue:.88,defaultValue:.74},{id:"GP_PROGRESSIVE_SQUARE_GLIDE",channel:"square1",param:"gain",measureBoundaryValue:.8,defaultValue:.66}]},gs={square1:{base:.68,peak:.9},square2:{base:.66,peak:.88},triangle:{base:.48,peak:.68},noise:{base:.74,peak:.82}};function fs(a,e){const t=[],s=a.events.reduce((l,c)=>Math.max(l,c.beatTime),0),r=Math.max(1,Math.ceil(s/y));for(const l of le.initialParams??[])t.push({beatTime:0,channel:l.channel,command:"setParam",data:{param:l.param,value:l.value}});const o=[...le.dutySweeps??[]],n=[...le.gainProfiles??[]];e.filterMotion&&o.push({id:"STYLE_FILTER_SWELL",param:"duty",channels:["square1","square2"],minDurationBeats:2,steps:[.2,.6,.4,.75]}),e.percussiveLayering&&n.push({id:"STYLE_NOISE_PUNCH",channel:"noise",param:"gain",measureBoundaryValue:.85,defaultValue:.78}),e.percussiveLayering&&!e.breakInsertion&&n.push({id:"STYLE_MINIMAL_SIDECHAIN_SQ1",channel:"square1",param:"gain",measureBoundaryValue:.74,defaultValue:.62},{id:"STYLE_MINIMAL_SIDECHAIN_SQ2",channel:"square2",param:"gain",measureBoundaryValue:.72,defaultValue:.6}),e.atmosPad&&n.push({id:"STYLE_TRIANGLE_PAD",channel:"triangle",param:"gain",measureBoundaryValue:.82,defaultValue:.72}),e.gradualBuild&&e.breakInsertion&&o.push({id:"STYLE_PROGRESSIVE_DUTY_SWELL",param:"duty",channels:["square2"],minDurationBeats:1,steps:[.32,.48,.58,.68]}),e.gradualBuild&&e.breakInsertion&&n.push({id:"STYLE_PROGRESSIVE_TRI_RISE",channel:"triangle",param:"gain",measureBoundaryValue:.9,defaultValue:.76});const i=new Set;for(const l of a.events){if(l.command!=="noteOn")continue;const c=vs(a.events,l),d=c?c.beatTime-l.beatTime:0;for(const h of o){if(!h.channels.includes(l.channel)||!c||d<h.minDurationBeats||h.requireMeasureBoundary&&!(ue(l.beatTime)||(c?ue(c.beatTime):!1)))continue;const p=d/(h.steps.length+1);h.steps.forEach((g,f)=>{t.push({beatTime:l.beatTime+p*(f+1),channel:l.channel,command:"setParam",data:{param:h.param,value:g}})})}for(const h of n){if(l.channel!==h.channel)continue;const p=ue(l.beatTime)?h.measureBoundaryValue:h.defaultValue;t.push({beatTime:l.beatTime,channel:l.channel,command:"setParam",data:{param:h.param,value:p}})}if(e.breakInsertion&&l.channel==="noise"){const h=Math.floor(l.beatTime/y);if(!i.has(h)&&h>0&&(h+1)%8===0){i.add(h);const p=h*y;t.push({beatTime:p-.25>=0?p-.25:p,channel:"noise",command:"setParam",data:{param:"gain",value:.45}}),t.push({beatTime:p+1,channel:"noise",command:"setParam",data:{param:"gain",value:.78}});for(const g of["square1","square2"])t.push({beatTime:p-.25>=0?p-.25:p,channel:g,command:"setParam",data:{param:"gain",value:.55}}),t.push({beatTime:p+1,channel:g,command:"setParam",data:{param:"gain",value:.82}})}}}if(e.gradualBuild&&r>1){const l=Math.max(1,Math.floor(r/8));for(const[c,d]of Object.entries(gs)){const h=c;for(let p=0;p<r;p+=l){const g=r>1?p/(r-1):1,f=Math.pow(g,e.loopCentric?.8:1),v=d.base+(d.peak-d.base)*f;t.push({beatTime:p*y,channel:h,command:"setParam",data:{param:"gain",value:Number(v.toFixed(3))}})}}}const u=[...a.events,...t];return u.sort((l,c)=>l.beatTime===c.beatTime?l.command===c.command?0:l.command==="setParam"?-1:c.command==="setParam"?1:0:l.beatTime-c.beatTime),{events:u}}function vs(a,e){if(e.command!=="noteOn")return;let t,s=1/0;for(const r of a)if(r.channel===e.channel&&r.command==="noteOff"&&r.beatTime>e.beatTime){const o=r.beatTime-e.beatTime;o<s&&(s=o,t=r)}return t}function ue(a){return Math.abs(a%y)<1e-6}function ms(a,e,t,s,r){const o=60/a.bpm,n=e.map(u=>({time:u.beatTime*o,channel:u.channel,command:u.command,data:u.data}));n.sort((u,l)=>u.time-l.time);const i={voiceAllocation:t.voiceAllocation.map(u=>({time:u.beatTime*o,channel:u.channel,activeCount:u.activeCount})),loopWindow:_s(n),motifUsage:s,sectionMotifPlan:r};return{events:n,diagnostics:i}}function _s(a){if(!a.length)return{head:[],tail:[]};const e=.1,t=a[a.length-1].time,s=a.filter(o=>t-o.time<e);return{head:a.filter(o=>o.time<e),tail:s}}function ys(a){return{percussiveMelodic:Math.max(-1,Math.min(1,a.percussiveMelodic)),calmEnergetic:Math.max(-1,Math.min(1,a.calmEnergetic))}}function Ms(a){const{percussiveMelodic:e,calmEnergetic:t}=a,s=Math.max(0,-e),r=Math.max(0,e),o=Math.max(0,-t),n=Math.max(0,t);return{percussiveLayering:s>.3,syncopationBias:s>.4,breakInsertion:s>.35&&n>.4,harmonicStatic:r>.4&&o>.3||s>.3&&o>.2,atmosPad:r>.3||o>.5||n>.55,filterMotion:r>.3||n>.5,loopCentric:o>.3,textureFocus:o>.4||s>.5&&o>.2,gradualBuild:n>.4}}function bs(a){return a.calmEnergetic<-.4?"slow":a.calmEnergetic>.4?"fast":"medium"}function Ss(a){const{percussiveMelodic:e,calmEnergetic:t}=a;let s="medium";t>.4&&(s="high"),t<-.4&&(s="low");let r="upbeat";return t<=-.5?r="peaceful":e<=-.4?r="tense":e>=.4?r="sad":t>=.4&&(r="upbeat"),{energy:s,mood:r}}const Rs={"minimal-techno":{percussiveMelodic:-.4,calmEnergetic:-.3},"progressive-house":{percussiveMelodic:-.45,calmEnergetic:.6},"retro-loopwave":{percussiveMelodic:.3,calmEnergetic:-.2},"breakbeat-jungle":{percussiveMelodic:-.7,calmEnergetic:.7},"lofi-chillhop":{percussiveMelodic:.5,calmEnergetic:-.6}},de=["textureFocus","loopCentric","gradualBuild","harmonicStatic","percussiveLayering","breakInsertion","filterMotion","syncopationBias","atmosPad"],Es={textureFocus:!1,loopCentric:!1,gradualBuild:!1,harmonicStatic:!1,percussiveLayering:!1,breakInsertion:!1,filterMotion:!1,syncopationBias:!1,atmosPad:!1},Ps={"minimal-techno":"minimalTechno","progressive-house":"progressiveHouse","retro-loopwave":"retroLoopwave","breakbeat-jungle":"breakbeatJungle","lofi-chillhop":"lofiChillhop"},Bs=.35,Ts={percussiveMelodic:0,calmEnergetic:0};function Os(a){let e=a>>>0;return e===0&&(e=1),()=>(e=e*1664525+1013904223>>>0,e/4294967295)}function As(a,e,t){const s={...Es};for(const r of de){const o=a[r];typeof o=="boolean"?s[r]=o:t&&e?s[r]=e()>=.5:s[r]=!1}return s}function xs(a,e){const t={...a.intent};if(e.intent)for(const s of de){const r=e.intent[s];typeof r=="boolean"&&(t[s]=r)}return{tempo:e.tempo??a.tempo,intent:t,randomizeUnsetIntent:e.randomizeUnsetIntent??a.randomizeUnsetIntent}}function Hs(a){let e,t=Number.POSITIVE_INFINITY;for(const[s,r]of Object.entries(Rs)){const o=Math.hypot(a.percussiveMelodic-r.percussiveMelodic,a.calmEnergetic-r.calmEnergetic);o<t&&(t=o,e=s)}if(!(!e||t>Bs))return Ps[e]??void 0}function Ks(a){var v;const e=typeof a.lengthInMeasures=="number"&&a.lengthInMeasures>0?Math.trunc(a.lengthInMeasures):32,t=typeof a.seed=="number"&&Number.isFinite(a.seed)?Math.trunc(a.seed):Math.floor(Math.random()*4294967295),s=a.twoAxisStyle??Ts,r=ys(s);let o=Ms(r);if((v=a.overrides)!=null&&v.intent)for(const m of de){const _=a.overrides.intent[m];typeof _=="boolean"&&(o[m]=_)}const n=bs(r),i=Ss(r),u=i.mood;let l={tempo:n,intent:o,randomizeUnsetIntent:!1};a.overrides&&(l=xs(l,a.overrides));const c=l.randomizeUnsetIntent??!1,d=c?Os(t):null,h=As(l.intent,d,c);l={...l,intent:h,randomizeUnsetIntent:c};const p={mood:u,tempo:l.tempo??"medium",lengthInMeasures:e,seed:t,stylePreset:Hs(r),styleOverrides:h},g={...l,tags:{mood:i.mood,energy:i.energy},twoAxisStyle:{...r}},f={lengthInMeasures:e,seed:t,twoAxisStyle:{...r}};return a.overrides&&(f.overrides=JSON.parse(JSON.stringify(a.overrides))),{pipeline:p,profile:g,replayOptions:f}}function je(a){const{pipeline:e,profile:t,replayOptions:s}=Is(a),r=Et(e),o=Ca(e,r),n=cs(e,r,o),i=fs(n,r.styleIntent),u=ms(r,i.events,n.diagnostics,o.motifUsage,o.sectionMotifPlan),c=e.lengthInMeasures*4,d=c/r.bpm*60;return{events:u.events,diagnostics:u.diagnostics,meta:{bpm:r.bpm,key:r.key,seed:e.seed,mood:e.mood,tempo:e.tempo,lengthInMeasures:e.lengthInMeasures,styleIntent:r.styleIntent,voiceArrangement:r.voiceArrangement,profile:t,replayOptions:s,loopInfo:{loopStartBeat:0,loopEndBeat:c,loopStartTime:0,loopEndTime:d,totalBeats:c,totalDuration:d}}}}async function Fs(a){return je(a)}function Is(a){return Ks(a)}const Cs={templates:[{id:"SE_JUMP_01",type:"jump",description:"",channels:["square1"],durationRange:[.12,.25],channelParams:{square1:{pitchStart:{min:50,max:62},pitchEnd:{min:72,max:84},dutyCycle:[.25,.5],velocityRange:[96,122]}},pitchSweep:{enabled:!0,curveOptions:["linear","exponential"],durationRange:[.14,.26]}},{id:"SE_JUMP_02",type:"jump",description:"",channels:["square2"],durationRange:[.15,.3],channelParams:{square2:{pitchStart:{min:40,max:52},pitchEnd:{min:64,max:76},dutyCycle:[.5],velocityRange:[94,120]}},pitchSweep:{enabled:!0,curveOptions:["linear","exponential"],durationRange:[.16,.32]}},{id:"SE_COIN_01",type:"coin",description:"2",channels:["square1"],durationRange:[.18,.24],channelParams:{square1:{pitchStart:{min:72,max:84},dutyCycle:[.5],velocityRange:[102,124]}},noteSequence:{intervals:[0,4],noteDurations:[.04,.16]}},{id:"SE_COIN_02",type:"coin",description:"3",channels:["square1"],durationRange:[.2,.28],channelParams:{square1:{pitchStart:{min:76,max:84},dutyCycle:[.5]}},noteSequence:{intervals:[0,4,12],noteDurations:[.04,.04,.16]}},{id:"SE_EXPLOSION_01",type:"explosion",description:" + ",channels:["noise","triangle"],durationRange:[.8,1.2],channelParams:{noise:{noiseMode:"long",envelope:"percussive",velocityRange:[92,120],releaseRange:[.5,.8]},triangle:{pitchStart:{min:36,max:43},pitchEnd:{min:24,max:31}}},pitchSweep:{enabled:!0,curveType:"linear"}},{id:"SE_EXPLOSION_02",type:"explosion",description:"",channels:["noise"],durationRange:[.4,.6],channelParams:{noise:{noiseMode:"short",envelope:"percussive",velocityRange:[90,118],releaseRange:[.22,.4]}}},{id:"SE_HIT_01",type:"hit",description:"",channels:["square1"],durationRange:[.08,.12],channelParams:{square1:{pitchStart:{min:60,max:72},dutyCycle:[.125],envelope:"percussive",velocityRange:[100,126]}},noteSequence:{intervals:[0,-2,-5],noteDurations:[.03,.03,.03]}},{id:"SE_HIT_02",type:"hit",description:" + ",channels:["square1","noise"],durationRange:[.1,.15],channelParams:{square1:{pitchStart:{min:48,max:60},dutyCycle:[.125],velocityRange:[96,120]},noise:{noiseMode:"short",envelope:"percussive",velocityRange:[94,120],releaseRange:[.12,.2]}}},{id:"SE_POWERUP_01",type:"powerup",description:"",channels:["square1"],durationRange:[.33,.46],channelParams:{square1:{pitchStart:{min:60,max:67},dutyCycle:[.5]}},noteSequence:{intervals:[0,4,7,12],noteDurations:[.08,.08,.08,.13]}},{id:"SE_POWERUP_02",type:"powerup",description:"5",channels:["square2"],durationRange:[.4,.52],channelParams:{square2:{pitchStart:{min:64,max:72},dutyCycle:[.25]}},noteSequence:{intervals:[0,4,7,12,16],noteDurations:[.07,.07,.07,.07,.16]}},{id:"SE_SELECT_01",type:"select",description:"",channels:["square1"],durationRange:[.05,.08],channelParams:{square1:{pitchStart:{min:72,max:84},dutyCycle:[.25]}}},{id:"SE_SELECT_02",type:"select",description:"2",channels:["square1"],durationRange:[.06,.1],channelParams:{square1:{pitchStart:{min:72,max:84},dutyCycle:[.5]}},noteSequence:{intervals:[0,4],noteDurations:[.03,.04]}},{id:"SE_LASER_01",type:"laser",description:"",channels:["square1"],durationRange:[.1,.15],channelParams:{square1:{pitchStart:{min:72,max:84},pitchEnd:{min:48,max:60},dutyCycle:[.125,.25]}},pitchSweep:{enabled:!0,curveType:"exponential"}},{id:"SE_LASER_02",type:"laser",description:"",channels:["square2"],durationRange:[.12,.2],channelParams:{square2:{pitchStart:{min:76,max:88},pitchEnd:{min:52,max:64},dutyCycle:[.125]}},pitchSweep:{enabled:!0,curveType:"linear"}},{id:"SE_CLICK_01",type:"click",description:"",channels:["square1"],durationRange:[.02,.03],channelParams:{square1:{pitchStart:{min:84,max:96},dutyCycle:[.125],envelope:"percussive"}}},{id:"SE_CLICK_02",type:"click",description:"",channels:["square1"],durationRange:[.03,.04],channelParams:{square1:{pitchStart:{min:88,max:100},dutyCycle:[.125],envelope:"percussive"}}},{id:"SE_SYNTH_01",type:"synth",description:"",channels:["square1"],durationRange:[.15,.3],channelParams:{square1:{pitchStart:{min:48,max:72},dutyCycle:[.125,.25,.5]}}},{id:"SE_SYNTH_02",type:"synth",description:"",channels:["triangle"],durationRange:[.2,.4],channelParams:{triangle:{pitchStart:{min:60,max:84}}}},{id:"SE_TONE_01",type:"tone",description:"",channels:["square1"],durationRange:[.1,.2],channelParams:{square1:{pitchStart:{min:60,max:72},dutyCycle:[.5]}}},{id:"SE_TONE_02",type:"tone",description:"",channels:["triangle"],durationRange:[.12,.3],channelParams:{triangle:{pitchStart:{min:60,max:72}}}}]};function Ds(){return Cs.templates}function ks(a){let e=a>>>0;return e===0&&(e=1),()=>(e=e*1664525+1013904223>>>0,e/4294967295)}class Ns{constructor(){this.templates=Ds()}generateSE(e){const t=e.seed??Math.floor(Math.random()*1e9),s=ks(t),r=this.selectTemplate(e,s),o=this.concretizeParameters(r,s,e.baseFrequency),n=this.generateEvents(r,o,e.startTime??0),i={type:e.type,seed:t,startTime:e.startTime??0};return e.templateId&&(i.templateId=e.templateId),e.baseFrequency!==void 0&&(i.baseFrequency=e.baseFrequency),{events:n,meta:{type:e.type,templateId:r.id,seed:t,duration:o.duration,channels:r.channels,replayOptions:i}}}selectTemplate(e,t){if(e.templateId){const r=this.templates.find(o=>o.id===e.templateId);if(!r)throw new Error(`Template not found: ${e.templateId}`);return r}const s=this.templates.filter(r=>r.type===e.type);if(s.length===0)throw new Error(`No templates found for type: ${e.type}`);return s[Math.floor(t()*s.length)]}concretizeParameters(e,t,s){var l;const[r,o]=e.durationRange,n=r+t()*(o-r),i={};let u=0;s!==void 0&&(u=this.calculatePitchShift(e,s));for(const c of e.channels){const d=e.channelParams[c];if(!d)continue;const h=d.velocityRange?d.velocityRange:c==="noise"?[88,118]:[96,122],p=Math.round(Math.max(1,Math.min(127,this.sampleFloatRange(h,t)))),g=d.pitchStart?this.samplePitchRange(d.pitchStart,t):void 0,f=d.pitchEnd?this.samplePitchRange(d.pitchEnd,t):void 0;if(i[c]={pitchStart:g!==void 0?this.clampMidi(g+u):void 0,pitchEnd:f!==void 0?this.clampMidi(f+u):void 0,dutyCycle:d.dutyCycleRange?this.sampleFloatRange([d.dutyCycleRange.min,d.dutyCycleRange.max],t):d.dutyCycle?d.dutyCycle[Math.floor(t()*d.dutyCycle.length)]:void 0,noiseMode:d.noiseMode,envelope:d.envelope,velocity:p,releaseSeconds:d.releaseRange?this.sampleFloatRange(d.releaseRange,t):void 0},(l=e.pitchSweep)!=null&&l.enabled){const v=e.pitchSweep.curveOptions??(e.pitchSweep.curveType?[e.pitchSweep.curveType]:void 0);v&&(i[c].sweepCurve=this.weightedChoice(v,e.pitchSweep.curveWeights,t)??e.pitchSweep.curveType),e.pitchSweep.durationRange&&(i[c].sweepDuration=this.sampleFloatRange(e.pitchSweep.durationRange,t))}}return{duration:n,channelParams:i}}samplePitchRange(e,t){return Math.floor(e.min+t()*(e.max-e.min+1))}sampleFloatRange(e,t){return e[0]+t()*(e[1]-e[0])}weightedChoice(e,t,s){if(!t)return e[Math.floor(s()*e.length)];const r=e.reduce((n,i)=>n+(t[String(i)]||1),0);let o=s()*r;for(const n of e){const i=t[String(n)]||1;if(o<i)return n;o-=i}return e[e.length-1]}generateEvents(e,t,s){const r=[];for(const o of e.channels){const n=t.channelParams[o],i=this.generateChannelEvents(o,e,n,t,s);r.push(...i)}return r.sort((o,n)=>o.time-n.time),r}generateChannelEvents(e,t,s,r,o){return e.startsWith("square")?this.generateSquareEvents(e,t,s,r,o):e==="triangle"?this.generateTriangleEvents(e,t,s,r,o):e==="noise"?this.generateNoiseEvents(t,s,r,o):[]}generateSquareEvents(e,t,s,r,o){var i;const n=[];return s.dutyCycle!==void 0&&n.push({time:o,channel:e,command:"setParam",data:{param:"duty",value:s.dutyCycle}}),t.noteSequence?n.push(...this.generateNoteSequence(e,t,s,o)):(i=t.pitchSweep)!=null&&i.enabled?n.push(...this.generatePitchSweep(e,t,s,r,o)):s.pitchStart!==void 0&&n.push(...this.generateSimpleNote(e,s,r.duration,o)),n}generateTriangleEvents(e,t,s,r,o){var i;const n=[];return t.noteSequence?n.push(...this.generateNoteSequence(e,t,s,o)):(i=t.pitchSweep)!=null&&i.enabled?n.push(...this.generatePitchSweep(e,t,s,r,o)):s.pitchStart!==void 0&&n.push(...this.generateSimpleNote(e,s,r.duration,o)),n}generateNoiseEvents(e,t,s,r){const o=[],n="noise";t.noiseMode&&o.push({time:r,channel:n,command:"setParam",data:{param:"noiseMode",value:t.noiseMode}});const i=t.velocity??110,u=t.releaseSeconds??s.duration*.3,l={velocity:i};return t.noiseMode&&(l.noiseMode=t.noiseMode),t.envelope==="percussive"?(l.decaySeconds=s.duration*.7,l.releaseSeconds=u):t.releaseSeconds&&(l.releaseSeconds=u),o.push({time:r,channel:n,command:"noteOn",data:l}),o.push({time:r+s.duration,channel:n,command:"noteOff",data:{}}),o}generateNoteSequence(e,t,s,r){const o=[];if(!t.noteSequence)return o;let n=r;const i=s.pitchStart,u=s.velocity??110;for(let l=0;l<t.noteSequence.intervals.length;l++){const c=i+t.noteSequence.intervals[l],d=t.noteSequence.noteDurations[l];o.push({time:n,channel:e,command:"noteOn",data:{midi:c,velocity:u}}),o.push({time:n+d,channel:e,command:"noteOff",data:{}}),n+=d}return o}generatePitchSweep(e,t,s,r,o){var c;const n=[];if(!((c=t.pitchSweep)!=null&&c.enabled))return n;const i=s.sweepDuration??r.duration,u=s.sweepCurve??t.pitchSweep.curveType??"exponential",l=s.velocity??110;return n.push({time:o,channel:e,command:"noteOn",data:{midi:s.pitchStart,velocity:l}}),n.push({time:o,channel:e,command:"setParam",data:{param:"pitchBend",value:s.pitchEnd,rampDuration:i,curve:u}}),n.push({time:o+i,channel:e,command:"noteOff",data:{}}),n}generateSimpleNote(e,t,s,r){const o=[],n=t.velocity??110,i=t.releaseSeconds;return o.push({time:r,channel:e,command:"noteOn",data:{midi:t.pitchStart,velocity:n}}),o.push({time:r+s,channel:e,command:"noteOff",data:i?{releaseSeconds:i}:{}}),o}calculatePitchShift(e,t){for(const s of e.channels){const r=e.channelParams[s];if(!(r!=null&&r.pitchStart))continue;const o=(r.pitchStart.min+r.pitchStart.max)/2,n=Ht(o),i=t/n,u=xt(i);return Math.round(u)}return 0}clampMidi(e){return Math.max(0,Math.min(127,Math.round(e)))}}const ze=.1,Ls=25,$e=.3,ws=1789773,ce=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068],Je={K:{mode:"long",periodIndex:14,baseAmplitude:.75,decaySeconds:.22,releaseSeconds:.04,cutoffHz:3200},S:{mode:"short",periodIndex:4,baseAmplitude:.65,decaySeconds:.14,releaseSeconds:.03,cutoffHz:5200},H:{mode:"short",periodIndex:1,baseAmplitude:.45,decaySeconds:.06,releaseSeconds:.02,cutoffHz:7800},O:{mode:"short",periodIndex:2,baseAmplitude:.6,decaySeconds:.4,releaseSeconds:.06,cutoffHz:6800},T:{mode:"long",periodIndex:10,baseAmplitude:.6,decaySeconds:.26,releaseSeconds:.05,cutoffHz:3600},default:{mode:"short",periodIndex:3,baseAmplitude:.6,decaySeconds:.14,releaseSeconds:.03,cutoffHz:6e3}},Gs=69,qs=440;function Z(a){return qs*Math.pow(2,(a-Gs)/12)}function Us(a,e=.85){return Math.max(0,Math.min(1,(a??100)/127*e))}class pe{constructor(e,t,s){this.context=e;const r=new AudioWorkletNode(e,t);r.connect(s),this.port=r.port,this.sampleRate=e.sampleRate}scheduleMessage(e,t){const s=Math.max(0,Math.round(t*this.sampleRate));this.port.postMessage({...e,sampleFrame:s})}stop(){this.port.postMessage({type:"clear"})}}class Xe extends pe{constructor(e,t){super(e,"square-processor",t),this.currentDuty=.5}noteOn(e,t){const s=e.detuneCents??0,r=Math.pow(2,s/1200),o={type:"noteOn",frequency:e.frequency*r,amplitude:e.amplitude??.8,duty:e.duty??this.currentDuty};e.slide&&(o.slide={targetFrequency:e.slide.targetFrequency,durationSamples:Math.round((e.slide.durationSeconds??0)*this.sampleRate)}),this.scheduleMessage(o,t)}noteOff(e,t){this.scheduleMessage({type:"noteOff"},t)}setParam(e,t){if(e.param==="duty"&&(this.currentDuty=Number(e.value??this.currentDuty)),e.param==="pitchBend"&&typeof e.value=="number"){const s=e.value>0?Z(e.value):0,r=Number(e.rampDuration??0),o=e.curve??"linear";this.scheduleMessage({type:"setParam",param:"pitchBend",value:s,rampDuration:r,curve:o},t);return}this.scheduleMessage({type:"setParam",param:e.param,value:e.value},t)}}class Vs extends pe{constructor(e,t){super(e,"triangle-processor",t)}noteOn(e,t){const s={type:"noteOn",frequency:e.frequency,amplitude:e.amplitude??.7};this.scheduleMessage(s,t)}noteOff(e,t){this.scheduleMessage({type:"noteOff"},t)}setParam(e,t){if(e.param==="pitchBend"&&typeof e.value=="number"){const s=e.value>0?Z(e.value):0,r=Number(e.rampDuration??0),o=e.curve??"linear";this.scheduleMessage({type:"setParam",param:"pitchBend",value:s,rampDuration:r,curve:o},t);return}this.scheduleMessage({type:"setParam",param:e.param,value:e.value},t)}}class Ys extends pe{constructor(e,t){super(e,"noise-processor",t),this.periodIndex=0,this.mode="short"}noteOn(e,t){const s=Math.max(0,Math.min(ce.length-1,e.periodIndex??this.periodIndex)),o=ce[s]*16/ws,n=Math.max(1,Math.round(o*this.sampleRate)),i=Math.max(.001,e.decaySeconds??.12),u=Math.max(.001,e.releaseSeconds??.03),l=Math.max(1,Math.round(i*this.sampleRate)),c=Math.max(1,Math.round(u*this.sampleRate)),d=Math.max(0,Math.min(1,e.amplitude??.6)),h=e.mode==="long"?"long":"short",p=Math.max(100,Math.min(this.sampleRate/2,e.cutoffHz??6e3));this.periodIndex=s,this.mode=h,this.scheduleMessage({type:"noteOn",mode:h,amplitude:d,periodSamples:n,decaySamples:l,releaseSamples:c,cutoffHz:p},t)}noteOff(e,t){const s=Math.max(.001,Number((e==null?void 0:e.releaseSeconds)??.03)),r=Math.max(1,Math.round(s*this.sampleRate));this.scheduleMessage({type:"noteOff",releaseSamples:r},t)}setParam(e,t){if(!(!e||!e.param)){if(e.param==="mode"&&typeof e.value=="string"&&(this.mode=e.value==="long"?"long":"short"),e.param==="periodIndex"){const s=Number(e.value??this.periodIndex);this.periodIndex=Math.max(0,Math.min(ce.length-1,s))}this.scheduleMessage({type:"setParam",param:e.param,value:e.value},t)}}}const U=class U{constructor(e,t={}){this.context=e,this.events=[],this.eventIndex=0,this.lookahead=ze,this.leadTime=$e,this.intervalHandle=null,this.startTime=0,this.lastEventTime=0,this.completionResolver=null,this.loopEnabled=!1,this.eventCallback=null,this.masterGainNode=e.createGain(),this.masterGainNode.gain.value=U.BASE_GAIN,this.masterGainNode.connect(e.destination),this.workletBasePath=t.workletBasePath??"./worklets/"}async init(){const e=this.context,t=this.workletBasePath,s=async r=>{const o=`${t}${r}`;try{await e.audioWorklet.addModule(o)}catch(n){const i=n instanceof Error?n.message:String(n);throw new Error(`Failed to load AudioWorklet "${r}" from "${o}". Verify that the processor file is hosted and workletBasePath is correct. Cause: ${i}`)}};await s("square-processor.js"),await s("triangle-processor.js"),await s("noise-processor.js"),this.channels={square1:new Xe(e,this.masterGainNode),square2:new Xe(e,this.masterGainNode),triangle:new Vs(e,this.masterGainNode),noise:new Ys(e,this.masterGainNode)}}get masterGain(){return this.masterGainNode}stop(){this.intervalHandle!==null&&(clearInterval(this.intervalHandle),this.intervalHandle=null),Object.values(this.channels).forEach(e=>e.stop()),this.completionResolver&&(this.completionResolver(),this.completionResolver=null)}play(e,t={}){return this.preparePlayback(e,t,!1),new Promise(s=>{this.completionResolver=s,this.startScheduler()})}playLoop(e,t={}){this.preparePlayback(e,t,!0),this.completionResolver=null,this.startScheduler()}preparePlayback(e,t,s){this.stop(),this.events=e??[],this.lookahead=t.lookahead??ze,this.leadTime=t.leadTime??$e,this.loopEnabled=s,this.eventCallback=t.onEvent??null;const r=t.volume??1;this.masterGainNode.gain.value=U.BASE_GAIN*r;const o=this.events.length?this.events[this.events.length-1].time:0;let n=Math.max(0,t.offset??0);n>0&&(s&&o>0?n=n%o:n=Math.min(n,o));const i=this.context.currentTime,u=t.startTime??i+this.leadTime;this.startTime=u-n,this.lastEventTime=o,this.eventIndex=this.resolveEventIndex(n)}startScheduler(){const e=()=>this.tick();this.intervalHandle=window.setInterval(e,Ls),e()}resolveEventIndex(e){if(e<=0)return 0;const t=.001;for(let s=0;s<this.events.length;s+=1)if(this.events[s].time+t>=e)return s;return this.events.length}tick(){const e=this.context.currentTime,t=e+this.lookahead;for(;this.eventIndex<this.events.length;){const s=this.events[this.eventIndex],r=this.startTime+s.time;if(r<=t)this.dispatchEvent(s,r),this.eventIndex+=1;else break}if(this.loopEnabled&&this.eventIndex>=this.events.length&&(this.startTime+=this.lastEventTime,this.eventIndex=0),!this.loopEnabled){const s=this.startTime+this.lastEventTime+1;this.eventIndex>=this.events.length&&e>=s&&this.stop()}}dispatchEvent(e,t){const s=e.data??{};switch(this.eventCallback&&this.eventCallback(e,t),e.channel){case"square1":case"square2":e.command==="noteOn"?this.channels[e.channel].noteOn(this.mapPitchData(s),t):e.command==="noteOff"?this.channels[e.channel].noteOff(s,t):e.command==="setParam"&&this.channels[e.channel].setParam(s,t);break;case"triangle":e.command==="noteOn"?this.channels.triangle.noteOn(this.mapPitchData(s),t):e.command==="noteOff"?this.channels.triangle.noteOff(s,t):e.command==="setParam"&&this.channels.triangle.setParam(s,t);break;case"noise":e.command==="noteOn"?this.channels.noise.noteOn(this.mapNoiseData(s),t):e.command==="noteOff"?this.channels.noise.noteOff(s,t):e.command==="setParam"&&this.channels.noise.setParam(s,t);break}}mapPitchData(e){const t=Number(e.midi??60),s=Number(e.detuneCents??0);let r=null;const o=e.slide;return o&&(typeof o.targetMidi=="number"?r={targetFrequency:Z(o.targetMidi),durationSeconds:Number(o.durationSeconds??0)}:typeof o.targetFrequency=="number"&&(r={targetFrequency:o.targetFrequency,durationSeconds:Number(o.durationSeconds??0)})),{frequency:Z(t),amplitude:Us(typeof e.velocity=="number"?e.velocity:void 0),duty:typeof e.duty=="number"?e.duty:void 0,detuneCents:s,slide:r}}mapNoiseData(e){const t=typeof e.velocity=="number"?e.velocity:100,s=Math.max(0,Math.min(1,t/127)),r=typeof e.instrument=="string"?e.instrument:"S",o=Je[r]??Je.default,n=Math.min(1,Math.max(0,(typeof e.amplitude=="number"?e.amplitude:o.baseAmplitude)*s)),i=typeof e.decaySeconds=="number"?e.decaySeconds:o.decaySeconds,u=typeof e.releaseSeconds=="number"?e.releaseSeconds:o.releaseSeconds,l=typeof e.periodIndex=="number"?e.periodIndex:typeof e.clockDivider=="number"?e.clockDivider:typeof e.period=="number"?e.period:o.periodIndex,c=typeof e.mode=="string"?e.mode:typeof e.noiseMode=="string"?e.noiseMode:o.mode,d=typeof e.cutoffHz=="number"?e.cutoffHz:o.cutoffHz;return{amplitude:n,decaySeconds:i,releaseSeconds:u,periodIndex:l,mode:c,cutoffHz:d}}};U.BASE_GAIN=.16;let he=U;T.AlgoChipSynthesizer=he,T.SEGenerator=Ns,T.generateComposition=Fs,T.runPipeline=je,Object.defineProperty(T,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=algo-chip.umd.js.map
